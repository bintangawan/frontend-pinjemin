/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ 4:
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var LandingPage = /*#__PURE__*/function (_HTMLElement) {
  function LandingPage() {
    var _this;
    _classCallCheck(this, LandingPage);
    _this = _callSuper(this, LandingPage);
    _defineProperty(_this, "openDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Show overlay
        drawerOverlay.classList.remove("hidden");
        // Force reflow before adding transform classes for smooth animation
        drawerOverlay.offsetHeight;

        // Slide in drawer
        mobileDrawer.classList.remove("-translate-x-full");

        // Prevent body scroll when drawer is open
        document.body.style.overflow = "hidden";
      }
    });
    _defineProperty(_this, "closeDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Slide out drawer
        mobileDrawer.classList.add("-translate-x-full");

        // Hide overlay after animation completes
        setTimeout(function () {
          drawerOverlay.classList.add("hidden");
        }, 300); // Match transition duration

        // Restore body scroll
        document.body.style.overflow = "";
      }
    });
    return _this;
  }
  _inherits(LandingPage, _HTMLElement);
  return _createClass(LandingPage, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
      this.setupMobileMenuToggle();
      this.setupScrollAnimations();
      this.setupFAQAccordion();

      // Add body padding to compensate for fixed header
      this.addBodyPadding();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      // Remove mobile menu listeners
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      if (mobileMenuButton && this._mobileMenuButtonHandler) {
        mobileMenuButton.removeEventListener("click", this._mobileMenuButtonHandler);
        this._mobileMenuButtonHandler = null;
      }

      // Remove drawer overlay listener
      if (this._drawerOverlayHandler) {
        document.removeEventListener("click", this._drawerOverlayHandler);
        this._drawerOverlayHandler = null;
      }

      // Remove body padding
      this.removeBodyPadding();
    }
  }, {
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }
  }, {
    key: "addBodyPadding",
    value: function addBodyPadding() {
      // Add padding-top to body to compensate for fixed header
      document.body.style.paddingTop = "80px"; // Adjust based on header height
    }
  }, {
    key: "removeBodyPadding",
    value: function removeBodyPadding() {
      // Remove padding when component is disconnected
      document.body.style.paddingTop = "";
    }
  }, {
    key: "setupScrollAnimations",
    value: function setupScrollAnimations() {
      var observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px"
      };
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add("animate-fade-in-up");
          }
        });
      }, observerOptions);

      // Observe all sections
      this.querySelectorAll(".animate-on-scroll").forEach(function (el) {
        observer.observe(el);
      });
    }
  }, {
    key: "setupFAQAccordion",
    value: function setupFAQAccordion() {
      var faqItems = this.querySelectorAll(".faq-item");
      faqItems.forEach(function (item) {
        var button = item.querySelector(".faq-button");
        var content = item.querySelector(".faq-content");
        var icon = item.querySelector(".faq-icon");
        button.addEventListener("click", function () {
          var isOpen = !content.classList.contains("hidden");

          // Close all other FAQ items
          faqItems.forEach(function (otherItem) {
            if (otherItem !== item) {
              otherItem.querySelector(".faq-content").classList.add("hidden");
              otherItem.querySelector(".faq-icon").style.transform = "rotate(0deg)";
            }
          });

          // Toggle current item
          if (isOpen) {
            content.classList.add("hidden");
            icon.style.transform = "rotate(0deg)";
          } else {
            content.classList.remove("hidden");
            icon.style.transform = "rotate(180deg)";
          }
        });
      });
    }

    // Mobile Menu Drawer Toggle
  }, {
    key: "setupMobileMenuToggle",
    value: function setupMobileMenuToggle() {
      var _this2 = this;
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      var mobileDrawer = this.querySelector("#mobile-drawer");
      var drawerOverlay = this.querySelector("#drawer-overlay");
      var closeDrawerButton = this.querySelector("#close-drawer-button");
      if (mobileMenuButton && mobileDrawer && drawerOverlay) {
        // Open drawer
        this._mobileMenuButtonHandler = function (event) {
          _this2.openDrawer();
        };
        mobileMenuButton.addEventListener("click", this._mobileMenuButtonHandler);

        // Close drawer via close button
        if (closeDrawerButton) {
          closeDrawerButton.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        }

        // Close drawer via overlay click
        this._drawerOverlayHandler = function (event) {
          if (event.target === drawerOverlay) {
            _this2.closeDrawer();
          }
        };
        drawerOverlay.addEventListener("click", this._drawerOverlayHandler);

        // Close drawer when clicking navigation links
        var drawerLinks = mobileDrawer.querySelectorAll("a");
        drawerLinks.forEach(function (link) {
          link.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        });

        // Close drawer on escape key
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape" && !mobileDrawer.classList.contains("-translate-x-full")) {
            _this2.closeDrawer();
          }
        });
      } else {
        console.error("Mobile drawer elements not found:", {
          mobileMenuButton: mobileMenuButton,
          mobileDrawer: mobileDrawer,
          drawerOverlay: drawerOverlay
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      this._emptyContent();
      this.innerHTML = "\n        <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n\n            .animate-fade-in-up {\n                animation: fadeInUp 0.8s ease-out forwards;\n            }\n                #how-it-works {\n                    scroll-margin-top: 100px;\n                }\n\n            @keyframes fadeInUp {\n                from {\n                    opacity: 0;\n                    transform: translateY(30px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n\n            .gradient-bg {\n                background: linear-gradient(135deg, #6C63FF 0%, #4F46E5 100%);\n            }\n\n            .feature-card:hover {\n                transform: translateY(-5px);\n                transition: all 0.3s ease;\n            }\n\n            .hero-pattern {\n                background-image: radial-gradient(circle at 25px 25px, rgba(255,255,255,0.1) 2px, transparent 0);\n                background-size: 50px 50px;\n            }\n        </style>\n\n        <!-- Fixed Header -->\n        <div class=\"fixed top-0 left-0 right-0 bg-white shadow-sm z-50\">\n            <div class=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n                \n                <!-- Mobile Menu Button (Left) -->\n                <div class=\"flex items-center md:hidden\">\n                    <button id=\"mobile-menu-button\" type=\"button\" class=\"text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-200 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                        <span class=\"sr-only\">Open main menu</span>\n                        <!-- Hamburger icon -->\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n                        </svg>\n                    </button>\n                </div>\n\n                <!-- Logo (Center on mobile, Left on desktop) -->\n                <div class=\"flex items-center justify-center md:justify-start flex-1 md:flex-none\">\n                    <div class=\"text-xl font-bold text-gray-800 flex items-center\">\n                        <img src=\"./logo-pinjemin.png\" class=\"mr-2 h-16 inline-block\" alt=\"Pinjemin Logo\">\n                    </div>\n                </div>\n\n                <!-- Desktop Navigation (Hidden on mobile) -->\n                <nav class=\"hidden md:flex items-center space-x-8 flex-1 justify-center\">\n                    <a href=\"#beranda\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                        Beranda\n                    </a>\n                    <a href=\"/#/community\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                        Komunitas\n                    </a>\n                    <a href=\"#how-it-works\" onclick=\"document.getElementById('how-it-works').scrollIntoView({behavior: 'smooth'})\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200 cursor-pointer\">\n                        Cara Kerja\n                    </a>\n                </nav>\n\n                <!-- Right Section: Auth Links -->\n                <div class=\"flex items-center space-x-3\">\n                    <!-- Authentication Links -->\n                    <div class=\"auth-links flex items-center space-x-2\">\n                        <a href=\"/#/login\" class=\"text-sm font-medium text-gray-700 hover:text-blue-600 px-3 py-2 rounded-lg hover:bg-gray-50 transition-all duration-200\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"text-sm font-medium bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Mobile Drawer Overlay -->\n        <div id=\"drawer-overlay\" class=\"fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden transition-opacity duration-300\"></div>\n\n        <!-- Mobile Drawer Menu -->\n        <div id=\"mobile-drawer\" class=\"fixed top-0 left-0 h-full w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden\">\n            <!-- Drawer Header -->\n            <div class=\"flex items-center justify-between p-4 border-b border-gray-200\">\n                <div class=\"flex items-center space-x-3\">\n                    <img src=\"./logo-pinjemin.png\" class=\"h-8\" alt=\"Pinjemin Logo\">\n                    <span class=\"text-lg font-bold text-gray-800\">Pinjemin</span>\n                </div>\n                <button id=\"close-drawer-button\" class=\"text-gray-400 hover:text-gray-600 focus:outline-none p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                    </svg>\n                </button>\n            </div>\n\n            <!-- Drawer Content -->\n            <div class=\"flex flex-col h-full overflow-y-auto\">\n                <!-- Auth Links -->\n                <div class=\"drawer-auth-links border-b border-gray-200 p-4\">\n                    <div class=\"space-y-3\">\n                        <a href=\"/#/login\" class=\"flex items-center justify-center w-full py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors duration-200 font-medium\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"flex items-center justify-center w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n\n                <!-- Navigation Links -->\n                <nav class=\"flex-1 px-4 py-4\">\n                    <ul class=\"space-y-2\">\n                        <li>\n                            <a href=\"/#/\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"></path>\n                                </svg>\n                                Beranda\n                            </a>\n                        </li>\n                        <li>\n                            <a href=\"/#/community\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                                </svg>\n                                Komunitas\n                            </a>\n                        </li>\n                        <li>\n                            <button onclick=\"document.getElementById('how-it-works').scrollIntoView({behavior: 'smooth'}); this.closest('#mobile-drawer').classList.add('-translate-x-full'); document.getElementById('drawer-overlay').classList.add('hidden');\" class=\"flex items-center w-full px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 text-left\">\n                                <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                                </svg>\n                                Cara Kerja\n                            </button>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n        </div>\n\n        <!-- Hero Section -->\n        <section id=\"beranda\" class=\"gradient-bg hero-pattern min-h-screen flex items-center justify-center px-4 py-20\">\n            <div class=\"container mx-auto\">\n                <div class=\"grid lg:grid-cols-2 gap-12 items-center\">\n                    <!-- Left Content -->\n                    <div class=\"text-white space-y-8 animate-on-scroll\">\n                        <div class=\"space-y-4\">\n                            <h1 class=\"text-4xl md:text-6xl font-bold leading-tight text-[#2E64E9]\">\n                                Pinjemin - \n                                <span class=\"text-[#2E64E9]\">Making All Your Needs Easier</span>\n                            </h1>\n                            <p class=\"text-xl md:text-2xl text-gray-700 leading-relaxed\">\n                                Platform serbaguna yang memudahkan kamu membeli, menyewa, atau meminjam barang apapun.\n                            </p>\n                        </div>\n                        \n                        <div class=\"flex flex-col sm:flex-row gap-4\">\n                            <a href=\"/#/register\" class=\"bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-all duration-300 text-center shadow-lg\">\n                                Mulai Sekarang\n                            </a>\n                            <button onclick=\"document.getElementById('how-it-works').scrollIntoView({behavior: 'smooth'})\" class=\"border-2 border-blue-600 text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-blue-600 hover:text-white transition-all duration-300 text-center\">\n                                Pelajari Lebih Lanjut\n                            </button>\n                        </div>\n                    </div>\n\n                    <!-- Right Content - Hero Image -->\n                    <div class=\"flex justify-center animate-on-scroll\">\n                        <div class=\"relative\">\n                            <img src=\"./dashboard-page.png?height=1080&width=1920\" alt=\"Pinjemin Platform Illustration\" class=\"w-full max-w-2xl rounded-2xl\">\n                            <div class=\"absolute -top-4 -right-4 bg-yellow-400 text-blue-900 px-4 py-2 rounded-full font-bold text-sm shadow-lg\">\n                                Sewa & Beli!\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Demo Section -->\n        <section class=\"py-20 bg-white\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"grid lg:grid-cols-2 gap-12 items-center\">\n                    <!-- Left Content - Demo Video -->\n                    <div class=\"flex justify-center animate-on-scroll\">\n                        <div class=\"relative w-full max-w-2xl\">\n                            <!-- YouTube Video Embed with fallback -->\n                            <div class=\"relative aspect-video bg-gray-100 rounded-2xl overflow-hidden shadow-xl\">\n                                <!-- Primary iframe with privacy-enhanced mode -->\n                                <iframe \n                                    class=\"w-full h-full\" \n                                    src=\"https://www.youtube-nocookie.com/embed/GmJqTraI9oQ?rel=0&modestbranding=1&showinfo=0\"\n                                    title=\"Pinjemin Demo Video\" \n                                    frameborder=\"0\" \n                                    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" \n                                    allowfullscreen\n                                    referrerpolicy=\"strict-origin-when-cross-origin\">\n                                </iframe>\n                                \n                                <!-- Fallback content if iframe fails -->\n                                <div class=\"absolute inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white opacity-0 hover:opacity-100 transition-opacity duration-300\" style=\"z-index: -1;\">\n                                    <div class=\"text-center\">\n                                        <svg class=\"w-16 h-16 mx-auto mb-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                            <path d=\"M8 5v14l11-7z\"/>\n                                        </svg>\n                                        <p class=\"text-lg font-semibold\">Demo Video</p>\n                                        <p class=\"text-sm opacity-75\">Klik untuk menonton</p>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <!-- Alternative: Direct YouTube link button -->\n                            <div class=\"mt-4 text-center\">\n                                <a \n                                    href=\"https://www.youtube.com/watch?v=GmJqTraI9oQ\" \n                                    target=\"_blank\" \n                                    rel=\"noopener noreferrer\"\n                                    class=\"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm font-medium\"\n                                >\n                                    <svg class=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\"/>\n                                    </svg>\n                                    Tonton di YouTube\n                                </a>\n                            </div>\n                            \n                            <!-- Demo Badge -->\n                            <div class=\"absolute -top-4 -right-4 bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm shadow-lg flex items-center space-x-2\">\n                                <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M8 5v14l11-7z\"/>\n                                </svg>\n                                <span>Demo Video</span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Right Content - same as before -->\n                    <div class=\"space-y-8 animate-on-scroll\">\n                        <div class=\"space-y-4\">\n                            <h2 class=\"text-4xl md:text-5xl font-bold text-gray-900 leading-tight\">\n                                Lihat Pinjemin \n                                <span class=\"text-blue-600\">Dalam Aksi</span>\n                            </h2>\n                            <p class=\"text-xl text-gray-600 leading-relaxed\">\n                                Tonton video demo lengkap tentang cara menggunakan Pinjemin untuk semua kebutuhan jual-beli dan sewa-menyewa kamu.\n                            </p>\n                        </div>\n                        \n                        <div class=\"space-y-4\">\n                            <div class=\"flex items-center space-x-3\">\n                                <div class=\"bg-green-100 p-2 rounded-full\">\n                                    <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                                    </svg>\n                                </div>\n                                <span class=\"text-gray-700 font-medium\">Panduan lengkap dari registrasi hingga transaksi</span>\n                            </div>\n                            <div class=\"flex items-center space-x-3\">\n                                <div class=\"bg-green-100 p-2 rounded-full\">\n                                    <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                                    </svg>\n                                </div>\n                                <span class=\"text-gray-700 font-medium\">Tips dan trik untuk pengalaman terbaik</span>\n                            </div>\n                            <div class=\"flex items-center space-x-3\">\n                                <div class=\"bg-green-100 p-2 rounded-full\">\n                                    <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                                    </svg>\n                                </div>\n                                <span class=\"text-gray-700 font-medium\">Fitur-fitur unggulan yang wajib dicoba</span>\n                            </div>\n                        </div>\n                        \n                        <div class=\"flex flex-col sm:flex-row gap-4\">\n                            <a href=\"/#/register\" class=\"bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-all duration-300 text-center shadow-lg\">\n                                Coba Sekarang\n                            </a>\n                            <button onclick=\"document.getElementById('how-it-works').scrollIntoView({behavior: 'smooth'})\" class=\"border-2 border-blue-600 text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-blue-600 hover:text-white transition-all duration-300 text-center\">\n                                Pelajari Lebih Lanjut\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- How It Works Section -->\n        <section id=\"how-it-works\" class=\"py-20 bg-gray-50\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"text-center mb-16 animate-on-scroll\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">Bagaimana Cara Kerjanya?</h2>\n                    <p class=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                        Tiga langkah mudah untuk memulai pengalaman jual-beli dan sewa-menyewa yang menyenangkan\n                    </p>\n                </div>\n\n                <div class=\"grid md:grid-cols-3 gap-8\">\n                    <!-- Step 1 -->\n                    <div class=\"bg-white p-8 rounded-2xl shadow-lg text-center feature-card animate-on-scroll\">\n                        <div class=\"bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <svg class=\"w-8 h-8 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-2xl font-bold text-gray-900 mb-4\">Unggah Barang</h3>\n                        <p class=\"text-gray-600 leading-relaxed\">\n                            Jual atau sewakan barang dengan mudah. Upload foto, tentukan harga, dan barang kamu siap dilihat ribuan pengguna.\n                        </p>\n                    </div>\n\n                    <!-- Step 2 -->\n                    <div class=\"bg-white p-8 rounded-2xl shadow-lg text-center feature-card animate-on-scroll\">\n                        <div class=\"bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <svg class=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-2xl font-bold text-gray-900 mb-4\">Temukan & Pinjam</h3>\n                        <p class=\"text-gray-600 leading-relaxed\">\n                            Cari dan checkout barang yang tersedia. Filter berdasarkan lokasi, harga, dan kategori untuk menemukan yang kamu butuhkan.\n                        </p>\n                    </div>\n\n                    <!-- Step 3 -->\n                    <div class=\"bg-white p-8 rounded-2xl shadow-lg text-center feature-card animate-on-scroll\">\n                        <div class=\"bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <svg class=\"w-8 h-8 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-2xl font-bold text-gray-900 mb-4\">Lakukan Transaksi</h3>\n                        <p class=\"text-gray-600 leading-relaxed\">\n                            COD atau janjian ambil barang, semuanya tercatat! Sistem kami memastikan transaksi aman dan terpercaya.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Features Section -->\n        <section class=\"py-20 bg-white\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"text-center mb-16 animate-on-scroll\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">Fitur Unggulan Pinjemin</h2>\n                    <p class=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                        Semua yang kamu butuhkan untuk pengalaman jual-beli dan sewa-menyewa yang sempurna\n                    </p>\n                </div>\n\n                <div class=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                    <!-- Feature 1 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-blue-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Akun Tunggal</h3>\n                        <p class=\"text-gray-600\">Satu akun untuk semua kebutuhan - jual, beli, sewa, dan pinjam.</p>\n                    </div>\n\n                    <!-- Feature 2 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-green-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L17 18\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Checkout Gabungan</h3>\n                        <p class=\"text-gray-600\">Beli dan sewa barang sekaligus dalam satu transaksi yang mudah.</p>\n                    </div>\n\n                    <!-- Feature 3 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-yellow-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Pembayaran COD</h3>\n                        <p class=\"text-gray-600\">Bayar langsung saat barang diterima untuk keamanan maksimal.</p>\n                    </div>\n\n                    <!-- Feature 4 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-purple-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Review & Chat</h3>\n                        <p class=\"text-gray-600\">Komunikasi langsung dengan penjual dan sistem review terpercaya.</p>\n                    </div>\n\n                    <!-- Feature 5 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-red-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Notifikasi & Pengingat</h3>\n                        <p class=\"text-gray-600\">Dapatkan update real-time untuk semua aktivitas transaksi kamu.</p>\n                    </div>\n\n                    <!-- Feature 6 -->\n                    <div class=\"p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-on-scroll\">\n                        <div class=\"bg-indigo-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4\">\n                            <svg class=\"w-6 h-6 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Filter & Pencarian</h3>\n                        <p class=\"text-gray-600\">Temukan barang yang tepat dengan filter lokasi, harga, dan kategori.</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- FAQ Section -->\n        <section class=\"py-20 bg-gray-50\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"text-center mb-16 animate-on-scroll\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">Pertanyaan yang Sering Diajukan</h2>\n                    <p class=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                        Temukan jawaban untuk pertanyaan umum tentang Pinjemin\n                    </p>\n                </div>\n\n                <div class=\"max-w-3xl mx-auto space-y-4\">\n                    <!-- FAQ Item 1 -->\n                    <div class=\"faq-item bg-white rounded-lg shadow-sm animate-on-scroll\">\n                        <button class=\"faq-button w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 transition-colors duration-200\">\n                            <span class=\"text-lg font-semibold text-gray-900\">Apakah saya bisa menyewa dan membeli sekaligus?</span>\n                            <svg class=\"faq-icon w-5 h-5 text-gray-500 transition-transform duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                            </svg>\n                        </button>\n                        <div class=\"faq-content hidden px-6 pb-4\">\n                            <p class=\"text-gray-600\">Ya! Pinjemin memungkinkan kamu untuk menyewa dan membeli barang dalam satu transaksi. Sistem checkout gabungan kami memudahkan kamu untuk mendapatkan semua yang dibutuhkan sekaligus.</p>\n                        </div>\n                    </div>\n\n                    <!-- FAQ Item 2 -->\n                    <div class=\"faq-item bg-white rounded-lg shadow-sm animate-on-scroll\">\n                        <button class=\"faq-button w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 transition-colors duration-200\">\n                            <span class=\"text-lg font-semibold text-gray-900\">Bagaimana sistem pembayaran di Pinjemin?</span>\n                            <svg class=\"faq-icon w-5 h-5 text-gray-500 transition-transform duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                            </svg>\n                        </button>\n                        <div class=\"faq-content hidden px-6 pb-4\">\n                            <p class=\"text-gray-600\">Kami menggunakan sistem COD (Cash on Delivery) untuk keamanan maksimal. Kamu bisa bayar langsung saat barang diterima, sehingga tidak perlu khawatir dengan penipuan online.</p>\n                        </div>\n                    </div>\n\n                    <!-- FAQ Item 3 -->\n                    <div class=\"faq-item bg-white rounded-lg shadow-sm animate-on-scroll\">\n                        <button class=\"faq-button w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 transition-colors duration-200\">\n                            <span class=\"text-lg font-semibold text-gray-900\">Apakah semua pengguna bisa jadi penyewa dan penjual?</span>\n                            <svg class=\"faq-icon w-5 h-5 text-gray-500 transition-transform duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                            </svg>\n                        </button>\n                        <div class=\"faq-content hidden px-6 pb-4\">\n                            <p class=\"text-gray-600\">Tentu saja! Dengan satu akun Pinjemin, kamu bisa menjadi pembeli, penyewa, penjual, dan yang menyewakan barang. Fleksibilitas penuh untuk semua kebutuhan transaksi kamu.</p>\n                        </div>\n                    </div>\n\n                    <!-- FAQ Item 4 -->\n                    <div class=\"faq-item bg-white rounded-lg shadow-sm animate-on-scroll\">\n                        <button class=\"faq-button w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 transition-colors duration-200\">\n                            <span class=\"text-lg font-semibold text-gray-900\">Bagaimana cara memastikan keamanan transaksi?</span>\n                            <svg class=\"faq-icon w-5 h-5 text-gray-500 transition-transform duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                            </svg>\n                        </button>\n                        <div class=\"faq-content hidden px-6 pb-4\">\n                            <p class=\"text-gray-600\">Pinjemin memiliki sistem review dan rating, chat langsung dengan penjual, serta semua transaksi tercatat dalam sistem. Ditambah dengan pembayaran COD, keamanan transaksi kamu terjamin.</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Contact/Team Section -->\n        <section class=\"py-20 bg-white\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"text-center mb-16 animate-on-scroll\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">\uD83D\uDC65 Siapa di Balik Pinjemin?</h2>\n                    <p class=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                        Tim passionate yang berkomitmen menghadirkan solusi terbaik untuk kebutuhan sehari-hari kamu\n                    </p>\n                </div>\n\n                <div class=\"grid md:grid-cols-2 gap-12 max-w-6xl mx-auto\">\n                    <!-- ML Team -->\n                    <div class=\"animate-on-scroll\">\n                        <div class=\"bg-gradient-to-br from-blue-50 to-indigo-50 p-8 rounded-2xl\">\n                            <h3 class=\"text-2xl font-bold text-gray-900 mb-6 flex items-center\">\n                                <span class=\"text-3xl mr-3\">\uD83C\uDFAF</span>\n                                Machine Learning Team\n                            </h3>\n                            <div class=\"space-y-4\">\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">MC008D5X0402</p>\n                                    <p class=\"text-lg font-medium text-blue-600\">Rahma Nur Annisa</p>\n                                    <p class=\"text-gray-600\">Statistika, Universitas Gadjah Mada</p>\n                                </div>\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">MC008D5Y0259</p>\n                                    <p class=\"text-lg font-medium text-blue-600\">Yohanes De Britto Dewo Prasetyo</p>\n                                    <p class=\"text-gray-600\">Statistika, Universitas Gadjah Mada</p>\n                                </div>\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">MC008D5Y1074</p>\n                                    <p class=\"text-lg font-medium text-blue-600\">Dimaz Andhika Putra</p>\n                                    <p class=\"text-gray-600\">Statistika, Universitas Gadjah Mada</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Frontend & Backend Team -->\n                    <div class=\"animate-on-scroll\">\n                        <div class=\"bg-gradient-to-br from-green-50 to-emerald-50 p-8 rounded-2xl\">\n                            <h3 class=\"text-2xl font-bold text-gray-900 mb-6 flex items-center\">\n                                <span class=\"text-3xl mr-3\">\uD83D\uDDA5\uFE0F</span>\n                                Front-End dan Back-End Team\n                            </h3>\n                            <div class=\"space-y-4\">\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">FC221D5Y1035</p>\n                                    <p class=\"text-lg font-medium text-green-600\">Bintang Kurniawan Herman</p>\n                                    <p class=\"text-gray-600\">Ilmu Komputer, UIN Sumatera Utara Medan</p>\n                                </div>\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">FC134D5X1508</p>\n                                    <p class=\"text-lg font-medium text-green-600\">Indah Sari Sitorus</p>\n                                    <p class=\"text-gray-600\">Manajemen Informatika, Politeknik Negeri Sriwijaya</p>\n                                </div>\n                                <div class=\"bg-white p-4 rounded-lg shadow-sm\">\n                                    <p class=\"font-semibold text-gray-900\">FC014D5Y0292</p>\n                                    <p class=\"text-lg font-medium text-green-600\">I Putu Yogi Prasetya Dharmawan</p>\n                                    <p class=\"text-gray-600\">Teknologi Informasi, Universitas Udayana</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- CTA Section -->\n        <section class=\"gradient-bg py-20\">\n            <div class=\"container mx-auto px-4 text-center animate-on-scroll\">\n                <div class=\"max-w-3xl mx-auto text-white space-y-8\">\n                    <h2 class=\"text-4xl md:text-5xl font-bold\">\n                        Siap Memulai Perjalanan Pinjemin?\n                    </h2>\n                    <p class=\"text-xl text-blue-100\">\n                        Bergabunglah dengan ribuan pengguna yang sudah merasakan kemudahan bertransaksi di Pinjemin\n                    </p>\n                    <div class=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                        <a href=\"/#/register\" class=\"bg-white text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition-all duration-300 shadow-lg\">\n                            Daftar Sekarang\n                        </a>\n                        <a href=\"/#/login\" class=\"border-2 border-white text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-white hover:text-blue-600 transition-all duration-300\">\n                            Sudah Punya Akun?\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Footer -->\n        <footer class=\"bg-gray-900 text-white py-12\">\n            <div class=\"container mx-auto px-4\">\n                <div class=\"grid md:grid-cols-4 gap-8\">\n                    <!-- Logo & Description -->\n                    <div class=\"md:col-span-2\">\n                        <div class=\"flex items-center mb-4\">\n                            <img src=\"./logo-pinjemin.png\" class=\"h-12 mr-3\" alt=\"Pinjemin Logo\">\n                            <span class=\"text-2xl font-bold\">Pinjemin</span>\n                        </div>\n                        <p class=\"text-gray-400 mb-4 max-w-md\">\n                            Platform serbaguna yang memudahkan kamu membeli, menyewa, atau meminjam barang apapun. Making all your needs easier.\n                        </p>\n                        <div class=\"flex space-x-4\">\n                            <a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">\n                                <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z\"/>\n                                </svg>\n                            </a>\n                            <a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">\n                                <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z\"/>\n                                </svg>\n                            </a>\n                            <a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">\n                                <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.001z\"/>\n                                </svg>\n                            </a>\n                        </div>\n                    </div>\n\n                    <!-- Quick Links -->\n                    <div>\n                        <h4 class=\"text-lg font-semibold mb-4\">Quick Links</h4>\n                        <ul class=\"space-y-2\">\n                            <li><a href=\"#beranda\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Beranda</a></li>\n                            <li><a href=\"/#/community\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Komunitas</a></li>\n                            <li><a href=\"/#/login\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Masuk</a></li>\n                            <li><a href=\"/#/register\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Daftar</a></li>\n                        </ul>\n                    </div>\n\n                    <!-- Support -->\n                    <div>\n                        <h4 class=\"text-lg font-semibold mb-4\">Bantuan</h4>\n                        <ul class=\"space-y-2\">\n                            <li><a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Pusat Bantuan</a></li>\n                            <li><a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Syarat & Ketentuan</a></li>\n                            <li><a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Kebijakan Privasi</a></li>\n                            <li><a href=\"#\" class=\"text-gray-400 hover:text-white transition-colors duration-200\">Kontak Kami</a></li>\n                        </ul>\n                    </div>\n                </div>\n\n                <div class=\"border-t border-gray-800 mt-8 pt-8 text-left\">\n                    <p class=\"text-gray-400\">\n                        \xA9 2025 Pinjemin. All rights reserved. Made with \u2764\uFE0F by Pinjemin Team.\n                    </p>\n                </div>\n            </div>\n        </footer>\n    ";
    }
  }]);
}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));
customElements.define("landing-page", LandingPage);

/***/ }),

/***/ 56:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

"use strict";


/* istanbul ignore next  */
function setAttributesWithoutAttributes(styleElement) {
  var nonce =  true ? __webpack_require__.nc : 0;
  if (nonce) {
    styleElement.setAttribute("nonce", nonce);
  }
}
module.exports = setAttributesWithoutAttributes;

/***/ }),

/***/ 72:
/***/ ((module) => {

"use strict";


var stylesInDOM = [];
function getIndexByIdentifier(identifier) {
  var result = -1;
  for (var i = 0; i < stylesInDOM.length; i++) {
    if (stylesInDOM[i].identifier === identifier) {
      result = i;
      break;
    }
  }
  return result;
}
function modulesToDom(list, options) {
  var idCountMap = {};
  var identifiers = [];
  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    var id = options.base ? item[0] + options.base : item[0];
    var count = idCountMap[id] || 0;
    var identifier = "".concat(id, " ").concat(count);
    idCountMap[id] = count + 1;
    var indexByIdentifier = getIndexByIdentifier(identifier);
    var obj = {
      css: item[1],
      media: item[2],
      sourceMap: item[3],
      supports: item[4],
      layer: item[5]
    };
    if (indexByIdentifier !== -1) {
      stylesInDOM[indexByIdentifier].references++;
      stylesInDOM[indexByIdentifier].updater(obj);
    } else {
      var updater = addElementStyle(obj, options);
      options.byIndex = i;
      stylesInDOM.splice(i, 0, {
        identifier: identifier,
        updater: updater,
        references: 1
      });
    }
    identifiers.push(identifier);
  }
  return identifiers;
}
function addElementStyle(obj, options) {
  var api = options.domAPI(options);
  api.update(obj);
  var updater = function updater(newObj) {
    if (newObj) {
      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {
        return;
      }
      api.update(obj = newObj);
    } else {
      api.remove();
    }
  };
  return updater;
}
module.exports = function (list, options) {
  options = options || {};
  list = list || [];
  var lastIdentifiers = modulesToDom(list, options);
  return function update(newList) {
    newList = newList || [];
    for (var i = 0; i < lastIdentifiers.length; i++) {
      var identifier = lastIdentifiers[i];
      var index = getIndexByIdentifier(identifier);
      stylesInDOM[index].references--;
    }
    var newLastIdentifiers = modulesToDom(newList, options);
    for (var _i = 0; _i < lastIdentifiers.length; _i++) {
      var _identifier = lastIdentifiers[_i];
      var _index = getIndexByIdentifier(_identifier);
      if (stylesInDOM[_index].references === 0) {
        stylesInDOM[_index].updater();
        stylesInDOM.splice(_index, 1);
      }
    }
    lastIdentifiers = newLastIdentifiers;
  };
};

/***/ }),

/***/ 109:
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
var SearchBar = /*#__PURE__*/function (_HTMLElement) {
  function SearchBar() {
    var _this;
    _classCallCheck(this, SearchBar);
    _this = _callSuper(this, SearchBar);
    _this.shadow = _this.attachShadow({
      mode: "open"
    });
    _this.setupEventListeners = _this.setupEventListeners.bind(_this);
    return _this;
  }
  _inherits(SearchBar, _HTMLElement);
  return _createClass(SearchBar, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
    }
  }, {
    key: "render",
    value: function render() {
      this.shadow.innerHTML = "\n            <style>\n                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n                @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');\n                \n                :host {\n                    display: block;\n                    width: 100%;\n                    font-family: 'Poppins', sans-serif;\n                }\n                \n                .search-container {\n                    display: flex;\n                    gap: 12px;\n                    align-items: center;\n                    max-width: 600px;\n                    margin: 0 auto;\n                    padding: 0 1rem;\n                    position: relative;\n                }\n\n                .search-input-wrapper {\n                    flex-grow: 1;\n                    position: relative;\n                    display: flex;\n                    align-items: center;\n                }\n\n                .search-input {\n                    width: 100%;\n                    padding: 14px 20px 14px 50px;\n                    font-size: 16px;\n                    font-weight: 400;\n                    color: #334155;\n                    background: linear-gradient(135deg, #ffffff, #f8fafc);\n                    border: 2px solid #e2e8f0;\n                    border-radius: 16px;\n                    outline: none;\n                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n                    font-family: 'Poppins', sans-serif;\n                }\n\n                .search-input::placeholder {\n                    color: #94a3b8;\n                    font-weight: 400;\n                }\n\n                .search-input:focus {\n                    border-color: #6366f1;\n                    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), 0 8px 24px rgba(0, 0, 0, 0.1);\n                    transform: translateY(-2px);\n                    background: #ffffff;\n                }\n\n                .search-input:hover {\n                    border-color: #cbd5e1;\n                    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);\n                }\n\n                .search-icon {\n                    position: absolute;\n                    left: 18px;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    color: #64748b;\n                    font-size: 18px;\n                    pointer-events: none;\n                    transition: all 0.3s ease;\n                    z-index: 1;\n                }\n\n                .search-input:focus + .search-icon {\n                    color: #6366f1;\n                    transform: translateY(-50%) scale(1.1);\n                }\n\n                .search-button {\n                    background: linear-gradient(135deg, #6366f1, #4f46e5);\n                    color: white;\n                    font-weight: 600;\n                    padding: 14px 20px;\n                    border-radius: 16px;\n                    font-size: 18px;\n                    cursor: pointer;\n                    border: none;\n                    outline: none;\n                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);\n                    font-family: 'Poppins', sans-serif;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-width: 56px;\n                    height: 56px;\n                }\n\n                .search-button:hover {\n                    background: linear-gradient(135deg, #4f46e5, #4338ca);\n                    transform: translateY(-3px);\n                    box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);\n                }\n\n                .search-button:active {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);\n                }\n\n                .search-button:focus {\n                    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2), 0 8px 20px rgba(99, 102, 241, 0.4);\n                }\n\n                .search-button-icon {\n                    font-size: 18px;\n                    transition: transform 0.3s ease;\n                }\n\n                .search-button:hover .search-button-icon {\n                    transform: scale(1.2);\n                }\n\n                /* Responsive Design */\n                @media (max-width: 640px) {\n                    .search-container {\n                        gap: 8px;\n                        padding: 0 0.5rem;\n                    }\n\n                    .search-input {\n                        padding: 12px 16px 12px 44px;\n                        font-size: 14px;\n                        border-radius: 12px;\n                    }\n\n                    .search-icon {\n                        left: 14px;\n                        font-size: 16px;\n                    }\n\n                    .search-button {\n                        padding: 12px 16px;\n                        font-size: 16px;\n                        border-radius: 12px;\n                        min-width: 48px;\n                        height: 48px;\n                    }\n\n                    .search-button-icon {\n                        font-size: 16px;\n                    }\n                }\n\n                @media (max-width: 480px) {\n                    .search-container {\n                        max-width: 100%;\n                        padding: 0 0.25rem;\n                        gap: 6px;\n                    }\n\n                    .search-input {\n                        padding: 10px 14px 10px 40px;\n                        font-size: 14px;\n                    }\n\n                    .search-icon {\n                        left: 12px;\n                        font-size: 14px;\n                    }\n\n                    .search-button {\n                        padding: 10px 14px;\n                        font-size: 14px;\n                        min-width: 44px;\n                        height: 44px;\n                    }\n\n                    .search-button-icon {\n                        font-size: 14px;\n                    }\n                }\n\n                /* Animation for loading state */\n                .search-button.loading {\n                    pointer-events: none;\n                    opacity: 0.8;\n                }\n\n                .search-button.loading .search-button-icon {\n                    animation: spin 1s linear infinite;\n                }\n\n                @keyframes spin {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n\n                /* Focus visible for accessibility */\n                .search-input:focus-visible,\n                .search-button:focus-visible {\n                    outline: 2px solid #6366f1;\n                    outline-offset: 2px;\n                }\n\n                /* Tooltip for button */\n                .search-button {\n                    position: relative;\n                }\n\n                .search-button::after {\n                    content: 'Cari';\n                    position: absolute;\n                    bottom: -35px;\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background: rgba(0, 0, 0, 0.8);\n                    color: white;\n                    padding: 4px 8px;\n                    border-radius: 6px;\n                    font-size: 12px;\n                    font-weight: 500;\n                    white-space: nowrap;\n                    opacity: 0;\n                    pointer-events: none;\n                    transition: opacity 0.3s ease;\n                    z-index: 1000;\n                }\n\n                .search-button:hover::after {\n                    opacity: 1;\n                }\n\n                @media (max-width: 640px) {\n                    .search-button::after {\n                        display: none;\n                    }\n                }\n            </style>\n            <div class=\"search-container\">\n                <div class=\"search-input-wrapper\">\n                    <input \n                        type=\"text\" \n                        class=\"search-input\" \n                        placeholder=\"Cari produk yang Anda inginkan...\"\n                        autocomplete=\"off\"\n                        spellcheck=\"false\"\n                    >\n                    <i class=\"fa-solid fa-magnifying-glass search-icon\"></i>\n                </div>\n                <button class=\"search-button\" type=\"button\" aria-label=\"Cari produk\" title=\"Cari\">\n                    <i class=\"fa-solid fa-magnifying-glass search-button-icon\"></i>\n                </button>\n            </div>\n        ";
      this.setupEventListeners();
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      var _this2 = this;
      var searchInput = this.shadow.querySelector(".search-input");
      var searchButton = this.shadow.querySelector(".search-button");

      // Check if elements exist
      if (!searchInput || !searchButton) {
        console.error("Search elements not found");
        return;
      }
      var performSearch = function performSearch() {
        try {
          var searchTerm = searchInput.value ? searchInput.value.trim() : "";
          var searchParams = {};

          // Hanya tambahkan parameter 'search' jika searchTerm tidak kosong
          if (searchTerm) {
            searchParams.search = searchTerm;
          }
          console.log("Dispatching search event with params:", searchParams);

          // Add loading state
          searchButton.classList.add("loading");

          // Remove loading state after a short delay
          setTimeout(function () {
            searchButton.classList.remove("loading");
          }, 1000);
          _this2.dispatchEvent(new CustomEvent("search", {
            bubbles: true,
            composed: true,
            detail: {
              params: searchParams
            }
          }));
        } catch (error) {
          console.error("Error in performSearch:", error);
          searchButton.classList.remove("loading");
        }
      };
      searchButton.addEventListener("click", performSearch);
      searchInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          performSearch();
        }
      });

      // Focus functionality
      searchInput.addEventListener("focus", function () {
        try {
          searchInput.select();
        } catch (error) {
          console.error("Error in focus event:", error);
        }
      });
    }

    // Method to clear search
  }, {
    key: "clearSearch",
    value: function clearSearch() {
      try {
        var searchInput = this.shadow.querySelector(".search-input");
        if (searchInput) {
          searchInput.value = "";
          searchInput.focus();
        }
      } catch (error) {
        console.error("Error in clearSearch:", error);
      }
    }

    // Method to set search value
  }, {
    key: "setSearchValue",
    value: function setSearchValue(value) {
      try {
        var searchInput = this.shadow.querySelector(".search-input");
        if (searchInput && typeof value === "string") {
          searchInput.value = value;
        }
      } catch (error) {
        console.error("Error in setSearchValue:", error);
      }
    }

    // Method to get current search value
  }, {
    key: "getSearchValue",
    value: function getSearchValue() {
      try {
        var searchInput = this.shadow.querySelector(".search-input");
        return searchInput && searchInput.value ? searchInput.value.trim() : "";
      } catch (error) {
        console.error("Error in getSearchValue:", error);
        return "";
      }
    }
  }]);
}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));
customElements.define("search-bar", SearchBar);

/***/ }),

/***/ 113:
/***/ ((module) => {

"use strict";


/* istanbul ignore next  */
function styleTagTransform(css, styleElement) {
  if (styleElement.styleSheet) {
    styleElement.styleSheet.cssText = css;
  } else {
    while (styleElement.firstChild) {
      styleElement.removeChild(styleElement.firstChild);
    }
    styleElement.appendChild(document.createTextNode(css));
  }
}
module.exports = styleTagTransform;

/***/ }),

/***/ 115:
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == _typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var RegisterPage = /*#__PURE__*/function (_HTMLElement) {
  function RegisterPage() {
    var _this;
    _classCallCheck(this, RegisterPage);
    _this = _callSuper(this, RegisterPage);
    _defineProperty(_this, "openDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Show overlay
        drawerOverlay.classList.remove("hidden");
        // Force reflow before adding transform classes for smooth animation
        drawerOverlay.offsetHeight;

        // Slide in drawer
        mobileDrawer.classList.remove("-translate-x-full");

        // Prevent body scroll when drawer is open
        document.body.style.overflow = "hidden";
      }
    });
    _defineProperty(_this, "closeDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Slide out drawer
        mobileDrawer.classList.add("-translate-x-full");

        // Hide overlay after animation completes
        setTimeout(function () {
          drawerOverlay.classList.add("hidden");
        }, 300); // Match transition duration

        // Restore body scroll
        document.body.style.overflow = "";
      }
    });
    _this.isLoading = false;
    // Bind methods to the class instance
    _this.fetchProvinces = _this.fetchProvinces.bind(_this);
    _this.populateProvincesDropdown = _this.populateProvincesDropdown.bind(_this);
    _this.handleProvinceChange = _this.handleProvinceChange.bind(_this);
    _this.fetchCitiesByProvinceId = _this.fetchCitiesByProvinceId.bind(_this);
    _this.populateCitiesDropdown = _this.populateCitiesDropdown.bind(_this);
    _this.setupFormSubmission = _this.setupFormSubmission.bind(_this);
    return _this;
  }
  _inherits(RegisterPage, _HTMLElement);
  return _createClass(RegisterPage, [{
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }
  }, {
    key: "connectedCallback",
    value: function connectedCallback() {
      // Check if user is already logged in
      var token = localStorage.getItem("token");
      if (token) {
        // User is already logged in, redirect to home
        window.location.href = "/#/home";
        return;
      }
      this.render();
      this.setupMobileMenuToggle();
      this.setupFormSubmission();
      this.fetchProvinces();
      this.setupProvinceChangeListener();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      var provinceSelect = this.querySelector("#province");
      if (provinceSelect) {
        provinceSelect.removeEventListener("change", this.handleProvinceChange);
      }
      // Remove mobile menu listeners
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      if (mobileMenuButton && this._mobileMenuButtonHandler) {
        mobileMenuButton.removeEventListener("click", this._mobileMenuButtonHandler);
        this._mobileMenuButtonHandler = null;
      }

      // Remove drawer overlay listener
      if (this._drawerOverlayHandler) {
        document.removeEventListener("click", this._drawerOverlayHandler);
        this._drawerOverlayHandler = null;
      }
    }
  }, {
    key: "setupMobileMenuToggle",
    value: function setupMobileMenuToggle() {
      var _this2 = this;
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      var mobileDrawer = this.querySelector("#mobile-drawer");
      var drawerOverlay = this.querySelector("#drawer-overlay");
      var closeDrawerButton = this.querySelector("#close-drawer-button");
      if (mobileMenuButton && mobileDrawer && drawerOverlay) {
        // Open drawer
        this._mobileMenuButtonHandler = function (event) {
          _this2.openDrawer();
        };
        mobileMenuButton.addEventListener("click", this._mobileMenuButtonHandler);

        // Close drawer via close button
        if (closeDrawerButton) {
          closeDrawerButton.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        }

        // Close drawer via overlay click
        this._drawerOverlayHandler = function (event) {
          if (event.target === drawerOverlay) {
            _this2.closeDrawer();
          }
        };
        drawerOverlay.addEventListener("click", this._drawerOverlayHandler);

        // Close drawer when clicking navigation links
        var drawerLinks = mobileDrawer.querySelectorAll("a");
        drawerLinks.forEach(function (link) {
          link.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        });

        // Close drawer on escape key
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape" && !mobileDrawer.classList.contains("-translate-x-full")) {
            _this2.closeDrawer();
          }
        });
      } else {
        console.error("Mobile drawer elements not found:", {
          mobileMenuButton: mobileMenuButton,
          mobileDrawer: mobileDrawer,
          drawerOverlay: drawerOverlay
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      this._emptyContent();
      this.innerHTML = "\n            <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n                .toast-slide-in {\n                    animation: slideIn 0.3s ease-out;\n                }\n                \n                .toast-slide-out {\n                    animation: slideOut 0.3s ease-in;\n                }\n                \n                @keyframes slideIn {\n                    from { transform: translateX(100%); opacity: 0; }\n                    to { transform: translateX(0); opacity: 1; }\n                }\n                \n                @keyframes slideOut {\n                    from { transform: translateX(0); opacity: 1; }\n                    to { transform: translateX(100%); opacity: 0; }\n                }\n\n                .form-grid {\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    gap: 1rem;\n                }\n\n                @media (max-width: 640px) {\n                    .form-grid {\n                        grid-template-columns: 1fr;\n                    }\n                }\n            </style>\n            <!-- Fixed Header -->\n        <div class=\"fixed top-0 left-0 right-0 bg-white shadow-sm z-50\">\n            <div class=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n                \n                <!-- Mobile Menu Button (Left) -->\n                <div class=\"flex items-center md:hidden\">\n                    <button id=\"mobile-menu-button\" type=\"button\" class=\"text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-200 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                        <span class=\"sr-only\">Open main menu</span>\n                        <!-- Hamburger icon -->\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n                        </svg>\n                    </button>\n                </div>\n\n                <!-- Logo (Center on mobile, Left on desktop) -->\n                <div class=\"flex items-center justify-center md:justify-start flex-1 md:flex-none\">\n                    <div class=\"text-xl font-bold text-gray-800 flex items-center\">\n                        <img src=\"./logo-pinjemin.png\" class=\"mr-2 h-16 inline-block\" alt=\"Pinjemin Logo\">\n                    </div>\n                </div>\n\n                <!-- Desktop Navigation (Hidden on mobile) -->\n                <nav class=\"hidden md:flex items-center space-x-8 flex-1 justify-center\">\n                    <a href=\"/#/\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                        Beranda\n                    </a>\n                </nav>\n\n                <!-- Right Section: Auth Links -->\n                <div class=\"flex items-center space-x-3\">\n                    <!-- Authentication Links -->\n                    <div class=\"auth-links flex items-center space-x-2\">\n                        <a href=\"/#/login\" class=\"text-sm font-medium text-gray-700 hover:text-blue-600 px-3 py-2 rounded-lg hover:bg-gray-50 transition-all duration-200\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"text-sm font-medium bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Mobile Drawer Overlay -->\n        <div id=\"drawer-overlay\" class=\"fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden transition-opacity duration-300\"></div>\n\n        <!-- Mobile Drawer Menu -->\n        <div id=\"mobile-drawer\" class=\"fixed top-0 left-0 h-full w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden\">\n            <!-- Drawer Header -->\n            <div class=\"flex items-center justify-between p-4 border-b border-gray-200\">\n                <div class=\"flex items-center space-x-3\">\n                    <img src=\"./logo-pinjemin.png\" class=\"h-8\" alt=\"Pinjemin Logo\">\n                    <span class=\"text-lg font-bold text-gray-800\">Pinjemin</span>\n                </div>\n                <button id=\"close-drawer-button\" class=\"text-gray-400 hover:text-gray-600 focus:outline-none p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                    </svg>\n                </button>\n            </div>\n\n            <!-- Drawer Content -->\n            <div class=\"flex flex-col h-full overflow-y-auto\">\n                <!-- Auth Links -->\n                <div class=\"drawer-auth-links border-b border-gray-200 p-4\">\n                    <div class=\"space-y-3\">\n                        <a href=\"/#/login\" class=\"flex items-center justify-center w-full py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors duration-200 font-medium\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"flex items-center justify-center w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n\n                <!-- Navigation Links -->\n                <nav class=\"flex-1 px-4 py-4\">\n                    <ul class=\"space-y-2\">\n                        <li>\n                            <a href=\"/#/\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"></path>\n                                </svg>\n                                Beranda\n                            </a>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n        </div>\n            \n            <div class=\"min-h-screen flex items-center justify-center p-4 mt-32\">\n                <div class=\"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg\">\n                    <!-- Logo -->\n                    <div class=\"text-center mb-6\">\n                        <img class=\"mx-auto h-16 w-16 rounded-xl object-cover shadow-lg\" src=\"./logo-pinjemin.png\" alt=\"Pinjemin\">\n                        <h2 class=\"mt-4 text-2xl font-bold text-gray-900\">Create Account</h2>\n                        <p class=\"mt-1 text-sm text-gray-600\">Join us and start your journey</p>\n                    </div>\n\n                    <!-- Form -->\n                    <form id=\"register-form\" class=\"space-y-4\">\n                        <div>\n                            <label for=\"name\" class=\"block text-sm font-medium text-gray-700 mb-1\">Full Name</label>\n                            <input \n                                id=\"name\" \n                                name=\"name\" \n                                type=\"text\" \n                                autocomplete=\"name\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Enter your full name\"\n                            >\n                        </div>\n\n                        <div>\n                            <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1\">Email Address</label>\n                            <input \n                                id=\"email\" \n                                name=\"email\" \n                                type=\"email\" \n                                autocomplete=\"email\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Enter your email\"\n                            >\n                        </div>\n\n                        <div class=\"form-grid\">\n                            <div>\n                                <label for=\"province\" class=\"block text-sm font-medium text-gray-700 mb-1\">Province</label>\n                                <select \n                                    id=\"province\" \n                                    name=\"province_name\" \n                                    required \n                                    class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                >\n                                    <option value=\"\">Select Province</option>\n                                </select>\n                            </div>\n\n                            <div>\n                                <label for=\"city\" class=\"block text-sm font-medium text-gray-700 mb-1\">City</label>\n                                <select \n                                    id=\"city\" \n                                    name=\"city_name\" \n                                    required \n                                    disabled \n                                    class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed\"\n                                >\n                                    <option value=\"\">Select City</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div>\n                            <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1\">Password</label>\n                            <input \n                                id=\"password\" \n                                name=\"password\" \n                                type=\"password\" \n                                autocomplete=\"new-password\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Create a password\"\n                            >\n                        </div>\n\n                        <div>\n                            <label for=\"retype-password\" class=\"block text-sm font-medium text-gray-700 mb-1\">Confirm Password</label>\n                            <input \n                                id=\"retype-password\" \n                                name=\"retype-password\" \n                                type=\"password\" \n                                autocomplete=\"new-password\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Confirm your password\"\n                            >\n                        </div>\n                        <div>\n                          <label for=\"hoby\" class=\"block text-sm font-medium text-gray-700 mb-1\">Hobby</label>\n                          <select \n                              id=\"hobby\" \n                              name=\"hobby\" \n                              required \n                              class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                          >\n                              <option value=\"\">Select Hobby</option>\n                              <option value=\"MASAK\">Masak</option>\n                              <option value=\"MEMBACA\">Membaca</option>\n                              <option value=\"FOTOGRAFI\">Fotografi</option>\n                          </select>\n                        </div>\n\n                        <button \n                            type=\"submit\" \n                            id=\"submit-btn\"\n                            class=\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center min-h-[44px]\"\n                        >\n                            <span id=\"btn-content\">Create Account</span>\n                        </button>\n                    </form>\n\n                    <!-- Login Link -->\n                    <p class=\"mt-6 text-center text-sm text-gray-600\">\n                        Already have an account?\n                        <a href=\"/#/login\" class=\"font-semibold text-purple-600 hover:text-purple-500 transition-colors duration-200\">Sign in here</a>\n                    </p>\n                </div>\n            </div>\n            \n            <!-- Toast Container -->\n            <div id=\"toast-container\" class=\"fixed top-4 right-4 z-50 space-y-2\"></div>\n        ";
    }
  }, {
    key: "showToast",
    value: function showToast(title, message) {
      var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "success";
      var toastContainer = this.querySelector("#toast-container");
      var toast = document.createElement("div");
      var bgColor = type === "success" ? "bg-green-500" : "bg-red-500";
      var icon = type === "success" ? "✓" : "✕";
      toast.className = "".concat(bgColor, " text-white px-6 py-4 rounded-lg shadow-lg flex items-center min-w-[320px] toast-slide-in");
      toast.innerHTML = "\n            <div class=\"flex-shrink-0 w-6 h-6 flex items-center justify-center bg-white bg-opacity-20 rounded-full mr-3\">\n                <span class=\"text-sm font-bold\">".concat(icon, "</span>\n            </div>\n            <div class=\"flex-1\">\n                <div class=\"font-semibold text-sm\">").concat(title, "</div>\n                <div class=\"text-xs opacity-90 mt-1\">").concat(message, "</div>\n            </div>\n        ");
      toastContainer.appendChild(toast);

      // Auto remove after 4 seconds
      setTimeout(function () {
        toast.classList.remove("toast-slide-in");
        toast.classList.add("toast-slide-out");
        setTimeout(function () {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 4000);
    }
  }, {
    key: "setLoading",
    value: function setLoading(loading) {
      this.isLoading = loading;
      var submitBtn = this.querySelector("#submit-btn");
      var btnContent = this.querySelector("#btn-content");
      if (loading) {
        submitBtn.disabled = true;
        btnContent.textContent = "Creating Account...";
      } else {
        submitBtn.disabled = false;
        btnContent.textContent = "Create Account";
      }
    }
  }, {
    key: "fetchProvinces",
    value: function () {
      var _fetchProvinces = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
        var provinceSelect, response, provinces;
        return _regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              provinceSelect = this.querySelector("#province");
              provinceSelect.innerHTML = '<option value="">Select Province</option>';
              _context.prev = 2;
              _context.next = 5;
              return fetch("https://kanglerian.my.id/api-wilayah-indonesia/api/provinces.json");
            case 5:
              response = _context.sent;
              _context.next = 8;
              return response.json();
            case 8:
              provinces = _context.sent;
              this.populateProvincesDropdown(provinces);
              _context.next = 15;
              break;
            case 12:
              _context.prev = 12;
              _context.t0 = _context["catch"](2);
              this.showToast("Error", "Failed to load provinces. Please try again later.", "error");
            case 15:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[2, 12]]);
      }));
      function fetchProvinces() {
        return _fetchProvinces.apply(this, arguments);
      }
      return fetchProvinces;
    }()
  }, {
    key: "populateProvincesDropdown",
    value: function populateProvincesDropdown(provinces) {
      var provinceSelect = this.querySelector("#province");
      if (provinceSelect) {
        provinces.forEach(function (province) {
          var option = document.createElement("option");
          option.value = province.id;
          option.textContent = province.name;
          provinceSelect.appendChild(option);
        });
      }
    }
  }, {
    key: "setupProvinceChangeListener",
    value: function setupProvinceChangeListener() {
      var provinceSelect = this.querySelector("#province");
      if (provinceSelect) {
        provinceSelect.addEventListener("change", this.handleProvinceChange);
      }
    }
  }, {
    key: "handleProvinceChange",
    value: function handleProvinceChange(event) {
      var provinceId = event.target.value;
      var citySelect = this.querySelector("#city");
      citySelect.innerHTML = '<option value="">Select City</option>';
      citySelect.disabled = true;
      if (provinceId) {
        this.fetchCitiesByProvinceId(provinceId);
      }
    }
  }, {
    key: "fetchCitiesByProvinceId",
    value: function () {
      var _fetchCitiesByProvinceId = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(provinceId) {
        var citySelect, response, cities;
        return _regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              citySelect = this.querySelector("#city");
              citySelect.disabled = true;
              _context2.prev = 2;
              _context2.next = 5;
              return fetch("https://kanglerian.my.id/api-wilayah-indonesia/api/regencies/".concat(provinceId, ".json"));
            case 5:
              response = _context2.sent;
              _context2.next = 8;
              return response.json();
            case 8:
              cities = _context2.sent;
              this.populateCitiesDropdown(cities);
              citySelect.disabled = false;
              _context2.next = 17;
              break;
            case 13:
              _context2.prev = 13;
              _context2.t0 = _context2["catch"](2);
              this.showToast("Error", "Failed to load cities. Please try again later.", "error");
              citySelect.disabled = true;
            case 17:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[2, 13]]);
      }));
      function fetchCitiesByProvinceId(_x) {
        return _fetchCitiesByProvinceId.apply(this, arguments);
      }
      return fetchCitiesByProvinceId;
    }()
  }, {
    key: "populateCitiesDropdown",
    value: function populateCitiesDropdown(cities) {
      var citySelect = this.querySelector("#city");
      if (citySelect) {
        cities.forEach(function (city) {
          var option = document.createElement("option");
          option.value = city.id;
          option.textContent = city.name;
          citySelect.appendChild(option);
        });
      }
    }
  }, {
    key: "setupFormSubmission",
    value: function setupFormSubmission() {
      var _this3 = this;
      var form = this.querySelector("#register-form");
      form.addEventListener("submit", /*#__PURE__*/function () {
        var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(event) {
          var token, formData, data, provinceSelect, citySelect, selectedProvinceOption, selectedCityOption, provinceName, cityName, response, result, loginEvent, errorMessage, _errorMessage;
          return _regeneratorRuntime().wrap(function _callee3$(_context3) {
            while (1) switch (_context3.prev = _context3.next) {
              case 0:
                event.preventDefault();

                // Check if user is already logged in
                token = localStorage.getItem("token");
                if (!token) {
                  _context3.next = 5;
                  break;
                }
                window.location.href = "/#/home";
                return _context3.abrupt("return");
              case 5:
                if (!_this3.isLoading) {
                  _context3.next = 7;
                  break;
                }
                return _context3.abrupt("return");
              case 7:
                formData = new FormData(form);
                data = Object.fromEntries(formData.entries()); // Validate password match
                if (!(data.password !== data["retype-password"])) {
                  _context3.next = 12;
                  break;
                }
                _this3.showToast("Password Mismatch", "Passwords do not match. Please try again.", "error");
                return _context3.abrupt("return");
              case 12:
                delete data["retype-password"];

                // Get province and city names
                provinceSelect = _this3.querySelector("#province");
                citySelect = _this3.querySelector("#city");
                selectedProvinceOption = provinceSelect.options[provinceSelect.selectedIndex];
                selectedCityOption = citySelect.options[citySelect.selectedIndex];
                provinceName = selectedProvinceOption ? selectedProvinceOption.textContent : "";
                cityName = selectedCityOption ? selectedCityOption.textContent : "";
                data.province_name = provinceName;
                data.city_name = cityName;
                _this3.setLoading(true);
                _context3.prev = 22;
                _context3.next = 25;
                return fetch("https://api.pinjemin.site/api/auth/register", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json"
                  },
                  body: JSON.stringify(data)
                });
              case 25:
                response = _context3.sent;
                _context3.next = 28;
                return response.json();
              case 28:
                result = _context3.sent;
                if (response.ok) {
                  if (result.status === "success") {
                    localStorage.setItem("token", result.token);
                    localStorage.setItem("user", JSON.stringify(result.data.user));

                    // Dispatch a custom event to notify other components
                    loginEvent = new CustomEvent("userLoggedIn", {
                      detail: {
                        user: result.data.user
                      }
                    });
                    window.dispatchEvent(loginEvent);
                    _this3.showToast("Registration Successful!", "Welcome! Redirecting to login...", "success");

                    // Redirect after showing toast
                    setTimeout(function () {
                      window.location.href = "/#/login";
                    }, 1500);
                  } else {
                    errorMessage = result.message + (result.errors ? "\n" + result.errors.map(function (e) {
                      return e.msg;
                    }).join(", ") : "");
                    _this3.showToast("Registration Failed", errorMessage, "error");
                  }
                } else {
                  _errorMessage = result.message + (result.errors ? "\n" + result.errors.map(function (e) {
                    return e.msg;
                  }).join(", ") : "An unexpected error occurred.");
                  _this3.showToast("Registration Failed", _errorMessage, "error");
                }
                _context3.next = 35;
                break;
              case 32:
                _context3.prev = 32;
                _context3.t0 = _context3["catch"](22);
                _this3.showToast("Connection Error", "Unable to connect to server. Please try again.", "error");
              case 35:
                _context3.prev = 35;
                _this3.setLoading(false);
                return _context3.finish(35);
              case 38:
              case "end":
                return _context3.stop();
            }
          }, _callee3, null, [[22, 32, 35, 38]]);
        }));
        return function (_x2) {
          return _ref.apply(this, arguments);
        };
      }());
    }
  }]);
}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));
customElements.define("register-page", RegisterPage);

/***/ }),

/***/ 314:
/***/ ((module) => {

"use strict";


/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
module.exports = function (cssWithMappingToString) {
  var list = [];

  // return the list of modules as css string
  list.toString = function toString() {
    return this.map(function (item) {
      var content = "";
      var needLayer = typeof item[5] !== "undefined";
      if (item[4]) {
        content += "@supports (".concat(item[4], ") {");
      }
      if (item[2]) {
        content += "@media ".concat(item[2], " {");
      }
      if (needLayer) {
        content += "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {");
      }
      content += cssWithMappingToString(item);
      if (needLayer) {
        content += "}";
      }
      if (item[2]) {
        content += "}";
      }
      if (item[4]) {
        content += "}";
      }
      return content;
    }).join("");
  };

  // import a list of modules into the list
  list.i = function i(modules, media, dedupe, supports, layer) {
    if (typeof modules === "string") {
      modules = [[null, modules, undefined]];
    }
    var alreadyImportedModules = {};
    if (dedupe) {
      for (var k = 0; k < this.length; k++) {
        var id = this[k][0];
        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }
    for (var _k = 0; _k < modules.length; _k++) {
      var item = [].concat(modules[_k]);
      if (dedupe && alreadyImportedModules[item[0]]) {
        continue;
      }
      if (typeof layer !== "undefined") {
        if (typeof item[5] === "undefined") {
          item[5] = layer;
        } else {
          item[1] = "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {").concat(item[1], "}");
          item[5] = layer;
        }
      }
      if (media) {
        if (!item[2]) {
          item[2] = media;
        } else {
          item[1] = "@media ".concat(item[2], " {").concat(item[1], "}");
          item[2] = media;
        }
      }
      if (supports) {
        if (!item[4]) {
          item[4] = "".concat(supports);
        } else {
          item[1] = "@supports (".concat(item[4], ") {").concat(item[1], "}");
          item[4] = supports;
        }
      }
      list.push(item);
    }
  };
  return list;
};

/***/ }),

/***/ 407:
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == _typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var LoginPage = /*#__PURE__*/function (_HTMLElement) {
  function LoginPage() {
    var _this;
    _classCallCheck(this, LoginPage);
    _this = _callSuper(this, LoginPage);
    _defineProperty(_this, "openDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Show overlay
        drawerOverlay.classList.remove("hidden");
        // Force reflow before adding transform classes for smooth animation
        drawerOverlay.offsetHeight;

        // Slide in drawer
        mobileDrawer.classList.remove("-translate-x-full");

        // Prevent body scroll when drawer is open
        document.body.style.overflow = "hidden";
      }
    });
    _defineProperty(_this, "closeDrawer", function () {
      var mobileDrawer = _this.querySelector("#mobile-drawer");
      var drawerOverlay = _this.querySelector("#drawer-overlay");
      if (mobileDrawer && drawerOverlay) {
        // Slide out drawer
        mobileDrawer.classList.add("-translate-x-full");

        // Hide overlay after animation completes
        setTimeout(function () {
          drawerOverlay.classList.add("hidden");
        }, 300); // Match transition duration

        // Restore body scroll
        document.body.style.overflow = "";
      }
    });
    _this.isLoading = false;
    return _this;
  }
  _inherits(LoginPage, _HTMLElement);
  return _createClass(LoginPage, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      // Check if user is already logged in
      var token = localStorage.getItem("token");
      if (token) {
        // User is already logged in, redirect to home
        window.location.href = "/#/home";
        return;
      }
      this.render();
      this.setupMobileMenuToggle();
      this.setupFormSubmission();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      // Remove mobile menu listeners
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      if (mobileMenuButton && this._mobileMenuButtonHandler) {
        mobileMenuButton.removeEventListener("click", this._mobileMenuButtonHandler);
        this._mobileMenuButtonHandler = null;
      }

      // Remove drawer overlay listener
      if (this._drawerOverlayHandler) {
        document.removeEventListener("click", this._drawerOverlayHandler);
        this._drawerOverlayHandler = null;
      }
    }
  }, {
    key: "setupMobileMenuToggle",
    value: function setupMobileMenuToggle() {
      var _this2 = this;
      var mobileMenuButton = this.querySelector("#mobile-menu-button");
      var mobileDrawer = this.querySelector("#mobile-drawer");
      var drawerOverlay = this.querySelector("#drawer-overlay");
      var closeDrawerButton = this.querySelector("#close-drawer-button");
      if (mobileMenuButton && mobileDrawer && drawerOverlay) {
        // Open drawer
        this._mobileMenuButtonHandler = function (event) {
          _this2.openDrawer();
        };
        mobileMenuButton.addEventListener("click", this._mobileMenuButtonHandler);

        // Close drawer via close button
        if (closeDrawerButton) {
          closeDrawerButton.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        }

        // Close drawer via overlay click
        this._drawerOverlayHandler = function (event) {
          if (event.target === drawerOverlay) {
            _this2.closeDrawer();
          }
        };
        drawerOverlay.addEventListener("click", this._drawerOverlayHandler);

        // Close drawer when clicking navigation links
        var drawerLinks = mobileDrawer.querySelectorAll("a");
        drawerLinks.forEach(function (link) {
          link.addEventListener("click", function () {
            _this2.closeDrawer();
          });
        });

        // Close drawer on escape key
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape" && !mobileDrawer.classList.contains("-translate-x-full")) {
            _this2.closeDrawer();
          }
        });
      } else {
        console.error("Mobile drawer elements not found:", {
          mobileMenuButton: mobileMenuButton,
          mobileDrawer: mobileDrawer,
          drawerOverlay: drawerOverlay
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      this.innerHTML = "\n            <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n                .toast-slide-in {\n                    animation: slideIn 0.3s ease-out;\n                }\n                \n                .toast-slide-out {\n                    animation: slideOut 0.3s ease-in;\n                }\n                \n                @keyframes slideIn {\n                    from { transform: translateX(100%); opacity: 0; }\n                    to { transform: translateX(0); opacity: 1; }\n                }\n                \n                @keyframes slideOut {\n                    from { transform: translateX(0); opacity: 1; }\n                    to { transform: translateX(100%); opacity: 0; }\n                }\n            </style>\n            <!-- Fixed Header -->\n        <div class=\"fixed top-0 left-0 right-0 bg-white shadow-sm z-50\">\n            <div class=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n                \n                <!-- Mobile Menu Button (Left) -->\n                <div class=\"flex items-center md:hidden\">\n                    <button id=\"mobile-menu-button\" type=\"button\" class=\"text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-200 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                        <span class=\"sr-only\">Open main menu</span>\n                        <!-- Hamburger icon -->\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n                        </svg>\n                    </button>\n                </div>\n\n                <!-- Logo (Center on mobile, Left on desktop) -->\n                <div class=\"flex items-center justify-center md:justify-start flex-1 md:flex-none\">\n                    <div class=\"text-xl font-bold text-gray-800 flex items-center\">\n                        <img src=\"./logo-pinjemin.png\" class=\"mr-2 h-16 inline-block\" alt=\"Pinjemin Logo\">\n                    </div>\n                </div>\n\n                <!-- Desktop Navigation (Hidden on mobile) -->\n                <nav class=\"hidden md:flex items-center space-x-8 flex-1 justify-center\">\n                    <a href=\"/#/\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                        Beranda\n                    </a>\n                </nav>\n\n                <!-- Right Section: Auth Links -->\n                <div class=\"flex items-center space-x-3\">\n                    <!-- Authentication Links -->\n                    <div class=\"auth-links flex items-center space-x-2\">\n                        <a href=\"/#/login\" class=\"text-sm font-medium text-gray-700 hover:text-blue-600 px-3 py-2 rounded-lg hover:bg-gray-50 transition-all duration-200\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"text-sm font-medium bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Mobile Drawer Overlay -->\n        <div id=\"drawer-overlay\" class=\"fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden transition-opacity duration-300\"></div>\n\n        <!-- Mobile Drawer Menu -->\n        <div id=\"mobile-drawer\" class=\"fixed top-0 left-0 h-full w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden\">\n            <!-- Drawer Header -->\n            <div class=\"flex items-center justify-between p-4 border-b border-gray-200\">\n                <div class=\"flex items-center space-x-3\">\n                    <img src=\"./logo-pinjemin.png\" class=\"h-8\" alt=\"Pinjemin Logo\">\n                    <span class=\"text-lg font-bold text-gray-800\">Pinjemin</span>\n                </div>\n                <button id=\"close-drawer-button\" class=\"text-gray-400 hover:text-gray-600 focus:outline-none p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                    </svg>\n                </button>\n            </div>\n\n            <!-- Drawer Content -->\n            <div class=\"flex flex-col h-full overflow-y-auto\">\n                <!-- Auth Links -->\n                <div class=\"drawer-auth-links border-b border-gray-200 p-4\">\n                    <div class=\"space-y-3\">\n                        <a href=\"/#/login\" class=\"flex items-center justify-center w-full py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors duration-200 font-medium\">\n                            Sign In\n                        </a>\n                        <a href=\"/#/register\" class=\"flex items-center justify-center w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium\">\n                            Register\n                        </a>\n                    </div>\n                </div>\n\n                <!-- Navigation Links -->\n                <nav class=\"flex-1 px-4 py-4\">\n                    <ul class=\"space-y-2\">\n                        <li>\n                            <a href=\"/#/\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"></path>\n                                </svg>\n                                Beranda\n                            </a>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n        </div>\n            \n            <div class=\"min-h-screen flex items-center justify-center p-4 py-8 mt-8\">\n                <div class=\"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md\">\n                    <!-- Logo -->\n                    <div class=\"text-center mb-6\">\n                        <img class=\"mx-auto h-16 w-16 rounded-xl object-cover shadow-lg\" src=\"./logo-pinjemin.png\" alt=\"Pinjemin\">\n                        <h2 class=\"mt-4 text-2xl font-bold text-gray-900\">Welcome Back</h2>\n                        <p class=\"mt-1 text-sm text-gray-600\">Sign in to your account</p>\n                    </div>\n\n                    <!-- Form -->\n                    <form id=\"login-form\" class=\"space-y-4\">\n                        <div>\n                            <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1\">Email Address</label>\n                            <input \n                                id=\"email\" \n                                name=\"email\" \n                                type=\"email\" \n                                autocomplete=\"email\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Enter your email\"\n                            >\n                        </div>\n\n                        <div>\n                            <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1\">Password</label>\n                            <input \n                                id=\"password\" \n                                name=\"password\" \n                                type=\"password\" \n                                autocomplete=\"current-password\" \n                                required \n                                class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                                placeholder=\"Enter your password\"\n                            >\n                        </div>\n\n                        <button \n                            type=\"submit\" \n                            id=\"submit-btn\"\n                            class=\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center min-h-[44px]\"\n                        >\n                            <span id=\"btn-content\">Sign In</span>\n                        </button>\n                    </form>\n\n                    <!-- Register Link -->\n                    <p class=\"mt-6 text-center text-sm text-gray-600\">\n                        Don't have an account?\n                        <a href=\"/#/register\" class=\"font-semibold text-purple-600 hover:text-purple-500 transition-colors duration-200\">Create one here</a>\n                    </p>\n                </div>\n            </div>\n            \n            <!-- Toast Container -->\n            <div id=\"toast-container\" class=\"fixed top-4 right-4 z-50 space-y-2\"></div>\n        ";
    }
  }, {
    key: "showToast",
    value: function showToast(title, message) {
      var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "success";
      var toastContainer = this.querySelector("#toast-container");
      var toast = document.createElement("div");
      var bgColor = type === "success" ? "bg-green-500" : "bg-red-500";
      var icon = type === "success" ? "✓" : "✕";
      toast.className = "".concat(bgColor, " text-white px-6 py-4 rounded-lg shadow-lg flex items-center min-w-[320px] toast-slide-in");
      toast.innerHTML = "\n            <div class=\"flex-shrink-0 w-6 h-6 flex items-center justify-center bg-white bg-opacity-20 rounded-full mr-3\">\n                <span class=\"text-sm font-bold\">".concat(icon, "</span>\n            </div>\n            <div class=\"flex-1\">\n                <div class=\"font-semibold text-sm\">").concat(title, "</div>\n                <div class=\"text-xs opacity-90 mt-1\">").concat(message, "</div>\n            </div>\n        ");
      toastContainer.appendChild(toast);

      // Auto remove after 4 seconds
      setTimeout(function () {
        toast.classList.remove("toast-slide-in");
        toast.classList.add("toast-slide-out");
        setTimeout(function () {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 4000);
    }
  }, {
    key: "setLoading",
    value: function setLoading(loading) {
      this.isLoading = loading;
      var submitBtn = this.querySelector("#submit-btn");
      var btnContent = this.querySelector("#btn-content");
      if (loading) {
        submitBtn.disabled = true;
        btnContent.textContent = "Signing In...";
      } else {
        submitBtn.disabled = false;
        btnContent.textContent = "Sign In";
      }
    }
  }, {
    key: "setupFormSubmission",
    value: function setupFormSubmission() {
      var _this3 = this;
      var form = this.querySelector("#login-form");
      form.addEventListener("submit", /*#__PURE__*/function () {
        var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event) {
          var token, formData, data, response, result, loginEvent;
          return _regeneratorRuntime().wrap(function _callee$(_context) {
            while (1) switch (_context.prev = _context.next) {
              case 0:
                event.preventDefault();

                // Check if user is already logged in
                token = localStorage.getItem("token");
                if (!token) {
                  _context.next = 5;
                  break;
                }
                window.location.href = "/#/home";
                return _context.abrupt("return");
              case 5:
                if (!_this3.isLoading) {
                  _context.next = 7;
                  break;
                }
                return _context.abrupt("return");
              case 7:
                formData = new FormData(form);
                data = Object.fromEntries(formData.entries());
                _this3.setLoading(true);
                _context.prev = 10;
                _context.next = 13;
                return fetch("https://api.pinjemin.site/api/auth/login", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json"
                  },
                  body: JSON.stringify(data)
                });
              case 13:
                response = _context.sent;
                _context.next = 16;
                return response.json();
              case 16:
                result = _context.sent;
                if (response.ok) {
                  if (result.status === "success") {
                    // Store token and user data in localStorage
                    localStorage.setItem("token", result.token);
                    localStorage.setItem("user", JSON.stringify(result.data.user));

                    // Dispatch a custom event to notify other components
                    loginEvent = new CustomEvent("userLoggedIn", {
                      detail: {
                        user: result.data.user
                      }
                    });
                    window.dispatchEvent(loginEvent);

                    // Show success toast
                    _this3.showToast("Login Successful!", "Welcome back! Redirecting to dashboard...", "success");

                    // Redirect after a short delay to show the toast
                    setTimeout(function () {
                      window.location.href = "/#/home";
                    }, 1500);
                  } else {
                    _this3.showToast("Login Failed", result.message || "Invalid credentials", "error");
                  }
                } else {
                  _this3.showToast("Login Failed", result.message || "Please check your credentials", "error");
                }
                _context.next = 23;
                break;
              case 20:
                _context.prev = 20;
                _context.t0 = _context["catch"](10);
                _this3.showToast("Connection Error", "Unable to connect to server. Please try again.", "error");
              case 23:
                _context.prev = 23;
                _this3.setLoading(false);
                return _context.finish(23);
              case 26:
              case "end":
                return _context.stop();
            }
          }, _callee, null, [[10, 20, 23, 26]]);
        }));
        return function (_x) {
          return _ref.apply(this, arguments);
        };
      }());
    }
  }]);
}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));
customElements.define("login-page", LoginPage);

/***/ }),

/***/ 424:
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(601);
/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(314);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, `// extracted by mini-css-extract-plugin
export {};`, ""]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 465:
/***/ (function(module) {

/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
(function (global, factory) {
   true ? module.exports = factory() :
  0;
})(this, (function () { 'use strict';

  function _assertClassBrand(e, t, n) {
    if ("function" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;
    throw new TypeError("Private element is not present on this object");
  }
  function _checkPrivateRedeclaration(e, t) {
    if (t.has(e)) throw new TypeError("Cannot initialize the same private elements twice on an object");
  }
  function _classPrivateFieldGet2(s, a) {
    return s.get(_assertClassBrand(s, a));
  }
  function _classPrivateFieldInitSpec(e, t, a) {
    _checkPrivateRedeclaration(e, t), t.set(e, a);
  }
  function _classPrivateFieldSet2(s, a, r) {
    return s.set(_assertClassBrand(s, a), r), r;
  }

  const RESTORE_FOCUS_TIMEOUT = 100;

  /** @type {GlobalState} */
  const globalState = {};
  const focusPreviousActiveElement = () => {
    if (globalState.previousActiveElement instanceof HTMLElement) {
      globalState.previousActiveElement.focus();
      globalState.previousActiveElement = null;
    } else if (document.body) {
      document.body.focus();
    }
  };

  /**
   * Restore previous active (focused) element
   *
   * @param {boolean} returnFocus
   * @returns {Promise<void>}
   */
  const restoreActiveElement = returnFocus => {
    return new Promise(resolve => {
      if (!returnFocus) {
        return resolve();
      }
      const x = window.scrollX;
      const y = window.scrollY;
      globalState.restoreFocusTimeout = setTimeout(() => {
        focusPreviousActiveElement();
        resolve();
      }, RESTORE_FOCUS_TIMEOUT); // issues/900

      window.scrollTo(x, y);
    });
  };

  const swalPrefix = 'swal2-';

  /**
   * @typedef {Record<SwalClass, string>} SwalClasses
   */

  /**
   * @typedef {'success' | 'warning' | 'info' | 'question' | 'error'} SwalIcon
   * @typedef {Record<SwalIcon, string>} SwalIcons
   */

  /** @type {SwalClass[]} */
  const classNames = ['container', 'shown', 'height-auto', 'iosfix', 'popup', 'modal', 'no-backdrop', 'no-transition', 'toast', 'toast-shown', 'show', 'hide', 'close', 'title', 'html-container', 'actions', 'confirm', 'deny', 'cancel', 'footer', 'icon', 'icon-content', 'image', 'input', 'file', 'range', 'select', 'radio', 'checkbox', 'label', 'textarea', 'inputerror', 'input-label', 'validation-message', 'progress-steps', 'active-progress-step', 'progress-step', 'progress-step-line', 'loader', 'loading', 'styled', 'top', 'top-start', 'top-end', 'top-left', 'top-right', 'center', 'center-start', 'center-end', 'center-left', 'center-right', 'bottom', 'bottom-start', 'bottom-end', 'bottom-left', 'bottom-right', 'grow-row', 'grow-column', 'grow-fullscreen', 'rtl', 'timer-progress-bar', 'timer-progress-bar-container', 'scrollbar-measure', 'icon-success', 'icon-warning', 'icon-info', 'icon-question', 'icon-error', 'draggable', 'dragging'];
  const swalClasses = classNames.reduce((acc, className) => {
    acc[className] = swalPrefix + className;
    return acc;
  }, /** @type {SwalClasses} */{});

  /** @type {SwalIcon[]} */
  const icons = ['success', 'warning', 'info', 'question', 'error'];
  const iconTypes = icons.reduce((acc, icon) => {
    acc[icon] = swalPrefix + icon;
    return acc;
  }, /** @type {SwalIcons} */{});

  const consolePrefix = 'SweetAlert2:';

  /**
   * Capitalize the first letter of a string
   *
   * @param {string} str
   * @returns {string}
   */
  const capitalizeFirstLetter = str => str.charAt(0).toUpperCase() + str.slice(1);

  /**
   * Standardize console warnings
   *
   * @param {string | string[]} message
   */
  const warn = message => {
    console.warn(`${consolePrefix} ${typeof message === 'object' ? message.join(' ') : message}`);
  };

  /**
   * Standardize console errors
   *
   * @param {string} message
   */
  const error = message => {
    console.error(`${consolePrefix} ${message}`);
  };

  /**
   * Private global state for `warnOnce`
   *
   * @type {string[]}
   * @private
   */
  const previousWarnOnceMessages = [];

  /**
   * Show a console warning, but only if it hasn't already been shown
   *
   * @param {string} message
   */
  const warnOnce = message => {
    if (!previousWarnOnceMessages.includes(message)) {
      previousWarnOnceMessages.push(message);
      warn(message);
    }
  };

  /**
   * Show a one-time console warning about deprecated params/methods
   *
   * @param {string} deprecatedParam
   * @param {string?} useInstead
   */
  const warnAboutDeprecation = (deprecatedParam, useInstead = null) => {
    warnOnce(`"${deprecatedParam}" is deprecated and will be removed in the next major release.${useInstead ? ` Use "${useInstead}" instead.` : ''}`);
  };

  /**
   * If `arg` is a function, call it (with no arguments or context) and return the result.
   * Otherwise, just pass the value through
   *
   * @param {Function | any} arg
   * @returns {any}
   */
  const callIfFunction = arg => typeof arg === 'function' ? arg() : arg;

  /**
   * @param {any} arg
   * @returns {boolean}
   */
  const hasToPromiseFn = arg => arg && typeof arg.toPromise === 'function';

  /**
   * @param {any} arg
   * @returns {Promise<any>}
   */
  const asPromise = arg => hasToPromiseFn(arg) ? arg.toPromise() : Promise.resolve(arg);

  /**
   * @param {any} arg
   * @returns {boolean}
   */
  const isPromise = arg => arg && Promise.resolve(arg) === arg;

  /**
   * Gets the popup container which contains the backdrop and the popup itself.
   *
   * @returns {HTMLElement | null}
   */
  const getContainer = () => document.body.querySelector(`.${swalClasses.container}`);

  /**
   * @param {string} selectorString
   * @returns {HTMLElement | null}
   */
  const elementBySelector = selectorString => {
    const container = getContainer();
    return container ? container.querySelector(selectorString) : null;
  };

  /**
   * @param {string} className
   * @returns {HTMLElement | null}
   */
  const elementByClass = className => {
    return elementBySelector(`.${className}`);
  };

  /**
   * @returns {HTMLElement | null}
   */
  const getPopup = () => elementByClass(swalClasses.popup);

  /**
   * @returns {HTMLElement | null}
   */
  const getIcon = () => elementByClass(swalClasses.icon);

  /**
   * @returns {HTMLElement | null}
   */
  const getIconContent = () => elementByClass(swalClasses['icon-content']);

  /**
   * @returns {HTMLElement | null}
   */
  const getTitle = () => elementByClass(swalClasses.title);

  /**
   * @returns {HTMLElement | null}
   */
  const getHtmlContainer = () => elementByClass(swalClasses['html-container']);

  /**
   * @returns {HTMLElement | null}
   */
  const getImage = () => elementByClass(swalClasses.image);

  /**
   * @returns {HTMLElement | null}
   */
  const getProgressSteps = () => elementByClass(swalClasses['progress-steps']);

  /**
   * @returns {HTMLElement | null}
   */
  const getValidationMessage = () => elementByClass(swalClasses['validation-message']);

  /**
   * @returns {HTMLButtonElement | null}
   */
  const getConfirmButton = () => (/** @type {HTMLButtonElement} */elementBySelector(`.${swalClasses.actions} .${swalClasses.confirm}`));

  /**
   * @returns {HTMLButtonElement | null}
   */
  const getCancelButton = () => (/** @type {HTMLButtonElement} */elementBySelector(`.${swalClasses.actions} .${swalClasses.cancel}`));

  /**
   * @returns {HTMLButtonElement | null}
   */
  const getDenyButton = () => (/** @type {HTMLButtonElement} */elementBySelector(`.${swalClasses.actions} .${swalClasses.deny}`));

  /**
   * @returns {HTMLElement | null}
   */
  const getInputLabel = () => elementByClass(swalClasses['input-label']);

  /**
   * @returns {HTMLElement | null}
   */
  const getLoader = () => elementBySelector(`.${swalClasses.loader}`);

  /**
   * @returns {HTMLElement | null}
   */
  const getActions = () => elementByClass(swalClasses.actions);

  /**
   * @returns {HTMLElement | null}
   */
  const getFooter = () => elementByClass(swalClasses.footer);

  /**
   * @returns {HTMLElement | null}
   */
  const getTimerProgressBar = () => elementByClass(swalClasses['timer-progress-bar']);

  /**
   * @returns {HTMLElement | null}
   */
  const getCloseButton = () => elementByClass(swalClasses.close);

  // https://github.com/jkup/focusable/blob/master/index.js
  const focusable = `
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`;
  /**
   * @returns {HTMLElement[]}
   */
  const getFocusableElements = () => {
    const popup = getPopup();
    if (!popup) {
      return [];
    }
    /** @type {NodeListOf<HTMLElement>} */
    const focusableElementsWithTabindex = popup.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])');
    const focusableElementsWithTabindexSorted = Array.from(focusableElementsWithTabindex)
    // sort according to tabindex
    .sort((a, b) => {
      const tabindexA = parseInt(a.getAttribute('tabindex') || '0');
      const tabindexB = parseInt(b.getAttribute('tabindex') || '0');
      if (tabindexA > tabindexB) {
        return 1;
      } else if (tabindexA < tabindexB) {
        return -1;
      }
      return 0;
    });

    /** @type {NodeListOf<HTMLElement>} */
    const otherFocusableElements = popup.querySelectorAll(focusable);
    const otherFocusableElementsFiltered = Array.from(otherFocusableElements).filter(el => el.getAttribute('tabindex') !== '-1');
    return [...new Set(focusableElementsWithTabindexSorted.concat(otherFocusableElementsFiltered))].filter(el => isVisible$1(el));
  };

  /**
   * @returns {boolean}
   */
  const isModal = () => {
    return hasClass(document.body, swalClasses.shown) && !hasClass(document.body, swalClasses['toast-shown']) && !hasClass(document.body, swalClasses['no-backdrop']);
  };

  /**
   * @returns {boolean}
   */
  const isToast = () => {
    const popup = getPopup();
    if (!popup) {
      return false;
    }
    return hasClass(popup, swalClasses.toast);
  };

  /**
   * @returns {boolean}
   */
  const isLoading = () => {
    const popup = getPopup();
    if (!popup) {
      return false;
    }
    return popup.hasAttribute('data-loading');
  };

  /**
   * Securely set innerHTML of an element
   * https://github.com/sweetalert2/sweetalert2/issues/1926
   *
   * @param {HTMLElement} elem
   * @param {string} html
   */
  const setInnerHtml = (elem, html) => {
    elem.textContent = '';
    if (html) {
      const parser = new DOMParser();
      const parsed = parser.parseFromString(html, `text/html`);
      const head = parsed.querySelector('head');
      if (head) {
        Array.from(head.childNodes).forEach(child => {
          elem.appendChild(child);
        });
      }
      const body = parsed.querySelector('body');
      if (body) {
        Array.from(body.childNodes).forEach(child => {
          if (child instanceof HTMLVideoElement || child instanceof HTMLAudioElement) {
            elem.appendChild(child.cloneNode(true)); // https://github.com/sweetalert2/sweetalert2/issues/2507
          } else {
            elem.appendChild(child);
          }
        });
      }
    }
  };

  /**
   * @param {HTMLElement} elem
   * @param {string} className
   * @returns {boolean}
   */
  const hasClass = (elem, className) => {
    if (!className) {
      return false;
    }
    const classList = className.split(/\s+/);
    for (let i = 0; i < classList.length; i++) {
      if (!elem.classList.contains(classList[i])) {
        return false;
      }
    }
    return true;
  };

  /**
   * @param {HTMLElement} elem
   * @param {SweetAlertOptions} params
   */
  const removeCustomClasses = (elem, params) => {
    Array.from(elem.classList).forEach(className => {
      if (!Object.values(swalClasses).includes(className) && !Object.values(iconTypes).includes(className) && !Object.values(params.showClass || {}).includes(className)) {
        elem.classList.remove(className);
      }
    });
  };

  /**
   * @param {HTMLElement} elem
   * @param {SweetAlertOptions} params
   * @param {string} className
   */
  const applyCustomClass = (elem, params, className) => {
    removeCustomClasses(elem, params);
    if (!params.customClass) {
      return;
    }
    const customClass = params.customClass[(/** @type {keyof SweetAlertCustomClass} */className)];
    if (!customClass) {
      return;
    }
    if (typeof customClass !== 'string' && !customClass.forEach) {
      warn(`Invalid type of customClass.${className}! Expected string or iterable object, got "${typeof customClass}"`);
      return;
    }
    addClass(elem, customClass);
  };

  /**
   * @param {HTMLElement} popup
   * @param {import('./renderers/renderInput').InputClass | SweetAlertInput} inputClass
   * @returns {HTMLInputElement | null}
   */
  const getInput$1 = (popup, inputClass) => {
    if (!inputClass) {
      return null;
    }
    switch (inputClass) {
      case 'select':
      case 'textarea':
      case 'file':
        return popup.querySelector(`.${swalClasses.popup} > .${swalClasses[inputClass]}`);
      case 'checkbox':
        return popup.querySelector(`.${swalClasses.popup} > .${swalClasses.checkbox} input`);
      case 'radio':
        return popup.querySelector(`.${swalClasses.popup} > .${swalClasses.radio} input:checked`) || popup.querySelector(`.${swalClasses.popup} > .${swalClasses.radio} input:first-child`);
      case 'range':
        return popup.querySelector(`.${swalClasses.popup} > .${swalClasses.range} input`);
      default:
        return popup.querySelector(`.${swalClasses.popup} > .${swalClasses.input}`);
    }
  };

  /**
   * @param {HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement} input
   */
  const focusInput = input => {
    input.focus();

    // place cursor at end of text in text input
    if (input.type !== 'file') {
      // http://stackoverflow.com/a/2345915
      const val = input.value;
      input.value = '';
      input.value = val;
    }
  };

  /**
   * @param {HTMLElement | HTMLElement[] | null} target
   * @param {string | string[] | readonly string[] | undefined} classList
   * @param {boolean} condition
   */
  const toggleClass = (target, classList, condition) => {
    if (!target || !classList) {
      return;
    }
    if (typeof classList === 'string') {
      classList = classList.split(/\s+/).filter(Boolean);
    }
    classList.forEach(className => {
      if (Array.isArray(target)) {
        target.forEach(elem => {
          if (condition) {
            elem.classList.add(className);
          } else {
            elem.classList.remove(className);
          }
        });
      } else {
        if (condition) {
          target.classList.add(className);
        } else {
          target.classList.remove(className);
        }
      }
    });
  };

  /**
   * @param {HTMLElement | HTMLElement[] | null} target
   * @param {string | string[] | readonly string[] | undefined} classList
   */
  const addClass = (target, classList) => {
    toggleClass(target, classList, true);
  };

  /**
   * @param {HTMLElement | HTMLElement[] | null} target
   * @param {string | string[] | readonly string[] | undefined} classList
   */
  const removeClass = (target, classList) => {
    toggleClass(target, classList, false);
  };

  /**
   * Get direct child of an element by class name
   *
   * @param {HTMLElement} elem
   * @param {string} className
   * @returns {HTMLElement | undefined}
   */
  const getDirectChildByClass = (elem, className) => {
    const children = Array.from(elem.children);
    for (let i = 0; i < children.length; i++) {
      const child = children[i];
      if (child instanceof HTMLElement && hasClass(child, className)) {
        return child;
      }
    }
  };

  /**
   * @param {HTMLElement} elem
   * @param {string} property
   * @param {*} value
   */
  const applyNumericalStyle = (elem, property, value) => {
    if (value === `${parseInt(value)}`) {
      value = parseInt(value);
    }
    if (value || parseInt(value) === 0) {
      elem.style.setProperty(property, typeof value === 'number' ? `${value}px` : value);
    } else {
      elem.style.removeProperty(property);
    }
  };

  /**
   * @param {HTMLElement | null} elem
   * @param {string} display
   */
  const show = (elem, display = 'flex') => {
    if (!elem) {
      return;
    }
    elem.style.display = display;
  };

  /**
   * @param {HTMLElement | null} elem
   */
  const hide = elem => {
    if (!elem) {
      return;
    }
    elem.style.display = 'none';
  };

  /**
   * @param {HTMLElement | null} elem
   * @param {string} display
   */
  const showWhenInnerHtmlPresent = (elem, display = 'block') => {
    if (!elem) {
      return;
    }
    new MutationObserver(() => {
      toggle(elem, elem.innerHTML, display);
    }).observe(elem, {
      childList: true,
      subtree: true
    });
  };

  /**
   * @param {HTMLElement} parent
   * @param {string} selector
   * @param {string} property
   * @param {string} value
   */
  const setStyle = (parent, selector, property, value) => {
    /** @type {HTMLElement | null} */
    const el = parent.querySelector(selector);
    if (el) {
      el.style.setProperty(property, value);
    }
  };

  /**
   * @param {HTMLElement} elem
   * @param {any} condition
   * @param {string} display
   */
  const toggle = (elem, condition, display = 'flex') => {
    if (condition) {
      show(elem, display);
    } else {
      hide(elem);
    }
  };

  /**
   * borrowed from jquery $(elem).is(':visible') implementation
   *
   * @param {HTMLElement | null} elem
   * @returns {boolean}
   */
  const isVisible$1 = elem => !!(elem && (elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length));

  /**
   * @returns {boolean}
   */
  const allButtonsAreHidden = () => !isVisible$1(getConfirmButton()) && !isVisible$1(getDenyButton()) && !isVisible$1(getCancelButton());

  /**
   * @param {HTMLElement} elem
   * @returns {boolean}
   */
  const isScrollable = elem => !!(elem.scrollHeight > elem.clientHeight);

  /**
   * @param {HTMLElement} element
   * @param {HTMLElement} stopElement
   * @returns {boolean}
   */
  const selfOrParentIsScrollable = (element, stopElement) => {
    let parent = element;
    while (parent && parent !== stopElement) {
      if (isScrollable(parent)) {
        return true;
      }
      parent = parent.parentElement;
    }
    return false;
  };

  /**
   * borrowed from https://stackoverflow.com/a/46352119
   *
   * @param {HTMLElement} elem
   * @returns {boolean}
   */
  const hasCssAnimation = elem => {
    const style = window.getComputedStyle(elem);
    const animDuration = parseFloat(style.getPropertyValue('animation-duration') || '0');
    const transDuration = parseFloat(style.getPropertyValue('transition-duration') || '0');
    return animDuration > 0 || transDuration > 0;
  };

  /**
   * @param {number} timer
   * @param {boolean} reset
   */
  const animateTimerProgressBar = (timer, reset = false) => {
    const timerProgressBar = getTimerProgressBar();
    if (!timerProgressBar) {
      return;
    }
    if (isVisible$1(timerProgressBar)) {
      if (reset) {
        timerProgressBar.style.transition = 'none';
        timerProgressBar.style.width = '100%';
      }
      setTimeout(() => {
        timerProgressBar.style.transition = `width ${timer / 1000}s linear`;
        timerProgressBar.style.width = '0%';
      }, 10);
    }
  };
  const stopTimerProgressBar = () => {
    const timerProgressBar = getTimerProgressBar();
    if (!timerProgressBar) {
      return;
    }
    const timerProgressBarWidth = parseInt(window.getComputedStyle(timerProgressBar).width);
    timerProgressBar.style.removeProperty('transition');
    timerProgressBar.style.width = '100%';
    const timerProgressBarFullWidth = parseInt(window.getComputedStyle(timerProgressBar).width);
    const timerProgressBarPercent = timerProgressBarWidth / timerProgressBarFullWidth * 100;
    timerProgressBar.style.width = `${timerProgressBarPercent}%`;
  };

  /**
   * Detect Node env
   *
   * @returns {boolean}
   */
  const isNodeEnv = () => typeof window === 'undefined' || typeof document === 'undefined';

  const sweetHTML = `
 <div aria-labelledby="${swalClasses.title}" aria-describedby="${swalClasses['html-container']}" class="${swalClasses.popup}" tabindex="-1">
   <button type="button" class="${swalClasses.close}"></button>
   <ul class="${swalClasses['progress-steps']}"></ul>
   <div class="${swalClasses.icon}"></div>
   <img class="${swalClasses.image}" />
   <h2 class="${swalClasses.title}" id="${swalClasses.title}"></h2>
   <div class="${swalClasses['html-container']}" id="${swalClasses['html-container']}"></div>
   <input class="${swalClasses.input}" id="${swalClasses.input}" />
   <input type="file" class="${swalClasses.file}" />
   <div class="${swalClasses.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${swalClasses.select}" id="${swalClasses.select}"></select>
   <div class="${swalClasses.radio}"></div>
   <label class="${swalClasses.checkbox}">
     <input type="checkbox" id="${swalClasses.checkbox}" />
     <span class="${swalClasses.label}"></span>
   </label>
   <textarea class="${swalClasses.textarea}" id="${swalClasses.textarea}"></textarea>
   <div class="${swalClasses['validation-message']}" id="${swalClasses['validation-message']}"></div>
   <div class="${swalClasses.actions}">
     <div class="${swalClasses.loader}"></div>
     <button type="button" class="${swalClasses.confirm}"></button>
     <button type="button" class="${swalClasses.deny}"></button>
     <button type="button" class="${swalClasses.cancel}"></button>
   </div>
   <div class="${swalClasses.footer}"></div>
   <div class="${swalClasses['timer-progress-bar-container']}">
     <div class="${swalClasses['timer-progress-bar']}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g, '');

  /**
   * @returns {boolean}
   */
  const resetOldContainer = () => {
    const oldContainer = getContainer();
    if (!oldContainer) {
      return false;
    }
    oldContainer.remove();
    removeClass([document.documentElement, document.body], [swalClasses['no-backdrop'], swalClasses['toast-shown'], swalClasses['has-column']]);
    return true;
  };
  const resetValidationMessage$1 = () => {
    globalState.currentInstance.resetValidationMessage();
  };
  const addInputChangeListeners = () => {
    const popup = getPopup();
    const input = getDirectChildByClass(popup, swalClasses.input);
    const file = getDirectChildByClass(popup, swalClasses.file);
    /** @type {HTMLInputElement} */
    const range = popup.querySelector(`.${swalClasses.range} input`);
    /** @type {HTMLOutputElement} */
    const rangeOutput = popup.querySelector(`.${swalClasses.range} output`);
    const select = getDirectChildByClass(popup, swalClasses.select);
    /** @type {HTMLInputElement} */
    const checkbox = popup.querySelector(`.${swalClasses.checkbox} input`);
    const textarea = getDirectChildByClass(popup, swalClasses.textarea);
    input.oninput = resetValidationMessage$1;
    file.onchange = resetValidationMessage$1;
    select.onchange = resetValidationMessage$1;
    checkbox.onchange = resetValidationMessage$1;
    textarea.oninput = resetValidationMessage$1;
    range.oninput = () => {
      resetValidationMessage$1();
      rangeOutput.value = range.value;
    };
    range.onchange = () => {
      resetValidationMessage$1();
      rangeOutput.value = range.value;
    };
  };

  /**
   * @param {string | HTMLElement} target
   * @returns {HTMLElement}
   */
  const getTarget = target => typeof target === 'string' ? document.querySelector(target) : target;

  /**
   * @param {SweetAlertOptions} params
   */
  const setupAccessibility = params => {
    const popup = getPopup();
    popup.setAttribute('role', params.toast ? 'alert' : 'dialog');
    popup.setAttribute('aria-live', params.toast ? 'polite' : 'assertive');
    if (!params.toast) {
      popup.setAttribute('aria-modal', 'true');
    }
  };

  /**
   * @param {HTMLElement} targetElement
   */
  const setupRTL = targetElement => {
    if (window.getComputedStyle(targetElement).direction === 'rtl') {
      addClass(getContainer(), swalClasses.rtl);
    }
  };

  /**
   * Add modal + backdrop + no-war message for Russians to DOM
   *
   * @param {SweetAlertOptions} params
   */
  const init = params => {
    // Clean up the old popup container if it exists
    const oldContainerExisted = resetOldContainer();
    if (isNodeEnv()) {
      error('SweetAlert2 requires document to initialize');
      return;
    }
    const container = document.createElement('div');
    container.className = swalClasses.container;
    if (oldContainerExisted) {
      addClass(container, swalClasses['no-transition']);
    }
    setInnerHtml(container, sweetHTML);
    container.dataset['swal2Theme'] = params.theme;
    const targetElement = getTarget(params.target);
    targetElement.appendChild(container);
    if (params.topLayer) {
      container.setAttribute('popover', '');
      container.showPopover();
    }
    setupAccessibility(params);
    setupRTL(targetElement);
    addInputChangeListeners();
  };

  /**
   * @param {HTMLElement | object | string} param
   * @param {HTMLElement} target
   */
  const parseHtmlToContainer = (param, target) => {
    // DOM element
    if (param instanceof HTMLElement) {
      target.appendChild(param);
    }

    // Object
    else if (typeof param === 'object') {
      handleObject(param, target);
    }

    // Plain string
    else if (param) {
      setInnerHtml(target, param);
    }
  };

  /**
   * @param {any} param
   * @param {HTMLElement} target
   */
  const handleObject = (param, target) => {
    // JQuery element(s)
    if (param.jquery) {
      handleJqueryElem(target, param);
    }

    // For other objects use their string representation
    else {
      setInnerHtml(target, param.toString());
    }
  };

  /**
   * @param {HTMLElement} target
   * @param {any} elem
   */
  const handleJqueryElem = (target, elem) => {
    target.textContent = '';
    if (0 in elem) {
      for (let i = 0; i in elem; i++) {
        target.appendChild(elem[i].cloneNode(true));
      }
    } else {
      target.appendChild(elem.cloneNode(true));
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderActions = (instance, params) => {
    const actions = getActions();
    const loader = getLoader();
    if (!actions || !loader) {
      return;
    }

    // Actions (buttons) wrapper
    if (!params.showConfirmButton && !params.showDenyButton && !params.showCancelButton) {
      hide(actions);
    } else {
      show(actions);
    }

    // Custom class
    applyCustomClass(actions, params, 'actions');

    // Render all the buttons
    renderButtons(actions, loader, params);

    // Loader
    setInnerHtml(loader, params.loaderHtml || '');
    applyCustomClass(loader, params, 'loader');
  };

  /**
   * @param {HTMLElement} actions
   * @param {HTMLElement} loader
   * @param {SweetAlertOptions} params
   */
  function renderButtons(actions, loader, params) {
    const confirmButton = getConfirmButton();
    const denyButton = getDenyButton();
    const cancelButton = getCancelButton();
    if (!confirmButton || !denyButton || !cancelButton) {
      return;
    }

    // Render buttons
    renderButton(confirmButton, 'confirm', params);
    renderButton(denyButton, 'deny', params);
    renderButton(cancelButton, 'cancel', params);
    handleButtonsStyling(confirmButton, denyButton, cancelButton, params);
    if (params.reverseButtons) {
      if (params.toast) {
        actions.insertBefore(cancelButton, confirmButton);
        actions.insertBefore(denyButton, confirmButton);
      } else {
        actions.insertBefore(cancelButton, loader);
        actions.insertBefore(denyButton, loader);
        actions.insertBefore(confirmButton, loader);
      }
    }
  }

  /**
   * @param {HTMLElement} confirmButton
   * @param {HTMLElement} denyButton
   * @param {HTMLElement} cancelButton
   * @param {SweetAlertOptions} params
   */
  function handleButtonsStyling(confirmButton, denyButton, cancelButton, params) {
    if (!params.buttonsStyling) {
      removeClass([confirmButton, denyButton, cancelButton], swalClasses.styled);
      return;
    }
    addClass([confirmButton, denyButton, cancelButton], swalClasses.styled);

    // Apply custom background colors to action buttons
    if (params.confirmButtonColor) {
      confirmButton.style.setProperty('--swal2-confirm-button-background-color', params.confirmButtonColor);
    }
    if (params.denyButtonColor) {
      denyButton.style.setProperty('--swal2-deny-button-background-color', params.denyButtonColor);
    }
    if (params.cancelButtonColor) {
      cancelButton.style.setProperty('--swal2-cancel-button-background-color', params.cancelButtonColor);
    }

    // Apply the outline color to action buttons
    applyOutlineColor(confirmButton);
    applyOutlineColor(denyButton);
    applyOutlineColor(cancelButton);
  }

  /**
   * @param {HTMLElement} button
   */
  function applyOutlineColor(button) {
    const buttonStyle = window.getComputedStyle(button);
    if (buttonStyle.getPropertyValue('--swal2-action-button-focus-box-shadow')) {
      // If the button already has a custom outline color, no need to change it
      return;
    }
    const outlineColor = buttonStyle.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/, 'rgba($1, $2, $3, 0.5)');
    button.style.setProperty('--swal2-action-button-focus-box-shadow', buttonStyle.getPropertyValue('--swal2-outline').replace(/ rgba\(.*/, ` ${outlineColor}`));
  }

  /**
   * @param {HTMLElement} button
   * @param {'confirm' | 'deny' | 'cancel'} buttonType
   * @param {SweetAlertOptions} params
   */
  function renderButton(button, buttonType, params) {
    const buttonName = /** @type {'Confirm' | 'Deny' | 'Cancel'} */capitalizeFirstLetter(buttonType);
    toggle(button, params[`show${buttonName}Button`], 'inline-block');
    setInnerHtml(button, params[`${buttonType}ButtonText`] || ''); // Set caption text
    button.setAttribute('aria-label', params[`${buttonType}ButtonAriaLabel`] || ''); // ARIA label

    // Add buttons custom classes
    button.className = swalClasses[buttonType];
    applyCustomClass(button, params, `${buttonType}Button`);
  }

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderCloseButton = (instance, params) => {
    const closeButton = getCloseButton();
    if (!closeButton) {
      return;
    }
    setInnerHtml(closeButton, params.closeButtonHtml || '');

    // Custom class
    applyCustomClass(closeButton, params, 'closeButton');
    toggle(closeButton, params.showCloseButton);
    closeButton.setAttribute('aria-label', params.closeButtonAriaLabel || '');
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderContainer = (instance, params) => {
    const container = getContainer();
    if (!container) {
      return;
    }
    handleBackdropParam(container, params.backdrop);
    handlePositionParam(container, params.position);
    handleGrowParam(container, params.grow);

    // Custom class
    applyCustomClass(container, params, 'container');
  };

  /**
   * @param {HTMLElement} container
   * @param {SweetAlertOptions['backdrop']} backdrop
   */
  function handleBackdropParam(container, backdrop) {
    if (typeof backdrop === 'string') {
      container.style.background = backdrop;
    } else if (!backdrop) {
      addClass([document.documentElement, document.body], swalClasses['no-backdrop']);
    }
  }

  /**
   * @param {HTMLElement} container
   * @param {SweetAlertOptions['position']} position
   */
  function handlePositionParam(container, position) {
    if (!position) {
      return;
    }
    if (position in swalClasses) {
      addClass(container, swalClasses[position]);
    } else {
      warn('The "position" parameter is not valid, defaulting to "center"');
      addClass(container, swalClasses.center);
    }
  }

  /**
   * @param {HTMLElement} container
   * @param {SweetAlertOptions['grow']} grow
   */
  function handleGrowParam(container, grow) {
    if (!grow) {
      return;
    }
    addClass(container, swalClasses[`grow-${grow}`]);
  }

  /**
   * This module contains `WeakMap`s for each effectively-"private  property" that a `Swal` has.
   * For example, to set the private property "foo" of `this` to "bar", you can `privateProps.foo.set(this, 'bar')`
   * This is the approach that Babel will probably take to implement private methods/fields
   *   https://github.com/tc39/proposal-private-methods
   *   https://github.com/babel/babel/pull/7555
   * Once we have the changes from that PR in Babel, and our core class fits reasonable in *one module*
   *   then we can use that language feature.
   */

  var privateProps = {
    innerParams: new WeakMap(),
    domCache: new WeakMap()
  };

  /// <reference path="../../../../sweetalert2.d.ts"/>


  /** @type {InputClass[]} */
  const inputClasses = ['input', 'file', 'range', 'select', 'radio', 'checkbox', 'textarea'];

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderInput = (instance, params) => {
    const popup = getPopup();
    if (!popup) {
      return;
    }
    const innerParams = privateProps.innerParams.get(instance);
    const rerender = !innerParams || params.input !== innerParams.input;
    inputClasses.forEach(inputClass => {
      const inputContainer = getDirectChildByClass(popup, swalClasses[inputClass]);
      if (!inputContainer) {
        return;
      }

      // set attributes
      setAttributes(inputClass, params.inputAttributes);

      // set class
      inputContainer.className = swalClasses[inputClass];
      if (rerender) {
        hide(inputContainer);
      }
    });
    if (params.input) {
      if (rerender) {
        showInput(params);
      }
      // set custom class
      setCustomClass(params);
    }
  };

  /**
   * @param {SweetAlertOptions} params
   */
  const showInput = params => {
    if (!params.input) {
      return;
    }
    if (!renderInputType[params.input]) {
      error(`Unexpected type of input! Expected ${Object.keys(renderInputType).join(' | ')}, got "${params.input}"`);
      return;
    }
    const inputContainer = getInputContainer(params.input);
    if (!inputContainer) {
      return;
    }
    const input = renderInputType[params.input](inputContainer, params);
    show(inputContainer);

    // input autofocus
    if (params.inputAutoFocus) {
      setTimeout(() => {
        focusInput(input);
      });
    }
  };

  /**
   * @param {HTMLInputElement} input
   */
  const removeAttributes = input => {
    for (let i = 0; i < input.attributes.length; i++) {
      const attrName = input.attributes[i].name;
      if (!['id', 'type', 'value', 'style'].includes(attrName)) {
        input.removeAttribute(attrName);
      }
    }
  };

  /**
   * @param {InputClass} inputClass
   * @param {SweetAlertOptions['inputAttributes']} inputAttributes
   */
  const setAttributes = (inputClass, inputAttributes) => {
    const popup = getPopup();
    if (!popup) {
      return;
    }
    const input = getInput$1(popup, inputClass);
    if (!input) {
      return;
    }
    removeAttributes(input);
    for (const attr in inputAttributes) {
      input.setAttribute(attr, inputAttributes[attr]);
    }
  };

  /**
   * @param {SweetAlertOptions} params
   */
  const setCustomClass = params => {
    if (!params.input) {
      return;
    }
    const inputContainer = getInputContainer(params.input);
    if (inputContainer) {
      applyCustomClass(inputContainer, params, 'input');
    }
  };

  /**
   * @param {HTMLInputElement | HTMLTextAreaElement} input
   * @param {SweetAlertOptions} params
   */
  const setInputPlaceholder = (input, params) => {
    if (!input.placeholder && params.inputPlaceholder) {
      input.placeholder = params.inputPlaceholder;
    }
  };

  /**
   * @param {Input} input
   * @param {Input} prependTo
   * @param {SweetAlertOptions} params
   */
  const setInputLabel = (input, prependTo, params) => {
    if (params.inputLabel) {
      const label = document.createElement('label');
      const labelClass = swalClasses['input-label'];
      label.setAttribute('for', input.id);
      label.className = labelClass;
      if (typeof params.customClass === 'object') {
        addClass(label, params.customClass.inputLabel);
      }
      label.innerText = params.inputLabel;
      prependTo.insertAdjacentElement('beforebegin', label);
    }
  };

  /**
   * @param {SweetAlertInput} inputType
   * @returns {HTMLElement | undefined}
   */
  const getInputContainer = inputType => {
    const popup = getPopup();
    if (!popup) {
      return;
    }
    return getDirectChildByClass(popup, swalClasses[(/** @type {SwalClass} */inputType)] || swalClasses.input);
  };

  /**
   * @param {HTMLInputElement | HTMLOutputElement | HTMLTextAreaElement} input
   * @param {SweetAlertOptions['inputValue']} inputValue
   */
  const checkAndSetInputValue = (input, inputValue) => {
    if (['string', 'number'].includes(typeof inputValue)) {
      input.value = `${inputValue}`;
    } else if (!isPromise(inputValue)) {
      warn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof inputValue}"`);
    }
  };

  /** @type {Record<SweetAlertInput, (input: Input | HTMLElement, params: SweetAlertOptions) => Input>} */
  const renderInputType = {};

  /**
   * @param {HTMLInputElement} input
   * @param {SweetAlertOptions} params
   * @returns {HTMLInputElement}
   */
  renderInputType.text = renderInputType.email = renderInputType.password = renderInputType.number = renderInputType.tel = renderInputType.url = renderInputType.search = renderInputType.date = renderInputType['datetime-local'] = renderInputType.time = renderInputType.week = renderInputType.month = /** @type {(input: Input | HTMLElement, params: SweetAlertOptions) => Input} */
  (input, params) => {
    checkAndSetInputValue(input, params.inputValue);
    setInputLabel(input, input, params);
    setInputPlaceholder(input, params);
    input.type = params.input;
    return input;
  };

  /**
   * @param {HTMLInputElement} input
   * @param {SweetAlertOptions} params
   * @returns {HTMLInputElement}
   */
  renderInputType.file = (input, params) => {
    setInputLabel(input, input, params);
    setInputPlaceholder(input, params);
    return input;
  };

  /**
   * @param {HTMLInputElement} range
   * @param {SweetAlertOptions} params
   * @returns {HTMLInputElement}
   */
  renderInputType.range = (range, params) => {
    const rangeInput = range.querySelector('input');
    const rangeOutput = range.querySelector('output');
    checkAndSetInputValue(rangeInput, params.inputValue);
    rangeInput.type = params.input;
    checkAndSetInputValue(rangeOutput, params.inputValue);
    setInputLabel(rangeInput, range, params);
    return range;
  };

  /**
   * @param {HTMLSelectElement} select
   * @param {SweetAlertOptions} params
   * @returns {HTMLSelectElement}
   */
  renderInputType.select = (select, params) => {
    select.textContent = '';
    if (params.inputPlaceholder) {
      const placeholder = document.createElement('option');
      setInnerHtml(placeholder, params.inputPlaceholder);
      placeholder.value = '';
      placeholder.disabled = true;
      placeholder.selected = true;
      select.appendChild(placeholder);
    }
    setInputLabel(select, select, params);
    return select;
  };

  /**
   * @param {HTMLInputElement} radio
   * @returns {HTMLInputElement}
   */
  renderInputType.radio = radio => {
    radio.textContent = '';
    return radio;
  };

  /**
   * @param {HTMLLabelElement} checkboxContainer
   * @param {SweetAlertOptions} params
   * @returns {HTMLInputElement}
   */
  renderInputType.checkbox = (checkboxContainer, params) => {
    const checkbox = getInput$1(getPopup(), 'checkbox');
    checkbox.value = '1';
    checkbox.checked = Boolean(params.inputValue);
    const label = checkboxContainer.querySelector('span');
    setInnerHtml(label, params.inputPlaceholder || params.inputLabel);
    return checkbox;
  };

  /**
   * @param {HTMLTextAreaElement} textarea
   * @param {SweetAlertOptions} params
   * @returns {HTMLTextAreaElement}
   */
  renderInputType.textarea = (textarea, params) => {
    checkAndSetInputValue(textarea, params.inputValue);
    setInputPlaceholder(textarea, params);
    setInputLabel(textarea, textarea, params);

    /**
     * @param {HTMLElement} el
     * @returns {number}
     */
    const getMargin = el => parseInt(window.getComputedStyle(el).marginLeft) + parseInt(window.getComputedStyle(el).marginRight);

    // https://github.com/sweetalert2/sweetalert2/issues/2291
    setTimeout(() => {
      // https://github.com/sweetalert2/sweetalert2/issues/1699
      if ('MutationObserver' in window) {
        const initialPopupWidth = parseInt(window.getComputedStyle(getPopup()).width);
        const textareaResizeHandler = () => {
          // check if texarea is still in document (i.e. popup wasn't closed in the meantime)
          if (!document.body.contains(textarea)) {
            return;
          }
          const textareaWidth = textarea.offsetWidth + getMargin(textarea);
          if (textareaWidth > initialPopupWidth) {
            getPopup().style.width = `${textareaWidth}px`;
          } else {
            applyNumericalStyle(getPopup(), 'width', params.width);
          }
        };
        new MutationObserver(textareaResizeHandler).observe(textarea, {
          attributes: true,
          attributeFilter: ['style']
        });
      }
    });
    return textarea;
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderContent = (instance, params) => {
    const htmlContainer = getHtmlContainer();
    if (!htmlContainer) {
      return;
    }
    showWhenInnerHtmlPresent(htmlContainer);
    applyCustomClass(htmlContainer, params, 'htmlContainer');

    // Content as HTML
    if (params.html) {
      parseHtmlToContainer(params.html, htmlContainer);
      show(htmlContainer, 'block');
    }

    // Content as plain text
    else if (params.text) {
      htmlContainer.textContent = params.text;
      show(htmlContainer, 'block');
    }

    // No content
    else {
      hide(htmlContainer);
    }
    renderInput(instance, params);
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderFooter = (instance, params) => {
    const footer = getFooter();
    if (!footer) {
      return;
    }
    showWhenInnerHtmlPresent(footer);
    toggle(footer, params.footer, 'block');
    if (params.footer) {
      parseHtmlToContainer(params.footer, footer);
    }

    // Custom class
    applyCustomClass(footer, params, 'footer');
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderIcon = (instance, params) => {
    const innerParams = privateProps.innerParams.get(instance);
    const icon = getIcon();
    if (!icon) {
      return;
    }

    // if the given icon already rendered, apply the styling without re-rendering the icon
    if (innerParams && params.icon === innerParams.icon) {
      // Custom or default content
      setContent(icon, params);
      applyStyles(icon, params);
      return;
    }
    if (!params.icon && !params.iconHtml) {
      hide(icon);
      return;
    }
    if (params.icon && Object.keys(iconTypes).indexOf(params.icon) === -1) {
      error(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${params.icon}"`);
      hide(icon);
      return;
    }
    show(icon);

    // Custom or default content
    setContent(icon, params);
    applyStyles(icon, params);

    // Animate icon
    addClass(icon, params.showClass && params.showClass.icon);

    // Re-adjust the success icon on system theme change
    const colorSchemeQueryList = window.matchMedia('(prefers-color-scheme: dark)');
    colorSchemeQueryList.addEventListener('change', adjustSuccessIconBackgroundColor);
  };

  /**
   * @param {HTMLElement} icon
   * @param {SweetAlertOptions} params
   */
  const applyStyles = (icon, params) => {
    for (const [iconType, iconClassName] of Object.entries(iconTypes)) {
      if (params.icon !== iconType) {
        removeClass(icon, iconClassName);
      }
    }
    addClass(icon, params.icon && iconTypes[params.icon]);

    // Icon color
    setColor(icon, params);

    // Success icon background color
    adjustSuccessIconBackgroundColor();

    // Custom class
    applyCustomClass(icon, params, 'icon');
  };

  // Adjust success icon background color to match the popup background color
  const adjustSuccessIconBackgroundColor = () => {
    const popup = getPopup();
    if (!popup) {
      return;
    }
    const popupBackgroundColor = window.getComputedStyle(popup).getPropertyValue('background-color');
    /** @type {NodeListOf<HTMLElement>} */
    const successIconParts = popup.querySelectorAll('[class^=swal2-success-circular-line], .swal2-success-fix');
    for (let i = 0; i < successIconParts.length; i++) {
      successIconParts[i].style.backgroundColor = popupBackgroundColor;
    }
  };
  const successIconHtml = `
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`;
  const errorIconHtml = `
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`;

  /**
   * @param {HTMLElement} icon
   * @param {SweetAlertOptions} params
   */
  const setContent = (icon, params) => {
    if (!params.icon && !params.iconHtml) {
      return;
    }
    let oldContent = icon.innerHTML;
    let newContent = '';
    if (params.iconHtml) {
      newContent = iconContent(params.iconHtml);
    } else if (params.icon === 'success') {
      newContent = successIconHtml;
      oldContent = oldContent.replace(/ style=".*?"/g, ''); // undo adjustSuccessIconBackgroundColor()
    } else if (params.icon === 'error') {
      newContent = errorIconHtml;
    } else if (params.icon) {
      const defaultIconHtml = {
        question: '?',
        warning: '!',
        info: 'i'
      };
      newContent = iconContent(defaultIconHtml[params.icon]);
    }
    if (oldContent.trim() !== newContent.trim()) {
      setInnerHtml(icon, newContent);
    }
  };

  /**
   * @param {HTMLElement} icon
   * @param {SweetAlertOptions} params
   */
  const setColor = (icon, params) => {
    if (!params.iconColor) {
      return;
    }
    icon.style.color = params.iconColor;
    icon.style.borderColor = params.iconColor;
    for (const sel of ['.swal2-success-line-tip', '.swal2-success-line-long', '.swal2-x-mark-line-left', '.swal2-x-mark-line-right']) {
      setStyle(icon, sel, 'background-color', params.iconColor);
    }
    setStyle(icon, '.swal2-success-ring', 'border-color', params.iconColor);
  };

  /**
   * @param {string} content
   * @returns {string}
   */
  const iconContent = content => `<div class="${swalClasses['icon-content']}">${content}</div>`;

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderImage = (instance, params) => {
    const image = getImage();
    if (!image) {
      return;
    }
    if (!params.imageUrl) {
      hide(image);
      return;
    }
    show(image, '');

    // Src, alt
    image.setAttribute('src', params.imageUrl);
    image.setAttribute('alt', params.imageAlt || '');

    // Width, height
    applyNumericalStyle(image, 'width', params.imageWidth);
    applyNumericalStyle(image, 'height', params.imageHeight);

    // Class
    image.className = swalClasses.image;
    applyCustomClass(image, params, 'image');
  };

  let dragging = false;
  let mousedownX = 0;
  let mousedownY = 0;
  let initialX = 0;
  let initialY = 0;

  /**
   * @param {HTMLElement} popup
   */
  const addDraggableListeners = popup => {
    popup.addEventListener('mousedown', down);
    document.body.addEventListener('mousemove', move);
    popup.addEventListener('mouseup', up);
    popup.addEventListener('touchstart', down);
    document.body.addEventListener('touchmove', move);
    popup.addEventListener('touchend', up);
  };

  /**
   * @param {HTMLElement} popup
   */
  const removeDraggableListeners = popup => {
    popup.removeEventListener('mousedown', down);
    document.body.removeEventListener('mousemove', move);
    popup.removeEventListener('mouseup', up);
    popup.removeEventListener('touchstart', down);
    document.body.removeEventListener('touchmove', move);
    popup.removeEventListener('touchend', up);
  };

  /**
   * @param {MouseEvent | TouchEvent} event
   */
  const down = event => {
    const popup = getPopup();
    if (event.target === popup || getIcon().contains(/** @type {HTMLElement} */event.target)) {
      dragging = true;
      const clientXY = getClientXY(event);
      mousedownX = clientXY.clientX;
      mousedownY = clientXY.clientY;
      initialX = parseInt(popup.style.insetInlineStart) || 0;
      initialY = parseInt(popup.style.insetBlockStart) || 0;
      addClass(popup, 'swal2-dragging');
    }
  };

  /**
   * @param {MouseEvent | TouchEvent} event
   */
  const move = event => {
    const popup = getPopup();
    if (dragging) {
      let {
        clientX,
        clientY
      } = getClientXY(event);
      popup.style.insetInlineStart = `${initialX + (clientX - mousedownX)}px`;
      popup.style.insetBlockStart = `${initialY + (clientY - mousedownY)}px`;
    }
  };
  const up = () => {
    const popup = getPopup();
    dragging = false;
    removeClass(popup, 'swal2-dragging');
  };

  /**
   * @param {MouseEvent | TouchEvent} event
   * @returns {{ clientX: number, clientY: number }}
   */
  const getClientXY = event => {
    let clientX = 0,
      clientY = 0;
    if (event.type.startsWith('mouse')) {
      clientX = /** @type {MouseEvent} */event.clientX;
      clientY = /** @type {MouseEvent} */event.clientY;
    } else if (event.type.startsWith('touch')) {
      clientX = /** @type {TouchEvent} */event.touches[0].clientX;
      clientY = /** @type {TouchEvent} */event.touches[0].clientY;
    }
    return {
      clientX,
      clientY
    };
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderPopup = (instance, params) => {
    const container = getContainer();
    const popup = getPopup();
    if (!container || !popup) {
      return;
    }

    // Width
    // https://github.com/sweetalert2/sweetalert2/issues/2170
    if (params.toast) {
      applyNumericalStyle(container, 'width', params.width);
      popup.style.width = '100%';
      const loader = getLoader();
      if (loader) {
        popup.insertBefore(loader, getIcon());
      }
    } else {
      applyNumericalStyle(popup, 'width', params.width);
    }

    // Padding
    applyNumericalStyle(popup, 'padding', params.padding);

    // Color
    if (params.color) {
      popup.style.color = params.color;
    }

    // Background
    if (params.background) {
      popup.style.background = params.background;
    }
    hide(getValidationMessage());

    // Classes
    addClasses$1(popup, params);
    if (params.draggable && !params.toast) {
      addClass(popup, swalClasses.draggable);
      addDraggableListeners(popup);
    } else {
      removeClass(popup, swalClasses.draggable);
      removeDraggableListeners(popup);
    }
  };

  /**
   * @param {HTMLElement} popup
   * @param {SweetAlertOptions} params
   */
  const addClasses$1 = (popup, params) => {
    const showClass = params.showClass || {};
    // Default Class + showClass when updating Swal.update({})
    popup.className = `${swalClasses.popup} ${isVisible$1(popup) ? showClass.popup : ''}`;
    if (params.toast) {
      addClass([document.documentElement, document.body], swalClasses['toast-shown']);
      addClass(popup, swalClasses.toast);
    } else {
      addClass(popup, swalClasses.modal);
    }

    // Custom class
    applyCustomClass(popup, params, 'popup');
    // TODO: remove in the next major
    if (typeof params.customClass === 'string') {
      addClass(popup, params.customClass);
    }

    // Icon class (#1842)
    if (params.icon) {
      addClass(popup, swalClasses[`icon-${params.icon}`]);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderProgressSteps = (instance, params) => {
    const progressStepsContainer = getProgressSteps();
    if (!progressStepsContainer) {
      return;
    }
    const {
      progressSteps,
      currentProgressStep
    } = params;
    if (!progressSteps || progressSteps.length === 0 || currentProgressStep === undefined) {
      hide(progressStepsContainer);
      return;
    }
    show(progressStepsContainer);
    progressStepsContainer.textContent = '';
    if (currentProgressStep >= progressSteps.length) {
      warn('Invalid currentProgressStep parameter, it should be less than progressSteps.length ' + '(currentProgressStep like JS arrays starts from 0)');
    }
    progressSteps.forEach((step, index) => {
      const stepEl = createStepElement(step);
      progressStepsContainer.appendChild(stepEl);
      if (index === currentProgressStep) {
        addClass(stepEl, swalClasses['active-progress-step']);
      }
      if (index !== progressSteps.length - 1) {
        const lineEl = createLineElement(params);
        progressStepsContainer.appendChild(lineEl);
      }
    });
  };

  /**
   * @param {string} step
   * @returns {HTMLLIElement}
   */
  const createStepElement = step => {
    const stepEl = document.createElement('li');
    addClass(stepEl, swalClasses['progress-step']);
    setInnerHtml(stepEl, step);
    return stepEl;
  };

  /**
   * @param {SweetAlertOptions} params
   * @returns {HTMLLIElement}
   */
  const createLineElement = params => {
    const lineEl = document.createElement('li');
    addClass(lineEl, swalClasses['progress-step-line']);
    if (params.progressStepsDistance) {
      applyNumericalStyle(lineEl, 'width', params.progressStepsDistance);
    }
    return lineEl;
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const renderTitle = (instance, params) => {
    const title = getTitle();
    if (!title) {
      return;
    }
    showWhenInnerHtmlPresent(title);
    toggle(title, params.title || params.titleText, 'block');
    if (params.title) {
      parseHtmlToContainer(params.title, title);
    }
    if (params.titleText) {
      title.innerText = params.titleText;
    }

    // Custom class
    applyCustomClass(title, params, 'title');
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const render = (instance, params) => {
    renderPopup(instance, params);
    renderContainer(instance, params);
    renderProgressSteps(instance, params);
    renderIcon(instance, params);
    renderImage(instance, params);
    renderTitle(instance, params);
    renderCloseButton(instance, params);
    renderContent(instance, params);
    renderActions(instance, params);
    renderFooter(instance, params);
    const popup = getPopup();
    if (typeof params.didRender === 'function' && popup) {
      params.didRender(popup);
    }
    globalState.eventEmitter.emit('didRender', popup);
  };

  /*
   * Global function to determine if SweetAlert2 popup is shown
   */
  const isVisible = () => {
    return isVisible$1(getPopup());
  };

  /*
   * Global function to click 'Confirm' button
   */
  const clickConfirm = () => {
    var _dom$getConfirmButton;
    return (_dom$getConfirmButton = getConfirmButton()) === null || _dom$getConfirmButton === void 0 ? void 0 : _dom$getConfirmButton.click();
  };

  /*
   * Global function to click 'Deny' button
   */
  const clickDeny = () => {
    var _dom$getDenyButton;
    return (_dom$getDenyButton = getDenyButton()) === null || _dom$getDenyButton === void 0 ? void 0 : _dom$getDenyButton.click();
  };

  /*
   * Global function to click 'Cancel' button
   */
  const clickCancel = () => {
    var _dom$getCancelButton;
    return (_dom$getCancelButton = getCancelButton()) === null || _dom$getCancelButton === void 0 ? void 0 : _dom$getCancelButton.click();
  };

  /** @typedef {'cancel' | 'backdrop' | 'close' | 'esc' | 'timer'} DismissReason */

  /** @type {Record<DismissReason, DismissReason>} */
  const DismissReason = Object.freeze({
    cancel: 'cancel',
    backdrop: 'backdrop',
    close: 'close',
    esc: 'esc',
    timer: 'timer'
  });

  /**
   * @param {GlobalState} globalState
   */
  const removeKeydownHandler = globalState => {
    if (globalState.keydownTarget && globalState.keydownHandlerAdded) {
      globalState.keydownTarget.removeEventListener('keydown', globalState.keydownHandler, {
        capture: globalState.keydownListenerCapture
      });
      globalState.keydownHandlerAdded = false;
    }
  };

  /**
   * @param {GlobalState} globalState
   * @param {SweetAlertOptions} innerParams
   * @param {*} dismissWith
   */
  const addKeydownHandler = (globalState, innerParams, dismissWith) => {
    removeKeydownHandler(globalState);
    if (!innerParams.toast) {
      globalState.keydownHandler = e => keydownHandler(innerParams, e, dismissWith);
      globalState.keydownTarget = innerParams.keydownListenerCapture ? window : getPopup();
      globalState.keydownListenerCapture = innerParams.keydownListenerCapture;
      globalState.keydownTarget.addEventListener('keydown', globalState.keydownHandler, {
        capture: globalState.keydownListenerCapture
      });
      globalState.keydownHandlerAdded = true;
    }
  };

  /**
   * @param {number} index
   * @param {number} increment
   */
  const setFocus = (index, increment) => {
    var _dom$getPopup;
    const focusableElements = getFocusableElements();
    // search for visible elements and select the next possible match
    if (focusableElements.length) {
      index = index + increment;

      // shift + tab when .swal2-popup is focused
      if (index === -2) {
        index = focusableElements.length - 1;
      }

      // rollover to first item
      if (index === focusableElements.length) {
        index = 0;

        // go to last item
      } else if (index === -1) {
        index = focusableElements.length - 1;
      }
      focusableElements[index].focus();
      return;
    }
    // no visible focusable elements, focus the popup
    (_dom$getPopup = getPopup()) === null || _dom$getPopup === void 0 || _dom$getPopup.focus();
  };
  const arrowKeysNextButton = ['ArrowRight', 'ArrowDown'];
  const arrowKeysPreviousButton = ['ArrowLeft', 'ArrowUp'];

  /**
   * @param {SweetAlertOptions} innerParams
   * @param {KeyboardEvent} event
   * @param {Function} dismissWith
   */
  const keydownHandler = (innerParams, event, dismissWith) => {
    if (!innerParams) {
      return; // This instance has already been destroyed
    }

    // Ignore keydown during IME composition
    // https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event#ignoring_keydown_during_ime_composition
    // https://github.com/sweetalert2/sweetalert2/issues/720
    // https://github.com/sweetalert2/sweetalert2/issues/2406
    if (event.isComposing || event.keyCode === 229) {
      return;
    }
    if (innerParams.stopKeydownPropagation) {
      event.stopPropagation();
    }

    // ENTER
    if (event.key === 'Enter') {
      handleEnter(event, innerParams);
    }

    // TAB
    else if (event.key === 'Tab') {
      handleTab(event);
    }

    // ARROWS - switch focus between buttons
    else if ([...arrowKeysNextButton, ...arrowKeysPreviousButton].includes(event.key)) {
      handleArrows(event.key);
    }

    // ESC
    else if (event.key === 'Escape') {
      handleEsc(event, innerParams, dismissWith);
    }
  };

  /**
   * @param {KeyboardEvent} event
   * @param {SweetAlertOptions} innerParams
   */
  const handleEnter = (event, innerParams) => {
    // https://github.com/sweetalert2/sweetalert2/issues/2386
    if (!callIfFunction(innerParams.allowEnterKey)) {
      return;
    }
    const input = getInput$1(getPopup(), innerParams.input);
    if (event.target && input && event.target instanceof HTMLElement && event.target.outerHTML === input.outerHTML) {
      if (['textarea', 'file'].includes(innerParams.input)) {
        return; // do not submit
      }
      clickConfirm();
      event.preventDefault();
    }
  };

  /**
   * @param {KeyboardEvent} event
   */
  const handleTab = event => {
    const targetElement = event.target;
    const focusableElements = getFocusableElements();
    let btnIndex = -1;
    for (let i = 0; i < focusableElements.length; i++) {
      if (targetElement === focusableElements[i]) {
        btnIndex = i;
        break;
      }
    }

    // Cycle to the next button
    if (!event.shiftKey) {
      setFocus(btnIndex, 1);
    }

    // Cycle to the prev button
    else {
      setFocus(btnIndex, -1);
    }
    event.stopPropagation();
    event.preventDefault();
  };

  /**
   * @param {string} key
   */
  const handleArrows = key => {
    const actions = getActions();
    const confirmButton = getConfirmButton();
    const denyButton = getDenyButton();
    const cancelButton = getCancelButton();
    if (!actions || !confirmButton || !denyButton || !cancelButton) {
      return;
    }
    /** @type HTMLElement[] */
    const buttons = [confirmButton, denyButton, cancelButton];
    if (document.activeElement instanceof HTMLElement && !buttons.includes(document.activeElement)) {
      return;
    }
    const sibling = arrowKeysNextButton.includes(key) ? 'nextElementSibling' : 'previousElementSibling';
    let buttonToFocus = document.activeElement;
    if (!buttonToFocus) {
      return;
    }
    for (let i = 0; i < actions.children.length; i++) {
      buttonToFocus = buttonToFocus[sibling];
      if (!buttonToFocus) {
        return;
      }
      if (buttonToFocus instanceof HTMLButtonElement && isVisible$1(buttonToFocus)) {
        break;
      }
    }
    if (buttonToFocus instanceof HTMLButtonElement) {
      buttonToFocus.focus();
    }
  };

  /**
   * @param {KeyboardEvent} event
   * @param {SweetAlertOptions} innerParams
   * @param {Function} dismissWith
   */
  const handleEsc = (event, innerParams, dismissWith) => {
    if (callIfFunction(innerParams.allowEscapeKey)) {
      event.preventDefault();
      dismissWith(DismissReason.esc);
    }
  };

  /**
   * This module contains `WeakMap`s for each effectively-"private  property" that a `Swal` has.
   * For example, to set the private property "foo" of `this` to "bar", you can `privateProps.foo.set(this, 'bar')`
   * This is the approach that Babel will probably take to implement private methods/fields
   *   https://github.com/tc39/proposal-private-methods
   *   https://github.com/babel/babel/pull/7555
   * Once we have the changes from that PR in Babel, and our core class fits reasonable in *one module*
   *   then we can use that language feature.
   */

  var privateMethods = {
    swalPromiseResolve: new WeakMap(),
    swalPromiseReject: new WeakMap()
  };

  // From https://developer.paciellogroup.com/blog/2018/06/the-current-state-of-modal-dialog-accessibility/
  // Adding aria-hidden="true" to elements outside of the active modal dialog ensures that
  // elements not within the active modal dialog will not be surfaced if a user opens a screen
  // reader’s list of elements (headings, form controls, landmarks, etc.) in the document.

  const setAriaHidden = () => {
    const container = getContainer();
    const bodyChildren = Array.from(document.body.children);
    bodyChildren.forEach(el => {
      if (el.contains(container)) {
        return;
      }
      if (el.hasAttribute('aria-hidden')) {
        el.setAttribute('data-previous-aria-hidden', el.getAttribute('aria-hidden') || '');
      }
      el.setAttribute('aria-hidden', 'true');
    });
  };
  const unsetAriaHidden = () => {
    const bodyChildren = Array.from(document.body.children);
    bodyChildren.forEach(el => {
      if (el.hasAttribute('data-previous-aria-hidden')) {
        el.setAttribute('aria-hidden', el.getAttribute('data-previous-aria-hidden') || '');
        el.removeAttribute('data-previous-aria-hidden');
      } else {
        el.removeAttribute('aria-hidden');
      }
    });
  };

  // @ts-ignore
  const isSafariOrIOS = typeof window !== 'undefined' && !!window.GestureEvent; // true for Safari desktop + all iOS browsers https://stackoverflow.com/a/70585394

  /**
   * Fix iOS scrolling
   * http://stackoverflow.com/q/39626302
   */
  const iOSfix = () => {
    if (isSafariOrIOS && !hasClass(document.body, swalClasses.iosfix)) {
      const offset = document.body.scrollTop;
      document.body.style.top = `${offset * -1}px`;
      addClass(document.body, swalClasses.iosfix);
      lockBodyScroll();
    }
  };

  /**
   * https://github.com/sweetalert2/sweetalert2/issues/1246
   */
  const lockBodyScroll = () => {
    const container = getContainer();
    if (!container) {
      return;
    }
    /** @type {boolean} */
    let preventTouchMove;
    /**
     * @param {TouchEvent} event
     */
    container.ontouchstart = event => {
      preventTouchMove = shouldPreventTouchMove(event);
    };
    /**
     * @param {TouchEvent} event
     */
    container.ontouchmove = event => {
      if (preventTouchMove) {
        event.preventDefault();
        event.stopPropagation();
      }
    };
  };

  /**
   * @param {TouchEvent} event
   * @returns {boolean}
   */
  const shouldPreventTouchMove = event => {
    const target = event.target;
    const container = getContainer();
    const htmlContainer = getHtmlContainer();
    if (!container || !htmlContainer) {
      return false;
    }
    if (isStylus(event) || isZoom(event)) {
      return false;
    }
    if (target === container) {
      return true;
    }
    if (!isScrollable(container) && target instanceof HTMLElement && !selfOrParentIsScrollable(target, htmlContainer) &&
    // #2823
    target.tagName !== 'INPUT' &&
    // #1603
    target.tagName !== 'TEXTAREA' &&
    // #2266
    !(isScrollable(htmlContainer) &&
    // #1944
    htmlContainer.contains(target))) {
      return true;
    }
    return false;
  };

  /**
   * https://github.com/sweetalert2/sweetalert2/issues/1786
   *
   * @param {*} event
   * @returns {boolean}
   */
  const isStylus = event => {
    return event.touches && event.touches.length && event.touches[0].touchType === 'stylus';
  };

  /**
   * https://github.com/sweetalert2/sweetalert2/issues/1891
   *
   * @param {TouchEvent} event
   * @returns {boolean}
   */
  const isZoom = event => {
    return event.touches && event.touches.length > 1;
  };
  const undoIOSfix = () => {
    if (hasClass(document.body, swalClasses.iosfix)) {
      const offset = parseInt(document.body.style.top, 10);
      removeClass(document.body, swalClasses.iosfix);
      document.body.style.top = '';
      document.body.scrollTop = offset * -1;
    }
  };

  /**
   * Measure scrollbar width for padding body during modal show/hide
   * https://github.com/twbs/bootstrap/blob/master/js/src/modal.js
   *
   * @returns {number}
   */
  const measureScrollbar = () => {
    const scrollDiv = document.createElement('div');
    scrollDiv.className = swalClasses['scrollbar-measure'];
    document.body.appendChild(scrollDiv);
    const scrollbarWidth = scrollDiv.getBoundingClientRect().width - scrollDiv.clientWidth;
    document.body.removeChild(scrollDiv);
    return scrollbarWidth;
  };

  /**
   * Remember state in cases where opening and handling a modal will fiddle with it.
   * @type {number | null}
   */
  let previousBodyPadding = null;

  /**
   * @param {string} initialBodyOverflow
   */
  const replaceScrollbarWithPadding = initialBodyOverflow => {
    // for queues, do not do this more than once
    if (previousBodyPadding !== null) {
      return;
    }
    // if the body has overflow
    if (document.body.scrollHeight > window.innerHeight || initialBodyOverflow === 'scroll' // https://github.com/sweetalert2/sweetalert2/issues/2663
    ) {
      // add padding so the content doesn't shift after removal of scrollbar
      previousBodyPadding = parseInt(window.getComputedStyle(document.body).getPropertyValue('padding-right'));
      document.body.style.paddingRight = `${previousBodyPadding + measureScrollbar()}px`;
    }
  };
  const undoReplaceScrollbarWithPadding = () => {
    if (previousBodyPadding !== null) {
      document.body.style.paddingRight = `${previousBodyPadding}px`;
      previousBodyPadding = null;
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {HTMLElement} container
   * @param {boolean} returnFocus
   * @param {Function} didClose
   */
  function removePopupAndResetState(instance, container, returnFocus, didClose) {
    if (isToast()) {
      triggerDidCloseAndDispose(instance, didClose);
    } else {
      restoreActiveElement(returnFocus).then(() => triggerDidCloseAndDispose(instance, didClose));
      removeKeydownHandler(globalState);
    }

    // workaround for https://github.com/sweetalert2/sweetalert2/issues/2088
    // for some reason removing the container in Safari will scroll the document to bottom
    if (isSafariOrIOS) {
      container.setAttribute('style', 'display:none !important');
      container.removeAttribute('class');
      container.innerHTML = '';
    } else {
      container.remove();
    }
    if (isModal()) {
      undoReplaceScrollbarWithPadding();
      undoIOSfix();
      unsetAriaHidden();
    }
    removeBodyClasses();
  }

  /**
   * Remove SweetAlert2 classes from body
   */
  function removeBodyClasses() {
    removeClass([document.documentElement, document.body], [swalClasses.shown, swalClasses['height-auto'], swalClasses['no-backdrop'], swalClasses['toast-shown']]);
  }

  /**
   * Instance method to close sweetAlert
   *
   * @param {any} resolveValue
   */
  function close(resolveValue) {
    resolveValue = prepareResolveValue(resolveValue);
    const swalPromiseResolve = privateMethods.swalPromiseResolve.get(this);
    const didClose = triggerClosePopup(this);
    if (this.isAwaitingPromise) {
      // A swal awaiting for a promise (after a click on Confirm or Deny) cannot be dismissed anymore #2335
      if (!resolveValue.isDismissed) {
        handleAwaitingPromise(this);
        swalPromiseResolve(resolveValue);
      }
    } else if (didClose) {
      // Resolve Swal promise
      swalPromiseResolve(resolveValue);
    }
  }
  const triggerClosePopup = instance => {
    const popup = getPopup();
    if (!popup) {
      return false;
    }
    const innerParams = privateProps.innerParams.get(instance);
    if (!innerParams || hasClass(popup, innerParams.hideClass.popup)) {
      return false;
    }
    removeClass(popup, innerParams.showClass.popup);
    addClass(popup, innerParams.hideClass.popup);
    const backdrop = getContainer();
    removeClass(backdrop, innerParams.showClass.backdrop);
    addClass(backdrop, innerParams.hideClass.backdrop);
    handlePopupAnimation(instance, popup, innerParams);
    return true;
  };

  /**
   * @param {any} error
   */
  function rejectPromise(error) {
    const rejectPromise = privateMethods.swalPromiseReject.get(this);
    handleAwaitingPromise(this);
    if (rejectPromise) {
      // Reject Swal promise
      rejectPromise(error);
    }
  }

  /**
   * @param {SweetAlert} instance
   */
  const handleAwaitingPromise = instance => {
    if (instance.isAwaitingPromise) {
      delete instance.isAwaitingPromise;
      // The instance might have been previously partly destroyed, we must resume the destroy process in this case #2335
      if (!privateProps.innerParams.get(instance)) {
        instance._destroy();
      }
    }
  };

  /**
   * @param {any} resolveValue
   * @returns {SweetAlertResult}
   */
  const prepareResolveValue = resolveValue => {
    // When user calls Swal.close()
    if (typeof resolveValue === 'undefined') {
      return {
        isConfirmed: false,
        isDenied: false,
        isDismissed: true
      };
    }
    return Object.assign({
      isConfirmed: false,
      isDenied: false,
      isDismissed: false
    }, resolveValue);
  };

  /**
   * @param {SweetAlert} instance
   * @param {HTMLElement} popup
   * @param {SweetAlertOptions} innerParams
   */
  const handlePopupAnimation = (instance, popup, innerParams) => {
    var _globalState$eventEmi;
    const container = getContainer();
    // If animation is supported, animate
    const animationIsSupported = hasCssAnimation(popup);
    if (typeof innerParams.willClose === 'function') {
      innerParams.willClose(popup);
    }
    (_globalState$eventEmi = globalState.eventEmitter) === null || _globalState$eventEmi === void 0 || _globalState$eventEmi.emit('willClose', popup);
    if (animationIsSupported) {
      animatePopup(instance, popup, container, innerParams.returnFocus, innerParams.didClose);
    } else {
      // Otherwise, remove immediately
      removePopupAndResetState(instance, container, innerParams.returnFocus, innerParams.didClose);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {HTMLElement} popup
   * @param {HTMLElement} container
   * @param {boolean} returnFocus
   * @param {Function} didClose
   */
  const animatePopup = (instance, popup, container, returnFocus, didClose) => {
    globalState.swalCloseEventFinishedCallback = removePopupAndResetState.bind(null, instance, container, returnFocus, didClose);
    /**
     * @param {AnimationEvent | TransitionEvent} e
     */
    const swalCloseAnimationFinished = function (e) {
      if (e.target === popup) {
        var _globalState$swalClos;
        (_globalState$swalClos = globalState.swalCloseEventFinishedCallback) === null || _globalState$swalClos === void 0 || _globalState$swalClos.call(globalState);
        delete globalState.swalCloseEventFinishedCallback;
        popup.removeEventListener('animationend', swalCloseAnimationFinished);
        popup.removeEventListener('transitionend', swalCloseAnimationFinished);
      }
    };
    popup.addEventListener('animationend', swalCloseAnimationFinished);
    popup.addEventListener('transitionend', swalCloseAnimationFinished);
  };

  /**
   * @param {SweetAlert} instance
   * @param {Function} didClose
   */
  const triggerDidCloseAndDispose = (instance, didClose) => {
    setTimeout(() => {
      var _globalState$eventEmi2;
      if (typeof didClose === 'function') {
        didClose.bind(instance.params)();
      }
      (_globalState$eventEmi2 = globalState.eventEmitter) === null || _globalState$eventEmi2 === void 0 || _globalState$eventEmi2.emit('didClose');
      // instance might have been destroyed already
      if (instance._destroy) {
        instance._destroy();
      }
    });
  };

  /**
   * Shows loader (spinner), this is useful with AJAX requests.
   * By default the loader be shown instead of the "Confirm" button.
   *
   * @param {HTMLButtonElement | null} [buttonToReplace]
   */
  const showLoading = buttonToReplace => {
    let popup = getPopup();
    if (!popup) {
      new Swal();
    }
    popup = getPopup();
    if (!popup) {
      return;
    }
    const loader = getLoader();
    if (isToast()) {
      hide(getIcon());
    } else {
      replaceButton(popup, buttonToReplace);
    }
    show(loader);
    popup.setAttribute('data-loading', 'true');
    popup.setAttribute('aria-busy', 'true');
    popup.focus();
  };

  /**
   * @param {HTMLElement} popup
   * @param {HTMLButtonElement | null} [buttonToReplace]
   */
  const replaceButton = (popup, buttonToReplace) => {
    const actions = getActions();
    const loader = getLoader();
    if (!actions || !loader) {
      return;
    }
    if (!buttonToReplace && isVisible$1(getConfirmButton())) {
      buttonToReplace = getConfirmButton();
    }
    show(actions);
    if (buttonToReplace) {
      hide(buttonToReplace);
      loader.setAttribute('data-button-to-replace', buttonToReplace.className);
      actions.insertBefore(loader, buttonToReplace);
    }
    addClass([popup, actions], swalClasses.loading);
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const handleInputOptionsAndValue = (instance, params) => {
    if (params.input === 'select' || params.input === 'radio') {
      handleInputOptions(instance, params);
    } else if (['text', 'email', 'number', 'tel', 'textarea'].some(i => i === params.input) && (hasToPromiseFn(params.inputValue) || isPromise(params.inputValue))) {
      showLoading(getConfirmButton());
      handleInputValue(instance, params);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} innerParams
   * @returns {SweetAlertInputValue}
   */
  const getInputValue = (instance, innerParams) => {
    const input = instance.getInput();
    if (!input) {
      return null;
    }
    switch (innerParams.input) {
      case 'checkbox':
        return getCheckboxValue(input);
      case 'radio':
        return getRadioValue(input);
      case 'file':
        return getFileValue(input);
      default:
        return innerParams.inputAutoTrim ? input.value.trim() : input.value;
    }
  };

  /**
   * @param {HTMLInputElement} input
   * @returns {number}
   */
  const getCheckboxValue = input => input.checked ? 1 : 0;

  /**
   * @param {HTMLInputElement} input
   * @returns {string | null}
   */
  const getRadioValue = input => input.checked ? input.value : null;

  /**
   * @param {HTMLInputElement} input
   * @returns {FileList | File | null}
   */
  const getFileValue = input => input.files && input.files.length ? input.getAttribute('multiple') !== null ? input.files : input.files[0] : null;

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const handleInputOptions = (instance, params) => {
    const popup = getPopup();
    if (!popup) {
      return;
    }
    /**
     * @param {Record<string, any>} inputOptions
     */
    const processInputOptions = inputOptions => {
      if (params.input === 'select') {
        populateSelectOptions(popup, formatInputOptions(inputOptions), params);
      } else if (params.input === 'radio') {
        populateRadioOptions(popup, formatInputOptions(inputOptions), params);
      }
    };
    if (hasToPromiseFn(params.inputOptions) || isPromise(params.inputOptions)) {
      showLoading(getConfirmButton());
      asPromise(params.inputOptions).then(inputOptions => {
        instance.hideLoading();
        processInputOptions(inputOptions);
      });
    } else if (typeof params.inputOptions === 'object') {
      processInputOptions(params.inputOptions);
    } else {
      error(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof params.inputOptions}`);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertOptions} params
   */
  const handleInputValue = (instance, params) => {
    const input = instance.getInput();
    if (!input) {
      return;
    }
    hide(input);
    asPromise(params.inputValue).then(inputValue => {
      input.value = params.input === 'number' ? `${parseFloat(inputValue) || 0}` : `${inputValue}`;
      show(input);
      input.focus();
      instance.hideLoading();
    }).catch(err => {
      error(`Error in inputValue promise: ${err}`);
      input.value = '';
      show(input);
      input.focus();
      instance.hideLoading();
    });
  };

  /**
   * @param {HTMLElement} popup
   * @param {InputOptionFlattened[]} inputOptions
   * @param {SweetAlertOptions} params
   */
  function populateSelectOptions(popup, inputOptions, params) {
    const select = getDirectChildByClass(popup, swalClasses.select);
    if (!select) {
      return;
    }
    /**
     * @param {HTMLElement} parent
     * @param {string} optionLabel
     * @param {string} optionValue
     */
    const renderOption = (parent, optionLabel, optionValue) => {
      const option = document.createElement('option');
      option.value = optionValue;
      setInnerHtml(option, optionLabel);
      option.selected = isSelected(optionValue, params.inputValue);
      parent.appendChild(option);
    };
    inputOptions.forEach(inputOption => {
      const optionValue = inputOption[0];
      const optionLabel = inputOption[1];
      // <optgroup> spec:
      // https://www.w3.org/TR/html401/interact/forms.html#h-17.6
      // "...all OPTGROUP elements must be specified directly within a SELECT element (i.e., groups may not be nested)..."
      // check whether this is a <optgroup>
      if (Array.isArray(optionLabel)) {
        // if it is an array, then it is an <optgroup>
        const optgroup = document.createElement('optgroup');
        optgroup.label = optionValue;
        optgroup.disabled = false; // not configurable for now
        select.appendChild(optgroup);
        optionLabel.forEach(o => renderOption(optgroup, o[1], o[0]));
      } else {
        // case of <option>
        renderOption(select, optionLabel, optionValue);
      }
    });
    select.focus();
  }

  /**
   * @param {HTMLElement} popup
   * @param {InputOptionFlattened[]} inputOptions
   * @param {SweetAlertOptions} params
   */
  function populateRadioOptions(popup, inputOptions, params) {
    const radio = getDirectChildByClass(popup, swalClasses.radio);
    if (!radio) {
      return;
    }
    inputOptions.forEach(inputOption => {
      const radioValue = inputOption[0];
      const radioLabel = inputOption[1];
      const radioInput = document.createElement('input');
      const radioLabelElement = document.createElement('label');
      radioInput.type = 'radio';
      radioInput.name = swalClasses.radio;
      radioInput.value = radioValue;
      if (isSelected(radioValue, params.inputValue)) {
        radioInput.checked = true;
      }
      const label = document.createElement('span');
      setInnerHtml(label, radioLabel);
      label.className = swalClasses.label;
      radioLabelElement.appendChild(radioInput);
      radioLabelElement.appendChild(label);
      radio.appendChild(radioLabelElement);
    });
    const radios = radio.querySelectorAll('input');
    if (radios.length) {
      radios[0].focus();
    }
  }

  /**
   * Converts `inputOptions` into an array of `[value, label]`s
   *
   * @param {Record<string, any>} inputOptions
   * @typedef {string[]} InputOptionFlattened
   * @returns {InputOptionFlattened[]}
   */
  const formatInputOptions = inputOptions => {
    /** @type {InputOptionFlattened[]} */
    const result = [];
    if (inputOptions instanceof Map) {
      inputOptions.forEach((value, key) => {
        let valueFormatted = value;
        if (typeof valueFormatted === 'object') {
          // case of <optgroup>
          valueFormatted = formatInputOptions(valueFormatted);
        }
        result.push([key, valueFormatted]);
      });
    } else {
      Object.keys(inputOptions).forEach(key => {
        let valueFormatted = inputOptions[key];
        if (typeof valueFormatted === 'object') {
          // case of <optgroup>
          valueFormatted = formatInputOptions(valueFormatted);
        }
        result.push([key, valueFormatted]);
      });
    }
    return result;
  };

  /**
   * @param {string} optionValue
   * @param {SweetAlertInputValue} inputValue
   * @returns {boolean}
   */
  const isSelected = (optionValue, inputValue) => {
    return !!inputValue && inputValue.toString() === optionValue.toString();
  };

  /**
   * @param {SweetAlert} instance
   */
  const handleConfirmButtonClick = instance => {
    const innerParams = privateProps.innerParams.get(instance);
    instance.disableButtons();
    if (innerParams.input) {
      handleConfirmOrDenyWithInput(instance, 'confirm');
    } else {
      confirm(instance, true);
    }
  };

  /**
   * @param {SweetAlert} instance
   */
  const handleDenyButtonClick = instance => {
    const innerParams = privateProps.innerParams.get(instance);
    instance.disableButtons();
    if (innerParams.returnInputValueOnDeny) {
      handleConfirmOrDenyWithInput(instance, 'deny');
    } else {
      deny(instance, false);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {Function} dismissWith
   */
  const handleCancelButtonClick = (instance, dismissWith) => {
    instance.disableButtons();
    dismissWith(DismissReason.cancel);
  };

  /**
   * @param {SweetAlert} instance
   * @param {'confirm' | 'deny'} type
   */
  const handleConfirmOrDenyWithInput = (instance, type) => {
    const innerParams = privateProps.innerParams.get(instance);
    if (!innerParams.input) {
      error(`The "input" parameter is needed to be set when using returnInputValueOn${capitalizeFirstLetter(type)}`);
      return;
    }
    const input = instance.getInput();
    const inputValue = getInputValue(instance, innerParams);
    if (innerParams.inputValidator) {
      handleInputValidator(instance, inputValue, type);
    } else if (input && !input.checkValidity()) {
      instance.enableButtons();
      instance.showValidationMessage(innerParams.validationMessage || input.validationMessage);
    } else if (type === 'deny') {
      deny(instance, inputValue);
    } else {
      confirm(instance, inputValue);
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {SweetAlertInputValue} inputValue
   * @param {'confirm' | 'deny'} type
   */
  const handleInputValidator = (instance, inputValue, type) => {
    const innerParams = privateProps.innerParams.get(instance);
    instance.disableInput();
    const validationPromise = Promise.resolve().then(() => asPromise(innerParams.inputValidator(inputValue, innerParams.validationMessage)));
    validationPromise.then(validationMessage => {
      instance.enableButtons();
      instance.enableInput();
      if (validationMessage) {
        instance.showValidationMessage(validationMessage);
      } else if (type === 'deny') {
        deny(instance, inputValue);
      } else {
        confirm(instance, inputValue);
      }
    });
  };

  /**
   * @param {SweetAlert} instance
   * @param {any} value
   */
  const deny = (instance, value) => {
    const innerParams = privateProps.innerParams.get(instance || undefined);
    if (innerParams.showLoaderOnDeny) {
      showLoading(getDenyButton());
    }
    if (innerParams.preDeny) {
      instance.isAwaitingPromise = true; // Flagging the instance as awaiting a promise so it's own promise's reject/resolve methods doesn't get destroyed until the result from this preDeny's promise is received
      const preDenyPromise = Promise.resolve().then(() => asPromise(innerParams.preDeny(value, innerParams.validationMessage)));
      preDenyPromise.then(preDenyValue => {
        if (preDenyValue === false) {
          instance.hideLoading();
          handleAwaitingPromise(instance);
        } else {
          instance.close({
            isDenied: true,
            value: typeof preDenyValue === 'undefined' ? value : preDenyValue
          });
        }
      }).catch(error => rejectWith(instance || undefined, error));
    } else {
      instance.close({
        isDenied: true,
        value
      });
    }
  };

  /**
   * @param {SweetAlert} instance
   * @param {any} value
   */
  const succeedWith = (instance, value) => {
    instance.close({
      isConfirmed: true,
      value
    });
  };

  /**
   *
   * @param {SweetAlert} instance
   * @param {string} error
   */
  const rejectWith = (instance, error) => {
    instance.rejectPromise(error);
  };

  /**
   *
   * @param {SweetAlert} instance
   * @param {any} value
   */
  const confirm = (instance, value) => {
    const innerParams = privateProps.innerParams.get(instance || undefined);
    if (innerParams.showLoaderOnConfirm) {
      showLoading();
    }
    if (innerParams.preConfirm) {
      instance.resetValidationMessage();
      instance.isAwaitingPromise = true; // Flagging the instance as awaiting a promise so it's own promise's reject/resolve methods doesn't get destroyed until the result from this preConfirm's promise is received
      const preConfirmPromise = Promise.resolve().then(() => asPromise(innerParams.preConfirm(value, innerParams.validationMessage)));
      preConfirmPromise.then(preConfirmValue => {
        if (isVisible$1(getValidationMessage()) || preConfirmValue === false) {
          instance.hideLoading();
          handleAwaitingPromise(instance);
        } else {
          succeedWith(instance, typeof preConfirmValue === 'undefined' ? value : preConfirmValue);
        }
      }).catch(error => rejectWith(instance || undefined, error));
    } else {
      succeedWith(instance, value);
    }
  };

  /**
   * Hides loader and shows back the button which was hidden by .showLoading()
   */
  function hideLoading() {
    // do nothing if popup is closed
    const innerParams = privateProps.innerParams.get(this);
    if (!innerParams) {
      return;
    }
    const domCache = privateProps.domCache.get(this);
    hide(domCache.loader);
    if (isToast()) {
      if (innerParams.icon) {
        show(getIcon());
      }
    } else {
      showRelatedButton(domCache);
    }
    removeClass([domCache.popup, domCache.actions], swalClasses.loading);
    domCache.popup.removeAttribute('aria-busy');
    domCache.popup.removeAttribute('data-loading');
    domCache.confirmButton.disabled = false;
    domCache.denyButton.disabled = false;
    domCache.cancelButton.disabled = false;
  }
  const showRelatedButton = domCache => {
    const buttonToReplace = domCache.popup.getElementsByClassName(domCache.loader.getAttribute('data-button-to-replace'));
    if (buttonToReplace.length) {
      show(buttonToReplace[0], 'inline-block');
    } else if (allButtonsAreHidden()) {
      hide(domCache.actions);
    }
  };

  /**
   * Gets the input DOM node, this method works with input parameter.
   *
   * @returns {HTMLInputElement | null}
   */
  function getInput() {
    const innerParams = privateProps.innerParams.get(this);
    const domCache = privateProps.domCache.get(this);
    if (!domCache) {
      return null;
    }
    return getInput$1(domCache.popup, innerParams.input);
  }

  /**
   * @param {SweetAlert} instance
   * @param {string[]} buttons
   * @param {boolean} disabled
   */
  function setButtonsDisabled(instance, buttons, disabled) {
    const domCache = privateProps.domCache.get(instance);
    buttons.forEach(button => {
      domCache[button].disabled = disabled;
    });
  }

  /**
   * @param {HTMLInputElement | null} input
   * @param {boolean} disabled
   */
  function setInputDisabled(input, disabled) {
    const popup = getPopup();
    if (!popup || !input) {
      return;
    }
    if (input.type === 'radio') {
      /** @type {NodeListOf<HTMLInputElement>} */
      const radios = popup.querySelectorAll(`[name="${swalClasses.radio}"]`);
      for (let i = 0; i < radios.length; i++) {
        radios[i].disabled = disabled;
      }
    } else {
      input.disabled = disabled;
    }
  }

  /**
   * Enable all the buttons
   * @this {SweetAlert}
   */
  function enableButtons() {
    setButtonsDisabled(this, ['confirmButton', 'denyButton', 'cancelButton'], false);
  }

  /**
   * Disable all the buttons
   * @this {SweetAlert}
   */
  function disableButtons() {
    setButtonsDisabled(this, ['confirmButton', 'denyButton', 'cancelButton'], true);
  }

  /**
   * Enable the input field
   * @this {SweetAlert}
   */
  function enableInput() {
    setInputDisabled(this.getInput(), false);
  }

  /**
   * Disable the input field
   * @this {SweetAlert}
   */
  function disableInput() {
    setInputDisabled(this.getInput(), true);
  }

  /**
   * Show block with validation message
   *
   * @param {string} error
   * @this {SweetAlert}
   */
  function showValidationMessage(error) {
    const domCache = privateProps.domCache.get(this);
    const params = privateProps.innerParams.get(this);
    setInnerHtml(domCache.validationMessage, error);
    domCache.validationMessage.className = swalClasses['validation-message'];
    if (params.customClass && params.customClass.validationMessage) {
      addClass(domCache.validationMessage, params.customClass.validationMessage);
    }
    show(domCache.validationMessage);
    const input = this.getInput();
    if (input) {
      input.setAttribute('aria-invalid', 'true');
      input.setAttribute('aria-describedby', swalClasses['validation-message']);
      focusInput(input);
      addClass(input, swalClasses.inputerror);
    }
  }

  /**
   * Hide block with validation message
   *
   * @this {SweetAlert}
   */
  function resetValidationMessage() {
    const domCache = privateProps.domCache.get(this);
    if (domCache.validationMessage) {
      hide(domCache.validationMessage);
    }
    const input = this.getInput();
    if (input) {
      input.removeAttribute('aria-invalid');
      input.removeAttribute('aria-describedby');
      removeClass(input, swalClasses.inputerror);
    }
  }

  const defaultParams = {
    title: '',
    titleText: '',
    text: '',
    html: '',
    footer: '',
    icon: undefined,
    iconColor: undefined,
    iconHtml: undefined,
    template: undefined,
    toast: false,
    draggable: false,
    animation: true,
    theme: 'light',
    showClass: {
      popup: 'swal2-show',
      backdrop: 'swal2-backdrop-show',
      icon: 'swal2-icon-show'
    },
    hideClass: {
      popup: 'swal2-hide',
      backdrop: 'swal2-backdrop-hide',
      icon: 'swal2-icon-hide'
    },
    customClass: {},
    target: 'body',
    color: undefined,
    backdrop: true,
    heightAuto: true,
    allowOutsideClick: true,
    allowEscapeKey: true,
    allowEnterKey: true,
    stopKeydownPropagation: true,
    keydownListenerCapture: false,
    showConfirmButton: true,
    showDenyButton: false,
    showCancelButton: false,
    preConfirm: undefined,
    preDeny: undefined,
    confirmButtonText: 'OK',
    confirmButtonAriaLabel: '',
    confirmButtonColor: undefined,
    denyButtonText: 'No',
    denyButtonAriaLabel: '',
    denyButtonColor: undefined,
    cancelButtonText: 'Cancel',
    cancelButtonAriaLabel: '',
    cancelButtonColor: undefined,
    buttonsStyling: true,
    reverseButtons: false,
    focusConfirm: true,
    focusDeny: false,
    focusCancel: false,
    returnFocus: true,
    showCloseButton: false,
    closeButtonHtml: '&times;',
    closeButtonAriaLabel: 'Close this dialog',
    loaderHtml: '',
    showLoaderOnConfirm: false,
    showLoaderOnDeny: false,
    imageUrl: undefined,
    imageWidth: undefined,
    imageHeight: undefined,
    imageAlt: '',
    timer: undefined,
    timerProgressBar: false,
    width: undefined,
    padding: undefined,
    background: undefined,
    input: undefined,
    inputPlaceholder: '',
    inputLabel: '',
    inputValue: '',
    inputOptions: {},
    inputAutoFocus: true,
    inputAutoTrim: true,
    inputAttributes: {},
    inputValidator: undefined,
    returnInputValueOnDeny: false,
    validationMessage: undefined,
    grow: false,
    position: 'center',
    progressSteps: [],
    currentProgressStep: undefined,
    progressStepsDistance: undefined,
    willOpen: undefined,
    didOpen: undefined,
    didRender: undefined,
    willClose: undefined,
    didClose: undefined,
    didDestroy: undefined,
    scrollbarPadding: true,
    topLayer: false
  };
  const updatableParams = ['allowEscapeKey', 'allowOutsideClick', 'background', 'buttonsStyling', 'cancelButtonAriaLabel', 'cancelButtonColor', 'cancelButtonText', 'closeButtonAriaLabel', 'closeButtonHtml', 'color', 'confirmButtonAriaLabel', 'confirmButtonColor', 'confirmButtonText', 'currentProgressStep', 'customClass', 'denyButtonAriaLabel', 'denyButtonColor', 'denyButtonText', 'didClose', 'didDestroy', 'draggable', 'footer', 'hideClass', 'html', 'icon', 'iconColor', 'iconHtml', 'imageAlt', 'imageHeight', 'imageUrl', 'imageWidth', 'preConfirm', 'preDeny', 'progressSteps', 'returnFocus', 'reverseButtons', 'showCancelButton', 'showCloseButton', 'showConfirmButton', 'showDenyButton', 'text', 'title', 'titleText', 'theme', 'willClose'];

  /** @type {Record<string, string | undefined>} */
  const deprecatedParams = {
    allowEnterKey: undefined
  };
  const toastIncompatibleParams = ['allowOutsideClick', 'allowEnterKey', 'backdrop', 'draggable', 'focusConfirm', 'focusDeny', 'focusCancel', 'returnFocus', 'heightAuto', 'keydownListenerCapture'];

  /**
   * Is valid parameter
   *
   * @param {string} paramName
   * @returns {boolean}
   */
  const isValidParameter = paramName => {
    return Object.prototype.hasOwnProperty.call(defaultParams, paramName);
  };

  /**
   * Is valid parameter for Swal.update() method
   *
   * @param {string} paramName
   * @returns {boolean}
   */
  const isUpdatableParameter = paramName => {
    return updatableParams.indexOf(paramName) !== -1;
  };

  /**
   * Is deprecated parameter
   *
   * @param {string} paramName
   * @returns {string | undefined}
   */
  const isDeprecatedParameter = paramName => {
    return deprecatedParams[paramName];
  };

  /**
   * @param {string} param
   */
  const checkIfParamIsValid = param => {
    if (!isValidParameter(param)) {
      warn(`Unknown parameter "${param}"`);
    }
  };

  /**
   * @param {string} param
   */
  const checkIfToastParamIsValid = param => {
    if (toastIncompatibleParams.includes(param)) {
      warn(`The parameter "${param}" is incompatible with toasts`);
    }
  };

  /**
   * @param {string} param
   */
  const checkIfParamIsDeprecated = param => {
    const isDeprecated = isDeprecatedParameter(param);
    if (isDeprecated) {
      warnAboutDeprecation(param, isDeprecated);
    }
  };

  /**
   * Show relevant warnings for given params
   *
   * @param {SweetAlertOptions} params
   */
  const showWarningsForParams = params => {
    if (params.backdrop === false && params.allowOutsideClick) {
      warn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');
    }
    if (params.theme && !['light', 'dark', 'auto', 'minimal', 'borderless', 'embed-iframe', 'bulma', 'bulma-light', 'bulma-dark'].includes(params.theme)) {
      warn(`Invalid theme "${params.theme}"`);
    }
    for (const param in params) {
      checkIfParamIsValid(param);
      if (params.toast) {
        checkIfToastParamIsValid(param);
      }
      checkIfParamIsDeprecated(param);
    }
  };

  /**
   * Updates popup parameters.
   *
   * @param {SweetAlertOptions} params
   */
  function update(params) {
    const container = getContainer();
    const popup = getPopup();
    const innerParams = privateProps.innerParams.get(this);
    if (!popup || hasClass(popup, innerParams.hideClass.popup)) {
      warn(`You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.`);
      return;
    }
    const validUpdatableParams = filterValidParams(params);
    const updatedParams = Object.assign({}, innerParams, validUpdatableParams);
    showWarningsForParams(updatedParams);
    container.dataset['swal2Theme'] = updatedParams.theme;
    render(this, updatedParams);
    privateProps.innerParams.set(this, updatedParams);
    Object.defineProperties(this, {
      params: {
        value: Object.assign({}, this.params, params),
        writable: false,
        enumerable: true
      }
    });
  }

  /**
   * @param {SweetAlertOptions} params
   * @returns {SweetAlertOptions}
   */
  const filterValidParams = params => {
    const validUpdatableParams = {};
    Object.keys(params).forEach(param => {
      if (isUpdatableParameter(param)) {
        validUpdatableParams[param] = params[param];
      } else {
        warn(`Invalid parameter to update: ${param}`);
      }
    });
    return validUpdatableParams;
  };

  /**
   * Dispose the current SweetAlert2 instance
   */
  function _destroy() {
    const domCache = privateProps.domCache.get(this);
    const innerParams = privateProps.innerParams.get(this);
    if (!innerParams) {
      disposeWeakMaps(this); // The WeakMaps might have been partly destroyed, we must recall it to dispose any remaining WeakMaps #2335
      return; // This instance has already been destroyed
    }

    // Check if there is another Swal closing
    if (domCache.popup && globalState.swalCloseEventFinishedCallback) {
      globalState.swalCloseEventFinishedCallback();
      delete globalState.swalCloseEventFinishedCallback;
    }
    if (typeof innerParams.didDestroy === 'function') {
      innerParams.didDestroy();
    }
    globalState.eventEmitter.emit('didDestroy');
    disposeSwal(this);
  }

  /**
   * @param {SweetAlert} instance
   */
  const disposeSwal = instance => {
    disposeWeakMaps(instance);
    // Unset this.params so GC will dispose it (#1569)
    delete instance.params;
    // Unset globalState props so GC will dispose globalState (#1569)
    delete globalState.keydownHandler;
    delete globalState.keydownTarget;
    // Unset currentInstance
    delete globalState.currentInstance;
  };

  /**
   * @param {SweetAlert} instance
   */
  const disposeWeakMaps = instance => {
    // If the current instance is awaiting a promise result, we keep the privateMethods to call them once the promise result is retrieved #2335
    if (instance.isAwaitingPromise) {
      unsetWeakMaps(privateProps, instance);
      instance.isAwaitingPromise = true;
    } else {
      unsetWeakMaps(privateMethods, instance);
      unsetWeakMaps(privateProps, instance);
      delete instance.isAwaitingPromise;
      // Unset instance methods
      delete instance.disableButtons;
      delete instance.enableButtons;
      delete instance.getInput;
      delete instance.disableInput;
      delete instance.enableInput;
      delete instance.hideLoading;
      delete instance.disableLoading;
      delete instance.showValidationMessage;
      delete instance.resetValidationMessage;
      delete instance.close;
      delete instance.closePopup;
      delete instance.closeModal;
      delete instance.closeToast;
      delete instance.rejectPromise;
      delete instance.update;
      delete instance._destroy;
    }
  };

  /**
   * @param {object} obj
   * @param {SweetAlert} instance
   */
  const unsetWeakMaps = (obj, instance) => {
    for (const i in obj) {
      obj[i].delete(instance);
    }
  };

  var instanceMethods = /*#__PURE__*/Object.freeze({
    __proto__: null,
    _destroy: _destroy,
    close: close,
    closeModal: close,
    closePopup: close,
    closeToast: close,
    disableButtons: disableButtons,
    disableInput: disableInput,
    disableLoading: hideLoading,
    enableButtons: enableButtons,
    enableInput: enableInput,
    getInput: getInput,
    handleAwaitingPromise: handleAwaitingPromise,
    hideLoading: hideLoading,
    rejectPromise: rejectPromise,
    resetValidationMessage: resetValidationMessage,
    showValidationMessage: showValidationMessage,
    update: update
  });

  /**
   * @param {SweetAlertOptions} innerParams
   * @param {DomCache} domCache
   * @param {Function} dismissWith
   */
  const handlePopupClick = (innerParams, domCache, dismissWith) => {
    if (innerParams.toast) {
      handleToastClick(innerParams, domCache, dismissWith);
    } else {
      // Ignore click events that had mousedown on the popup but mouseup on the container
      // This can happen when the user drags a slider
      handleModalMousedown(domCache);

      // Ignore click events that had mousedown on the container but mouseup on the popup
      handleContainerMousedown(domCache);
      handleModalClick(innerParams, domCache, dismissWith);
    }
  };

  /**
   * @param {SweetAlertOptions} innerParams
   * @param {DomCache} domCache
   * @param {Function} dismissWith
   */
  const handleToastClick = (innerParams, domCache, dismissWith) => {
    // Closing toast by internal click
    domCache.popup.onclick = () => {
      if (innerParams && (isAnyButtonShown(innerParams) || innerParams.timer || innerParams.input)) {
        return;
      }
      dismissWith(DismissReason.close);
    };
  };

  /**
   * @param {SweetAlertOptions} innerParams
   * @returns {boolean}
   */
  const isAnyButtonShown = innerParams => {
    return !!(innerParams.showConfirmButton || innerParams.showDenyButton || innerParams.showCancelButton || innerParams.showCloseButton);
  };
  let ignoreOutsideClick = false;

  /**
   * @param {DomCache} domCache
   */
  const handleModalMousedown = domCache => {
    domCache.popup.onmousedown = () => {
      domCache.container.onmouseup = function (e) {
        domCache.container.onmouseup = () => {};
        // We only check if the mouseup target is the container because usually it doesn't
        // have any other direct children aside of the popup
        if (e.target === domCache.container) {
          ignoreOutsideClick = true;
        }
      };
    };
  };

  /**
   * @param {DomCache} domCache
   */
  const handleContainerMousedown = domCache => {
    domCache.container.onmousedown = e => {
      // prevent the modal text from being selected on double click on the container (allowOutsideClick: false)
      if (e.target === domCache.container) {
        e.preventDefault();
      }
      domCache.popup.onmouseup = function (e) {
        domCache.popup.onmouseup = () => {};
        // We also need to check if the mouseup target is a child of the popup
        if (e.target === domCache.popup || e.target instanceof HTMLElement && domCache.popup.contains(e.target)) {
          ignoreOutsideClick = true;
        }
      };
    };
  };

  /**
   * @param {SweetAlertOptions} innerParams
   * @param {DomCache} domCache
   * @param {Function} dismissWith
   */
  const handleModalClick = (innerParams, domCache, dismissWith) => {
    domCache.container.onclick = e => {
      if (ignoreOutsideClick) {
        ignoreOutsideClick = false;
        return;
      }
      if (e.target === domCache.container && callIfFunction(innerParams.allowOutsideClick)) {
        dismissWith(DismissReason.backdrop);
      }
    };
  };

  const isJqueryElement = elem => typeof elem === 'object' && elem.jquery;
  const isElement = elem => elem instanceof Element || isJqueryElement(elem);
  const argsToParams = args => {
    const params = {};
    if (typeof args[0] === 'object' && !isElement(args[0])) {
      Object.assign(params, args[0]);
    } else {
      ['title', 'html', 'icon'].forEach((name, index) => {
        const arg = args[index];
        if (typeof arg === 'string' || isElement(arg)) {
          params[name] = arg;
        } else if (arg !== undefined) {
          error(`Unexpected type of ${name}! Expected "string" or "Element", got ${typeof arg}`);
        }
      });
    }
    return params;
  };

  /**
   * Main method to create a new SweetAlert2 popup
   *
   * @param  {...SweetAlertOptions} args
   * @returns {Promise<SweetAlertResult>}
   */
  function fire(...args) {
    return new this(...args);
  }

  /**
   * Returns an extended version of `Swal` containing `params` as defaults.
   * Useful for reusing Swal configuration.
   *
   * For example:
   *
   * Before:
   * const textPromptOptions = { input: 'text', showCancelButton: true }
   * const {value: firstName} = await Swal.fire({ ...textPromptOptions, title: 'What is your first name?' })
   * const {value: lastName} = await Swal.fire({ ...textPromptOptions, title: 'What is your last name?' })
   *
   * After:
   * const TextPrompt = Swal.mixin({ input: 'text', showCancelButton: true })
   * const {value: firstName} = await TextPrompt('What is your first name?')
   * const {value: lastName} = await TextPrompt('What is your last name?')
   *
   * @param {SweetAlertOptions} mixinParams
   * @returns {SweetAlert}
   */
  function mixin(mixinParams) {
    class MixinSwal extends this {
      _main(params, priorityMixinParams) {
        return super._main(params, Object.assign({}, mixinParams, priorityMixinParams));
      }
    }
    // @ts-ignore
    return MixinSwal;
  }

  /**
   * If `timer` parameter is set, returns number of milliseconds of timer remained.
   * Otherwise, returns undefined.
   *
   * @returns {number | undefined}
   */
  const getTimerLeft = () => {
    return globalState.timeout && globalState.timeout.getTimerLeft();
  };

  /**
   * Stop timer. Returns number of milliseconds of timer remained.
   * If `timer` parameter isn't set, returns undefined.
   *
   * @returns {number | undefined}
   */
  const stopTimer = () => {
    if (globalState.timeout) {
      stopTimerProgressBar();
      return globalState.timeout.stop();
    }
  };

  /**
   * Resume timer. Returns number of milliseconds of timer remained.
   * If `timer` parameter isn't set, returns undefined.
   *
   * @returns {number | undefined}
   */
  const resumeTimer = () => {
    if (globalState.timeout) {
      const remaining = globalState.timeout.start();
      animateTimerProgressBar(remaining);
      return remaining;
    }
  };

  /**
   * Resume timer. Returns number of milliseconds of timer remained.
   * If `timer` parameter isn't set, returns undefined.
   *
   * @returns {number | undefined}
   */
  const toggleTimer = () => {
    const timer = globalState.timeout;
    return timer && (timer.running ? stopTimer() : resumeTimer());
  };

  /**
   * Increase timer. Returns number of milliseconds of an updated timer.
   * If `timer` parameter isn't set, returns undefined.
   *
   * @param {number} ms
   * @returns {number | undefined}
   */
  const increaseTimer = ms => {
    if (globalState.timeout) {
      const remaining = globalState.timeout.increase(ms);
      animateTimerProgressBar(remaining, true);
      return remaining;
    }
  };

  /**
   * Check if timer is running. Returns true if timer is running
   * or false if timer is paused or stopped.
   * If `timer` parameter isn't set, returns undefined
   *
   * @returns {boolean}
   */
  const isTimerRunning = () => {
    return !!(globalState.timeout && globalState.timeout.isRunning());
  };

  let bodyClickListenerAdded = false;
  const clickHandlers = {};

  /**
   * @param {string} attr
   */
  function bindClickHandler(attr = 'data-swal-template') {
    clickHandlers[attr] = this;
    if (!bodyClickListenerAdded) {
      document.body.addEventListener('click', bodyClickListener);
      bodyClickListenerAdded = true;
    }
  }
  const bodyClickListener = event => {
    for (let el = event.target; el && el !== document; el = el.parentNode) {
      for (const attr in clickHandlers) {
        const template = el.getAttribute(attr);
        if (template) {
          clickHandlers[attr].fire({
            template
          });
          return;
        }
      }
    }
  };

  // Source: https://gist.github.com/mudge/5830382?permalink_comment_id=2691957#gistcomment-2691957

  class EventEmitter {
    constructor() {
      /** @type {Events} */
      this.events = {};
    }

    /**
     * @param {string} eventName
     * @returns {EventHandlers}
     */
    _getHandlersByEventName(eventName) {
      if (typeof this.events[eventName] === 'undefined') {
        // not Set because we need to keep the FIFO order
        // https://github.com/sweetalert2/sweetalert2/pull/2763#discussion_r1748990334
        this.events[eventName] = [];
      }
      return this.events[eventName];
    }

    /**
     * @param {string} eventName
     * @param {EventHandler} eventHandler
     */
    on(eventName, eventHandler) {
      const currentHandlers = this._getHandlersByEventName(eventName);
      if (!currentHandlers.includes(eventHandler)) {
        currentHandlers.push(eventHandler);
      }
    }

    /**
     * @param {string} eventName
     * @param {EventHandler} eventHandler
     */
    once(eventName, eventHandler) {
      /**
       * @param {Array} args
       */
      const onceFn = (...args) => {
        this.removeListener(eventName, onceFn);
        eventHandler.apply(this, args);
      };
      this.on(eventName, onceFn);
    }

    /**
     * @param {string} eventName
     * @param {Array} args
     */
    emit(eventName, ...args) {
      this._getHandlersByEventName(eventName).forEach(
      /**
       * @param {EventHandler} eventHandler
       */
      eventHandler => {
        try {
          eventHandler.apply(this, args);
        } catch (error) {
          console.error(error);
        }
      });
    }

    /**
     * @param {string} eventName
     * @param {EventHandler} eventHandler
     */
    removeListener(eventName, eventHandler) {
      const currentHandlers = this._getHandlersByEventName(eventName);
      const index = currentHandlers.indexOf(eventHandler);
      if (index > -1) {
        currentHandlers.splice(index, 1);
      }
    }

    /**
     * @param {string} eventName
     */
    removeAllListeners(eventName) {
      if (this.events[eventName] !== undefined) {
        // https://github.com/sweetalert2/sweetalert2/pull/2763#discussion_r1749239222
        this.events[eventName].length = 0;
      }
    }
    reset() {
      this.events = {};
    }
  }

  globalState.eventEmitter = new EventEmitter();

  /**
   * @param {string} eventName
   * @param {EventHandler} eventHandler
   */
  const on = (eventName, eventHandler) => {
    globalState.eventEmitter.on(eventName, eventHandler);
  };

  /**
   * @param {string} eventName
   * @param {EventHandler} eventHandler
   */
  const once = (eventName, eventHandler) => {
    globalState.eventEmitter.once(eventName, eventHandler);
  };

  /**
   * @param {string} [eventName]
   * @param {EventHandler} [eventHandler]
   */
  const off = (eventName, eventHandler) => {
    // Remove all handlers for all events
    if (!eventName) {
      globalState.eventEmitter.reset();
      return;
    }
    if (eventHandler) {
      // Remove a specific handler
      globalState.eventEmitter.removeListener(eventName, eventHandler);
    } else {
      // Remove all handlers for a specific event
      globalState.eventEmitter.removeAllListeners(eventName);
    }
  };

  var staticMethods = /*#__PURE__*/Object.freeze({
    __proto__: null,
    argsToParams: argsToParams,
    bindClickHandler: bindClickHandler,
    clickCancel: clickCancel,
    clickConfirm: clickConfirm,
    clickDeny: clickDeny,
    enableLoading: showLoading,
    fire: fire,
    getActions: getActions,
    getCancelButton: getCancelButton,
    getCloseButton: getCloseButton,
    getConfirmButton: getConfirmButton,
    getContainer: getContainer,
    getDenyButton: getDenyButton,
    getFocusableElements: getFocusableElements,
    getFooter: getFooter,
    getHtmlContainer: getHtmlContainer,
    getIcon: getIcon,
    getIconContent: getIconContent,
    getImage: getImage,
    getInputLabel: getInputLabel,
    getLoader: getLoader,
    getPopup: getPopup,
    getProgressSteps: getProgressSteps,
    getTimerLeft: getTimerLeft,
    getTimerProgressBar: getTimerProgressBar,
    getTitle: getTitle,
    getValidationMessage: getValidationMessage,
    increaseTimer: increaseTimer,
    isDeprecatedParameter: isDeprecatedParameter,
    isLoading: isLoading,
    isTimerRunning: isTimerRunning,
    isUpdatableParameter: isUpdatableParameter,
    isValidParameter: isValidParameter,
    isVisible: isVisible,
    mixin: mixin,
    off: off,
    on: on,
    once: once,
    resumeTimer: resumeTimer,
    showLoading: showLoading,
    stopTimer: stopTimer,
    toggleTimer: toggleTimer
  });

  class Timer {
    /**
     * @param {Function} callback
     * @param {number} delay
     */
    constructor(callback, delay) {
      this.callback = callback;
      this.remaining = delay;
      this.running = false;
      this.start();
    }

    /**
     * @returns {number}
     */
    start() {
      if (!this.running) {
        this.running = true;
        this.started = new Date();
        this.id = setTimeout(this.callback, this.remaining);
      }
      return this.remaining;
    }

    /**
     * @returns {number}
     */
    stop() {
      if (this.started && this.running) {
        this.running = false;
        clearTimeout(this.id);
        this.remaining -= new Date().getTime() - this.started.getTime();
      }
      return this.remaining;
    }

    /**
     * @param {number} n
     * @returns {number}
     */
    increase(n) {
      const running = this.running;
      if (running) {
        this.stop();
      }
      this.remaining += n;
      if (running) {
        this.start();
      }
      return this.remaining;
    }

    /**
     * @returns {number}
     */
    getTimerLeft() {
      if (this.running) {
        this.stop();
        this.start();
      }
      return this.remaining;
    }

    /**
     * @returns {boolean}
     */
    isRunning() {
      return this.running;
    }
  }

  const swalStringParams = ['swal-title', 'swal-html', 'swal-footer'];

  /**
   * @param {SweetAlertOptions} params
   * @returns {SweetAlertOptions}
   */
  const getTemplateParams = params => {
    const template = typeof params.template === 'string' ? (/** @type {HTMLTemplateElement} */document.querySelector(params.template)) : params.template;
    if (!template) {
      return {};
    }
    /** @type {DocumentFragment} */
    const templateContent = template.content;
    showWarningsForElements(templateContent);
    const result = Object.assign(getSwalParams(templateContent), getSwalFunctionParams(templateContent), getSwalButtons(templateContent), getSwalImage(templateContent), getSwalIcon(templateContent), getSwalInput(templateContent), getSwalStringParams(templateContent, swalStringParams));
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Record<string, any>}
   */
  const getSwalParams = templateContent => {
    /** @type {Record<string, any>} */
    const result = {};
    /** @type {HTMLElement[]} */
    const swalParams = Array.from(templateContent.querySelectorAll('swal-param'));
    swalParams.forEach(param => {
      showWarningsForAttributes(param, ['name', 'value']);
      const paramName = /** @type {keyof SweetAlertOptions} */param.getAttribute('name');
      const value = param.getAttribute('value');
      if (!paramName || !value) {
        return;
      }
      if (typeof defaultParams[paramName] === 'boolean') {
        result[paramName] = value !== 'false';
      } else if (typeof defaultParams[paramName] === 'object') {
        result[paramName] = JSON.parse(value);
      } else {
        result[paramName] = value;
      }
    });
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Record<string, any>}
   */
  const getSwalFunctionParams = templateContent => {
    /** @type {Record<string, any>} */
    const result = {};
    /** @type {HTMLElement[]} */
    const swalFunctions = Array.from(templateContent.querySelectorAll('swal-function-param'));
    swalFunctions.forEach(param => {
      const paramName = /** @type {keyof SweetAlertOptions} */param.getAttribute('name');
      const value = param.getAttribute('value');
      if (!paramName || !value) {
        return;
      }
      result[paramName] = new Function(`return ${value}`)();
    });
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Record<string, any>}
   */
  const getSwalButtons = templateContent => {
    /** @type {Record<string, any>} */
    const result = {};
    /** @type {HTMLElement[]} */
    const swalButtons = Array.from(templateContent.querySelectorAll('swal-button'));
    swalButtons.forEach(button => {
      showWarningsForAttributes(button, ['type', 'color', 'aria-label']);
      const type = button.getAttribute('type');
      if (!type || !['confirm', 'cancel', 'deny'].includes(type)) {
        return;
      }
      result[`${type}ButtonText`] = button.innerHTML;
      result[`show${capitalizeFirstLetter(type)}Button`] = true;
      if (button.hasAttribute('color')) {
        result[`${type}ButtonColor`] = button.getAttribute('color');
      }
      if (button.hasAttribute('aria-label')) {
        result[`${type}ButtonAriaLabel`] = button.getAttribute('aria-label');
      }
    });
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Pick<SweetAlertOptions, 'imageUrl' | 'imageWidth' | 'imageHeight' | 'imageAlt'>}
   */
  const getSwalImage = templateContent => {
    const result = {};
    /** @type {HTMLElement | null} */
    const image = templateContent.querySelector('swal-image');
    if (image) {
      showWarningsForAttributes(image, ['src', 'width', 'height', 'alt']);
      if (image.hasAttribute('src')) {
        result.imageUrl = image.getAttribute('src') || undefined;
      }
      if (image.hasAttribute('width')) {
        result.imageWidth = image.getAttribute('width') || undefined;
      }
      if (image.hasAttribute('height')) {
        result.imageHeight = image.getAttribute('height') || undefined;
      }
      if (image.hasAttribute('alt')) {
        result.imageAlt = image.getAttribute('alt') || undefined;
      }
    }
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Record<string, any>}
   */
  const getSwalIcon = templateContent => {
    const result = {};
    /** @type {HTMLElement | null} */
    const icon = templateContent.querySelector('swal-icon');
    if (icon) {
      showWarningsForAttributes(icon, ['type', 'color']);
      if (icon.hasAttribute('type')) {
        result.icon = icon.getAttribute('type');
      }
      if (icon.hasAttribute('color')) {
        result.iconColor = icon.getAttribute('color');
      }
      result.iconHtml = icon.innerHTML;
    }
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @returns {Record<string, any>}
   */
  const getSwalInput = templateContent => {
    /** @type {Record<string, any>} */
    const result = {};
    /** @type {HTMLElement | null} */
    const input = templateContent.querySelector('swal-input');
    if (input) {
      showWarningsForAttributes(input, ['type', 'label', 'placeholder', 'value']);
      result.input = input.getAttribute('type') || 'text';
      if (input.hasAttribute('label')) {
        result.inputLabel = input.getAttribute('label');
      }
      if (input.hasAttribute('placeholder')) {
        result.inputPlaceholder = input.getAttribute('placeholder');
      }
      if (input.hasAttribute('value')) {
        result.inputValue = input.getAttribute('value');
      }
    }
    /** @type {HTMLElement[]} */
    const inputOptions = Array.from(templateContent.querySelectorAll('swal-input-option'));
    if (inputOptions.length) {
      result.inputOptions = {};
      inputOptions.forEach(option => {
        showWarningsForAttributes(option, ['value']);
        const optionValue = option.getAttribute('value');
        if (!optionValue) {
          return;
        }
        const optionName = option.innerHTML;
        result.inputOptions[optionValue] = optionName;
      });
    }
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   * @param {string[]} paramNames
   * @returns {Record<string, any>}
   */
  const getSwalStringParams = (templateContent, paramNames) => {
    /** @type {Record<string, any>} */
    const result = {};
    for (const i in paramNames) {
      const paramName = paramNames[i];
      /** @type {HTMLElement | null} */
      const tag = templateContent.querySelector(paramName);
      if (tag) {
        showWarningsForAttributes(tag, []);
        result[paramName.replace(/^swal-/, '')] = tag.innerHTML.trim();
      }
    }
    return result;
  };

  /**
   * @param {DocumentFragment} templateContent
   */
  const showWarningsForElements = templateContent => {
    const allowedElements = swalStringParams.concat(['swal-param', 'swal-function-param', 'swal-button', 'swal-image', 'swal-icon', 'swal-input', 'swal-input-option']);
    Array.from(templateContent.children).forEach(el => {
      const tagName = el.tagName.toLowerCase();
      if (!allowedElements.includes(tagName)) {
        warn(`Unrecognized element <${tagName}>`);
      }
    });
  };

  /**
   * @param {HTMLElement} el
   * @param {string[]} allowedAttributes
   */
  const showWarningsForAttributes = (el, allowedAttributes) => {
    Array.from(el.attributes).forEach(attribute => {
      if (allowedAttributes.indexOf(attribute.name) === -1) {
        warn([`Unrecognized attribute "${attribute.name}" on <${el.tagName.toLowerCase()}>.`, `${allowedAttributes.length ? `Allowed attributes are: ${allowedAttributes.join(', ')}` : 'To set the value, use HTML within the element.'}`]);
      }
    });
  };

  const SHOW_CLASS_TIMEOUT = 10;

  /**
   * Open popup, add necessary classes and styles, fix scrollbar
   *
   * @param {SweetAlertOptions} params
   */
  const openPopup = params => {
    const container = getContainer();
    const popup = getPopup();
    if (typeof params.willOpen === 'function') {
      params.willOpen(popup);
    }
    globalState.eventEmitter.emit('willOpen', popup);
    const bodyStyles = window.getComputedStyle(document.body);
    const initialBodyOverflow = bodyStyles.overflowY;
    addClasses(container, popup, params);

    // scrolling is 'hidden' until animation is done, after that 'auto'
    setTimeout(() => {
      setScrollingVisibility(container, popup);
    }, SHOW_CLASS_TIMEOUT);
    if (isModal()) {
      fixScrollContainer(container, params.scrollbarPadding, initialBodyOverflow);
      setAriaHidden();
    }
    if (!isToast() && !globalState.previousActiveElement) {
      globalState.previousActiveElement = document.activeElement;
    }
    if (typeof params.didOpen === 'function') {
      setTimeout(() => params.didOpen(popup));
    }
    globalState.eventEmitter.emit('didOpen', popup);
    removeClass(container, swalClasses['no-transition']);
  };

  /**
   * @param {AnimationEvent} event
   */
  const swalOpenAnimationFinished = event => {
    const popup = getPopup();
    if (event.target !== popup) {
      return;
    }
    const container = getContainer();
    popup.removeEventListener('animationend', swalOpenAnimationFinished);
    popup.removeEventListener('transitionend', swalOpenAnimationFinished);
    container.style.overflowY = 'auto';
  };

  /**
   * @param {HTMLElement} container
   * @param {HTMLElement} popup
   */
  const setScrollingVisibility = (container, popup) => {
    if (hasCssAnimation(popup)) {
      container.style.overflowY = 'hidden';
      popup.addEventListener('animationend', swalOpenAnimationFinished);
      popup.addEventListener('transitionend', swalOpenAnimationFinished);
    } else {
      container.style.overflowY = 'auto';
    }
  };

  /**
   * @param {HTMLElement} container
   * @param {boolean} scrollbarPadding
   * @param {string} initialBodyOverflow
   */
  const fixScrollContainer = (container, scrollbarPadding, initialBodyOverflow) => {
    iOSfix();
    if (scrollbarPadding && initialBodyOverflow !== 'hidden') {
      replaceScrollbarWithPadding(initialBodyOverflow);
    }

    // sweetalert2/issues/1247
    setTimeout(() => {
      container.scrollTop = 0;
    });
  };

  /**
   * @param {HTMLElement} container
   * @param {HTMLElement} popup
   * @param {SweetAlertOptions} params
   */
  const addClasses = (container, popup, params) => {
    addClass(container, params.showClass.backdrop);
    if (params.animation) {
      // this workaround with opacity is needed for https://github.com/sweetalert2/sweetalert2/issues/2059
      popup.style.setProperty('opacity', '0', 'important');
      show(popup, 'grid');
      setTimeout(() => {
        // Animate popup right after showing it
        addClass(popup, params.showClass.popup);
        // and remove the opacity workaround
        popup.style.removeProperty('opacity');
      }, SHOW_CLASS_TIMEOUT); // 10ms in order to fix #2062
    } else {
      show(popup, 'grid');
    }
    addClass([document.documentElement, document.body], swalClasses.shown);
    if (params.heightAuto && params.backdrop && !params.toast) {
      addClass([document.documentElement, document.body], swalClasses['height-auto']);
    }
  };

  var defaultInputValidators = {
    /**
     * @param {string} string
     * @param {string} [validationMessage]
     * @returns {Promise<string | void>}
     */
    email: (string, validationMessage) => {
      return /^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(string) ? Promise.resolve() : Promise.resolve(validationMessage || 'Invalid email address');
    },
    /**
     * @param {string} string
     * @param {string} [validationMessage]
     * @returns {Promise<string | void>}
     */
    url: (string, validationMessage) => {
      // taken from https://stackoverflow.com/a/3809435 with a small change from #1306 and #2013
      return /^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(string) ? Promise.resolve() : Promise.resolve(validationMessage || 'Invalid URL');
    }
  };

  /**
   * @param {SweetAlertOptions} params
   */
  function setDefaultInputValidators(params) {
    // Use default `inputValidator` for supported input types if not provided
    if (params.inputValidator) {
      return;
    }
    if (params.input === 'email') {
      params.inputValidator = defaultInputValidators['email'];
    }
    if (params.input === 'url') {
      params.inputValidator = defaultInputValidators['url'];
    }
  }

  /**
   * @param {SweetAlertOptions} params
   */
  function validateCustomTargetElement(params) {
    // Determine if the custom target element is valid
    if (!params.target || typeof params.target === 'string' && !document.querySelector(params.target) || typeof params.target !== 'string' && !params.target.appendChild) {
      warn('Target parameter is not valid, defaulting to "body"');
      params.target = 'body';
    }
  }

  /**
   * Set type, text and actions on popup
   *
   * @param {SweetAlertOptions} params
   */
  function setParameters(params) {
    setDefaultInputValidators(params);

    // showLoaderOnConfirm && preConfirm
    if (params.showLoaderOnConfirm && !params.preConfirm) {
      warn('showLoaderOnConfirm is set to true, but preConfirm is not defined.\n' + 'showLoaderOnConfirm should be used together with preConfirm, see usage example:\n' + 'https://sweetalert2.github.io/#ajax-request');
    }
    validateCustomTargetElement(params);

    // Replace newlines with <br> in title
    if (typeof params.title === 'string') {
      params.title = params.title.split('\n').join('<br />');
    }
    init(params);
  }

  /** @type {SweetAlert} */
  let currentInstance;
  var _promise = /*#__PURE__*/new WeakMap();
  class SweetAlert {
    /**
     * @param {...any} args
     * @this {SweetAlert}
     */
    constructor(...args) {
      /**
       * @type {Promise<SweetAlertResult>}
       */
      _classPrivateFieldInitSpec(this, _promise, void 0);
      // Prevent run in Node env
      if (typeof window === 'undefined') {
        return;
      }
      currentInstance = this;

      // @ts-ignore
      const outerParams = Object.freeze(this.constructor.argsToParams(args));

      /** @type {Readonly<SweetAlertOptions>} */
      this.params = outerParams;

      /** @type {boolean} */
      this.isAwaitingPromise = false;
      _classPrivateFieldSet2(_promise, this, this._main(currentInstance.params));
    }
    _main(userParams, mixinParams = {}) {
      showWarningsForParams(Object.assign({}, mixinParams, userParams));
      if (globalState.currentInstance) {
        const swalPromiseResolve = privateMethods.swalPromiseResolve.get(globalState.currentInstance);
        const {
          isAwaitingPromise
        } = globalState.currentInstance;
        globalState.currentInstance._destroy();
        if (!isAwaitingPromise) {
          swalPromiseResolve({
            isDismissed: true
          });
        }
        if (isModal()) {
          unsetAriaHidden();
        }
      }
      globalState.currentInstance = currentInstance;
      const innerParams = prepareParams(userParams, mixinParams);
      setParameters(innerParams);
      Object.freeze(innerParams);

      // clear the previous timer
      if (globalState.timeout) {
        globalState.timeout.stop();
        delete globalState.timeout;
      }

      // clear the restore focus timeout
      clearTimeout(globalState.restoreFocusTimeout);
      const domCache = populateDomCache(currentInstance);
      render(currentInstance, innerParams);
      privateProps.innerParams.set(currentInstance, innerParams);
      return swalPromise(currentInstance, domCache, innerParams);
    }

    // `catch` cannot be the name of a module export, so we define our thenable methods here instead
    then(onFulfilled) {
      return _classPrivateFieldGet2(_promise, this).then(onFulfilled);
    }
    finally(onFinally) {
      return _classPrivateFieldGet2(_promise, this).finally(onFinally);
    }
  }

  /**
   * @param {SweetAlert} instance
   * @param {DomCache} domCache
   * @param {SweetAlertOptions} innerParams
   * @returns {Promise}
   */
  const swalPromise = (instance, domCache, innerParams) => {
    return new Promise((resolve, reject) => {
      // functions to handle all closings/dismissals
      /**
       * @param {DismissReason} dismiss
       */
      const dismissWith = dismiss => {
        instance.close({
          isDismissed: true,
          dismiss
        });
      };
      privateMethods.swalPromiseResolve.set(instance, resolve);
      privateMethods.swalPromiseReject.set(instance, reject);
      domCache.confirmButton.onclick = () => {
        handleConfirmButtonClick(instance);
      };
      domCache.denyButton.onclick = () => {
        handleDenyButtonClick(instance);
      };
      domCache.cancelButton.onclick = () => {
        handleCancelButtonClick(instance, dismissWith);
      };
      domCache.closeButton.onclick = () => {
        dismissWith(DismissReason.close);
      };
      handlePopupClick(innerParams, domCache, dismissWith);
      addKeydownHandler(globalState, innerParams, dismissWith);
      handleInputOptionsAndValue(instance, innerParams);
      openPopup(innerParams);
      setupTimer(globalState, innerParams, dismissWith);
      initFocus(domCache, innerParams);

      // Scroll container to top on open (#1247, #1946)
      setTimeout(() => {
        domCache.container.scrollTop = 0;
      });
    });
  };

  /**
   * @param {SweetAlertOptions} userParams
   * @param {SweetAlertOptions} mixinParams
   * @returns {SweetAlertOptions}
   */
  const prepareParams = (userParams, mixinParams) => {
    const templateParams = getTemplateParams(userParams);
    const params = Object.assign({}, defaultParams, mixinParams, templateParams, userParams); // precedence is described in #2131
    params.showClass = Object.assign({}, defaultParams.showClass, params.showClass);
    params.hideClass = Object.assign({}, defaultParams.hideClass, params.hideClass);
    if (params.animation === false) {
      params.showClass = {
        backdrop: 'swal2-noanimation'
      };
      params.hideClass = {};
    }
    return params;
  };

  /**
   * @param {SweetAlert} instance
   * @returns {DomCache}
   */
  const populateDomCache = instance => {
    const domCache = {
      popup: getPopup(),
      container: getContainer(),
      actions: getActions(),
      confirmButton: getConfirmButton(),
      denyButton: getDenyButton(),
      cancelButton: getCancelButton(),
      loader: getLoader(),
      closeButton: getCloseButton(),
      validationMessage: getValidationMessage(),
      progressSteps: getProgressSteps()
    };
    privateProps.domCache.set(instance, domCache);
    return domCache;
  };

  /**
   * @param {GlobalState} globalState
   * @param {SweetAlertOptions} innerParams
   * @param {Function} dismissWith
   */
  const setupTimer = (globalState, innerParams, dismissWith) => {
    const timerProgressBar = getTimerProgressBar();
    hide(timerProgressBar);
    if (innerParams.timer) {
      globalState.timeout = new Timer(() => {
        dismissWith('timer');
        delete globalState.timeout;
      }, innerParams.timer);
      if (innerParams.timerProgressBar) {
        show(timerProgressBar);
        applyCustomClass(timerProgressBar, innerParams, 'timerProgressBar');
        setTimeout(() => {
          if (globalState.timeout && globalState.timeout.running) {
            // timer can be already stopped or unset at this point
            animateTimerProgressBar(innerParams.timer);
          }
        });
      }
    }
  };

  /**
   * Initialize focus in the popup:
   *
   * 1. If `toast` is `true`, don't steal focus from the document.
   * 2. Else if there is an [autofocus] element, focus it.
   * 3. Else if `focusConfirm` is `true` and confirm button is visible, focus it.
   * 4. Else if `focusDeny` is `true` and deny button is visible, focus it.
   * 5. Else if `focusCancel` is `true` and cancel button is visible, focus it.
   * 6. Else focus the first focusable element in a popup (if any).
   *
   * @param {DomCache} domCache
   * @param {SweetAlertOptions} innerParams
   */
  const initFocus = (domCache, innerParams) => {
    if (innerParams.toast) {
      return;
    }
    // TODO: this is dumb, remove `allowEnterKey` param in the next major version
    if (!callIfFunction(innerParams.allowEnterKey)) {
      warnAboutDeprecation('allowEnterKey');
      blurActiveElement();
      return;
    }
    if (focusAutofocus(domCache)) {
      return;
    }
    if (focusButton(domCache, innerParams)) {
      return;
    }
    setFocus(-1, 1);
  };

  /**
   * @param {DomCache} domCache
   * @returns {boolean}
   */
  const focusAutofocus = domCache => {
    const autofocusElements = Array.from(domCache.popup.querySelectorAll('[autofocus]'));
    for (const autofocusElement of autofocusElements) {
      if (autofocusElement instanceof HTMLElement && isVisible$1(autofocusElement)) {
        autofocusElement.focus();
        return true;
      }
    }
    return false;
  };

  /**
   * @param {DomCache} domCache
   * @param {SweetAlertOptions} innerParams
   * @returns {boolean}
   */
  const focusButton = (domCache, innerParams) => {
    if (innerParams.focusDeny && isVisible$1(domCache.denyButton)) {
      domCache.denyButton.focus();
      return true;
    }
    if (innerParams.focusCancel && isVisible$1(domCache.cancelButton)) {
      domCache.cancelButton.focus();
      return true;
    }
    if (innerParams.focusConfirm && isVisible$1(domCache.confirmButton)) {
      domCache.confirmButton.focus();
      return true;
    }
    return false;
  };
  const blurActiveElement = () => {
    if (document.activeElement instanceof HTMLElement && typeof document.activeElement.blur === 'function') {
      document.activeElement.blur();
    }
  };

  // Dear russian users visiting russian sites. Let's have fun.
  if (typeof window !== 'undefined' && /^ru\b/.test(navigator.language) && location.host.match(/\.(ru|su|by|xn--p1ai)$/)) {
    const now = new Date();
    const initiationDate = localStorage.getItem('swal-initiation');
    if (!initiationDate) {
      localStorage.setItem('swal-initiation', `${now}`);
    } else if ((now.getTime() - Date.parse(initiationDate)) / (1000 * 60 * 60 * 24) > 3) {
      setTimeout(() => {
        document.body.style.pointerEvents = 'none';
        const ukrainianAnthem = document.createElement('audio');
        ukrainianAnthem.src = 'https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3';
        ukrainianAnthem.loop = true;
        document.body.appendChild(ukrainianAnthem);
        setTimeout(() => {
          ukrainianAnthem.play().catch(() => {
            // ignore
          });
        }, 2500);
      }, 500);
    }
  }

  // Assign instance methods from src/instanceMethods/*.js to prototype
  SweetAlert.prototype.disableButtons = disableButtons;
  SweetAlert.prototype.enableButtons = enableButtons;
  SweetAlert.prototype.getInput = getInput;
  SweetAlert.prototype.disableInput = disableInput;
  SweetAlert.prototype.enableInput = enableInput;
  SweetAlert.prototype.hideLoading = hideLoading;
  SweetAlert.prototype.disableLoading = hideLoading;
  SweetAlert.prototype.showValidationMessage = showValidationMessage;
  SweetAlert.prototype.resetValidationMessage = resetValidationMessage;
  SweetAlert.prototype.close = close;
  SweetAlert.prototype.closePopup = close;
  SweetAlert.prototype.closeModal = close;
  SweetAlert.prototype.closeToast = close;
  SweetAlert.prototype.rejectPromise = rejectPromise;
  SweetAlert.prototype.update = update;
  SweetAlert.prototype._destroy = _destroy;

  // Assign static methods from src/staticMethods/*.js to constructor
  Object.assign(SweetAlert, staticMethods);

  // Proxy to instance methods to constructor, for now, for backwards compatibility
  Object.keys(instanceMethods).forEach(key => {
    /**
     * @param {...any} args
     * @returns {any | undefined}
     */
    SweetAlert[key] = function (...args) {
      if (currentInstance && currentInstance[key]) {
        return currentInstance[key](...args);
      }
      return null;
    };
  });
  SweetAlert.DismissReason = DismissReason;
  SweetAlert.version = '11.22.0';

  const Swal = SweetAlert;
  // @ts-ignore
  Swal.default = Swal;

  return Swal;

}));
if (typeof this !== 'undefined' && this.Sweetalert2){this.swal = this.sweetAlert = this.Swal = this.SweetAlert = this.Sweetalert2}
"undefined"!=typeof document&&function(e,t){var n=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(n),n.styleSheet)n.styleSheet.disabled||(n.styleSheet.cssText=t);else try{n.innerHTML=t}catch(e){n.innerText=t}}(document,":root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:\"top-start     top            top-end\" \"center-start  center         center-end\" \"bottom-start  bottom-center  bottom-end\";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:\"!\";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}");

/***/ }),

/***/ 481:
/***/ (function(__unused_webpack_module, exports) {

/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */

(function (global, factory) {
   true ? factory(exports) :
  0;
})(this, (function (exports) { 'use strict';

  var version = "1.9.4";

  /*
   * @namespace Util
   *
   * Various utility functions, used by Leaflet internally.
   */

  // @function extend(dest: Object, src?: Object): Object
  // Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.
  function extend(dest) {
  	var i, j, len, src;

  	for (j = 1, len = arguments.length; j < len; j++) {
  		src = arguments[j];
  		for (i in src) {
  			dest[i] = src[i];
  		}
  	}
  	return dest;
  }

  // @function create(proto: Object, properties?: Object): Object
  // Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)
  var create$2 = Object.create || (function () {
  	function F() {}
  	return function (proto) {
  		F.prototype = proto;
  		return new F();
  	};
  })();

  // @function bind(fn: Function, …): Function
  // Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).
  // Has a `L.bind()` shortcut.
  function bind(fn, obj) {
  	var slice = Array.prototype.slice;

  	if (fn.bind) {
  		return fn.bind.apply(fn, slice.call(arguments, 1));
  	}

  	var args = slice.call(arguments, 2);

  	return function () {
  		return fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);
  	};
  }

  // @property lastId: Number
  // Last unique ID used by [`stamp()`](#util-stamp)
  var lastId = 0;

  // @function stamp(obj: Object): Number
  // Returns the unique ID of an object, assigning it one if it doesn't have it.
  function stamp(obj) {
  	if (!('_leaflet_id' in obj)) {
  		obj['_leaflet_id'] = ++lastId;
  	}
  	return obj._leaflet_id;
  }

  // @function throttle(fn: Function, time: Number, context: Object): Function
  // Returns a function which executes function `fn` with the given scope `context`
  // (so that the `this` keyword refers to `context` inside `fn`'s code). The function
  // `fn` will be called no more than one time per given amount of `time`. The arguments
  // received by the bound function will be any arguments passed when binding the
  // function, followed by any arguments passed when invoking the bound function.
  // Has an `L.throttle` shortcut.
  function throttle(fn, time, context) {
  	var lock, args, wrapperFn, later;

  	later = function () {
  		// reset lock and call if queued
  		lock = false;
  		if (args) {
  			wrapperFn.apply(context, args);
  			args = false;
  		}
  	};

  	wrapperFn = function () {
  		if (lock) {
  			// called too soon, queue to call later
  			args = arguments;

  		} else {
  			// call and lock until later
  			fn.apply(context, arguments);
  			setTimeout(later, time);
  			lock = true;
  		}
  	};

  	return wrapperFn;
  }

  // @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number
  // Returns the number `num` modulo `range` in such a way so it lies within
  // `range[0]` and `range[1]`. The returned value will be always smaller than
  // `range[1]` unless `includeMax` is set to `true`.
  function wrapNum(x, range, includeMax) {
  	var max = range[1],
  	    min = range[0],
  	    d = max - min;
  	return x === max && includeMax ? x : ((x - min) % d + d) % d + min;
  }

  // @function falseFn(): Function
  // Returns a function which always returns `false`.
  function falseFn() { return false; }

  // @function formatNum(num: Number, precision?: Number|false): Number
  // Returns the number `num` rounded with specified `precision`.
  // The default `precision` value is 6 decimal places.
  // `false` can be passed to skip any processing (can be useful to avoid round-off errors).
  function formatNum(num, precision) {
  	if (precision === false) { return num; }
  	var pow = Math.pow(10, precision === undefined ? 6 : precision);
  	return Math.round(num * pow) / pow;
  }

  // @function trim(str: String): String
  // Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)
  function trim(str) {
  	return str.trim ? str.trim() : str.replace(/^\s+|\s+$/g, '');
  }

  // @function splitWords(str: String): String[]
  // Trims and splits the string on whitespace and returns the array of parts.
  function splitWords(str) {
  	return trim(str).split(/\s+/);
  }

  // @function setOptions(obj: Object, options: Object): Object
  // Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.
  function setOptions(obj, options) {
  	if (!Object.prototype.hasOwnProperty.call(obj, 'options')) {
  		obj.options = obj.options ? create$2(obj.options) : {};
  	}
  	for (var i in options) {
  		obj.options[i] = options[i];
  	}
  	return obj.options;
  }

  // @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String
  // Converts an object into a parameter URL string, e.g. `{a: "foo", b: "bar"}`
  // translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will
  // be appended at the end. If `uppercase` is `true`, the parameter names will
  // be uppercased (e.g. `'?A=foo&B=bar'`)
  function getParamString(obj, existingUrl, uppercase) {
  	var params = [];
  	for (var i in obj) {
  		params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));
  	}
  	return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');
  }

  var templateRe = /\{ *([\w_ -]+) *\}/g;

  // @function template(str: String, data: Object): String
  // Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`
  // and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string
  // `('Hello foo, bar')`. You can also specify functions instead of strings for
  // data values — they will be evaluated passing `data` as an argument.
  function template(str, data) {
  	return str.replace(templateRe, function (str, key) {
  		var value = data[key];

  		if (value === undefined) {
  			throw new Error('No value provided for variable ' + str);

  		} else if (typeof value === 'function') {
  			value = value(data);
  		}
  		return value;
  	});
  }

  // @function isArray(obj): Boolean
  // Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)
  var isArray = Array.isArray || function (obj) {
  	return (Object.prototype.toString.call(obj) === '[object Array]');
  };

  // @function indexOf(array: Array, el: Object): Number
  // Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)
  function indexOf(array, el) {
  	for (var i = 0; i < array.length; i++) {
  		if (array[i] === el) { return i; }
  	}
  	return -1;
  }

  // @property emptyImageUrl: String
  // Data URI string containing a base64-encoded empty GIF image.
  // Used as a hack to free memory from unused images on WebKit-powered
  // mobile devices (by setting image `src` to this string).
  var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

  // inspired by https://paulirish.com/2011/requestanimationframe-for-smart-animating/

  function getPrefixed(name) {
  	return window['webkit' + name] || window['moz' + name] || window['ms' + name];
  }

  var lastTime = 0;

  // fallback for IE 7-8
  function timeoutDefer(fn) {
  	var time = +new Date(),
  	    timeToCall = Math.max(0, 16 - (time - lastTime));

  	lastTime = time + timeToCall;
  	return window.setTimeout(fn, timeToCall);
  }

  var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;
  var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||
  		getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };

  // @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number
  // Schedules `fn` to be executed when the browser repaints. `fn` is bound to
  // `context` if given. When `immediate` is set, `fn` is called immediately if
  // the browser doesn't have native support for
  // [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),
  // otherwise it's delayed. Returns a request ID that can be used to cancel the request.
  function requestAnimFrame(fn, context, immediate) {
  	if (immediate && requestFn === timeoutDefer) {
  		fn.call(context);
  	} else {
  		return requestFn.call(window, bind(fn, context));
  	}
  }

  // @function cancelAnimFrame(id: Number): undefined
  // Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).
  function cancelAnimFrame(id) {
  	if (id) {
  		cancelFn.call(window, id);
  	}
  }

  var Util = {
    __proto__: null,
    extend: extend,
    create: create$2,
    bind: bind,
    get lastId () { return lastId; },
    stamp: stamp,
    throttle: throttle,
    wrapNum: wrapNum,
    falseFn: falseFn,
    formatNum: formatNum,
    trim: trim,
    splitWords: splitWords,
    setOptions: setOptions,
    getParamString: getParamString,
    template: template,
    isArray: isArray,
    indexOf: indexOf,
    emptyImageUrl: emptyImageUrl,
    requestFn: requestFn,
    cancelFn: cancelFn,
    requestAnimFrame: requestAnimFrame,
    cancelAnimFrame: cancelAnimFrame
  };

  // @class Class
  // @aka L.Class

  // @section
  // @uninheritable

  // Thanks to John Resig and Dean Edwards for inspiration!

  function Class() {}

  Class.extend = function (props) {

  	// @function extend(props: Object): Function
  	// [Extends the current class](#class-inheritance) given the properties to be included.
  	// Returns a Javascript function that is a class constructor (to be called with `new`).
  	var NewClass = function () {

  		setOptions(this);

  		// call the constructor
  		if (this.initialize) {
  			this.initialize.apply(this, arguments);
  		}

  		// call all constructor hooks
  		this.callInitHooks();
  	};

  	var parentProto = NewClass.__super__ = this.prototype;

  	var proto = create$2(parentProto);
  	proto.constructor = NewClass;

  	NewClass.prototype = proto;

  	// inherit parent's statics
  	for (var i in this) {
  		if (Object.prototype.hasOwnProperty.call(this, i) && i !== 'prototype' && i !== '__super__') {
  			NewClass[i] = this[i];
  		}
  	}

  	// mix static properties into the class
  	if (props.statics) {
  		extend(NewClass, props.statics);
  	}

  	// mix includes into the prototype
  	if (props.includes) {
  		checkDeprecatedMixinEvents(props.includes);
  		extend.apply(null, [proto].concat(props.includes));
  	}

  	// mix given properties into the prototype
  	extend(proto, props);
  	delete proto.statics;
  	delete proto.includes;

  	// merge options
  	if (proto.options) {
  		proto.options = parentProto.options ? create$2(parentProto.options) : {};
  		extend(proto.options, props.options);
  	}

  	proto._initHooks = [];

  	// add method for calling all hooks
  	proto.callInitHooks = function () {

  		if (this._initHooksCalled) { return; }

  		if (parentProto.callInitHooks) {
  			parentProto.callInitHooks.call(this);
  		}

  		this._initHooksCalled = true;

  		for (var i = 0, len = proto._initHooks.length; i < len; i++) {
  			proto._initHooks[i].call(this);
  		}
  	};

  	return NewClass;
  };


  // @function include(properties: Object): this
  // [Includes a mixin](#class-includes) into the current class.
  Class.include = function (props) {
  	var parentOptions = this.prototype.options;
  	extend(this.prototype, props);
  	if (props.options) {
  		this.prototype.options = parentOptions;
  		this.mergeOptions(props.options);
  	}
  	return this;
  };

  // @function mergeOptions(options: Object): this
  // [Merges `options`](#class-options) into the defaults of the class.
  Class.mergeOptions = function (options) {
  	extend(this.prototype.options, options);
  	return this;
  };

  // @function addInitHook(fn: Function): this
  // Adds a [constructor hook](#class-constructor-hooks) to the class.
  Class.addInitHook = function (fn) { // (Function) || (String, args...)
  	var args = Array.prototype.slice.call(arguments, 1);

  	var init = typeof fn === 'function' ? fn : function () {
  		this[fn].apply(this, args);
  	};

  	this.prototype._initHooks = this.prototype._initHooks || [];
  	this.prototype._initHooks.push(init);
  	return this;
  };

  function checkDeprecatedMixinEvents(includes) {
  	/* global L: true */
  	if (typeof L === 'undefined' || !L || !L.Mixin) { return; }

  	includes = isArray(includes) ? includes : [includes];

  	for (var i = 0; i < includes.length; i++) {
  		if (includes[i] === L.Mixin.Events) {
  			console.warn('Deprecated include of L.Mixin.Events: ' +
  				'this property will be removed in future releases, ' +
  				'please inherit from L.Evented instead.', new Error().stack);
  		}
  	}
  }

  /*
   * @class Evented
   * @aka L.Evented
   * @inherits Class
   *
   * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).
   *
   * @example
   *
   * ```js
   * map.on('click', function(e) {
   * 	alert(e.latlng);
   * } );
   * ```
   *
   * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:
   *
   * ```js
   * function onClick(e) { ... }
   *
   * map.on('click', onClick);
   * map.off('click', onClick);
   * ```
   */

  var Events = {
  	/* @method on(type: String, fn: Function, context?: Object): this
  	 * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).
  	 *
  	 * @alternative
  	 * @method on(eventMap: Object): this
  	 * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`
  	 */
  	on: function (types, fn, context) {

  		// types can be a map of types/handlers
  		if (typeof types === 'object') {
  			for (var type in types) {
  				// we don't process space-separated events here for performance;
  				// it's a hot path since Layer uses the on(obj) syntax
  				this._on(type, types[type], fn);
  			}

  		} else {
  			// types can be a string of space-separated words
  			types = splitWords(types);

  			for (var i = 0, len = types.length; i < len; i++) {
  				this._on(types[i], fn, context);
  			}
  		}

  		return this;
  	},

  	/* @method off(type: String, fn?: Function, context?: Object): this
  	 * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.
  	 *
  	 * @alternative
  	 * @method off(eventMap: Object): this
  	 * Removes a set of type/listener pairs.
  	 *
  	 * @alternative
  	 * @method off: this
  	 * Removes all listeners to all events on the object. This includes implicitly attached events.
  	 */
  	off: function (types, fn, context) {

  		if (!arguments.length) {
  			// clear all listeners if called without arguments
  			delete this._events;

  		} else if (typeof types === 'object') {
  			for (var type in types) {
  				this._off(type, types[type], fn);
  			}

  		} else {
  			types = splitWords(types);

  			var removeAll = arguments.length === 1;
  			for (var i = 0, len = types.length; i < len; i++) {
  				if (removeAll) {
  					this._off(types[i]);
  				} else {
  					this._off(types[i], fn, context);
  				}
  			}
  		}

  		return this;
  	},

  	// attach listener (without syntactic sugar now)
  	_on: function (type, fn, context, _once) {
  		if (typeof fn !== 'function') {
  			console.warn('wrong listener type: ' + typeof fn);
  			return;
  		}

  		// check if fn already there
  		if (this._listens(type, fn, context) !== false) {
  			return;
  		}

  		if (context === this) {
  			// Less memory footprint.
  			context = undefined;
  		}

  		var newListener = {fn: fn, ctx: context};
  		if (_once) {
  			newListener.once = true;
  		}

  		this._events = this._events || {};
  		this._events[type] = this._events[type] || [];
  		this._events[type].push(newListener);
  	},

  	_off: function (type, fn, context) {
  		var listeners,
  		    i,
  		    len;

  		if (!this._events) {
  			return;
  		}

  		listeners = this._events[type];
  		if (!listeners) {
  			return;
  		}

  		if (arguments.length === 1) { // remove all
  			if (this._firingCount) {
  				// Set all removed listeners to noop
  				// so they are not called if remove happens in fire
  				for (i = 0, len = listeners.length; i < len; i++) {
  					listeners[i].fn = falseFn;
  				}
  			}
  			// clear all listeners for a type if function isn't specified
  			delete this._events[type];
  			return;
  		}

  		if (typeof fn !== 'function') {
  			console.warn('wrong listener type: ' + typeof fn);
  			return;
  		}

  		// find fn and remove it
  		var index = this._listens(type, fn, context);
  		if (index !== false) {
  			var listener = listeners[index];
  			if (this._firingCount) {
  				// set the removed listener to noop so that's not called if remove happens in fire
  				listener.fn = falseFn;

  				/* copy array in case events are being fired */
  				this._events[type] = listeners = listeners.slice();
  			}
  			listeners.splice(index, 1);
  		}
  	},

  	// @method fire(type: String, data?: Object, propagate?: Boolean): this
  	// Fires an event of the specified type. You can optionally provide a data
  	// object — the first argument of the listener function will contain its
  	// properties. The event can optionally be propagated to event parents.
  	fire: function (type, data, propagate) {
  		if (!this.listens(type, propagate)) { return this; }

  		var event = extend({}, data, {
  			type: type,
  			target: this,
  			sourceTarget: data && data.sourceTarget || this
  		});

  		if (this._events) {
  			var listeners = this._events[type];
  			if (listeners) {
  				this._firingCount = (this._firingCount + 1) || 1;
  				for (var i = 0, len = listeners.length; i < len; i++) {
  					var l = listeners[i];
  					// off overwrites l.fn, so we need to copy fn to a var
  					var fn = l.fn;
  					if (l.once) {
  						this.off(type, fn, l.ctx);
  					}
  					fn.call(l.ctx || this, event);
  				}

  				this._firingCount--;
  			}
  		}

  		if (propagate) {
  			// propagate the event to parents (set with addEventParent)
  			this._propagateEvent(event);
  		}

  		return this;
  	},

  	// @method listens(type: String, propagate?: Boolean): Boolean
  	// @method listens(type: String, fn: Function, context?: Object, propagate?: Boolean): Boolean
  	// Returns `true` if a particular event type has any listeners attached to it.
  	// The verification can optionally be propagated, it will return `true` if parents have the listener attached to it.
  	listens: function (type, fn, context, propagate) {
  		if (typeof type !== 'string') {
  			console.warn('"string" type argument expected');
  		}

  		// we don't overwrite the input `fn` value, because we need to use it for propagation
  		var _fn = fn;
  		if (typeof fn !== 'function') {
  			propagate = !!fn;
  			_fn = undefined;
  			context = undefined;
  		}

  		var listeners = this._events && this._events[type];
  		if (listeners && listeners.length) {
  			if (this._listens(type, _fn, context) !== false) {
  				return true;
  			}
  		}

  		if (propagate) {
  			// also check parents for listeners if event propagates
  			for (var id in this._eventParents) {
  				if (this._eventParents[id].listens(type, fn, context, propagate)) { return true; }
  			}
  		}
  		return false;
  	},

  	// returns the index (number) or false
  	_listens: function (type, fn, context) {
  		if (!this._events) {
  			return false;
  		}

  		var listeners = this._events[type] || [];
  		if (!fn) {
  			return !!listeners.length;
  		}

  		if (context === this) {
  			// Less memory footprint.
  			context = undefined;
  		}

  		for (var i = 0, len = listeners.length; i < len; i++) {
  			if (listeners[i].fn === fn && listeners[i].ctx === context) {
  				return i;
  			}
  		}
  		return false;

  	},

  	// @method once(…): this
  	// Behaves as [`on(…)`](#evented-on), except the listener will only get fired once and then removed.
  	once: function (types, fn, context) {

  		// types can be a map of types/handlers
  		if (typeof types === 'object') {
  			for (var type in types) {
  				// we don't process space-separated events here for performance;
  				// it's a hot path since Layer uses the on(obj) syntax
  				this._on(type, types[type], fn, true);
  			}

  		} else {
  			// types can be a string of space-separated words
  			types = splitWords(types);

  			for (var i = 0, len = types.length; i < len; i++) {
  				this._on(types[i], fn, context, true);
  			}
  		}

  		return this;
  	},

  	// @method addEventParent(obj: Evented): this
  	// Adds an event parent - an `Evented` that will receive propagated events
  	addEventParent: function (obj) {
  		this._eventParents = this._eventParents || {};
  		this._eventParents[stamp(obj)] = obj;
  		return this;
  	},

  	// @method removeEventParent(obj: Evented): this
  	// Removes an event parent, so it will stop receiving propagated events
  	removeEventParent: function (obj) {
  		if (this._eventParents) {
  			delete this._eventParents[stamp(obj)];
  		}
  		return this;
  	},

  	_propagateEvent: function (e) {
  		for (var id in this._eventParents) {
  			this._eventParents[id].fire(e.type, extend({
  				layer: e.target,
  				propagatedFrom: e.target
  			}, e), true);
  		}
  	}
  };

  // aliases; we should ditch those eventually

  // @method addEventListener(…): this
  // Alias to [`on(…)`](#evented-on)
  Events.addEventListener = Events.on;

  // @method removeEventListener(…): this
  // Alias to [`off(…)`](#evented-off)

  // @method clearAllEventListeners(…): this
  // Alias to [`off()`](#evented-off)
  Events.removeEventListener = Events.clearAllEventListeners = Events.off;

  // @method addOneTimeEventListener(…): this
  // Alias to [`once(…)`](#evented-once)
  Events.addOneTimeEventListener = Events.once;

  // @method fireEvent(…): this
  // Alias to [`fire(…)`](#evented-fire)
  Events.fireEvent = Events.fire;

  // @method hasEventListeners(…): Boolean
  // Alias to [`listens(…)`](#evented-listens)
  Events.hasEventListeners = Events.listens;

  var Evented = Class.extend(Events);

  /*
   * @class Point
   * @aka L.Point
   *
   * Represents a point with `x` and `y` coordinates in pixels.
   *
   * @example
   *
   * ```js
   * var point = L.point(200, 300);
   * ```
   *
   * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:
   *
   * ```js
   * map.panBy([200, 300]);
   * map.panBy(L.point(200, 300));
   * ```
   *
   * Note that `Point` does not inherit from Leaflet's `Class` object,
   * which means new classes can't inherit from it, and new methods
   * can't be added to it with the `include` function.
   */

  function Point(x, y, round) {
  	// @property x: Number; The `x` coordinate of the point
  	this.x = (round ? Math.round(x) : x);
  	// @property y: Number; The `y` coordinate of the point
  	this.y = (round ? Math.round(y) : y);
  }

  var trunc = Math.trunc || function (v) {
  	return v > 0 ? Math.floor(v) : Math.ceil(v);
  };

  Point.prototype = {

  	// @method clone(): Point
  	// Returns a copy of the current point.
  	clone: function () {
  		return new Point(this.x, this.y);
  	},

  	// @method add(otherPoint: Point): Point
  	// Returns the result of addition of the current and the given points.
  	add: function (point) {
  		// non-destructive, returns a new point
  		return this.clone()._add(toPoint(point));
  	},

  	_add: function (point) {
  		// destructive, used directly for performance in situations where it's safe to modify existing point
  		this.x += point.x;
  		this.y += point.y;
  		return this;
  	},

  	// @method subtract(otherPoint: Point): Point
  	// Returns the result of subtraction of the given point from the current.
  	subtract: function (point) {
  		return this.clone()._subtract(toPoint(point));
  	},

  	_subtract: function (point) {
  		this.x -= point.x;
  		this.y -= point.y;
  		return this;
  	},

  	// @method divideBy(num: Number): Point
  	// Returns the result of division of the current point by the given number.
  	divideBy: function (num) {
  		return this.clone()._divideBy(num);
  	},

  	_divideBy: function (num) {
  		this.x /= num;
  		this.y /= num;
  		return this;
  	},

  	// @method multiplyBy(num: Number): Point
  	// Returns the result of multiplication of the current point by the given number.
  	multiplyBy: function (num) {
  		return this.clone()._multiplyBy(num);
  	},

  	_multiplyBy: function (num) {
  		this.x *= num;
  		this.y *= num;
  		return this;
  	},

  	// @method scaleBy(scale: Point): Point
  	// Multiply each coordinate of the current point by each coordinate of
  	// `scale`. In linear algebra terms, multiply the point by the
  	// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)
  	// defined by `scale`.
  	scaleBy: function (point) {
  		return new Point(this.x * point.x, this.y * point.y);
  	},

  	// @method unscaleBy(scale: Point): Point
  	// Inverse of `scaleBy`. Divide each coordinate of the current point by
  	// each coordinate of `scale`.
  	unscaleBy: function (point) {
  		return new Point(this.x / point.x, this.y / point.y);
  	},

  	// @method round(): Point
  	// Returns a copy of the current point with rounded coordinates.
  	round: function () {
  		return this.clone()._round();
  	},

  	_round: function () {
  		this.x = Math.round(this.x);
  		this.y = Math.round(this.y);
  		return this;
  	},

  	// @method floor(): Point
  	// Returns a copy of the current point with floored coordinates (rounded down).
  	floor: function () {
  		return this.clone()._floor();
  	},

  	_floor: function () {
  		this.x = Math.floor(this.x);
  		this.y = Math.floor(this.y);
  		return this;
  	},

  	// @method ceil(): Point
  	// Returns a copy of the current point with ceiled coordinates (rounded up).
  	ceil: function () {
  		return this.clone()._ceil();
  	},

  	_ceil: function () {
  		this.x = Math.ceil(this.x);
  		this.y = Math.ceil(this.y);
  		return this;
  	},

  	// @method trunc(): Point
  	// Returns a copy of the current point with truncated coordinates (rounded towards zero).
  	trunc: function () {
  		return this.clone()._trunc();
  	},

  	_trunc: function () {
  		this.x = trunc(this.x);
  		this.y = trunc(this.y);
  		return this;
  	},

  	// @method distanceTo(otherPoint: Point): Number
  	// Returns the cartesian distance between the current and the given points.
  	distanceTo: function (point) {
  		point = toPoint(point);

  		var x = point.x - this.x,
  		    y = point.y - this.y;

  		return Math.sqrt(x * x + y * y);
  	},

  	// @method equals(otherPoint: Point): Boolean
  	// Returns `true` if the given point has the same coordinates.
  	equals: function (point) {
  		point = toPoint(point);

  		return point.x === this.x &&
  		       point.y === this.y;
  	},

  	// @method contains(otherPoint: Point): Boolean
  	// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).
  	contains: function (point) {
  		point = toPoint(point);

  		return Math.abs(point.x) <= Math.abs(this.x) &&
  		       Math.abs(point.y) <= Math.abs(this.y);
  	},

  	// @method toString(): String
  	// Returns a string representation of the point for debugging purposes.
  	toString: function () {
  		return 'Point(' +
  		        formatNum(this.x) + ', ' +
  		        formatNum(this.y) + ')';
  	}
  };

  // @factory L.point(x: Number, y: Number, round?: Boolean)
  // Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.

  // @alternative
  // @factory L.point(coords: Number[])
  // Expects an array of the form `[x, y]` instead.

  // @alternative
  // @factory L.point(coords: Object)
  // Expects a plain object of the form `{x: Number, y: Number}` instead.
  function toPoint(x, y, round) {
  	if (x instanceof Point) {
  		return x;
  	}
  	if (isArray(x)) {
  		return new Point(x[0], x[1]);
  	}
  	if (x === undefined || x === null) {
  		return x;
  	}
  	if (typeof x === 'object' && 'x' in x && 'y' in x) {
  		return new Point(x.x, x.y);
  	}
  	return new Point(x, y, round);
  }

  /*
   * @class Bounds
   * @aka L.Bounds
   *
   * Represents a rectangular area in pixel coordinates.
   *
   * @example
   *
   * ```js
   * var p1 = L.point(10, 10),
   * p2 = L.point(40, 60),
   * bounds = L.bounds(p1, p2);
   * ```
   *
   * All Leaflet methods that accept `Bounds` objects also accept them in a simple Array form (unless noted otherwise), so the bounds example above can be passed like this:
   *
   * ```js
   * otherBounds.intersects([[10, 10], [40, 60]]);
   * ```
   *
   * Note that `Bounds` does not inherit from Leaflet's `Class` object,
   * which means new classes can't inherit from it, and new methods
   * can't be added to it with the `include` function.
   */

  function Bounds(a, b) {
  	if (!a) { return; }

  	var points = b ? [a, b] : a;

  	for (var i = 0, len = points.length; i < len; i++) {
  		this.extend(points[i]);
  	}
  }

  Bounds.prototype = {
  	// @method extend(point: Point): this
  	// Extends the bounds to contain the given point.

  	// @alternative
  	// @method extend(otherBounds: Bounds): this
  	// Extend the bounds to contain the given bounds
  	extend: function (obj) {
  		var min2, max2;
  		if (!obj) { return this; }

  		if (obj instanceof Point || typeof obj[0] === 'number' || 'x' in obj) {
  			min2 = max2 = toPoint(obj);
  		} else {
  			obj = toBounds(obj);
  			min2 = obj.min;
  			max2 = obj.max;

  			if (!min2 || !max2) { return this; }
  		}

  		// @property min: Point
  		// The top left corner of the rectangle.
  		// @property max: Point
  		// The bottom right corner of the rectangle.
  		if (!this.min && !this.max) {
  			this.min = min2.clone();
  			this.max = max2.clone();
  		} else {
  			this.min.x = Math.min(min2.x, this.min.x);
  			this.max.x = Math.max(max2.x, this.max.x);
  			this.min.y = Math.min(min2.y, this.min.y);
  			this.max.y = Math.max(max2.y, this.max.y);
  		}
  		return this;
  	},

  	// @method getCenter(round?: Boolean): Point
  	// Returns the center point of the bounds.
  	getCenter: function (round) {
  		return toPoint(
  		        (this.min.x + this.max.x) / 2,
  		        (this.min.y + this.max.y) / 2, round);
  	},

  	// @method getBottomLeft(): Point
  	// Returns the bottom-left point of the bounds.
  	getBottomLeft: function () {
  		return toPoint(this.min.x, this.max.y);
  	},

  	// @method getTopRight(): Point
  	// Returns the top-right point of the bounds.
  	getTopRight: function () { // -> Point
  		return toPoint(this.max.x, this.min.y);
  	},

  	// @method getTopLeft(): Point
  	// Returns the top-left point of the bounds (i.e. [`this.min`](#bounds-min)).
  	getTopLeft: function () {
  		return this.min; // left, top
  	},

  	// @method getBottomRight(): Point
  	// Returns the bottom-right point of the bounds (i.e. [`this.max`](#bounds-max)).
  	getBottomRight: function () {
  		return this.max; // right, bottom
  	},

  	// @method getSize(): Point
  	// Returns the size of the given bounds
  	getSize: function () {
  		return this.max.subtract(this.min);
  	},

  	// @method contains(otherBounds: Bounds): Boolean
  	// Returns `true` if the rectangle contains the given one.
  	// @alternative
  	// @method contains(point: Point): Boolean
  	// Returns `true` if the rectangle contains the given point.
  	contains: function (obj) {
  		var min, max;

  		if (typeof obj[0] === 'number' || obj instanceof Point) {
  			obj = toPoint(obj);
  		} else {
  			obj = toBounds(obj);
  		}

  		if (obj instanceof Bounds) {
  			min = obj.min;
  			max = obj.max;
  		} else {
  			min = max = obj;
  		}

  		return (min.x >= this.min.x) &&
  		       (max.x <= this.max.x) &&
  		       (min.y >= this.min.y) &&
  		       (max.y <= this.max.y);
  	},

  	// @method intersects(otherBounds: Bounds): Boolean
  	// Returns `true` if the rectangle intersects the given bounds. Two bounds
  	// intersect if they have at least one point in common.
  	intersects: function (bounds) { // (Bounds) -> Boolean
  		bounds = toBounds(bounds);

  		var min = this.min,
  		    max = this.max,
  		    min2 = bounds.min,
  		    max2 = bounds.max,
  		    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),
  		    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);

  		return xIntersects && yIntersects;
  	},

  	// @method overlaps(otherBounds: Bounds): Boolean
  	// Returns `true` if the rectangle overlaps the given bounds. Two bounds
  	// overlap if their intersection is an area.
  	overlaps: function (bounds) { // (Bounds) -> Boolean
  		bounds = toBounds(bounds);

  		var min = this.min,
  		    max = this.max,
  		    min2 = bounds.min,
  		    max2 = bounds.max,
  		    xOverlaps = (max2.x > min.x) && (min2.x < max.x),
  		    yOverlaps = (max2.y > min.y) && (min2.y < max.y);

  		return xOverlaps && yOverlaps;
  	},

  	// @method isValid(): Boolean
  	// Returns `true` if the bounds are properly initialized.
  	isValid: function () {
  		return !!(this.min && this.max);
  	},


  	// @method pad(bufferRatio: Number): Bounds
  	// Returns bounds created by extending or retracting the current bounds by a given ratio in each direction.
  	// For example, a ratio of 0.5 extends the bounds by 50% in each direction.
  	// Negative values will retract the bounds.
  	pad: function (bufferRatio) {
  		var min = this.min,
  		max = this.max,
  		heightBuffer = Math.abs(min.x - max.x) * bufferRatio,
  		widthBuffer = Math.abs(min.y - max.y) * bufferRatio;


  		return toBounds(
  			toPoint(min.x - heightBuffer, min.y - widthBuffer),
  			toPoint(max.x + heightBuffer, max.y + widthBuffer));
  	},


  	// @method equals(otherBounds: Bounds): Boolean
  	// Returns `true` if the rectangle is equivalent to the given bounds.
  	equals: function (bounds) {
  		if (!bounds) { return false; }

  		bounds = toBounds(bounds);

  		return this.min.equals(bounds.getTopLeft()) &&
  			this.max.equals(bounds.getBottomRight());
  	},
  };


  // @factory L.bounds(corner1: Point, corner2: Point)
  // Creates a Bounds object from two corners coordinate pairs.
  // @alternative
  // @factory L.bounds(points: Point[])
  // Creates a Bounds object from the given array of points.
  function toBounds(a, b) {
  	if (!a || a instanceof Bounds) {
  		return a;
  	}
  	return new Bounds(a, b);
  }

  /*
   * @class LatLngBounds
   * @aka L.LatLngBounds
   *
   * Represents a rectangular geographical area on a map.
   *
   * @example
   *
   * ```js
   * var corner1 = L.latLng(40.712, -74.227),
   * corner2 = L.latLng(40.774, -74.125),
   * bounds = L.latLngBounds(corner1, corner2);
   * ```
   *
   * All Leaflet methods that accept LatLngBounds objects also accept them in a simple Array form (unless noted otherwise), so the bounds example above can be passed like this:
   *
   * ```js
   * map.fitBounds([
   * 	[40.712, -74.227],
   * 	[40.774, -74.125]
   * ]);
   * ```
   *
   * Caution: if the area crosses the antimeridian (often confused with the International Date Line), you must specify corners _outside_ the [-180, 180] degrees longitude range.
   *
   * Note that `LatLngBounds` does not inherit from Leaflet's `Class` object,
   * which means new classes can't inherit from it, and new methods
   * can't be added to it with the `include` function.
   */

  function LatLngBounds(corner1, corner2) { // (LatLng, LatLng) or (LatLng[])
  	if (!corner1) { return; }

  	var latlngs = corner2 ? [corner1, corner2] : corner1;

  	for (var i = 0, len = latlngs.length; i < len; i++) {
  		this.extend(latlngs[i]);
  	}
  }

  LatLngBounds.prototype = {

  	// @method extend(latlng: LatLng): this
  	// Extend the bounds to contain the given point

  	// @alternative
  	// @method extend(otherBounds: LatLngBounds): this
  	// Extend the bounds to contain the given bounds
  	extend: function (obj) {
  		var sw = this._southWest,
  		    ne = this._northEast,
  		    sw2, ne2;

  		if (obj instanceof LatLng) {
  			sw2 = obj;
  			ne2 = obj;

  		} else if (obj instanceof LatLngBounds) {
  			sw2 = obj._southWest;
  			ne2 = obj._northEast;

  			if (!sw2 || !ne2) { return this; }

  		} else {
  			return obj ? this.extend(toLatLng(obj) || toLatLngBounds(obj)) : this;
  		}

  		if (!sw && !ne) {
  			this._southWest = new LatLng(sw2.lat, sw2.lng);
  			this._northEast = new LatLng(ne2.lat, ne2.lng);
  		} else {
  			sw.lat = Math.min(sw2.lat, sw.lat);
  			sw.lng = Math.min(sw2.lng, sw.lng);
  			ne.lat = Math.max(ne2.lat, ne.lat);
  			ne.lng = Math.max(ne2.lng, ne.lng);
  		}

  		return this;
  	},

  	// @method pad(bufferRatio: Number): LatLngBounds
  	// Returns bounds created by extending or retracting the current bounds by a given ratio in each direction.
  	// For example, a ratio of 0.5 extends the bounds by 50% in each direction.
  	// Negative values will retract the bounds.
  	pad: function (bufferRatio) {
  		var sw = this._southWest,
  		    ne = this._northEast,
  		    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,
  		    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;

  		return new LatLngBounds(
  		        new LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),
  		        new LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));
  	},

  	// @method getCenter(): LatLng
  	// Returns the center point of the bounds.
  	getCenter: function () {
  		return new LatLng(
  		        (this._southWest.lat + this._northEast.lat) / 2,
  		        (this._southWest.lng + this._northEast.lng) / 2);
  	},

  	// @method getSouthWest(): LatLng
  	// Returns the south-west point of the bounds.
  	getSouthWest: function () {
  		return this._southWest;
  	},

  	// @method getNorthEast(): LatLng
  	// Returns the north-east point of the bounds.
  	getNorthEast: function () {
  		return this._northEast;
  	},

  	// @method getNorthWest(): LatLng
  	// Returns the north-west point of the bounds.
  	getNorthWest: function () {
  		return new LatLng(this.getNorth(), this.getWest());
  	},

  	// @method getSouthEast(): LatLng
  	// Returns the south-east point of the bounds.
  	getSouthEast: function () {
  		return new LatLng(this.getSouth(), this.getEast());
  	},

  	// @method getWest(): Number
  	// Returns the west longitude of the bounds
  	getWest: function () {
  		return this._southWest.lng;
  	},

  	// @method getSouth(): Number
  	// Returns the south latitude of the bounds
  	getSouth: function () {
  		return this._southWest.lat;
  	},

  	// @method getEast(): Number
  	// Returns the east longitude of the bounds
  	getEast: function () {
  		return this._northEast.lng;
  	},

  	// @method getNorth(): Number
  	// Returns the north latitude of the bounds
  	getNorth: function () {
  		return this._northEast.lat;
  	},

  	// @method contains(otherBounds: LatLngBounds): Boolean
  	// Returns `true` if the rectangle contains the given one.

  	// @alternative
  	// @method contains (latlng: LatLng): Boolean
  	// Returns `true` if the rectangle contains the given point.
  	contains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean
  		if (typeof obj[0] === 'number' || obj instanceof LatLng || 'lat' in obj) {
  			obj = toLatLng(obj);
  		} else {
  			obj = toLatLngBounds(obj);
  		}

  		var sw = this._southWest,
  		    ne = this._northEast,
  		    sw2, ne2;

  		if (obj instanceof LatLngBounds) {
  			sw2 = obj.getSouthWest();
  			ne2 = obj.getNorthEast();
  		} else {
  			sw2 = ne2 = obj;
  		}

  		return (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&
  		       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);
  	},

  	// @method intersects(otherBounds: LatLngBounds): Boolean
  	// Returns `true` if the rectangle intersects the given bounds. Two bounds intersect if they have at least one point in common.
  	intersects: function (bounds) {
  		bounds = toLatLngBounds(bounds);

  		var sw = this._southWest,
  		    ne = this._northEast,
  		    sw2 = bounds.getSouthWest(),
  		    ne2 = bounds.getNorthEast(),

  		    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),
  		    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);

  		return latIntersects && lngIntersects;
  	},

  	// @method overlaps(otherBounds: LatLngBounds): Boolean
  	// Returns `true` if the rectangle overlaps the given bounds. Two bounds overlap if their intersection is an area.
  	overlaps: function (bounds) {
  		bounds = toLatLngBounds(bounds);

  		var sw = this._southWest,
  		    ne = this._northEast,
  		    sw2 = bounds.getSouthWest(),
  		    ne2 = bounds.getNorthEast(),

  		    latOverlaps = (ne2.lat > sw.lat) && (sw2.lat < ne.lat),
  		    lngOverlaps = (ne2.lng > sw.lng) && (sw2.lng < ne.lng);

  		return latOverlaps && lngOverlaps;
  	},

  	// @method toBBoxString(): String
  	// Returns a string with bounding box coordinates in a 'southwest_lng,southwest_lat,northeast_lng,northeast_lat' format. Useful for sending requests to web services that return geo data.
  	toBBoxString: function () {
  		return [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');
  	},

  	// @method equals(otherBounds: LatLngBounds, maxMargin?: Number): Boolean
  	// Returns `true` if the rectangle is equivalent (within a small margin of error) to the given bounds. The margin of error can be overridden by setting `maxMargin` to a small number.
  	equals: function (bounds, maxMargin) {
  		if (!bounds) { return false; }

  		bounds = toLatLngBounds(bounds);

  		return this._southWest.equals(bounds.getSouthWest(), maxMargin) &&
  		       this._northEast.equals(bounds.getNorthEast(), maxMargin);
  	},

  	// @method isValid(): Boolean
  	// Returns `true` if the bounds are properly initialized.
  	isValid: function () {
  		return !!(this._southWest && this._northEast);
  	}
  };

  // TODO International date line?

  // @factory L.latLngBounds(corner1: LatLng, corner2: LatLng)
  // Creates a `LatLngBounds` object by defining two diagonally opposite corners of the rectangle.

  // @alternative
  // @factory L.latLngBounds(latlngs: LatLng[])
  // Creates a `LatLngBounds` object defined by the geographical points it contains. Very useful for zooming the map to fit a particular set of locations with [`fitBounds`](#map-fitbounds).
  function toLatLngBounds(a, b) {
  	if (a instanceof LatLngBounds) {
  		return a;
  	}
  	return new LatLngBounds(a, b);
  }

  /* @class LatLng
   * @aka L.LatLng
   *
   * Represents a geographical point with a certain latitude and longitude.
   *
   * @example
   *
   * ```
   * var latlng = L.latLng(50.5, 30.5);
   * ```
   *
   * All Leaflet methods that accept LatLng objects also accept them in a simple Array form and simple object form (unless noted otherwise), so these lines are equivalent:
   *
   * ```
   * map.panTo([50, 30]);
   * map.panTo({lon: 30, lat: 50});
   * map.panTo({lat: 50, lng: 30});
   * map.panTo(L.latLng(50, 30));
   * ```
   *
   * Note that `LatLng` does not inherit from Leaflet's `Class` object,
   * which means new classes can't inherit from it, and new methods
   * can't be added to it with the `include` function.
   */

  function LatLng(lat, lng, alt) {
  	if (isNaN(lat) || isNaN(lng)) {
  		throw new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');
  	}

  	// @property lat: Number
  	// Latitude in degrees
  	this.lat = +lat;

  	// @property lng: Number
  	// Longitude in degrees
  	this.lng = +lng;

  	// @property alt: Number
  	// Altitude in meters (optional)
  	if (alt !== undefined) {
  		this.alt = +alt;
  	}
  }

  LatLng.prototype = {
  	// @method equals(otherLatLng: LatLng, maxMargin?: Number): Boolean
  	// Returns `true` if the given `LatLng` point is at the same position (within a small margin of error). The margin of error can be overridden by setting `maxMargin` to a small number.
  	equals: function (obj, maxMargin) {
  		if (!obj) { return false; }

  		obj = toLatLng(obj);

  		var margin = Math.max(
  		        Math.abs(this.lat - obj.lat),
  		        Math.abs(this.lng - obj.lng));

  		return margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);
  	},

  	// @method toString(): String
  	// Returns a string representation of the point (for debugging purposes).
  	toString: function (precision) {
  		return 'LatLng(' +
  		        formatNum(this.lat, precision) + ', ' +
  		        formatNum(this.lng, precision) + ')';
  	},

  	// @method distanceTo(otherLatLng: LatLng): Number
  	// Returns the distance (in meters) to the given `LatLng` calculated using the [Spherical Law of Cosines](https://en.wikipedia.org/wiki/Spherical_law_of_cosines).
  	distanceTo: function (other) {
  		return Earth.distance(this, toLatLng(other));
  	},

  	// @method wrap(): LatLng
  	// Returns a new `LatLng` object with the longitude wrapped so it's always between -180 and +180 degrees.
  	wrap: function () {
  		return Earth.wrapLatLng(this);
  	},

  	// @method toBounds(sizeInMeters: Number): LatLngBounds
  	// Returns a new `LatLngBounds` object in which each boundary is `sizeInMeters/2` meters apart from the `LatLng`.
  	toBounds: function (sizeInMeters) {
  		var latAccuracy = 180 * sizeInMeters / 40075017,
  		    lngAccuracy = latAccuracy / Math.cos((Math.PI / 180) * this.lat);

  		return toLatLngBounds(
  		        [this.lat - latAccuracy, this.lng - lngAccuracy],
  		        [this.lat + latAccuracy, this.lng + lngAccuracy]);
  	},

  	clone: function () {
  		return new LatLng(this.lat, this.lng, this.alt);
  	}
  };



  // @factory L.latLng(latitude: Number, longitude: Number, altitude?: Number): LatLng
  // Creates an object representing a geographical point with the given latitude and longitude (and optionally altitude).

  // @alternative
  // @factory L.latLng(coords: Array): LatLng
  // Expects an array of the form `[Number, Number]` or `[Number, Number, Number]` instead.

  // @alternative
  // @factory L.latLng(coords: Object): LatLng
  // Expects an plain object of the form `{lat: Number, lng: Number}` or `{lat: Number, lng: Number, alt: Number}` instead.

  function toLatLng(a, b, c) {
  	if (a instanceof LatLng) {
  		return a;
  	}
  	if (isArray(a) && typeof a[0] !== 'object') {
  		if (a.length === 3) {
  			return new LatLng(a[0], a[1], a[2]);
  		}
  		if (a.length === 2) {
  			return new LatLng(a[0], a[1]);
  		}
  		return null;
  	}
  	if (a === undefined || a === null) {
  		return a;
  	}
  	if (typeof a === 'object' && 'lat' in a) {
  		return new LatLng(a.lat, 'lng' in a ? a.lng : a.lon, a.alt);
  	}
  	if (b === undefined) {
  		return null;
  	}
  	return new LatLng(a, b, c);
  }

  /*
   * @namespace CRS
   * @crs L.CRS.Base
   * Object that defines coordinate reference systems for projecting
   * geographical points into pixel (screen) coordinates and back (and to
   * coordinates in other units for [WMS](https://en.wikipedia.org/wiki/Web_Map_Service) services). See
   * [spatial reference system](https://en.wikipedia.org/wiki/Spatial_reference_system).
   *
   * Leaflet defines the most usual CRSs by default. If you want to use a
   * CRS not defined by default, take a look at the
   * [Proj4Leaflet](https://github.com/kartena/Proj4Leaflet) plugin.
   *
   * Note that the CRS instances do not inherit from Leaflet's `Class` object,
   * and can't be instantiated. Also, new classes can't inherit from them,
   * and methods can't be added to them with the `include` function.
   */

  var CRS = {
  	// @method latLngToPoint(latlng: LatLng, zoom: Number): Point
  	// Projects geographical coordinates into pixel coordinates for a given zoom.
  	latLngToPoint: function (latlng, zoom) {
  		var projectedPoint = this.projection.project(latlng),
  		    scale = this.scale(zoom);

  		return this.transformation._transform(projectedPoint, scale);
  	},

  	// @method pointToLatLng(point: Point, zoom: Number): LatLng
  	// The inverse of `latLngToPoint`. Projects pixel coordinates on a given
  	// zoom into geographical coordinates.
  	pointToLatLng: function (point, zoom) {
  		var scale = this.scale(zoom),
  		    untransformedPoint = this.transformation.untransform(point, scale);

  		return this.projection.unproject(untransformedPoint);
  	},

  	// @method project(latlng: LatLng): Point
  	// Projects geographical coordinates into coordinates in units accepted for
  	// this CRS (e.g. meters for EPSG:3857, for passing it to WMS services).
  	project: function (latlng) {
  		return this.projection.project(latlng);
  	},

  	// @method unproject(point: Point): LatLng
  	// Given a projected coordinate returns the corresponding LatLng.
  	// The inverse of `project`.
  	unproject: function (point) {
  		return this.projection.unproject(point);
  	},

  	// @method scale(zoom: Number): Number
  	// Returns the scale used when transforming projected coordinates into
  	// pixel coordinates for a particular zoom. For example, it returns
  	// `256 * 2^zoom` for Mercator-based CRS.
  	scale: function (zoom) {
  		return 256 * Math.pow(2, zoom);
  	},

  	// @method zoom(scale: Number): Number
  	// Inverse of `scale()`, returns the zoom level corresponding to a scale
  	// factor of `scale`.
  	zoom: function (scale) {
  		return Math.log(scale / 256) / Math.LN2;
  	},

  	// @method getProjectedBounds(zoom: Number): Bounds
  	// Returns the projection's bounds scaled and transformed for the provided `zoom`.
  	getProjectedBounds: function (zoom) {
  		if (this.infinite) { return null; }

  		var b = this.projection.bounds,
  		    s = this.scale(zoom),
  		    min = this.transformation.transform(b.min, s),
  		    max = this.transformation.transform(b.max, s);

  		return new Bounds(min, max);
  	},

  	// @method distance(latlng1: LatLng, latlng2: LatLng): Number
  	// Returns the distance between two geographical coordinates.

  	// @property code: String
  	// Standard code name of the CRS passed into WMS services (e.g. `'EPSG:3857'`)
  	//
  	// @property wrapLng: Number[]
  	// An array of two numbers defining whether the longitude (horizontal) coordinate
  	// axis wraps around a given range and how. Defaults to `[-180, 180]` in most
  	// geographical CRSs. If `undefined`, the longitude axis does not wrap around.
  	//
  	// @property wrapLat: Number[]
  	// Like `wrapLng`, but for the latitude (vertical) axis.

  	// wrapLng: [min, max],
  	// wrapLat: [min, max],

  	// @property infinite: Boolean
  	// If true, the coordinate space will be unbounded (infinite in both axes)
  	infinite: false,

  	// @method wrapLatLng(latlng: LatLng): LatLng
  	// Returns a `LatLng` where lat and lng has been wrapped according to the
  	// CRS's `wrapLat` and `wrapLng` properties, if they are outside the CRS's bounds.
  	wrapLatLng: function (latlng) {
  		var lng = this.wrapLng ? wrapNum(latlng.lng, this.wrapLng, true) : latlng.lng,
  		    lat = this.wrapLat ? wrapNum(latlng.lat, this.wrapLat, true) : latlng.lat,
  		    alt = latlng.alt;

  		return new LatLng(lat, lng, alt);
  	},

  	// @method wrapLatLngBounds(bounds: LatLngBounds): LatLngBounds
  	// Returns a `LatLngBounds` with the same size as the given one, ensuring
  	// that its center is within the CRS's bounds.
  	// Only accepts actual `L.LatLngBounds` instances, not arrays.
  	wrapLatLngBounds: function (bounds) {
  		var center = bounds.getCenter(),
  		    newCenter = this.wrapLatLng(center),
  		    latShift = center.lat - newCenter.lat,
  		    lngShift = center.lng - newCenter.lng;

  		if (latShift === 0 && lngShift === 0) {
  			return bounds;
  		}

  		var sw = bounds.getSouthWest(),
  		    ne = bounds.getNorthEast(),
  		    newSw = new LatLng(sw.lat - latShift, sw.lng - lngShift),
  		    newNe = new LatLng(ne.lat - latShift, ne.lng - lngShift);

  		return new LatLngBounds(newSw, newNe);
  	}
  };

  /*
   * @namespace CRS
   * @crs L.CRS.Earth
   *
   * Serves as the base for CRS that are global such that they cover the earth.
   * Can only be used as the base for other CRS and cannot be used directly,
   * since it does not have a `code`, `projection` or `transformation`. `distance()` returns
   * meters.
   */

  var Earth = extend({}, CRS, {
  	wrapLng: [-180, 180],

  	// Mean Earth Radius, as recommended for use by
  	// the International Union of Geodesy and Geophysics,
  	// see https://rosettacode.org/wiki/Haversine_formula
  	R: 6371000,

  	// distance between two geographical points using spherical law of cosines approximation
  	distance: function (latlng1, latlng2) {
  		var rad = Math.PI / 180,
  		    lat1 = latlng1.lat * rad,
  		    lat2 = latlng2.lat * rad,
  		    sinDLat = Math.sin((latlng2.lat - latlng1.lat) * rad / 2),
  		    sinDLon = Math.sin((latlng2.lng - latlng1.lng) * rad / 2),
  		    a = sinDLat * sinDLat + Math.cos(lat1) * Math.cos(lat2) * sinDLon * sinDLon,
  		    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  		return this.R * c;
  	}
  });

  /*
   * @namespace Projection
   * @projection L.Projection.SphericalMercator
   *
   * Spherical Mercator projection — the most common projection for online maps,
   * used by almost all free and commercial tile providers. Assumes that Earth is
   * a sphere. Used by the `EPSG:3857` CRS.
   */

  var earthRadius = 6378137;

  var SphericalMercator = {

  	R: earthRadius,
  	MAX_LATITUDE: 85.0511287798,

  	project: function (latlng) {
  		var d = Math.PI / 180,
  		    max = this.MAX_LATITUDE,
  		    lat = Math.max(Math.min(max, latlng.lat), -max),
  		    sin = Math.sin(lat * d);

  		return new Point(
  			this.R * latlng.lng * d,
  			this.R * Math.log((1 + sin) / (1 - sin)) / 2);
  	},

  	unproject: function (point) {
  		var d = 180 / Math.PI;

  		return new LatLng(
  			(2 * Math.atan(Math.exp(point.y / this.R)) - (Math.PI / 2)) * d,
  			point.x * d / this.R);
  	},

  	bounds: (function () {
  		var d = earthRadius * Math.PI;
  		return new Bounds([-d, -d], [d, d]);
  	})()
  };

  /*
   * @class Transformation
   * @aka L.Transformation
   *
   * Represents an affine transformation: a set of coefficients `a`, `b`, `c`, `d`
   * for transforming a point of a form `(x, y)` into `(a*x + b, c*y + d)` and doing
   * the reverse. Used by Leaflet in its projections code.
   *
   * @example
   *
   * ```js
   * var transformation = L.transformation(2, 5, -1, 10),
   * 	p = L.point(1, 2),
   * 	p2 = transformation.transform(p), //  L.point(7, 8)
   * 	p3 = transformation.untransform(p2); //  L.point(1, 2)
   * ```
   */


  // factory new L.Transformation(a: Number, b: Number, c: Number, d: Number)
  // Creates a `Transformation` object with the given coefficients.
  function Transformation(a, b, c, d) {
  	if (isArray(a)) {
  		// use array properties
  		this._a = a[0];
  		this._b = a[1];
  		this._c = a[2];
  		this._d = a[3];
  		return;
  	}
  	this._a = a;
  	this._b = b;
  	this._c = c;
  	this._d = d;
  }

  Transformation.prototype = {
  	// @method transform(point: Point, scale?: Number): Point
  	// Returns a transformed point, optionally multiplied by the given scale.
  	// Only accepts actual `L.Point` instances, not arrays.
  	transform: function (point, scale) { // (Point, Number) -> Point
  		return this._transform(point.clone(), scale);
  	},

  	// destructive transform (faster)
  	_transform: function (point, scale) {
  		scale = scale || 1;
  		point.x = scale * (this._a * point.x + this._b);
  		point.y = scale * (this._c * point.y + this._d);
  		return point;
  	},

  	// @method untransform(point: Point, scale?: Number): Point
  	// Returns the reverse transformation of the given point, optionally divided
  	// by the given scale. Only accepts actual `L.Point` instances, not arrays.
  	untransform: function (point, scale) {
  		scale = scale || 1;
  		return new Point(
  		        (point.x / scale - this._b) / this._a,
  		        (point.y / scale - this._d) / this._c);
  	}
  };

  // factory L.transformation(a: Number, b: Number, c: Number, d: Number)

  // @factory L.transformation(a: Number, b: Number, c: Number, d: Number)
  // Instantiates a Transformation object with the given coefficients.

  // @alternative
  // @factory L.transformation(coefficients: Array): Transformation
  // Expects an coefficients array of the form
  // `[a: Number, b: Number, c: Number, d: Number]`.

  function toTransformation(a, b, c, d) {
  	return new Transformation(a, b, c, d);
  }

  /*
   * @namespace CRS
   * @crs L.CRS.EPSG3857
   *
   * The most common CRS for online maps, used by almost all free and commercial
   * tile providers. Uses Spherical Mercator projection. Set in by default in
   * Map's `crs` option.
   */

  var EPSG3857 = extend({}, Earth, {
  	code: 'EPSG:3857',
  	projection: SphericalMercator,

  	transformation: (function () {
  		var scale = 0.5 / (Math.PI * SphericalMercator.R);
  		return toTransformation(scale, 0.5, -scale, 0.5);
  	}())
  });

  var EPSG900913 = extend({}, EPSG3857, {
  	code: 'EPSG:900913'
  });

  // @namespace SVG; @section
  // There are several static functions which can be called without instantiating L.SVG:

  // @function create(name: String): SVGElement
  // Returns a instance of [SVGElement](https://developer.mozilla.org/docs/Web/API/SVGElement),
  // corresponding to the class name passed. For example, using 'line' will return
  // an instance of [SVGLineElement](https://developer.mozilla.org/docs/Web/API/SVGLineElement).
  function svgCreate(name) {
  	return document.createElementNS('http://www.w3.org/2000/svg', name);
  }

  // @function pointsToPath(rings: Point[], closed: Boolean): String
  // Generates a SVG path string for multiple rings, with each ring turning
  // into "M..L..L.." instructions
  function pointsToPath(rings, closed) {
  	var str = '',
  	i, j, len, len2, points, p;

  	for (i = 0, len = rings.length; i < len; i++) {
  		points = rings[i];

  		for (j = 0, len2 = points.length; j < len2; j++) {
  			p = points[j];
  			str += (j ? 'L' : 'M') + p.x + ' ' + p.y;
  		}

  		// closes the ring for polygons; "x" is VML syntax
  		str += closed ? (Browser.svg ? 'z' : 'x') : '';
  	}

  	// SVG complains about empty path strings
  	return str || 'M0 0';
  }

  /*
   * @namespace Browser
   * @aka L.Browser
   *
   * A namespace with static properties for browser/feature detection used by Leaflet internally.
   *
   * @example
   *
   * ```js
   * if (L.Browser.ielt9) {
   *   alert('Upgrade your browser, dude!');
   * }
   * ```
   */

  var style = document.documentElement.style;

  // @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).
  var ie = 'ActiveXObject' in window;

  // @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.
  var ielt9 = ie && !document.addEventListener;

  // @property edge: Boolean; `true` for the Edge web browser.
  var edge = 'msLaunchUri' in navigator && !('documentMode' in document);

  // @property webkit: Boolean;
  // `true` for webkit-based browsers like Chrome and Safari (including mobile versions).
  var webkit = userAgentContains('webkit');

  // @property android: Boolean
  // **Deprecated.** `true` for any browser running on an Android platform.
  var android = userAgentContains('android');

  // @property android23: Boolean; **Deprecated.** `true` for browsers running on Android 2 or Android 3.
  var android23 = userAgentContains('android 2') || userAgentContains('android 3');

  /* See https://stackoverflow.com/a/17961266 for details on detecting stock Android */
  var webkitVer = parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1], 10); // also matches AppleWebKit
  // @property androidStock: Boolean; **Deprecated.** `true` for the Android stock browser (i.e. not Chrome)
  var androidStock = android && userAgentContains('Google') && webkitVer < 537 && !('AudioNode' in window);

  // @property opera: Boolean; `true` for the Opera browser
  var opera = !!window.opera;

  // @property chrome: Boolean; `true` for the Chrome browser.
  var chrome = !edge && userAgentContains('chrome');

  // @property gecko: Boolean; `true` for gecko-based browsers like Firefox.
  var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;

  // @property safari: Boolean; `true` for the Safari browser.
  var safari = !chrome && userAgentContains('safari');

  var phantom = userAgentContains('phantom');

  // @property opera12: Boolean
  // `true` for the Opera browser supporting CSS transforms (version 12 or later).
  var opera12 = 'OTransition' in style;

  // @property win: Boolean; `true` when the browser is running in a Windows platform
  var win = navigator.platform.indexOf('Win') === 0;

  // @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.
  var ie3d = ie && ('transition' in style);

  // @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.
  var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;

  // @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.
  var gecko3d = 'MozPerspective' in style;

  // @property any3d: Boolean
  // `true` for all browsers supporting CSS transforms.
  var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;

  // @property mobile: Boolean; `true` for all browsers running in a mobile device.
  var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');

  // @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.
  var mobileWebkit = mobile && webkit;

  // @property mobileWebkit3d: Boolean
  // `true` for all webkit-based browsers in a mobile device supporting CSS transforms.
  var mobileWebkit3d = mobile && webkit3d;

  // @property msPointer: Boolean
  // `true` for browsers implementing the Microsoft touch events model (notably IE10).
  var msPointer = !window.PointerEvent && window.MSPointerEvent;

  // @property pointer: Boolean
  // `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).
  var pointer = !!(window.PointerEvent || msPointer);

  // @property touchNative: Boolean
  // `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).
  // **This does not necessarily mean** that the browser is running in a computer with
  // a touchscreen, it only means that the browser is capable of understanding
  // touch events.
  var touchNative = 'ontouchstart' in window || !!window.TouchEvent;

  // @property touch: Boolean
  // `true` for all browsers supporting either [touch](#browser-touch) or [pointer](#browser-pointer) events.
  // Note: pointer events will be preferred (if available), and processed for all `touch*` listeners.
  var touch = !window.L_NO_TOUCH && (touchNative || pointer);

  // @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.
  var mobileOpera = mobile && opera;

  // @property mobileGecko: Boolean
  // `true` for gecko-based browsers running in a mobile device.
  var mobileGecko = mobile && gecko;

  // @property retina: Boolean
  // `true` for browsers on a high-resolution "retina" screen or on any screen when browser's display zoom is more than 100%.
  var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;

  // @property passiveEvents: Boolean
  // `true` for browsers that support passive events.
  var passiveEvents = (function () {
  	var supportsPassiveOption = false;
  	try {
  		var opts = Object.defineProperty({}, 'passive', {
  			get: function () { // eslint-disable-line getter-return
  				supportsPassiveOption = true;
  			}
  		});
  		window.addEventListener('testPassiveEventSupport', falseFn, opts);
  		window.removeEventListener('testPassiveEventSupport', falseFn, opts);
  	} catch (e) {
  		// Errors can safely be ignored since this is only a browser support test.
  	}
  	return supportsPassiveOption;
  }());

  // @property canvas: Boolean
  // `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).
  var canvas$1 = (function () {
  	return !!document.createElement('canvas').getContext;
  }());

  // @property svg: Boolean
  // `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).
  var svg$1 = !!(document.createElementNS && svgCreate('svg').createSVGRect);

  var inlineSvg = !!svg$1 && (function () {
  	var div = document.createElement('div');
  	div.innerHTML = '<svg/>';
  	return (div.firstChild && div.firstChild.namespaceURI) === 'http://www.w3.org/2000/svg';
  })();

  // @property vml: Boolean
  // `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).
  var vml = !svg$1 && (function () {
  	try {
  		var div = document.createElement('div');
  		div.innerHTML = '<v:shape adj="1"/>';

  		var shape = div.firstChild;
  		shape.style.behavior = 'url(#default#VML)';

  		return shape && (typeof shape.adj === 'object');

  	} catch (e) {
  		return false;
  	}
  }());


  // @property mac: Boolean; `true` when the browser is running in a Mac platform
  var mac = navigator.platform.indexOf('Mac') === 0;

  // @property mac: Boolean; `true` when the browser is running in a Linux platform
  var linux = navigator.platform.indexOf('Linux') === 0;

  function userAgentContains(str) {
  	return navigator.userAgent.toLowerCase().indexOf(str) >= 0;
  }


  var Browser = {
  	ie: ie,
  	ielt9: ielt9,
  	edge: edge,
  	webkit: webkit,
  	android: android,
  	android23: android23,
  	androidStock: androidStock,
  	opera: opera,
  	chrome: chrome,
  	gecko: gecko,
  	safari: safari,
  	phantom: phantom,
  	opera12: opera12,
  	win: win,
  	ie3d: ie3d,
  	webkit3d: webkit3d,
  	gecko3d: gecko3d,
  	any3d: any3d,
  	mobile: mobile,
  	mobileWebkit: mobileWebkit,
  	mobileWebkit3d: mobileWebkit3d,
  	msPointer: msPointer,
  	pointer: pointer,
  	touch: touch,
  	touchNative: touchNative,
  	mobileOpera: mobileOpera,
  	mobileGecko: mobileGecko,
  	retina: retina,
  	passiveEvents: passiveEvents,
  	canvas: canvas$1,
  	svg: svg$1,
  	vml: vml,
  	inlineSvg: inlineSvg,
  	mac: mac,
  	linux: linux
  };

  /*
   * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.
   */

  var POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown';
  var POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove';
  var POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup';
  var POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel';
  var pEvent = {
  	touchstart  : POINTER_DOWN,
  	touchmove   : POINTER_MOVE,
  	touchend    : POINTER_UP,
  	touchcancel : POINTER_CANCEL
  };
  var handle = {
  	touchstart  : _onPointerStart,
  	touchmove   : _handlePointer,
  	touchend    : _handlePointer,
  	touchcancel : _handlePointer
  };
  var _pointers = {};
  var _pointerDocListener = false;

  // Provides a touch events wrapper for (ms)pointer events.
  // ref https://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890

  function addPointerListener(obj, type, handler) {
  	if (type === 'touchstart') {
  		_addPointerDocListener();
  	}
  	if (!handle[type]) {
  		console.warn('wrong event specified:', type);
  		return falseFn;
  	}
  	handler = handle[type].bind(this, handler);
  	obj.addEventListener(pEvent[type], handler, false);
  	return handler;
  }

  function removePointerListener(obj, type, handler) {
  	if (!pEvent[type]) {
  		console.warn('wrong event specified:', type);
  		return;
  	}
  	obj.removeEventListener(pEvent[type], handler, false);
  }

  function _globalPointerDown(e) {
  	_pointers[e.pointerId] = e;
  }

  function _globalPointerMove(e) {
  	if (_pointers[e.pointerId]) {
  		_pointers[e.pointerId] = e;
  	}
  }

  function _globalPointerUp(e) {
  	delete _pointers[e.pointerId];
  }

  function _addPointerDocListener() {
  	// need to keep track of what pointers and how many are active to provide e.touches emulation
  	if (!_pointerDocListener) {
  		// we listen document as any drags that end by moving the touch off the screen get fired there
  		document.addEventListener(POINTER_DOWN, _globalPointerDown, true);
  		document.addEventListener(POINTER_MOVE, _globalPointerMove, true);
  		document.addEventListener(POINTER_UP, _globalPointerUp, true);
  		document.addEventListener(POINTER_CANCEL, _globalPointerUp, true);

  		_pointerDocListener = true;
  	}
  }

  function _handlePointer(handler, e) {
  	if (e.pointerType === (e.MSPOINTER_TYPE_MOUSE || 'mouse')) { return; }

  	e.touches = [];
  	for (var i in _pointers) {
  		e.touches.push(_pointers[i]);
  	}
  	e.changedTouches = [e];

  	handler(e);
  }

  function _onPointerStart(handler, e) {
  	// IE10 specific: MsTouch needs preventDefault. See #2000
  	if (e.MSPOINTER_TYPE_TOUCH && e.pointerType === e.MSPOINTER_TYPE_TOUCH) {
  		preventDefault(e);
  	}
  	_handlePointer(handler, e);
  }

  /*
   * Extends the event handling code with double tap support for mobile browsers.
   *
   * Note: currently most browsers fire native dblclick, with only a few exceptions
   * (see https://github.com/Leaflet/Leaflet/issues/7012#issuecomment-595087386)
   */

  function makeDblclick(event) {
  	// in modern browsers `type` cannot be just overridden:
  	// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Getter_only
  	var newEvent = {},
  	    prop, i;
  	for (i in event) {
  		prop = event[i];
  		newEvent[i] = prop && prop.bind ? prop.bind(event) : prop;
  	}
  	event = newEvent;
  	newEvent.type = 'dblclick';
  	newEvent.detail = 2;
  	newEvent.isTrusted = false;
  	newEvent._simulated = true; // for debug purposes
  	return newEvent;
  }

  var delay = 200;
  function addDoubleTapListener(obj, handler) {
  	// Most browsers handle double tap natively
  	obj.addEventListener('dblclick', handler);

  	// On some platforms the browser doesn't fire native dblclicks for touch events.
  	// It seems that in all such cases `detail` property of `click` event is always `1`.
  	// So here we rely on that fact to avoid excessive 'dblclick' simulation when not needed.
  	var last = 0,
  	    detail;
  	function simDblclick(e) {
  		if (e.detail !== 1) {
  			detail = e.detail; // keep in sync to avoid false dblclick in some cases
  			return;
  		}

  		if (e.pointerType === 'mouse' ||
  			(e.sourceCapabilities && !e.sourceCapabilities.firesTouchEvents)) {

  			return;
  		}

  		// When clicking on an <input>, the browser generates a click on its
  		// <label> (and vice versa) triggering two clicks in quick succession.
  		// This ignores clicks on elements which are a label with a 'for'
  		// attribute (or children of such a label), but not children of
  		// a <input>.
  		var path = getPropagationPath(e);
  		if (path.some(function (el) {
  			return el instanceof HTMLLabelElement && el.attributes.for;
  		}) &&
  			!path.some(function (el) {
  				return (
  					el instanceof HTMLInputElement ||
  					el instanceof HTMLSelectElement
  				);
  			})
  		) {
  			return;
  		}

  		var now = Date.now();
  		if (now - last <= delay) {
  			detail++;
  			if (detail === 2) {
  				handler(makeDblclick(e));
  			}
  		} else {
  			detail = 1;
  		}
  		last = now;
  	}

  	obj.addEventListener('click', simDblclick);

  	return {
  		dblclick: handler,
  		simDblclick: simDblclick
  	};
  }

  function removeDoubleTapListener(obj, handlers) {
  	obj.removeEventListener('dblclick', handlers.dblclick);
  	obj.removeEventListener('click', handlers.simDblclick);
  }

  /*
   * @namespace DomUtil
   *
   * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)
   * tree, used by Leaflet internally.
   *
   * Most functions expecting or returning a `HTMLElement` also work for
   * SVG elements. The only difference is that classes refer to CSS classes
   * in HTML and SVG classes in SVG.
   */


  // @property TRANSFORM: String
  // Vendor-prefixed transform style name (e.g. `'webkitTransform'` for WebKit).
  var TRANSFORM = testProp(
  	['transform', 'webkitTransform', 'OTransform', 'MozTransform', 'msTransform']);

  // webkitTransition comes first because some browser versions that drop vendor prefix don't do
  // the same for the transitionend event, in particular the Android 4.1 stock browser

  // @property TRANSITION: String
  // Vendor-prefixed transition style name.
  var TRANSITION = testProp(
  	['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);

  // @property TRANSITION_END: String
  // Vendor-prefixed transitionend event name.
  var TRANSITION_END =
  	TRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';


  // @function get(id: String|HTMLElement): HTMLElement
  // Returns an element given its DOM id, or returns the element itself
  // if it was passed directly.
  function get(id) {
  	return typeof id === 'string' ? document.getElementById(id) : id;
  }

  // @function getStyle(el: HTMLElement, styleAttrib: String): String
  // Returns the value for a certain style attribute on an element,
  // including computed values or values set through CSS.
  function getStyle(el, style) {
  	var value = el.style[style] || (el.currentStyle && el.currentStyle[style]);

  	if ((!value || value === 'auto') && document.defaultView) {
  		var css = document.defaultView.getComputedStyle(el, null);
  		value = css ? css[style] : null;
  	}
  	return value === 'auto' ? null : value;
  }

  // @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement
  // Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.
  function create$1(tagName, className, container) {
  	var el = document.createElement(tagName);
  	el.className = className || '';

  	if (container) {
  		container.appendChild(el);
  	}
  	return el;
  }

  // @function remove(el: HTMLElement)
  // Removes `el` from its parent element
  function remove(el) {
  	var parent = el.parentNode;
  	if (parent) {
  		parent.removeChild(el);
  	}
  }

  // @function empty(el: HTMLElement)
  // Removes all of `el`'s children elements from `el`
  function empty(el) {
  	while (el.firstChild) {
  		el.removeChild(el.firstChild);
  	}
  }

  // @function toFront(el: HTMLElement)
  // Makes `el` the last child of its parent, so it renders in front of the other children.
  function toFront(el) {
  	var parent = el.parentNode;
  	if (parent && parent.lastChild !== el) {
  		parent.appendChild(el);
  	}
  }

  // @function toBack(el: HTMLElement)
  // Makes `el` the first child of its parent, so it renders behind the other children.
  function toBack(el) {
  	var parent = el.parentNode;
  	if (parent && parent.firstChild !== el) {
  		parent.insertBefore(el, parent.firstChild);
  	}
  }

  // @function hasClass(el: HTMLElement, name: String): Boolean
  // Returns `true` if the element's class attribute contains `name`.
  function hasClass(el, name) {
  	if (el.classList !== undefined) {
  		return el.classList.contains(name);
  	}
  	var className = getClass(el);
  	return className.length > 0 && new RegExp('(^|\\s)' + name + '(\\s|$)').test(className);
  }

  // @function addClass(el: HTMLElement, name: String)
  // Adds `name` to the element's class attribute.
  function addClass(el, name) {
  	if (el.classList !== undefined) {
  		var classes = splitWords(name);
  		for (var i = 0, len = classes.length; i < len; i++) {
  			el.classList.add(classes[i]);
  		}
  	} else if (!hasClass(el, name)) {
  		var className = getClass(el);
  		setClass(el, (className ? className + ' ' : '') + name);
  	}
  }

  // @function removeClass(el: HTMLElement, name: String)
  // Removes `name` from the element's class attribute.
  function removeClass(el, name) {
  	if (el.classList !== undefined) {
  		el.classList.remove(name);
  	} else {
  		setClass(el, trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));
  	}
  }

  // @function setClass(el: HTMLElement, name: String)
  // Sets the element's class.
  function setClass(el, name) {
  	if (el.className.baseVal === undefined) {
  		el.className = name;
  	} else {
  		// in case of SVG element
  		el.className.baseVal = name;
  	}
  }

  // @function getClass(el: HTMLElement): String
  // Returns the element's class.
  function getClass(el) {
  	// Check if the element is an SVGElementInstance and use the correspondingElement instead
  	// (Required for linked SVG elements in IE11.)
  	if (el.correspondingElement) {
  		el = el.correspondingElement;
  	}
  	return el.className.baseVal === undefined ? el.className : el.className.baseVal;
  }

  // @function setOpacity(el: HTMLElement, opacity: Number)
  // Set the opacity of an element (including old IE support).
  // `opacity` must be a number from `0` to `1`.
  function setOpacity(el, value) {
  	if ('opacity' in el.style) {
  		el.style.opacity = value;
  	} else if ('filter' in el.style) {
  		_setOpacityIE(el, value);
  	}
  }

  function _setOpacityIE(el, value) {
  	var filter = false,
  	    filterName = 'DXImageTransform.Microsoft.Alpha';

  	// filters collection throws an error if we try to retrieve a filter that doesn't exist
  	try {
  		filter = el.filters.item(filterName);
  	} catch (e) {
  		// don't set opacity to 1 if we haven't already set an opacity,
  		// it isn't needed and breaks transparent pngs.
  		if (value === 1) { return; }
  	}

  	value = Math.round(value * 100);

  	if (filter) {
  		filter.Enabled = (value !== 100);
  		filter.Opacity = value;
  	} else {
  		el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';
  	}
  }

  // @function testProp(props: String[]): String|false
  // Goes through the array of style names and returns the first name
  // that is a valid style name for an element. If no such name is found,
  // it returns false. Useful for vendor-prefixed styles like `transform`.
  function testProp(props) {
  	var style = document.documentElement.style;

  	for (var i = 0; i < props.length; i++) {
  		if (props[i] in style) {
  			return props[i];
  		}
  	}
  	return false;
  }

  // @function setTransform(el: HTMLElement, offset: Point, scale?: Number)
  // Resets the 3D CSS transform of `el` so it is translated by `offset` pixels
  // and optionally scaled by `scale`. Does not have an effect if the
  // browser doesn't support 3D CSS transforms.
  function setTransform(el, offset, scale) {
  	var pos = offset || new Point(0, 0);

  	el.style[TRANSFORM] =
  		(Browser.ie3d ?
  			'translate(' + pos.x + 'px,' + pos.y + 'px)' :
  			'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +
  		(scale ? ' scale(' + scale + ')' : '');
  }

  // @function setPosition(el: HTMLElement, position: Point)
  // Sets the position of `el` to coordinates specified by `position`,
  // using CSS translate or top/left positioning depending on the browser
  // (used by Leaflet internally to position its layers).
  function setPosition(el, point) {

  	/*eslint-disable */
  	el._leaflet_pos = point;
  	/* eslint-enable */

  	if (Browser.any3d) {
  		setTransform(el, point);
  	} else {
  		el.style.left = point.x + 'px';
  		el.style.top = point.y + 'px';
  	}
  }

  // @function getPosition(el: HTMLElement): Point
  // Returns the coordinates of an element previously positioned with setPosition.
  function getPosition(el) {
  	// this method is only used for elements previously positioned using setPosition,
  	// so it's safe to cache the position for performance

  	return el._leaflet_pos || new Point(0, 0);
  }

  // @function disableTextSelection()
  // Prevents the user from generating `selectstart` DOM events, usually generated
  // when the user drags the mouse through a page with text. Used internally
  // by Leaflet to override the behaviour of any click-and-drag interaction on
  // the map. Affects drag interactions on the whole document.

  // @function enableTextSelection()
  // Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).
  var disableTextSelection;
  var enableTextSelection;
  var _userSelect;
  if ('onselectstart' in document) {
  	disableTextSelection = function () {
  		on(window, 'selectstart', preventDefault);
  	};
  	enableTextSelection = function () {
  		off(window, 'selectstart', preventDefault);
  	};
  } else {
  	var userSelectProperty = testProp(
  		['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);

  	disableTextSelection = function () {
  		if (userSelectProperty) {
  			var style = document.documentElement.style;
  			_userSelect = style[userSelectProperty];
  			style[userSelectProperty] = 'none';
  		}
  	};
  	enableTextSelection = function () {
  		if (userSelectProperty) {
  			document.documentElement.style[userSelectProperty] = _userSelect;
  			_userSelect = undefined;
  		}
  	};
  }

  // @function disableImageDrag()
  // As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but
  // for `dragstart` DOM events, usually generated when the user drags an image.
  function disableImageDrag() {
  	on(window, 'dragstart', preventDefault);
  }

  // @function enableImageDrag()
  // Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).
  function enableImageDrag() {
  	off(window, 'dragstart', preventDefault);
  }

  var _outlineElement, _outlineStyle;
  // @function preventOutline(el: HTMLElement)
  // Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)
  // of the element `el` invisible. Used internally by Leaflet to prevent
  // focusable elements from displaying an outline when the user performs a
  // drag interaction on them.
  function preventOutline(element) {
  	while (element.tabIndex === -1) {
  		element = element.parentNode;
  	}
  	if (!element.style) { return; }
  	restoreOutline();
  	_outlineElement = element;
  	_outlineStyle = element.style.outlineStyle;
  	element.style.outlineStyle = 'none';
  	on(window, 'keydown', restoreOutline);
  }

  // @function restoreOutline()
  // Cancels the effects of a previous [`L.DomUtil.preventOutline`]().
  function restoreOutline() {
  	if (!_outlineElement) { return; }
  	_outlineElement.style.outlineStyle = _outlineStyle;
  	_outlineElement = undefined;
  	_outlineStyle = undefined;
  	off(window, 'keydown', restoreOutline);
  }

  // @function getSizedParentNode(el: HTMLElement): HTMLElement
  // Finds the closest parent node which size (width and height) is not null.
  function getSizedParentNode(element) {
  	do {
  		element = element.parentNode;
  	} while ((!element.offsetWidth || !element.offsetHeight) && element !== document.body);
  	return element;
  }

  // @function getScale(el: HTMLElement): Object
  // Computes the CSS scale currently applied on the element.
  // Returns an object with `x` and `y` members as horizontal and vertical scales respectively,
  // and `boundingClientRect` as the result of [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).
  function getScale(element) {
  	var rect = element.getBoundingClientRect(); // Read-only in old browsers.

  	return {
  		x: rect.width / element.offsetWidth || 1,
  		y: rect.height / element.offsetHeight || 1,
  		boundingClientRect: rect
  	};
  }

  var DomUtil = {
    __proto__: null,
    TRANSFORM: TRANSFORM,
    TRANSITION: TRANSITION,
    TRANSITION_END: TRANSITION_END,
    get: get,
    getStyle: getStyle,
    create: create$1,
    remove: remove,
    empty: empty,
    toFront: toFront,
    toBack: toBack,
    hasClass: hasClass,
    addClass: addClass,
    removeClass: removeClass,
    setClass: setClass,
    getClass: getClass,
    setOpacity: setOpacity,
    testProp: testProp,
    setTransform: setTransform,
    setPosition: setPosition,
    getPosition: getPosition,
    get disableTextSelection () { return disableTextSelection; },
    get enableTextSelection () { return enableTextSelection; },
    disableImageDrag: disableImageDrag,
    enableImageDrag: enableImageDrag,
    preventOutline: preventOutline,
    restoreOutline: restoreOutline,
    getSizedParentNode: getSizedParentNode,
    getScale: getScale
  };

  /*
   * @namespace DomEvent
   * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.
   */

  // Inspired by John Resig, Dean Edwards and YUI addEvent implementations.

  // @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this
  // Adds a listener function (`fn`) to a particular DOM event type of the
  // element `el`. You can optionally specify the context of the listener
  // (object the `this` keyword will point to). You can also pass several
  // space-separated types (e.g. `'click dblclick'`).

  // @alternative
  // @function on(el: HTMLElement, eventMap: Object, context?: Object): this
  // Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`
  function on(obj, types, fn, context) {

  	if (types && typeof types === 'object') {
  		for (var type in types) {
  			addOne(obj, type, types[type], fn);
  		}
  	} else {
  		types = splitWords(types);

  		for (var i = 0, len = types.length; i < len; i++) {
  			addOne(obj, types[i], fn, context);
  		}
  	}

  	return this;
  }

  var eventsKey = '_leaflet_events';

  // @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this
  // Removes a previously added listener function.
  // Note that if you passed a custom context to on, you must pass the same
  // context to `off` in order to remove the listener.

  // @alternative
  // @function off(el: HTMLElement, eventMap: Object, context?: Object): this
  // Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`

  // @alternative
  // @function off(el: HTMLElement, types: String): this
  // Removes all previously added listeners of given types.

  // @alternative
  // @function off(el: HTMLElement): this
  // Removes all previously added listeners from given HTMLElement
  function off(obj, types, fn, context) {

  	if (arguments.length === 1) {
  		batchRemove(obj);
  		delete obj[eventsKey];

  	} else if (types && typeof types === 'object') {
  		for (var type in types) {
  			removeOne(obj, type, types[type], fn);
  		}

  	} else {
  		types = splitWords(types);

  		if (arguments.length === 2) {
  			batchRemove(obj, function (type) {
  				return indexOf(types, type) !== -1;
  			});
  		} else {
  			for (var i = 0, len = types.length; i < len; i++) {
  				removeOne(obj, types[i], fn, context);
  			}
  		}
  	}

  	return this;
  }

  function batchRemove(obj, filterFn) {
  	for (var id in obj[eventsKey]) {
  		var type = id.split(/\d/)[0];
  		if (!filterFn || filterFn(type)) {
  			removeOne(obj, type, null, null, id);
  		}
  	}
  }

  var mouseSubst = {
  	mouseenter: 'mouseover',
  	mouseleave: 'mouseout',
  	wheel: !('onwheel' in window) && 'mousewheel'
  };

  function addOne(obj, type, fn, context) {
  	var id = type + stamp(fn) + (context ? '_' + stamp(context) : '');

  	if (obj[eventsKey] && obj[eventsKey][id]) { return this; }

  	var handler = function (e) {
  		return fn.call(context || obj, e || window.event);
  	};

  	var originalHandler = handler;

  	if (!Browser.touchNative && Browser.pointer && type.indexOf('touch') === 0) {
  		// Needs DomEvent.Pointer.js
  		handler = addPointerListener(obj, type, handler);

  	} else if (Browser.touch && (type === 'dblclick')) {
  		handler = addDoubleTapListener(obj, handler);

  	} else if ('addEventListener' in obj) {

  		if (type === 'touchstart' || type === 'touchmove' || type === 'wheel' ||  type === 'mousewheel') {
  			obj.addEventListener(mouseSubst[type] || type, handler, Browser.passiveEvents ? {passive: false} : false);

  		} else if (type === 'mouseenter' || type === 'mouseleave') {
  			handler = function (e) {
  				e = e || window.event;
  				if (isExternalTarget(obj, e)) {
  					originalHandler(e);
  				}
  			};
  			obj.addEventListener(mouseSubst[type], handler, false);

  		} else {
  			obj.addEventListener(type, originalHandler, false);
  		}

  	} else {
  		obj.attachEvent('on' + type, handler);
  	}

  	obj[eventsKey] = obj[eventsKey] || {};
  	obj[eventsKey][id] = handler;
  }

  function removeOne(obj, type, fn, context, id) {
  	id = id || type + stamp(fn) + (context ? '_' + stamp(context) : '');
  	var handler = obj[eventsKey] && obj[eventsKey][id];

  	if (!handler) { return this; }

  	if (!Browser.touchNative && Browser.pointer && type.indexOf('touch') === 0) {
  		removePointerListener(obj, type, handler);

  	} else if (Browser.touch && (type === 'dblclick')) {
  		removeDoubleTapListener(obj, handler);

  	} else if ('removeEventListener' in obj) {

  		obj.removeEventListener(mouseSubst[type] || type, handler, false);

  	} else {
  		obj.detachEvent('on' + type, handler);
  	}

  	obj[eventsKey][id] = null;
  }

  // @function stopPropagation(ev: DOMEvent): this
  // Stop the given event from propagation to parent elements. Used inside the listener functions:
  // ```js
  // L.DomEvent.on(div, 'click', function (ev) {
  // 	L.DomEvent.stopPropagation(ev);
  // });
  // ```
  function stopPropagation(e) {

  	if (e.stopPropagation) {
  		e.stopPropagation();
  	} else if (e.originalEvent) {  // In case of Leaflet event.
  		e.originalEvent._stopped = true;
  	} else {
  		e.cancelBubble = true;
  	}

  	return this;
  }

  // @function disableScrollPropagation(el: HTMLElement): this
  // Adds `stopPropagation` to the element's `'wheel'` events (plus browser variants).
  function disableScrollPropagation(el) {
  	addOne(el, 'wheel', stopPropagation);
  	return this;
  }

  // @function disableClickPropagation(el: HTMLElement): this
  // Adds `stopPropagation` to the element's `'click'`, `'dblclick'`, `'contextmenu'`,
  // `'mousedown'` and `'touchstart'` events (plus browser variants).
  function disableClickPropagation(el) {
  	on(el, 'mousedown touchstart dblclick contextmenu', stopPropagation);
  	el['_leaflet_disable_click'] = true;
  	return this;
  }

  // @function preventDefault(ev: DOMEvent): this
  // Prevents the default action of the DOM Event `ev` from happening (such as
  // following a link in the href of the a element, or doing a POST request
  // with page reload when a `<form>` is submitted).
  // Use it inside listener functions.
  function preventDefault(e) {
  	if (e.preventDefault) {
  		e.preventDefault();
  	} else {
  		e.returnValue = false;
  	}
  	return this;
  }

  // @function stop(ev: DOMEvent): this
  // Does `stopPropagation` and `preventDefault` at the same time.
  function stop(e) {
  	preventDefault(e);
  	stopPropagation(e);
  	return this;
  }

  // @function getPropagationPath(ev: DOMEvent): Array
  // Compatibility polyfill for [`Event.composedPath()`](https://developer.mozilla.org/en-US/docs/Web/API/Event/composedPath).
  // Returns an array containing the `HTMLElement`s that the given DOM event
  // should propagate to (if not stopped).
  function getPropagationPath(ev) {
  	if (ev.composedPath) {
  		return ev.composedPath();
  	}

  	var path = [];
  	var el = ev.target;

  	while (el) {
  		path.push(el);
  		el = el.parentNode;
  	}
  	return path;
  }


  // @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point
  // Gets normalized mouse position from a DOM event relative to the
  // `container` (border excluded) or to the whole page if not specified.
  function getMousePosition(e, container) {
  	if (!container) {
  		return new Point(e.clientX, e.clientY);
  	}

  	var scale = getScale(container),
  	    offset = scale.boundingClientRect; // left and top  values are in page scale (like the event clientX/Y)

  	return new Point(
  		// offset.left/top values are in page scale (like clientX/Y),
  		// whereas clientLeft/Top (border width) values are the original values (before CSS scale applies).
  		(e.clientX - offset.left) / scale.x - container.clientLeft,
  		(e.clientY - offset.top) / scale.y - container.clientTop
  	);
  }


  //  except , Safari and
  // We need double the scroll pixels (see #7403 and #4538) for all Browsers
  // except OSX (Mac) -> 3x, Chrome running on Linux 1x

  var wheelPxFactor =
  	(Browser.linux && Browser.chrome) ? window.devicePixelRatio :
  	Browser.mac ? window.devicePixelRatio * 3 :
  	window.devicePixelRatio > 0 ? 2 * window.devicePixelRatio : 1;
  // @function getWheelDelta(ev: DOMEvent): Number
  // Gets normalized wheel delta from a wheel DOM event, in vertical
  // pixels scrolled (negative if scrolling down).
  // Events from pointing devices without precise scrolling are mapped to
  // a best guess of 60 pixels.
  function getWheelDelta(e) {
  	return (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta
  	       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels
  	       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines
  	       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages
  	       (e.deltaX || e.deltaZ) ? 0 :	// Skip horizontal/depth wheel events
  	       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels
  	       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines
  	       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages
  	       0;
  }

  // check if element really left/entered the event target (for mouseenter/mouseleave)
  function isExternalTarget(el, e) {

  	var related = e.relatedTarget;

  	if (!related) { return true; }

  	try {
  		while (related && (related !== el)) {
  			related = related.parentNode;
  		}
  	} catch (err) {
  		return false;
  	}
  	return (related !== el);
  }

  var DomEvent = {
    __proto__: null,
    on: on,
    off: off,
    stopPropagation: stopPropagation,
    disableScrollPropagation: disableScrollPropagation,
    disableClickPropagation: disableClickPropagation,
    preventDefault: preventDefault,
    stop: stop,
    getPropagationPath: getPropagationPath,
    getMousePosition: getMousePosition,
    getWheelDelta: getWheelDelta,
    isExternalTarget: isExternalTarget,
    addListener: on,
    removeListener: off
  };

  /*
   * @class PosAnimation
   * @aka L.PosAnimation
   * @inherits Evented
   * Used internally for panning animations, utilizing CSS3 Transitions for modern browsers and a timer fallback for IE6-9.
   *
   * @example
   * ```js
   * var myPositionMarker = L.marker([48.864716, 2.294694]).addTo(map);
   *
   * myPositionMarker.on("click", function() {
   * 	var pos = map.latLngToLayerPoint(myPositionMarker.getLatLng());
   * 	pos.y -= 25;
   * 	var fx = new L.PosAnimation();
   *
   * 	fx.once('end',function() {
   * 		pos.y += 25;
   * 		fx.run(myPositionMarker._icon, pos, 0.8);
   * 	});
   *
   * 	fx.run(myPositionMarker._icon, pos, 0.3);
   * });
   *
   * ```
   *
   * @constructor L.PosAnimation()
   * Creates a `PosAnimation` object.
   *
   */

  var PosAnimation = Evented.extend({

  	// @method run(el: HTMLElement, newPos: Point, duration?: Number, easeLinearity?: Number)
  	// Run an animation of a given element to a new position, optionally setting
  	// duration in seconds (`0.25` by default) and easing linearity factor (3rd
  	// argument of the [cubic bezier curve](https://cubic-bezier.com/#0,0,.5,1),
  	// `0.5` by default).
  	run: function (el, newPos, duration, easeLinearity) {
  		this.stop();

  		this._el = el;
  		this._inProgress = true;
  		this._duration = duration || 0.25;
  		this._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);

  		this._startPos = getPosition(el);
  		this._offset = newPos.subtract(this._startPos);
  		this._startTime = +new Date();

  		// @event start: Event
  		// Fired when the animation starts
  		this.fire('start');

  		this._animate();
  	},

  	// @method stop()
  	// Stops the animation (if currently running).
  	stop: function () {
  		if (!this._inProgress) { return; }

  		this._step(true);
  		this._complete();
  	},

  	_animate: function () {
  		// animation loop
  		this._animId = requestAnimFrame(this._animate, this);
  		this._step();
  	},

  	_step: function (round) {
  		var elapsed = (+new Date()) - this._startTime,
  		    duration = this._duration * 1000;

  		if (elapsed < duration) {
  			this._runFrame(this._easeOut(elapsed / duration), round);
  		} else {
  			this._runFrame(1);
  			this._complete();
  		}
  	},

  	_runFrame: function (progress, round) {
  		var pos = this._startPos.add(this._offset.multiplyBy(progress));
  		if (round) {
  			pos._round();
  		}
  		setPosition(this._el, pos);

  		// @event step: Event
  		// Fired continuously during the animation.
  		this.fire('step');
  	},

  	_complete: function () {
  		cancelAnimFrame(this._animId);

  		this._inProgress = false;
  		// @event end: Event
  		// Fired when the animation ends.
  		this.fire('end');
  	},

  	_easeOut: function (t) {
  		return 1 - Math.pow(1 - t, this._easeOutPower);
  	}
  });

  /*
   * @class Map
   * @aka L.Map
   * @inherits Evented
   *
   * The central class of the API — it is used to create a map on a page and manipulate it.
   *
   * @example
   *
   * ```js
   * // initialize the map on the "map" div with a given center and zoom
   * var map = L.map('map', {
   * 	center: [51.505, -0.09],
   * 	zoom: 13
   * });
   * ```
   *
   */

  var Map = Evented.extend({

  	options: {
  		// @section Map State Options
  		// @option crs: CRS = L.CRS.EPSG3857
  		// The [Coordinate Reference System](#crs) to use. Don't change this if you're not
  		// sure what it means.
  		crs: EPSG3857,

  		// @option center: LatLng = undefined
  		// Initial geographic center of the map
  		center: undefined,

  		// @option zoom: Number = undefined
  		// Initial map zoom level
  		zoom: undefined,

  		// @option minZoom: Number = *
  		// Minimum zoom level of the map.
  		// If not specified and at least one `GridLayer` or `TileLayer` is in the map,
  		// the lowest of their `minZoom` options will be used instead.
  		minZoom: undefined,

  		// @option maxZoom: Number = *
  		// Maximum zoom level of the map.
  		// If not specified and at least one `GridLayer` or `TileLayer` is in the map,
  		// the highest of their `maxZoom` options will be used instead.
  		maxZoom: undefined,

  		// @option layers: Layer[] = []
  		// Array of layers that will be added to the map initially
  		layers: [],

  		// @option maxBounds: LatLngBounds = null
  		// When this option is set, the map restricts the view to the given
  		// geographical bounds, bouncing the user back if the user tries to pan
  		// outside the view. To set the restriction dynamically, use
  		// [`setMaxBounds`](#map-setmaxbounds) method.
  		maxBounds: undefined,

  		// @option renderer: Renderer = *
  		// The default method for drawing vector layers on the map. `L.SVG`
  		// or `L.Canvas` by default depending on browser support.
  		renderer: undefined,


  		// @section Animation Options
  		// @option zoomAnimation: Boolean = true
  		// Whether the map zoom animation is enabled. By default it's enabled
  		// in all browsers that support CSS3 Transitions except Android.
  		zoomAnimation: true,

  		// @option zoomAnimationThreshold: Number = 4
  		// Won't animate zoom if the zoom difference exceeds this value.
  		zoomAnimationThreshold: 4,

  		// @option fadeAnimation: Boolean = true
  		// Whether the tile fade animation is enabled. By default it's enabled
  		// in all browsers that support CSS3 Transitions except Android.
  		fadeAnimation: true,

  		// @option markerZoomAnimation: Boolean = true
  		// Whether markers animate their zoom with the zoom animation, if disabled
  		// they will disappear for the length of the animation. By default it's
  		// enabled in all browsers that support CSS3 Transitions except Android.
  		markerZoomAnimation: true,

  		// @option transform3DLimit: Number = 2^23
  		// Defines the maximum size of a CSS translation transform. The default
  		// value should not be changed unless a web browser positions layers in
  		// the wrong place after doing a large `panBy`.
  		transform3DLimit: 8388608, // Precision limit of a 32-bit float

  		// @section Interaction Options
  		// @option zoomSnap: Number = 1
  		// Forces the map's zoom level to always be a multiple of this, particularly
  		// right after a [`fitBounds()`](#map-fitbounds) or a pinch-zoom.
  		// By default, the zoom level snaps to the nearest integer; lower values
  		// (e.g. `0.5` or `0.1`) allow for greater granularity. A value of `0`
  		// means the zoom level will not be snapped after `fitBounds` or a pinch-zoom.
  		zoomSnap: 1,

  		// @option zoomDelta: Number = 1
  		// Controls how much the map's zoom level will change after a
  		// [`zoomIn()`](#map-zoomin), [`zoomOut()`](#map-zoomout), pressing `+`
  		// or `-` on the keyboard, or using the [zoom controls](#control-zoom).
  		// Values smaller than `1` (e.g. `0.5`) allow for greater granularity.
  		zoomDelta: 1,

  		// @option trackResize: Boolean = true
  		// Whether the map automatically handles browser window resize to update itself.
  		trackResize: true
  	},

  	initialize: function (id, options) { // (HTMLElement or String, Object)
  		options = setOptions(this, options);

  		// Make sure to assign internal flags at the beginning,
  		// to avoid inconsistent state in some edge cases.
  		this._handlers = [];
  		this._layers = {};
  		this._zoomBoundLayers = {};
  		this._sizeChanged = true;

  		this._initContainer(id);
  		this._initLayout();

  		// hack for https://github.com/Leaflet/Leaflet/issues/1980
  		this._onResize = bind(this._onResize, this);

  		this._initEvents();

  		if (options.maxBounds) {
  			this.setMaxBounds(options.maxBounds);
  		}

  		if (options.zoom !== undefined) {
  			this._zoom = this._limitZoom(options.zoom);
  		}

  		if (options.center && options.zoom !== undefined) {
  			this.setView(toLatLng(options.center), options.zoom, {reset: true});
  		}

  		this.callInitHooks();

  		// don't animate on browsers without hardware-accelerated transitions or old Android/Opera
  		this._zoomAnimated = TRANSITION && Browser.any3d && !Browser.mobileOpera &&
  				this.options.zoomAnimation;

  		// zoom transitions run with the same duration for all layers, so if one of transitionend events
  		// happens after starting zoom animation (propagating to the map pane), we know that it ended globally
  		if (this._zoomAnimated) {
  			this._createAnimProxy();
  			on(this._proxy, TRANSITION_END, this._catchTransitionEnd, this);
  		}

  		this._addLayers(this.options.layers);
  	},


  	// @section Methods for modifying map state

  	// @method setView(center: LatLng, zoom: Number, options?: Zoom/pan options): this
  	// Sets the view of the map (geographical center and zoom) with the given
  	// animation options.
  	setView: function (center, zoom, options) {

  		zoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);
  		center = this._limitCenter(toLatLng(center), zoom, this.options.maxBounds);
  		options = options || {};

  		this._stop();

  		if (this._loaded && !options.reset && options !== true) {

  			if (options.animate !== undefined) {
  				options.zoom = extend({animate: options.animate}, options.zoom);
  				options.pan = extend({animate: options.animate, duration: options.duration}, options.pan);
  			}

  			// try animating pan or zoom
  			var moved = (this._zoom !== zoom) ?
  				this._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :
  				this._tryAnimatedPan(center, options.pan);

  			if (moved) {
  				// prevent resize handler call, the view will refresh after animation anyway
  				clearTimeout(this._sizeTimer);
  				return this;
  			}
  		}

  		// animation didn't start, just reset the map view
  		this._resetView(center, zoom, options.pan && options.pan.noMoveStart);

  		return this;
  	},

  	// @method setZoom(zoom: Number, options?: Zoom/pan options): this
  	// Sets the zoom of the map.
  	setZoom: function (zoom, options) {
  		if (!this._loaded) {
  			this._zoom = zoom;
  			return this;
  		}
  		return this.setView(this.getCenter(), zoom, {zoom: options});
  	},

  	// @method zoomIn(delta?: Number, options?: Zoom options): this
  	// Increases the zoom of the map by `delta` ([`zoomDelta`](#map-zoomdelta) by default).
  	zoomIn: function (delta, options) {
  		delta = delta || (Browser.any3d ? this.options.zoomDelta : 1);
  		return this.setZoom(this._zoom + delta, options);
  	},

  	// @method zoomOut(delta?: Number, options?: Zoom options): this
  	// Decreases the zoom of the map by `delta` ([`zoomDelta`](#map-zoomdelta) by default).
  	zoomOut: function (delta, options) {
  		delta = delta || (Browser.any3d ? this.options.zoomDelta : 1);
  		return this.setZoom(this._zoom - delta, options);
  	},

  	// @method setZoomAround(latlng: LatLng, zoom: Number, options: Zoom options): this
  	// Zooms the map while keeping a specified geographical point on the map
  	// stationary (e.g. used internally for scroll zoom and double-click zoom).
  	// @alternative
  	// @method setZoomAround(offset: Point, zoom: Number, options: Zoom options): this
  	// Zooms the map while keeping a specified pixel on the map (relative to the top-left corner) stationary.
  	setZoomAround: function (latlng, zoom, options) {
  		var scale = this.getZoomScale(zoom),
  		    viewHalf = this.getSize().divideBy(2),
  		    containerPoint = latlng instanceof Point ? latlng : this.latLngToContainerPoint(latlng),

  		    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),
  		    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));

  		return this.setView(newCenter, zoom, {zoom: options});
  	},

  	_getBoundsCenterZoom: function (bounds, options) {

  		options = options || {};
  		bounds = bounds.getBounds ? bounds.getBounds() : toLatLngBounds(bounds);

  		var paddingTL = toPoint(options.paddingTopLeft || options.padding || [0, 0]),
  		    paddingBR = toPoint(options.paddingBottomRight || options.padding || [0, 0]),

  		    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR));

  		zoom = (typeof options.maxZoom === 'number') ? Math.min(options.maxZoom, zoom) : zoom;

  		if (zoom === Infinity) {
  			return {
  				center: bounds.getCenter(),
  				zoom: zoom
  			};
  		}

  		var paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),

  		    swPoint = this.project(bounds.getSouthWest(), zoom),
  		    nePoint = this.project(bounds.getNorthEast(), zoom),
  		    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);

  		return {
  			center: center,
  			zoom: zoom
  		};
  	},

  	// @method fitBounds(bounds: LatLngBounds, options?: fitBounds options): this
  	// Sets a map view that contains the given geographical bounds with the
  	// maximum zoom level possible.
  	fitBounds: function (bounds, options) {

  		bounds = toLatLngBounds(bounds);

  		if (!bounds.isValid()) {
  			throw new Error('Bounds are not valid.');
  		}

  		var target = this._getBoundsCenterZoom(bounds, options);
  		return this.setView(target.center, target.zoom, options);
  	},

  	// @method fitWorld(options?: fitBounds options): this
  	// Sets a map view that mostly contains the whole world with the maximum
  	// zoom level possible.
  	fitWorld: function (options) {
  		return this.fitBounds([[-90, -180], [90, 180]], options);
  	},

  	// @method panTo(latlng: LatLng, options?: Pan options): this
  	// Pans the map to a given center.
  	panTo: function (center, options) { // (LatLng)
  		return this.setView(center, this._zoom, {pan: options});
  	},

  	// @method panBy(offset: Point, options?: Pan options): this
  	// Pans the map by a given number of pixels (animated).
  	panBy: function (offset, options) {
  		offset = toPoint(offset).round();
  		options = options || {};

  		if (!offset.x && !offset.y) {
  			return this.fire('moveend');
  		}
  		// If we pan too far, Chrome gets issues with tiles
  		// and makes them disappear or appear in the wrong place (slightly offset) #2602
  		if (options.animate !== true && !this.getSize().contains(offset)) {
  			this._resetView(this.unproject(this.project(this.getCenter()).add(offset)), this.getZoom());
  			return this;
  		}

  		if (!this._panAnim) {
  			this._panAnim = new PosAnimation();

  			this._panAnim.on({
  				'step': this._onPanTransitionStep,
  				'end': this._onPanTransitionEnd
  			}, this);
  		}

  		// don't fire movestart if animating inertia
  		if (!options.noMoveStart) {
  			this.fire('movestart');
  		}

  		// animate pan unless animate: false specified
  		if (options.animate !== false) {
  			addClass(this._mapPane, 'leaflet-pan-anim');

  			var newPos = this._getMapPanePos().subtract(offset).round();
  			this._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);
  		} else {
  			this._rawPanBy(offset);
  			this.fire('move').fire('moveend');
  		}

  		return this;
  	},

  	// @method flyTo(latlng: LatLng, zoom?: Number, options?: Zoom/pan options): this
  	// Sets the view of the map (geographical center and zoom) performing a smooth
  	// pan-zoom animation.
  	flyTo: function (targetCenter, targetZoom, options) {

  		options = options || {};
  		if (options.animate === false || !Browser.any3d) {
  			return this.setView(targetCenter, targetZoom, options);
  		}

  		this._stop();

  		var from = this.project(this.getCenter()),
  		    to = this.project(targetCenter),
  		    size = this.getSize(),
  		    startZoom = this._zoom;

  		targetCenter = toLatLng(targetCenter);
  		targetZoom = targetZoom === undefined ? startZoom : targetZoom;

  		var w0 = Math.max(size.x, size.y),
  		    w1 = w0 * this.getZoomScale(startZoom, targetZoom),
  		    u1 = (to.distanceTo(from)) || 1,
  		    rho = 1.42,
  		    rho2 = rho * rho;

  		function r(i) {
  			var s1 = i ? -1 : 1,
  			    s2 = i ? w1 : w0,
  			    t1 = w1 * w1 - w0 * w0 + s1 * rho2 * rho2 * u1 * u1,
  			    b1 = 2 * s2 * rho2 * u1,
  			    b = t1 / b1,
  			    sq = Math.sqrt(b * b + 1) - b;

  			    // workaround for floating point precision bug when sq = 0, log = -Infinite,
  			    // thus triggering an infinite loop in flyTo
  			    var log = sq < 0.000000001 ? -18 : Math.log(sq);

  			return log;
  		}

  		function sinh(n) { return (Math.exp(n) - Math.exp(-n)) / 2; }
  		function cosh(n) { return (Math.exp(n) + Math.exp(-n)) / 2; }
  		function tanh(n) { return sinh(n) / cosh(n); }

  		var r0 = r(0);

  		function w(s) { return w0 * (cosh(r0) / cosh(r0 + rho * s)); }
  		function u(s) { return w0 * (cosh(r0) * tanh(r0 + rho * s) - sinh(r0)) / rho2; }

  		function easeOut(t) { return 1 - Math.pow(1 - t, 1.5); }

  		var start = Date.now(),
  		    S = (r(1) - r0) / rho,
  		    duration = options.duration ? 1000 * options.duration : 1000 * S * 0.8;

  		function frame() {
  			var t = (Date.now() - start) / duration,
  			    s = easeOut(t) * S;

  			if (t <= 1) {
  				this._flyToFrame = requestAnimFrame(frame, this);

  				this._move(
  					this.unproject(from.add(to.subtract(from).multiplyBy(u(s) / u1)), startZoom),
  					this.getScaleZoom(w0 / w(s), startZoom),
  					{flyTo: true});

  			} else {
  				this
  					._move(targetCenter, targetZoom)
  					._moveEnd(true);
  			}
  		}

  		this._moveStart(true, options.noMoveStart);

  		frame.call(this);
  		return this;
  	},

  	// @method flyToBounds(bounds: LatLngBounds, options?: fitBounds options): this
  	// Sets the view of the map with a smooth animation like [`flyTo`](#map-flyto),
  	// but takes a bounds parameter like [`fitBounds`](#map-fitbounds).
  	flyToBounds: function (bounds, options) {
  		var target = this._getBoundsCenterZoom(bounds, options);
  		return this.flyTo(target.center, target.zoom, options);
  	},

  	// @method setMaxBounds(bounds: LatLngBounds): this
  	// Restricts the map view to the given bounds (see the [maxBounds](#map-maxbounds) option).
  	setMaxBounds: function (bounds) {
  		bounds = toLatLngBounds(bounds);

  		if (this.listens('moveend', this._panInsideMaxBounds)) {
  			this.off('moveend', this._panInsideMaxBounds);
  		}

  		if (!bounds.isValid()) {
  			this.options.maxBounds = null;
  			return this;
  		}

  		this.options.maxBounds = bounds;

  		if (this._loaded) {
  			this._panInsideMaxBounds();
  		}

  		return this.on('moveend', this._panInsideMaxBounds);
  	},

  	// @method setMinZoom(zoom: Number): this
  	// Sets the lower limit for the available zoom levels (see the [minZoom](#map-minzoom) option).
  	setMinZoom: function (zoom) {
  		var oldZoom = this.options.minZoom;
  		this.options.minZoom = zoom;

  		if (this._loaded && oldZoom !== zoom) {
  			this.fire('zoomlevelschange');

  			if (this.getZoom() < this.options.minZoom) {
  				return this.setZoom(zoom);
  			}
  		}

  		return this;
  	},

  	// @method setMaxZoom(zoom: Number): this
  	// Sets the upper limit for the available zoom levels (see the [maxZoom](#map-maxzoom) option).
  	setMaxZoom: function (zoom) {
  		var oldZoom = this.options.maxZoom;
  		this.options.maxZoom = zoom;

  		if (this._loaded && oldZoom !== zoom) {
  			this.fire('zoomlevelschange');

  			if (this.getZoom() > this.options.maxZoom) {
  				return this.setZoom(zoom);
  			}
  		}

  		return this;
  	},

  	// @method panInsideBounds(bounds: LatLngBounds, options?: Pan options): this
  	// Pans the map to the closest view that would lie inside the given bounds (if it's not already), controlling the animation using the options specific, if any.
  	panInsideBounds: function (bounds, options) {
  		this._enforcingBounds = true;
  		var center = this.getCenter(),
  		    newCenter = this._limitCenter(center, this._zoom, toLatLngBounds(bounds));

  		if (!center.equals(newCenter)) {
  			this.panTo(newCenter, options);
  		}

  		this._enforcingBounds = false;
  		return this;
  	},

  	// @method panInside(latlng: LatLng, options?: padding options): this
  	// Pans the map the minimum amount to make the `latlng` visible. Use
  	// padding options to fit the display to more restricted bounds.
  	// If `latlng` is already within the (optionally padded) display bounds,
  	// the map will not be panned.
  	panInside: function (latlng, options) {
  		options = options || {};

  		var paddingTL = toPoint(options.paddingTopLeft || options.padding || [0, 0]),
  		    paddingBR = toPoint(options.paddingBottomRight || options.padding || [0, 0]),
  		    pixelCenter = this.project(this.getCenter()),
  		    pixelPoint = this.project(latlng),
  		    pixelBounds = this.getPixelBounds(),
  		    paddedBounds = toBounds([pixelBounds.min.add(paddingTL), pixelBounds.max.subtract(paddingBR)]),
  		    paddedSize = paddedBounds.getSize();

  		if (!paddedBounds.contains(pixelPoint)) {
  			this._enforcingBounds = true;
  			var centerOffset = pixelPoint.subtract(paddedBounds.getCenter());
  			var offset = paddedBounds.extend(pixelPoint).getSize().subtract(paddedSize);
  			pixelCenter.x += centerOffset.x < 0 ? -offset.x : offset.x;
  			pixelCenter.y += centerOffset.y < 0 ? -offset.y : offset.y;
  			this.panTo(this.unproject(pixelCenter), options);
  			this._enforcingBounds = false;
  		}
  		return this;
  	},

  	// @method invalidateSize(options: Zoom/pan options): this
  	// Checks if the map container size changed and updates the map if so —
  	// call it after you've changed the map size dynamically, also animating
  	// pan by default. If `options.pan` is `false`, panning will not occur.
  	// If `options.debounceMoveend` is `true`, it will delay `moveend` event so
  	// that it doesn't happen often even if the method is called many
  	// times in a row.

  	// @alternative
  	// @method invalidateSize(animate: Boolean): this
  	// Checks if the map container size changed and updates the map if so —
  	// call it after you've changed the map size dynamically, also animating
  	// pan by default.
  	invalidateSize: function (options) {
  		if (!this._loaded) { return this; }

  		options = extend({
  			animate: false,
  			pan: true
  		}, options === true ? {animate: true} : options);

  		var oldSize = this.getSize();
  		this._sizeChanged = true;
  		this._lastCenter = null;

  		var newSize = this.getSize(),
  		    oldCenter = oldSize.divideBy(2).round(),
  		    newCenter = newSize.divideBy(2).round(),
  		    offset = oldCenter.subtract(newCenter);

  		if (!offset.x && !offset.y) { return this; }

  		if (options.animate && options.pan) {
  			this.panBy(offset);

  		} else {
  			if (options.pan) {
  				this._rawPanBy(offset);
  			}

  			this.fire('move');

  			if (options.debounceMoveend) {
  				clearTimeout(this._sizeTimer);
  				this._sizeTimer = setTimeout(bind(this.fire, this, 'moveend'), 200);
  			} else {
  				this.fire('moveend');
  			}
  		}

  		// @section Map state change events
  		// @event resize: ResizeEvent
  		// Fired when the map is resized.
  		return this.fire('resize', {
  			oldSize: oldSize,
  			newSize: newSize
  		});
  	},

  	// @section Methods for modifying map state
  	// @method stop(): this
  	// Stops the currently running `panTo` or `flyTo` animation, if any.
  	stop: function () {
  		this.setZoom(this._limitZoom(this._zoom));
  		if (!this.options.zoomSnap) {
  			this.fire('viewreset');
  		}
  		return this._stop();
  	},

  	// @section Geolocation methods
  	// @method locate(options?: Locate options): this
  	// Tries to locate the user using the Geolocation API, firing a [`locationfound`](#map-locationfound)
  	// event with location data on success or a [`locationerror`](#map-locationerror) event on failure,
  	// and optionally sets the map view to the user's location with respect to
  	// detection accuracy (or to the world view if geolocation failed).
  	// Note that, if your page doesn't use HTTPS, this method will fail in
  	// modern browsers ([Chrome 50 and newer](https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-powerful-features-on-insecure-origins))
  	// See `Locate options` for more details.
  	locate: function (options) {

  		options = this._locateOptions = extend({
  			timeout: 10000,
  			watch: false
  			// setView: false
  			// maxZoom: <Number>
  			// maximumAge: 0
  			// enableHighAccuracy: false
  		}, options);

  		if (!('geolocation' in navigator)) {
  			this._handleGeolocationError({
  				code: 0,
  				message: 'Geolocation not supported.'
  			});
  			return this;
  		}

  		var onResponse = bind(this._handleGeolocationResponse, this),
  		    onError = bind(this._handleGeolocationError, this);

  		if (options.watch) {
  			this._locationWatchId =
  			        navigator.geolocation.watchPosition(onResponse, onError, options);
  		} else {
  			navigator.geolocation.getCurrentPosition(onResponse, onError, options);
  		}
  		return this;
  	},

  	// @method stopLocate(): this
  	// Stops watching location previously initiated by `map.locate({watch: true})`
  	// and aborts resetting the map view if map.locate was called with
  	// `{setView: true}`.
  	stopLocate: function () {
  		if (navigator.geolocation && navigator.geolocation.clearWatch) {
  			navigator.geolocation.clearWatch(this._locationWatchId);
  		}
  		if (this._locateOptions) {
  			this._locateOptions.setView = false;
  		}
  		return this;
  	},

  	_handleGeolocationError: function (error) {
  		if (!this._container._leaflet_id) { return; }

  		var c = error.code,
  		    message = error.message ||
  		            (c === 1 ? 'permission denied' :
  		            (c === 2 ? 'position unavailable' : 'timeout'));

  		if (this._locateOptions.setView && !this._loaded) {
  			this.fitWorld();
  		}

  		// @section Location events
  		// @event locationerror: ErrorEvent
  		// Fired when geolocation (using the [`locate`](#map-locate) method) failed.
  		this.fire('locationerror', {
  			code: c,
  			message: 'Geolocation error: ' + message + '.'
  		});
  	},

  	_handleGeolocationResponse: function (pos) {
  		if (!this._container._leaflet_id) { return; }

  		var lat = pos.coords.latitude,
  		    lng = pos.coords.longitude,
  		    latlng = new LatLng(lat, lng),
  		    bounds = latlng.toBounds(pos.coords.accuracy * 2),
  		    options = this._locateOptions;

  		if (options.setView) {
  			var zoom = this.getBoundsZoom(bounds);
  			this.setView(latlng, options.maxZoom ? Math.min(zoom, options.maxZoom) : zoom);
  		}

  		var data = {
  			latlng: latlng,
  			bounds: bounds,
  			timestamp: pos.timestamp
  		};

  		for (var i in pos.coords) {
  			if (typeof pos.coords[i] === 'number') {
  				data[i] = pos.coords[i];
  			}
  		}

  		// @event locationfound: LocationEvent
  		// Fired when geolocation (using the [`locate`](#map-locate) method)
  		// went successfully.
  		this.fire('locationfound', data);
  	},

  	// TODO Appropriate docs section?
  	// @section Other Methods
  	// @method addHandler(name: String, HandlerClass: Function): this
  	// Adds a new `Handler` to the map, given its name and constructor function.
  	addHandler: function (name, HandlerClass) {
  		if (!HandlerClass) { return this; }

  		var handler = this[name] = new HandlerClass(this);

  		this._handlers.push(handler);

  		if (this.options[name]) {
  			handler.enable();
  		}

  		return this;
  	},

  	// @method remove(): this
  	// Destroys the map and clears all related event listeners.
  	remove: function () {

  		this._initEvents(true);
  		if (this.options.maxBounds) { this.off('moveend', this._panInsideMaxBounds); }

  		if (this._containerId !== this._container._leaflet_id) {
  			throw new Error('Map container is being reused by another instance');
  		}

  		try {
  			// throws error in IE6-8
  			delete this._container._leaflet_id;
  			delete this._containerId;
  		} catch (e) {
  			/*eslint-disable */
  			this._container._leaflet_id = undefined;
  			/* eslint-enable */
  			this._containerId = undefined;
  		}

  		if (this._locationWatchId !== undefined) {
  			this.stopLocate();
  		}

  		this._stop();

  		remove(this._mapPane);

  		if (this._clearControlPos) {
  			this._clearControlPos();
  		}
  		if (this._resizeRequest) {
  			cancelAnimFrame(this._resizeRequest);
  			this._resizeRequest = null;
  		}

  		this._clearHandlers();

  		if (this._loaded) {
  			// @section Map state change events
  			// @event unload: Event
  			// Fired when the map is destroyed with [remove](#map-remove) method.
  			this.fire('unload');
  		}

  		var i;
  		for (i in this._layers) {
  			this._layers[i].remove();
  		}
  		for (i in this._panes) {
  			remove(this._panes[i]);
  		}

  		this._layers = [];
  		this._panes = [];
  		delete this._mapPane;
  		delete this._renderer;

  		return this;
  	},

  	// @section Other Methods
  	// @method createPane(name: String, container?: HTMLElement): HTMLElement
  	// Creates a new [map pane](#map-pane) with the given name if it doesn't exist already,
  	// then returns it. The pane is created as a child of `container`, or
  	// as a child of the main map pane if not set.
  	createPane: function (name, container) {
  		var className = 'leaflet-pane' + (name ? ' leaflet-' + name.replace('Pane', '') + '-pane' : ''),
  		    pane = create$1('div', className, container || this._mapPane);

  		if (name) {
  			this._panes[name] = pane;
  		}
  		return pane;
  	},

  	// @section Methods for Getting Map State

  	// @method getCenter(): LatLng
  	// Returns the geographical center of the map view
  	getCenter: function () {
  		this._checkIfLoaded();

  		if (this._lastCenter && !this._moved()) {
  			return this._lastCenter.clone();
  		}
  		return this.layerPointToLatLng(this._getCenterLayerPoint());
  	},

  	// @method getZoom(): Number
  	// Returns the current zoom level of the map view
  	getZoom: function () {
  		return this._zoom;
  	},

  	// @method getBounds(): LatLngBounds
  	// Returns the geographical bounds visible in the current map view
  	getBounds: function () {
  		var bounds = this.getPixelBounds(),
  		    sw = this.unproject(bounds.getBottomLeft()),
  		    ne = this.unproject(bounds.getTopRight());

  		return new LatLngBounds(sw, ne);
  	},

  	// @method getMinZoom(): Number
  	// Returns the minimum zoom level of the map (if set in the `minZoom` option of the map or of any layers), or `0` by default.
  	getMinZoom: function () {
  		return this.options.minZoom === undefined ? this._layersMinZoom || 0 : this.options.minZoom;
  	},

  	// @method getMaxZoom(): Number
  	// Returns the maximum zoom level of the map (if set in the `maxZoom` option of the map or of any layers).
  	getMaxZoom: function () {
  		return this.options.maxZoom === undefined ?
  			(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :
  			this.options.maxZoom;
  	},

  	// @method getBoundsZoom(bounds: LatLngBounds, inside?: Boolean, padding?: Point): Number
  	// Returns the maximum zoom level on which the given bounds fit to the map
  	// view in its entirety. If `inside` (optional) is set to `true`, the method
  	// instead returns the minimum zoom level on which the map view fits into
  	// the given bounds in its entirety.
  	getBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number
  		bounds = toLatLngBounds(bounds);
  		padding = toPoint(padding || [0, 0]);

  		var zoom = this.getZoom() || 0,
  		    min = this.getMinZoom(),
  		    max = this.getMaxZoom(),
  		    nw = bounds.getNorthWest(),
  		    se = bounds.getSouthEast(),
  		    size = this.getSize().subtract(padding),
  		    boundsSize = toBounds(this.project(se, zoom), this.project(nw, zoom)).getSize(),
  		    snap = Browser.any3d ? this.options.zoomSnap : 1,
  		    scalex = size.x / boundsSize.x,
  		    scaley = size.y / boundsSize.y,
  		    scale = inside ? Math.max(scalex, scaley) : Math.min(scalex, scaley);

  		zoom = this.getScaleZoom(scale, zoom);

  		if (snap) {
  			zoom = Math.round(zoom / (snap / 100)) * (snap / 100); // don't jump if within 1% of a snap level
  			zoom = inside ? Math.ceil(zoom / snap) * snap : Math.floor(zoom / snap) * snap;
  		}

  		return Math.max(min, Math.min(max, zoom));
  	},

  	// @method getSize(): Point
  	// Returns the current size of the map container (in pixels).
  	getSize: function () {
  		if (!this._size || this._sizeChanged) {
  			this._size = new Point(
  				this._container.clientWidth || 0,
  				this._container.clientHeight || 0);

  			this._sizeChanged = false;
  		}
  		return this._size.clone();
  	},

  	// @method getPixelBounds(): Bounds
  	// Returns the bounds of the current map view in projected pixel
  	// coordinates (sometimes useful in layer and overlay implementations).
  	getPixelBounds: function (center, zoom) {
  		var topLeftPoint = this._getTopLeftPoint(center, zoom);
  		return new Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));
  	},

  	// TODO: Check semantics - isn't the pixel origin the 0,0 coord relative to
  	// the map pane? "left point of the map layer" can be confusing, specially
  	// since there can be negative offsets.
  	// @method getPixelOrigin(): Point
  	// Returns the projected pixel coordinates of the top left point of
  	// the map layer (useful in custom layer and overlay implementations).
  	getPixelOrigin: function () {
  		this._checkIfLoaded();
  		return this._pixelOrigin;
  	},

  	// @method getPixelWorldBounds(zoom?: Number): Bounds
  	// Returns the world's bounds in pixel coordinates for zoom level `zoom`.
  	// If `zoom` is omitted, the map's current zoom level is used.
  	getPixelWorldBounds: function (zoom) {
  		return this.options.crs.getProjectedBounds(zoom === undefined ? this.getZoom() : zoom);
  	},

  	// @section Other Methods

  	// @method getPane(pane: String|HTMLElement): HTMLElement
  	// Returns a [map pane](#map-pane), given its name or its HTML element (its identity).
  	getPane: function (pane) {
  		return typeof pane === 'string' ? this._panes[pane] : pane;
  	},

  	// @method getPanes(): Object
  	// Returns a plain object containing the names of all [panes](#map-pane) as keys and
  	// the panes as values.
  	getPanes: function () {
  		return this._panes;
  	},

  	// @method getContainer: HTMLElement
  	// Returns the HTML element that contains the map.
  	getContainer: function () {
  		return this._container;
  	},


  	// @section Conversion Methods

  	// @method getZoomScale(toZoom: Number, fromZoom: Number): Number
  	// Returns the scale factor to be applied to a map transition from zoom level
  	// `fromZoom` to `toZoom`. Used internally to help with zoom animations.
  	getZoomScale: function (toZoom, fromZoom) {
  		// TODO replace with universal implementation after refactoring projections
  		var crs = this.options.crs;
  		fromZoom = fromZoom === undefined ? this._zoom : fromZoom;
  		return crs.scale(toZoom) / crs.scale(fromZoom);
  	},

  	// @method getScaleZoom(scale: Number, fromZoom: Number): Number
  	// Returns the zoom level that the map would end up at, if it is at `fromZoom`
  	// level and everything is scaled by a factor of `scale`. Inverse of
  	// [`getZoomScale`](#map-getZoomScale).
  	getScaleZoom: function (scale, fromZoom) {
  		var crs = this.options.crs;
  		fromZoom = fromZoom === undefined ? this._zoom : fromZoom;
  		var zoom = crs.zoom(scale * crs.scale(fromZoom));
  		return isNaN(zoom) ? Infinity : zoom;
  	},

  	// @method project(latlng: LatLng, zoom: Number): Point
  	// Projects a geographical coordinate `LatLng` according to the projection
  	// of the map's CRS, then scales it according to `zoom` and the CRS's
  	// `Transformation`. The result is pixel coordinate relative to
  	// the CRS origin.
  	project: function (latlng, zoom) {
  		zoom = zoom === undefined ? this._zoom : zoom;
  		return this.options.crs.latLngToPoint(toLatLng(latlng), zoom);
  	},

  	// @method unproject(point: Point, zoom: Number): LatLng
  	// Inverse of [`project`](#map-project).
  	unproject: function (point, zoom) {
  		zoom = zoom === undefined ? this._zoom : zoom;
  		return this.options.crs.pointToLatLng(toPoint(point), zoom);
  	},

  	// @method layerPointToLatLng(point: Point): LatLng
  	// Given a pixel coordinate relative to the [origin pixel](#map-getpixelorigin),
  	// returns the corresponding geographical coordinate (for the current zoom level).
  	layerPointToLatLng: function (point) {
  		var projectedPoint = toPoint(point).add(this.getPixelOrigin());
  		return this.unproject(projectedPoint);
  	},

  	// @method latLngToLayerPoint(latlng: LatLng): Point
  	// Given a geographical coordinate, returns the corresponding pixel coordinate
  	// relative to the [origin pixel](#map-getpixelorigin).
  	latLngToLayerPoint: function (latlng) {
  		var projectedPoint = this.project(toLatLng(latlng))._round();
  		return projectedPoint._subtract(this.getPixelOrigin());
  	},

  	// @method wrapLatLng(latlng: LatLng): LatLng
  	// Returns a `LatLng` where `lat` and `lng` has been wrapped according to the
  	// map's CRS's `wrapLat` and `wrapLng` properties, if they are outside the
  	// CRS's bounds.
  	// By default this means longitude is wrapped around the dateline so its
  	// value is between -180 and +180 degrees.
  	wrapLatLng: function (latlng) {
  		return this.options.crs.wrapLatLng(toLatLng(latlng));
  	},

  	// @method wrapLatLngBounds(bounds: LatLngBounds): LatLngBounds
  	// Returns a `LatLngBounds` with the same size as the given one, ensuring that
  	// its center is within the CRS's bounds.
  	// By default this means the center longitude is wrapped around the dateline so its
  	// value is between -180 and +180 degrees, and the majority of the bounds
  	// overlaps the CRS's bounds.
  	wrapLatLngBounds: function (latlng) {
  		return this.options.crs.wrapLatLngBounds(toLatLngBounds(latlng));
  	},

  	// @method distance(latlng1: LatLng, latlng2: LatLng): Number
  	// Returns the distance between two geographical coordinates according to
  	// the map's CRS. By default this measures distance in meters.
  	distance: function (latlng1, latlng2) {
  		return this.options.crs.distance(toLatLng(latlng1), toLatLng(latlng2));
  	},

  	// @method containerPointToLayerPoint(point: Point): Point
  	// Given a pixel coordinate relative to the map container, returns the corresponding
  	// pixel coordinate relative to the [origin pixel](#map-getpixelorigin).
  	containerPointToLayerPoint: function (point) { // (Point)
  		return toPoint(point).subtract(this._getMapPanePos());
  	},

  	// @method layerPointToContainerPoint(point: Point): Point
  	// Given a pixel coordinate relative to the [origin pixel](#map-getpixelorigin),
  	// returns the corresponding pixel coordinate relative to the map container.
  	layerPointToContainerPoint: function (point) { // (Point)
  		return toPoint(point).add(this._getMapPanePos());
  	},

  	// @method containerPointToLatLng(point: Point): LatLng
  	// Given a pixel coordinate relative to the map container, returns
  	// the corresponding geographical coordinate (for the current zoom level).
  	containerPointToLatLng: function (point) {
  		var layerPoint = this.containerPointToLayerPoint(toPoint(point));
  		return this.layerPointToLatLng(layerPoint);
  	},

  	// @method latLngToContainerPoint(latlng: LatLng): Point
  	// Given a geographical coordinate, returns the corresponding pixel coordinate
  	// relative to the map container.
  	latLngToContainerPoint: function (latlng) {
  		return this.layerPointToContainerPoint(this.latLngToLayerPoint(toLatLng(latlng)));
  	},

  	// @method mouseEventToContainerPoint(ev: MouseEvent): Point
  	// Given a MouseEvent object, returns the pixel coordinate relative to the
  	// map container where the event took place.
  	mouseEventToContainerPoint: function (e) {
  		return getMousePosition(e, this._container);
  	},

  	// @method mouseEventToLayerPoint(ev: MouseEvent): Point
  	// Given a MouseEvent object, returns the pixel coordinate relative to
  	// the [origin pixel](#map-getpixelorigin) where the event took place.
  	mouseEventToLayerPoint: function (e) {
  		return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));
  	},

  	// @method mouseEventToLatLng(ev: MouseEvent): LatLng
  	// Given a MouseEvent object, returns geographical coordinate where the
  	// event took place.
  	mouseEventToLatLng: function (e) { // (MouseEvent)
  		return this.layerPointToLatLng(this.mouseEventToLayerPoint(e));
  	},


  	// map initialization methods

  	_initContainer: function (id) {
  		var container = this._container = get(id);

  		if (!container) {
  			throw new Error('Map container not found.');
  		} else if (container._leaflet_id) {
  			throw new Error('Map container is already initialized.');
  		}

  		on(container, 'scroll', this._onScroll, this);
  		this._containerId = stamp(container);
  	},

  	_initLayout: function () {
  		var container = this._container;

  		this._fadeAnimated = this.options.fadeAnimation && Browser.any3d;

  		addClass(container, 'leaflet-container' +
  			(Browser.touch ? ' leaflet-touch' : '') +
  			(Browser.retina ? ' leaflet-retina' : '') +
  			(Browser.ielt9 ? ' leaflet-oldie' : '') +
  			(Browser.safari ? ' leaflet-safari' : '') +
  			(this._fadeAnimated ? ' leaflet-fade-anim' : ''));

  		var position = getStyle(container, 'position');

  		if (position !== 'absolute' && position !== 'relative' && position !== 'fixed' && position !== 'sticky') {
  			container.style.position = 'relative';
  		}

  		this._initPanes();

  		if (this._initControlPos) {
  			this._initControlPos();
  		}
  	},

  	_initPanes: function () {
  		var panes = this._panes = {};
  		this._paneRenderers = {};

  		// @section
  		//
  		// Panes are DOM elements used to control the ordering of layers on the map. You
  		// can access panes with [`map.getPane`](#map-getpane) or
  		// [`map.getPanes`](#map-getpanes) methods. New panes can be created with the
  		// [`map.createPane`](#map-createpane) method.
  		//
  		// Every map has the following default panes that differ only in zIndex.
  		//
  		// @pane mapPane: HTMLElement = 'auto'
  		// Pane that contains all other map panes

  		this._mapPane = this.createPane('mapPane', this._container);
  		setPosition(this._mapPane, new Point(0, 0));

  		// @pane tilePane: HTMLElement = 200
  		// Pane for `GridLayer`s and `TileLayer`s
  		this.createPane('tilePane');
  		// @pane overlayPane: HTMLElement = 400
  		// Pane for vectors (`Path`s, like `Polyline`s and `Polygon`s), `ImageOverlay`s and `VideoOverlay`s
  		this.createPane('overlayPane');
  		// @pane shadowPane: HTMLElement = 500
  		// Pane for overlay shadows (e.g. `Marker` shadows)
  		this.createPane('shadowPane');
  		// @pane markerPane: HTMLElement = 600
  		// Pane for `Icon`s of `Marker`s
  		this.createPane('markerPane');
  		// @pane tooltipPane: HTMLElement = 650
  		// Pane for `Tooltip`s.
  		this.createPane('tooltipPane');
  		// @pane popupPane: HTMLElement = 700
  		// Pane for `Popup`s.
  		this.createPane('popupPane');

  		if (!this.options.markerZoomAnimation) {
  			addClass(panes.markerPane, 'leaflet-zoom-hide');
  			addClass(panes.shadowPane, 'leaflet-zoom-hide');
  		}
  	},


  	// private methods that modify map state

  	// @section Map state change events
  	_resetView: function (center, zoom, noMoveStart) {
  		setPosition(this._mapPane, new Point(0, 0));

  		var loading = !this._loaded;
  		this._loaded = true;
  		zoom = this._limitZoom(zoom);

  		this.fire('viewprereset');

  		var zoomChanged = this._zoom !== zoom;
  		this
  			._moveStart(zoomChanged, noMoveStart)
  			._move(center, zoom)
  			._moveEnd(zoomChanged);

  		// @event viewreset: Event
  		// Fired when the map needs to redraw its content (this usually happens
  		// on map zoom or load). Very useful for creating custom overlays.
  		this.fire('viewreset');

  		// @event load: Event
  		// Fired when the map is initialized (when its center and zoom are set
  		// for the first time).
  		if (loading) {
  			this.fire('load');
  		}
  	},

  	_moveStart: function (zoomChanged, noMoveStart) {
  		// @event zoomstart: Event
  		// Fired when the map zoom is about to change (e.g. before zoom animation).
  		// @event movestart: Event
  		// Fired when the view of the map starts changing (e.g. user starts dragging the map).
  		if (zoomChanged) {
  			this.fire('zoomstart');
  		}
  		if (!noMoveStart) {
  			this.fire('movestart');
  		}
  		return this;
  	},

  	_move: function (center, zoom, data, supressEvent) {
  		if (zoom === undefined) {
  			zoom = this._zoom;
  		}
  		var zoomChanged = this._zoom !== zoom;

  		this._zoom = zoom;
  		this._lastCenter = center;
  		this._pixelOrigin = this._getNewPixelOrigin(center);

  		if (!supressEvent) {
  			// @event zoom: Event
  			// Fired repeatedly during any change in zoom level,
  			// including zoom and fly animations.
  			if (zoomChanged || (data && data.pinch)) {	// Always fire 'zoom' if pinching because #3530
  				this.fire('zoom', data);
  			}

  			// @event move: Event
  			// Fired repeatedly during any movement of the map,
  			// including pan and fly animations.
  			this.fire('move', data);
  		} else if (data && data.pinch) {	// Always fire 'zoom' if pinching because #3530
  			this.fire('zoom', data);
  		}
  		return this;
  	},

  	_moveEnd: function (zoomChanged) {
  		// @event zoomend: Event
  		// Fired when the map zoom changed, after any animations.
  		if (zoomChanged) {
  			this.fire('zoomend');
  		}

  		// @event moveend: Event
  		// Fired when the center of the map stops changing
  		// (e.g. user stopped dragging the map or after non-centered zoom).
  		return this.fire('moveend');
  	},

  	_stop: function () {
  		cancelAnimFrame(this._flyToFrame);
  		if (this._panAnim) {
  			this._panAnim.stop();
  		}
  		return this;
  	},

  	_rawPanBy: function (offset) {
  		setPosition(this._mapPane, this._getMapPanePos().subtract(offset));
  	},

  	_getZoomSpan: function () {
  		return this.getMaxZoom() - this.getMinZoom();
  	},

  	_panInsideMaxBounds: function () {
  		if (!this._enforcingBounds) {
  			this.panInsideBounds(this.options.maxBounds);
  		}
  	},

  	_checkIfLoaded: function () {
  		if (!this._loaded) {
  			throw new Error('Set map center and zoom first.');
  		}
  	},

  	// DOM event handling

  	// @section Interaction events
  	_initEvents: function (remove) {
  		this._targets = {};
  		this._targets[stamp(this._container)] = this;

  		var onOff = remove ? off : on;

  		// @event click: MouseEvent
  		// Fired when the user clicks (or taps) the map.
  		// @event dblclick: MouseEvent
  		// Fired when the user double-clicks (or double-taps) the map.
  		// @event mousedown: MouseEvent
  		// Fired when the user pushes the mouse button on the map.
  		// @event mouseup: MouseEvent
  		// Fired when the user releases the mouse button on the map.
  		// @event mouseover: MouseEvent
  		// Fired when the mouse enters the map.
  		// @event mouseout: MouseEvent
  		// Fired when the mouse leaves the map.
  		// @event mousemove: MouseEvent
  		// Fired while the mouse moves over the map.
  		// @event contextmenu: MouseEvent
  		// Fired when the user pushes the right mouse button on the map, prevents
  		// default browser context menu from showing if there are listeners on
  		// this event. Also fired on mobile when the user holds a single touch
  		// for a second (also called long press).
  		// @event keypress: KeyboardEvent
  		// Fired when the user presses a key from the keyboard that produces a character value while the map is focused.
  		// @event keydown: KeyboardEvent
  		// Fired when the user presses a key from the keyboard while the map is focused. Unlike the `keypress` event,
  		// the `keydown` event is fired for keys that produce a character value and for keys
  		// that do not produce a character value.
  		// @event keyup: KeyboardEvent
  		// Fired when the user releases a key from the keyboard while the map is focused.
  		onOff(this._container, 'click dblclick mousedown mouseup ' +
  			'mouseover mouseout mousemove contextmenu keypress keydown keyup', this._handleDOMEvent, this);

  		if (this.options.trackResize) {
  			onOff(window, 'resize', this._onResize, this);
  		}

  		if (Browser.any3d && this.options.transform3DLimit) {
  			(remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);
  		}
  	},

  	_onResize: function () {
  		cancelAnimFrame(this._resizeRequest);
  		this._resizeRequest = requestAnimFrame(
  		        function () { this.invalidateSize({debounceMoveend: true}); }, this);
  	},

  	_onScroll: function () {
  		this._container.scrollTop  = 0;
  		this._container.scrollLeft = 0;
  	},

  	_onMoveEnd: function () {
  		var pos = this._getMapPanePos();
  		if (Math.max(Math.abs(pos.x), Math.abs(pos.y)) >= this.options.transform3DLimit) {
  			// https://bugzilla.mozilla.org/show_bug.cgi?id=1203873 but Webkit also have
  			// a pixel offset on very high values, see: https://jsfiddle.net/dg6r5hhb/
  			this._resetView(this.getCenter(), this.getZoom());
  		}
  	},

  	_findEventTargets: function (e, type) {
  		var targets = [],
  		    target,
  		    isHover = type === 'mouseout' || type === 'mouseover',
  		    src = e.target || e.srcElement,
  		    dragging = false;

  		while (src) {
  			target = this._targets[stamp(src)];
  			if (target && (type === 'click' || type === 'preclick') && this._draggableMoved(target)) {
  				// Prevent firing click after you just dragged an object.
  				dragging = true;
  				break;
  			}
  			if (target && target.listens(type, true)) {
  				if (isHover && !isExternalTarget(src, e)) { break; }
  				targets.push(target);
  				if (isHover) { break; }
  			}
  			if (src === this._container) { break; }
  			src = src.parentNode;
  		}
  		if (!targets.length && !dragging && !isHover && this.listens(type, true)) {
  			targets = [this];
  		}
  		return targets;
  	},

  	_isClickDisabled: function (el) {
  		while (el && el !== this._container) {
  			if (el['_leaflet_disable_click']) { return true; }
  			el = el.parentNode;
  		}
  	},

  	_handleDOMEvent: function (e) {
  		var el = (e.target || e.srcElement);
  		if (!this._loaded || el['_leaflet_disable_events'] || e.type === 'click' && this._isClickDisabled(el)) {
  			return;
  		}

  		var type = e.type;

  		if (type === 'mousedown') {
  			// prevents outline when clicking on keyboard-focusable element
  			preventOutline(el);
  		}

  		this._fireDOMEvent(e, type);
  	},

  	_mouseEvents: ['click', 'dblclick', 'mouseover', 'mouseout', 'contextmenu'],

  	_fireDOMEvent: function (e, type, canvasTargets) {

  		if (e.type === 'click') {
  			// Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).
  			// @event preclick: MouseEvent
  			// Fired before mouse click on the map (sometimes useful when you
  			// want something to happen on click before any existing click
  			// handlers start running).
  			var synth = extend({}, e);
  			synth.type = 'preclick';
  			this._fireDOMEvent(synth, synth.type, canvasTargets);
  		}

  		// Find the layer the event is propagating from and its parents.
  		var targets = this._findEventTargets(e, type);

  		if (canvasTargets) {
  			var filtered = []; // pick only targets with listeners
  			for (var i = 0; i < canvasTargets.length; i++) {
  				if (canvasTargets[i].listens(type, true)) {
  					filtered.push(canvasTargets[i]);
  				}
  			}
  			targets = filtered.concat(targets);
  		}

  		if (!targets.length) { return; }

  		if (type === 'contextmenu') {
  			preventDefault(e);
  		}

  		var target = targets[0];
  		var data = {
  			originalEvent: e
  		};

  		if (e.type !== 'keypress' && e.type !== 'keydown' && e.type !== 'keyup') {
  			var isMarker = target.getLatLng && (!target._radius || target._radius <= 10);
  			data.containerPoint = isMarker ?
  				this.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);
  			data.layerPoint = this.containerPointToLayerPoint(data.containerPoint);
  			data.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);
  		}

  		for (i = 0; i < targets.length; i++) {
  			targets[i].fire(type, data, true);
  			if (data.originalEvent._stopped ||
  				(targets[i].options.bubblingMouseEvents === false && indexOf(this._mouseEvents, type) !== -1)) { return; }
  		}
  	},

  	_draggableMoved: function (obj) {
  		obj = obj.dragging && obj.dragging.enabled() ? obj : this;
  		return (obj.dragging && obj.dragging.moved()) || (this.boxZoom && this.boxZoom.moved());
  	},

  	_clearHandlers: function () {
  		for (var i = 0, len = this._handlers.length; i < len; i++) {
  			this._handlers[i].disable();
  		}
  	},

  	// @section Other Methods

  	// @method whenReady(fn: Function, context?: Object): this
  	// Runs the given function `fn` when the map gets initialized with
  	// a view (center and zoom) and at least one layer, or immediately
  	// if it's already initialized, optionally passing a function context.
  	whenReady: function (callback, context) {
  		if (this._loaded) {
  			callback.call(context || this, {target: this});
  		} else {
  			this.on('load', callback, context);
  		}
  		return this;
  	},


  	// private methods for getting map state

  	_getMapPanePos: function () {
  		return getPosition(this._mapPane) || new Point(0, 0);
  	},

  	_moved: function () {
  		var pos = this._getMapPanePos();
  		return pos && !pos.equals([0, 0]);
  	},

  	_getTopLeftPoint: function (center, zoom) {
  		var pixelOrigin = center && zoom !== undefined ?
  			this._getNewPixelOrigin(center, zoom) :
  			this.getPixelOrigin();
  		return pixelOrigin.subtract(this._getMapPanePos());
  	},

  	_getNewPixelOrigin: function (center, zoom) {
  		var viewHalf = this.getSize()._divideBy(2);
  		return this.project(center, zoom)._subtract(viewHalf)._add(this._getMapPanePos())._round();
  	},

  	_latLngToNewLayerPoint: function (latlng, zoom, center) {
  		var topLeft = this._getNewPixelOrigin(center, zoom);
  		return this.project(latlng, zoom)._subtract(topLeft);
  	},

  	_latLngBoundsToNewLayerBounds: function (latLngBounds, zoom, center) {
  		var topLeft = this._getNewPixelOrigin(center, zoom);
  		return toBounds([
  			this.project(latLngBounds.getSouthWest(), zoom)._subtract(topLeft),
  			this.project(latLngBounds.getNorthWest(), zoom)._subtract(topLeft),
  			this.project(latLngBounds.getSouthEast(), zoom)._subtract(topLeft),
  			this.project(latLngBounds.getNorthEast(), zoom)._subtract(topLeft)
  		]);
  	},

  	// layer point of the current center
  	_getCenterLayerPoint: function () {
  		return this.containerPointToLayerPoint(this.getSize()._divideBy(2));
  	},

  	// offset of the specified place to the current center in pixels
  	_getCenterOffset: function (latlng) {
  		return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());
  	},

  	// adjust center for view to get inside bounds
  	_limitCenter: function (center, zoom, bounds) {

  		if (!bounds) { return center; }

  		var centerPoint = this.project(center, zoom),
  		    viewHalf = this.getSize().divideBy(2),
  		    viewBounds = new Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),
  		    offset = this._getBoundsOffset(viewBounds, bounds, zoom);

  		// If offset is less than a pixel, ignore.
  		// This prevents unstable projections from getting into
  		// an infinite loop of tiny offsets.
  		if (Math.abs(offset.x) <= 1 && Math.abs(offset.y) <= 1) {
  			return center;
  		}

  		return this.unproject(centerPoint.add(offset), zoom);
  	},

  	// adjust offset for view to get inside bounds
  	_limitOffset: function (offset, bounds) {
  		if (!bounds) { return offset; }

  		var viewBounds = this.getPixelBounds(),
  		    newBounds = new Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));

  		return offset.add(this._getBoundsOffset(newBounds, bounds));
  	},

  	// returns offset needed for pxBounds to get inside maxBounds at a specified zoom
  	_getBoundsOffset: function (pxBounds, maxBounds, zoom) {
  		var projectedMaxBounds = toBounds(
  		        this.project(maxBounds.getNorthEast(), zoom),
  		        this.project(maxBounds.getSouthWest(), zoom)
  		    ),
  		    minOffset = projectedMaxBounds.min.subtract(pxBounds.min),
  		    maxOffset = projectedMaxBounds.max.subtract(pxBounds.max),

  		    dx = this._rebound(minOffset.x, -maxOffset.x),
  		    dy = this._rebound(minOffset.y, -maxOffset.y);

  		return new Point(dx, dy);
  	},

  	_rebound: function (left, right) {
  		return left + right > 0 ?
  			Math.round(left - right) / 2 :
  			Math.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));
  	},

  	_limitZoom: function (zoom) {
  		var min = this.getMinZoom(),
  		    max = this.getMaxZoom(),
  		    snap = Browser.any3d ? this.options.zoomSnap : 1;
  		if (snap) {
  			zoom = Math.round(zoom / snap) * snap;
  		}
  		return Math.max(min, Math.min(max, zoom));
  	},

  	_onPanTransitionStep: function () {
  		this.fire('move');
  	},

  	_onPanTransitionEnd: function () {
  		removeClass(this._mapPane, 'leaflet-pan-anim');
  		this.fire('moveend');
  	},

  	_tryAnimatedPan: function (center, options) {
  		// difference between the new and current centers in pixels
  		var offset = this._getCenterOffset(center)._trunc();

  		// don't animate too far unless animate: true specified in options
  		if ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }

  		this.panBy(offset, options);

  		return true;
  	},

  	_createAnimProxy: function () {

  		var proxy = this._proxy = create$1('div', 'leaflet-proxy leaflet-zoom-animated');
  		this._panes.mapPane.appendChild(proxy);

  		this.on('zoomanim', function (e) {
  			var prop = TRANSFORM,
  			    transform = this._proxy.style[prop];

  			setTransform(this._proxy, this.project(e.center, e.zoom), this.getZoomScale(e.zoom, 1));

  			// workaround for case when transform is the same and so transitionend event is not fired
  			if (transform === this._proxy.style[prop] && this._animatingZoom) {
  				this._onZoomTransitionEnd();
  			}
  		}, this);

  		this.on('load moveend', this._animMoveEnd, this);

  		this._on('unload', this._destroyAnimProxy, this);
  	},

  	_destroyAnimProxy: function () {
  		remove(this._proxy);
  		this.off('load moveend', this._animMoveEnd, this);
  		delete this._proxy;
  	},

  	_animMoveEnd: function () {
  		var c = this.getCenter(),
  		    z = this.getZoom();
  		setTransform(this._proxy, this.project(c, z), this.getZoomScale(z, 1));
  	},

  	_catchTransitionEnd: function (e) {
  		if (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {
  			this._onZoomTransitionEnd();
  		}
  	},

  	_nothingToAnimate: function () {
  		return !this._container.getElementsByClassName('leaflet-zoom-animated').length;
  	},

  	_tryAnimatedZoom: function (center, zoom, options) {

  		if (this._animatingZoom) { return true; }

  		options = options || {};

  		// don't animate if disabled, not supported or zoom difference is too large
  		if (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||
  		        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }

  		// offset is the pixel coords of the zoom origin relative to the current center
  		var scale = this.getZoomScale(zoom),
  		    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale);

  		// don't animate if the zoom origin isn't within one screen from the current center, unless forced
  		if (options.animate !== true && !this.getSize().contains(offset)) { return false; }

  		requestAnimFrame(function () {
  			this
  			    ._moveStart(true, options.noMoveStart || false)
  			    ._animateZoom(center, zoom, true);
  		}, this);

  		return true;
  	},

  	_animateZoom: function (center, zoom, startAnim, noUpdate) {
  		if (!this._mapPane) { return; }

  		if (startAnim) {
  			this._animatingZoom = true;

  			// remember what center/zoom to set after animation
  			this._animateToCenter = center;
  			this._animateToZoom = zoom;

  			addClass(this._mapPane, 'leaflet-zoom-anim');
  		}

  		// @section Other Events
  		// @event zoomanim: ZoomAnimEvent
  		// Fired at least once per zoom animation. For continuous zoom, like pinch zooming, fired once per frame during zoom.
  		this.fire('zoomanim', {
  			center: center,
  			zoom: zoom,
  			noUpdate: noUpdate
  		});

  		if (!this._tempFireZoomEvent) {
  			this._tempFireZoomEvent = this._zoom !== this._animateToZoom;
  		}

  		this._move(this._animateToCenter, this._animateToZoom, undefined, true);

  		// Work around webkit not firing 'transitionend', see https://github.com/Leaflet/Leaflet/issues/3689, 2693
  		setTimeout(bind(this._onZoomTransitionEnd, this), 250);
  	},

  	_onZoomTransitionEnd: function () {
  		if (!this._animatingZoom) { return; }

  		if (this._mapPane) {
  			removeClass(this._mapPane, 'leaflet-zoom-anim');
  		}

  		this._animatingZoom = false;

  		this._move(this._animateToCenter, this._animateToZoom, undefined, true);

  		if (this._tempFireZoomEvent) {
  			this.fire('zoom');
  		}
  		delete this._tempFireZoomEvent;

  		this.fire('move');

  		this._moveEnd(true);
  	}
  });

  // @section

  // @factory L.map(id: String, options?: Map options)
  // Instantiates a map object given the DOM ID of a `<div>` element
  // and optionally an object literal with `Map options`.
  //
  // @alternative
  // @factory L.map(el: HTMLElement, options?: Map options)
  // Instantiates a map object given an instance of a `<div>` HTML element
  // and optionally an object literal with `Map options`.
  function createMap(id, options) {
  	return new Map(id, options);
  }

  /*
   * @class Control
   * @aka L.Control
   * @inherits Class
   *
   * L.Control is a base class for implementing map controls. Handles positioning.
   * All other controls extend from this class.
   */

  var Control = Class.extend({
  	// @section
  	// @aka Control Options
  	options: {
  		// @option position: String = 'topright'
  		// The position of the control (one of the map corners). Possible values are `'topleft'`,
  		// `'topright'`, `'bottomleft'` or `'bottomright'`
  		position: 'topright'
  	},

  	initialize: function (options) {
  		setOptions(this, options);
  	},

  	/* @section
  	 * Classes extending L.Control will inherit the following methods:
  	 *
  	 * @method getPosition: string
  	 * Returns the position of the control.
  	 */
  	getPosition: function () {
  		return this.options.position;
  	},

  	// @method setPosition(position: string): this
  	// Sets the position of the control.
  	setPosition: function (position) {
  		var map = this._map;

  		if (map) {
  			map.removeControl(this);
  		}

  		this.options.position = position;

  		if (map) {
  			map.addControl(this);
  		}

  		return this;
  	},

  	// @method getContainer: HTMLElement
  	// Returns the HTMLElement that contains the control.
  	getContainer: function () {
  		return this._container;
  	},

  	// @method addTo(map: Map): this
  	// Adds the control to the given map.
  	addTo: function (map) {
  		this.remove();
  		this._map = map;

  		var container = this._container = this.onAdd(map),
  		    pos = this.getPosition(),
  		    corner = map._controlCorners[pos];

  		addClass(container, 'leaflet-control');

  		if (pos.indexOf('bottom') !== -1) {
  			corner.insertBefore(container, corner.firstChild);
  		} else {
  			corner.appendChild(container);
  		}

  		this._map.on('unload', this.remove, this);

  		return this;
  	},

  	// @method remove: this
  	// Removes the control from the map it is currently active on.
  	remove: function () {
  		if (!this._map) {
  			return this;
  		}

  		remove(this._container);

  		if (this.onRemove) {
  			this.onRemove(this._map);
  		}

  		this._map.off('unload', this.remove, this);
  		this._map = null;

  		return this;
  	},

  	_refocusOnMap: function (e) {
  		// if map exists and event is not a keyboard event
  		if (this._map && e && e.screenX > 0 && e.screenY > 0) {
  			this._map.getContainer().focus();
  		}
  	}
  });

  var control = function (options) {
  	return new Control(options);
  };

  /* @section Extension methods
   * @uninheritable
   *
   * Every control should extend from `L.Control` and (re-)implement the following methods.
   *
   * @method onAdd(map: Map): HTMLElement
   * Should return the container DOM element for the control and add listeners on relevant map events. Called on [`control.addTo(map)`](#control-addTo).
   *
   * @method onRemove(map: Map)
   * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).
   */

  /* @namespace Map
   * @section Methods for Layers and Controls
   */
  Map.include({
  	// @method addControl(control: Control): this
  	// Adds the given control to the map
  	addControl: function (control) {
  		control.addTo(this);
  		return this;
  	},

  	// @method removeControl(control: Control): this
  	// Removes the given control from the map
  	removeControl: function (control) {
  		control.remove();
  		return this;
  	},

  	_initControlPos: function () {
  		var corners = this._controlCorners = {},
  		    l = 'leaflet-',
  		    container = this._controlContainer =
  		            create$1('div', l + 'control-container', this._container);

  		function createCorner(vSide, hSide) {
  			var className = l + vSide + ' ' + l + hSide;

  			corners[vSide + hSide] = create$1('div', className, container);
  		}

  		createCorner('top', 'left');
  		createCorner('top', 'right');
  		createCorner('bottom', 'left');
  		createCorner('bottom', 'right');
  	},

  	_clearControlPos: function () {
  		for (var i in this._controlCorners) {
  			remove(this._controlCorners[i]);
  		}
  		remove(this._controlContainer);
  		delete this._controlCorners;
  		delete this._controlContainer;
  	}
  });

  /*
   * @class Control.Layers
   * @aka L.Control.Layers
   * @inherits Control
   *
   * The layers control gives users the ability to switch between different base layers and switch overlays on/off (check out the [detailed example](https://leafletjs.com/examples/layers-control/)). Extends `Control`.
   *
   * @example
   *
   * ```js
   * var baseLayers = {
   * 	"Mapbox": mapbox,
   * 	"OpenStreetMap": osm
   * };
   *
   * var overlays = {
   * 	"Marker": marker,
   * 	"Roads": roadsLayer
   * };
   *
   * L.control.layers(baseLayers, overlays).addTo(map);
   * ```
   *
   * The `baseLayers` and `overlays` parameters are object literals with layer names as keys and `Layer` objects as values:
   *
   * ```js
   * {
   *     "<someName1>": layer1,
   *     "<someName2>": layer2
   * }
   * ```
   *
   * The layer names can contain HTML, which allows you to add additional styling to the items:
   *
   * ```js
   * {"<img src='my-layer-icon' /> <span class='my-layer-item'>My Layer</span>": myLayer}
   * ```
   */

  var Layers = Control.extend({
  	// @section
  	// @aka Control.Layers options
  	options: {
  		// @option collapsed: Boolean = true
  		// If `true`, the control will be collapsed into an icon and expanded on mouse hover, touch, or keyboard activation.
  		collapsed: true,
  		position: 'topright',

  		// @option autoZIndex: Boolean = true
  		// If `true`, the control will assign zIndexes in increasing order to all of its layers so that the order is preserved when switching them on/off.
  		autoZIndex: true,

  		// @option hideSingleBase: Boolean = false
  		// If `true`, the base layers in the control will be hidden when there is only one.
  		hideSingleBase: false,

  		// @option sortLayers: Boolean = false
  		// Whether to sort the layers. When `false`, layers will keep the order
  		// in which they were added to the control.
  		sortLayers: false,

  		// @option sortFunction: Function = *
  		// A [compare function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/sort)
  		// that will be used for sorting the layers, when `sortLayers` is `true`.
  		// The function receives both the `L.Layer` instances and their names, as in
  		// `sortFunction(layerA, layerB, nameA, nameB)`.
  		// By default, it sorts layers alphabetically by their name.
  		sortFunction: function (layerA, layerB, nameA, nameB) {
  			return nameA < nameB ? -1 : (nameB < nameA ? 1 : 0);
  		}
  	},

  	initialize: function (baseLayers, overlays, options) {
  		setOptions(this, options);

  		this._layerControlInputs = [];
  		this._layers = [];
  		this._lastZIndex = 0;
  		this._handlingClick = false;
  		this._preventClick = false;

  		for (var i in baseLayers) {
  			this._addLayer(baseLayers[i], i);
  		}

  		for (i in overlays) {
  			this._addLayer(overlays[i], i, true);
  		}
  	},

  	onAdd: function (map) {
  		this._initLayout();
  		this._update();

  		this._map = map;
  		map.on('zoomend', this._checkDisabledLayers, this);

  		for (var i = 0; i < this._layers.length; i++) {
  			this._layers[i].layer.on('add remove', this._onLayerChange, this);
  		}

  		return this._container;
  	},

  	addTo: function (map) {
  		Control.prototype.addTo.call(this, map);
  		// Trigger expand after Layers Control has been inserted into DOM so that is now has an actual height.
  		return this._expandIfNotCollapsed();
  	},

  	onRemove: function () {
  		this._map.off('zoomend', this._checkDisabledLayers, this);

  		for (var i = 0; i < this._layers.length; i++) {
  			this._layers[i].layer.off('add remove', this._onLayerChange, this);
  		}
  	},

  	// @method addBaseLayer(layer: Layer, name: String): this
  	// Adds a base layer (radio button entry) with the given name to the control.
  	addBaseLayer: function (layer, name) {
  		this._addLayer(layer, name);
  		return (this._map) ? this._update() : this;
  	},

  	// @method addOverlay(layer: Layer, name: String): this
  	// Adds an overlay (checkbox entry) with the given name to the control.
  	addOverlay: function (layer, name) {
  		this._addLayer(layer, name, true);
  		return (this._map) ? this._update() : this;
  	},

  	// @method removeLayer(layer: Layer): this
  	// Remove the given layer from the control.
  	removeLayer: function (layer) {
  		layer.off('add remove', this._onLayerChange, this);

  		var obj = this._getLayer(stamp(layer));
  		if (obj) {
  			this._layers.splice(this._layers.indexOf(obj), 1);
  		}
  		return (this._map) ? this._update() : this;
  	},

  	// @method expand(): this
  	// Expand the control container if collapsed.
  	expand: function () {
  		addClass(this._container, 'leaflet-control-layers-expanded');
  		this._section.style.height = null;
  		var acceptableHeight = this._map.getSize().y - (this._container.offsetTop + 50);
  		if (acceptableHeight < this._section.clientHeight) {
  			addClass(this._section, 'leaflet-control-layers-scrollbar');
  			this._section.style.height = acceptableHeight + 'px';
  		} else {
  			removeClass(this._section, 'leaflet-control-layers-scrollbar');
  		}
  		this._checkDisabledLayers();
  		return this;
  	},

  	// @method collapse(): this
  	// Collapse the control container if expanded.
  	collapse: function () {
  		removeClass(this._container, 'leaflet-control-layers-expanded');
  		return this;
  	},

  	_initLayout: function () {
  		var className = 'leaflet-control-layers',
  		    container = this._container = create$1('div', className),
  		    collapsed = this.options.collapsed;

  		// makes this work on IE touch devices by stopping it from firing a mouseout event when the touch is released
  		container.setAttribute('aria-haspopup', true);

  		disableClickPropagation(container);
  		disableScrollPropagation(container);

  		var section = this._section = create$1('section', className + '-list');

  		if (collapsed) {
  			this._map.on('click', this.collapse, this);

  			on(container, {
  				mouseenter: this._expandSafely,
  				mouseleave: this.collapse
  			}, this);
  		}

  		var link = this._layersLink = create$1('a', className + '-toggle', container);
  		link.href = '#';
  		link.title = 'Layers';
  		link.setAttribute('role', 'button');

  		on(link, {
  			keydown: function (e) {
  				if (e.keyCode === 13) {
  					this._expandSafely();
  				}
  			},
  			// Certain screen readers intercept the key event and instead send a click event
  			click: function (e) {
  				preventDefault(e);
  				this._expandSafely();
  			}
  		}, this);

  		if (!collapsed) {
  			this.expand();
  		}

  		this._baseLayersList = create$1('div', className + '-base', section);
  		this._separator = create$1('div', className + '-separator', section);
  		this._overlaysList = create$1('div', className + '-overlays', section);

  		container.appendChild(section);
  	},

  	_getLayer: function (id) {
  		for (var i = 0; i < this._layers.length; i++) {

  			if (this._layers[i] && stamp(this._layers[i].layer) === id) {
  				return this._layers[i];
  			}
  		}
  	},

  	_addLayer: function (layer, name, overlay) {
  		if (this._map) {
  			layer.on('add remove', this._onLayerChange, this);
  		}

  		this._layers.push({
  			layer: layer,
  			name: name,
  			overlay: overlay
  		});

  		if (this.options.sortLayers) {
  			this._layers.sort(bind(function (a, b) {
  				return this.options.sortFunction(a.layer, b.layer, a.name, b.name);
  			}, this));
  		}

  		if (this.options.autoZIndex && layer.setZIndex) {
  			this._lastZIndex++;
  			layer.setZIndex(this._lastZIndex);
  		}

  		this._expandIfNotCollapsed();
  	},

  	_update: function () {
  		if (!this._container) { return this; }

  		empty(this._baseLayersList);
  		empty(this._overlaysList);

  		this._layerControlInputs = [];
  		var baseLayersPresent, overlaysPresent, i, obj, baseLayersCount = 0;

  		for (i = 0; i < this._layers.length; i++) {
  			obj = this._layers[i];
  			this._addItem(obj);
  			overlaysPresent = overlaysPresent || obj.overlay;
  			baseLayersPresent = baseLayersPresent || !obj.overlay;
  			baseLayersCount += !obj.overlay ? 1 : 0;
  		}

  		// Hide base layers section if there's only one layer.
  		if (this.options.hideSingleBase) {
  			baseLayersPresent = baseLayersPresent && baseLayersCount > 1;
  			this._baseLayersList.style.display = baseLayersPresent ? '' : 'none';
  		}

  		this._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';

  		return this;
  	},

  	_onLayerChange: function (e) {
  		if (!this._handlingClick) {
  			this._update();
  		}

  		var obj = this._getLayer(stamp(e.target));

  		// @namespace Map
  		// @section Layer events
  		// @event baselayerchange: LayersControlEvent
  		// Fired when the base layer is changed through the [layers control](#control-layers).
  		// @event overlayadd: LayersControlEvent
  		// Fired when an overlay is selected through the [layers control](#control-layers).
  		// @event overlayremove: LayersControlEvent
  		// Fired when an overlay is deselected through the [layers control](#control-layers).
  		// @namespace Control.Layers
  		var type = obj.overlay ?
  			(e.type === 'add' ? 'overlayadd' : 'overlayremove') :
  			(e.type === 'add' ? 'baselayerchange' : null);

  		if (type) {
  			this._map.fire(type, obj);
  		}
  	},

  	// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see https://stackoverflow.com/a/119079)
  	_createRadioElement: function (name, checked) {

  		var radioHtml = '<input type="radio" class="leaflet-control-layers-selector" name="' +
  				name + '"' + (checked ? ' checked="checked"' : '') + '/>';

  		var radioFragment = document.createElement('div');
  		radioFragment.innerHTML = radioHtml;

  		return radioFragment.firstChild;
  	},

  	_addItem: function (obj) {
  		var label = document.createElement('label'),
  		    checked = this._map.hasLayer(obj.layer),
  		    input;

  		if (obj.overlay) {
  			input = document.createElement('input');
  			input.type = 'checkbox';
  			input.className = 'leaflet-control-layers-selector';
  			input.defaultChecked = checked;
  		} else {
  			input = this._createRadioElement('leaflet-base-layers_' + stamp(this), checked);
  		}

  		this._layerControlInputs.push(input);
  		input.layerId = stamp(obj.layer);

  		on(input, 'click', this._onInputClick, this);

  		var name = document.createElement('span');
  		name.innerHTML = ' ' + obj.name;

  		// Helps from preventing layer control flicker when checkboxes are disabled
  		// https://github.com/Leaflet/Leaflet/issues/2771
  		var holder = document.createElement('span');

  		label.appendChild(holder);
  		holder.appendChild(input);
  		holder.appendChild(name);

  		var container = obj.overlay ? this._overlaysList : this._baseLayersList;
  		container.appendChild(label);

  		this._checkDisabledLayers();
  		return label;
  	},

  	_onInputClick: function () {
  		// expanding the control on mobile with a click can cause adding a layer - we don't want this
  		if (this._preventClick) {
  			return;
  		}

  		var inputs = this._layerControlInputs,
  		    input, layer;
  		var addedLayers = [],
  		    removedLayers = [];

  		this._handlingClick = true;

  		for (var i = inputs.length - 1; i >= 0; i--) {
  			input = inputs[i];
  			layer = this._getLayer(input.layerId).layer;

  			if (input.checked) {
  				addedLayers.push(layer);
  			} else if (!input.checked) {
  				removedLayers.push(layer);
  			}
  		}

  		// Bugfix issue 2318: Should remove all old layers before readding new ones
  		for (i = 0; i < removedLayers.length; i++) {
  			if (this._map.hasLayer(removedLayers[i])) {
  				this._map.removeLayer(removedLayers[i]);
  			}
  		}
  		for (i = 0; i < addedLayers.length; i++) {
  			if (!this._map.hasLayer(addedLayers[i])) {
  				this._map.addLayer(addedLayers[i]);
  			}
  		}

  		this._handlingClick = false;

  		this._refocusOnMap();
  	},

  	_checkDisabledLayers: function () {
  		var inputs = this._layerControlInputs,
  		    input,
  		    layer,
  		    zoom = this._map.getZoom();

  		for (var i = inputs.length - 1; i >= 0; i--) {
  			input = inputs[i];
  			layer = this._getLayer(input.layerId).layer;
  			input.disabled = (layer.options.minZoom !== undefined && zoom < layer.options.minZoom) ||
  			                 (layer.options.maxZoom !== undefined && zoom > layer.options.maxZoom);

  		}
  	},

  	_expandIfNotCollapsed: function () {
  		if (this._map && !this.options.collapsed) {
  			this.expand();
  		}
  		return this;
  	},

  	_expandSafely: function () {
  		var section = this._section;
  		this._preventClick = true;
  		on(section, 'click', preventDefault);
  		this.expand();
  		var that = this;
  		setTimeout(function () {
  			off(section, 'click', preventDefault);
  			that._preventClick = false;
  		});
  	}

  });


  // @factory L.control.layers(baselayers?: Object, overlays?: Object, options?: Control.Layers options)
  // Creates a layers control with the given layers. Base layers will be switched with radio buttons, while overlays will be switched with checkboxes. Note that all base layers should be passed in the base layers object, but only one should be added to the map during map instantiation.
  var layers = function (baseLayers, overlays, options) {
  	return new Layers(baseLayers, overlays, options);
  };

  /*
   * @class Control.Zoom
   * @aka L.Control.Zoom
   * @inherits Control
   *
   * A basic zoom control with two buttons (zoom in and zoom out). It is put on the map by default unless you set its [`zoomControl` option](#map-zoomcontrol) to `false`. Extends `Control`.
   */

  var Zoom = Control.extend({
  	// @section
  	// @aka Control.Zoom options
  	options: {
  		position: 'topleft',

  		// @option zoomInText: String = '<span aria-hidden="true">+</span>'
  		// The text set on the 'zoom in' button.
  		zoomInText: '<span aria-hidden="true">+</span>',

  		// @option zoomInTitle: String = 'Zoom in'
  		// The title set on the 'zoom in' button.
  		zoomInTitle: 'Zoom in',

  		// @option zoomOutText: String = '<span aria-hidden="true">&#x2212;</span>'
  		// The text set on the 'zoom out' button.
  		zoomOutText: '<span aria-hidden="true">&#x2212;</span>',

  		// @option zoomOutTitle: String = 'Zoom out'
  		// The title set on the 'zoom out' button.
  		zoomOutTitle: 'Zoom out'
  	},

  	onAdd: function (map) {
  		var zoomName = 'leaflet-control-zoom',
  		    container = create$1('div', zoomName + ' leaflet-bar'),
  		    options = this.options;

  		this._zoomInButton  = this._createButton(options.zoomInText, options.zoomInTitle,
  		        zoomName + '-in',  container, this._zoomIn);
  		this._zoomOutButton = this._createButton(options.zoomOutText, options.zoomOutTitle,
  		        zoomName + '-out', container, this._zoomOut);

  		this._updateDisabled();
  		map.on('zoomend zoomlevelschange', this._updateDisabled, this);

  		return container;
  	},

  	onRemove: function (map) {
  		map.off('zoomend zoomlevelschange', this._updateDisabled, this);
  	},

  	disable: function () {
  		this._disabled = true;
  		this._updateDisabled();
  		return this;
  	},

  	enable: function () {
  		this._disabled = false;
  		this._updateDisabled();
  		return this;
  	},

  	_zoomIn: function (e) {
  		if (!this._disabled && this._map._zoom < this._map.getMaxZoom()) {
  			this._map.zoomIn(this._map.options.zoomDelta * (e.shiftKey ? 3 : 1));
  		}
  	},

  	_zoomOut: function (e) {
  		if (!this._disabled && this._map._zoom > this._map.getMinZoom()) {
  			this._map.zoomOut(this._map.options.zoomDelta * (e.shiftKey ? 3 : 1));
  		}
  	},

  	_createButton: function (html, title, className, container, fn) {
  		var link = create$1('a', className, container);
  		link.innerHTML = html;
  		link.href = '#';
  		link.title = title;

  		/*
  		 * Will force screen readers like VoiceOver to read this as "Zoom in - button"
  		 */
  		link.setAttribute('role', 'button');
  		link.setAttribute('aria-label', title);

  		disableClickPropagation(link);
  		on(link, 'click', stop);
  		on(link, 'click', fn, this);
  		on(link, 'click', this._refocusOnMap, this);

  		return link;
  	},

  	_updateDisabled: function () {
  		var map = this._map,
  		    className = 'leaflet-disabled';

  		removeClass(this._zoomInButton, className);
  		removeClass(this._zoomOutButton, className);
  		this._zoomInButton.setAttribute('aria-disabled', 'false');
  		this._zoomOutButton.setAttribute('aria-disabled', 'false');

  		if (this._disabled || map._zoom === map.getMinZoom()) {
  			addClass(this._zoomOutButton, className);
  			this._zoomOutButton.setAttribute('aria-disabled', 'true');
  		}
  		if (this._disabled || map._zoom === map.getMaxZoom()) {
  			addClass(this._zoomInButton, className);
  			this._zoomInButton.setAttribute('aria-disabled', 'true');
  		}
  	}
  });

  // @namespace Map
  // @section Control options
  // @option zoomControl: Boolean = true
  // Whether a [zoom control](#control-zoom) is added to the map by default.
  Map.mergeOptions({
  	zoomControl: true
  });

  Map.addInitHook(function () {
  	if (this.options.zoomControl) {
  		// @section Controls
  		// @property zoomControl: Control.Zoom
  		// The default zoom control (only available if the
  		// [`zoomControl` option](#map-zoomcontrol) was `true` when creating the map).
  		this.zoomControl = new Zoom();
  		this.addControl(this.zoomControl);
  	}
  });

  // @namespace Control.Zoom
  // @factory L.control.zoom(options: Control.Zoom options)
  // Creates a zoom control
  var zoom = function (options) {
  	return new Zoom(options);
  };

  /*
   * @class Control.Scale
   * @aka L.Control.Scale
   * @inherits Control
   *
   * A simple scale control that shows the scale of the current center of screen in metric (m/km) and imperial (mi/ft) systems. Extends `Control`.
   *
   * @example
   *
   * ```js
   * L.control.scale().addTo(map);
   * ```
   */

  var Scale = Control.extend({
  	// @section
  	// @aka Control.Scale options
  	options: {
  		position: 'bottomleft',

  		// @option maxWidth: Number = 100
  		// Maximum width of the control in pixels. The width is set dynamically to show round values (e.g. 100, 200, 500).
  		maxWidth: 100,

  		// @option metric: Boolean = True
  		// Whether to show the metric scale line (m/km).
  		metric: true,

  		// @option imperial: Boolean = True
  		// Whether to show the imperial scale line (mi/ft).
  		imperial: true

  		// @option updateWhenIdle: Boolean = false
  		// If `true`, the control is updated on [`moveend`](#map-moveend), otherwise it's always up-to-date (updated on [`move`](#map-move)).
  	},

  	onAdd: function (map) {
  		var className = 'leaflet-control-scale',
  		    container = create$1('div', className),
  		    options = this.options;

  		this._addScales(options, className + '-line', container);

  		map.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);
  		map.whenReady(this._update, this);

  		return container;
  	},

  	onRemove: function (map) {
  		map.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);
  	},

  	_addScales: function (options, className, container) {
  		if (options.metric) {
  			this._mScale = create$1('div', className, container);
  		}
  		if (options.imperial) {
  			this._iScale = create$1('div', className, container);
  		}
  	},

  	_update: function () {
  		var map = this._map,
  		    y = map.getSize().y / 2;

  		var maxMeters = map.distance(
  			map.containerPointToLatLng([0, y]),
  			map.containerPointToLatLng([this.options.maxWidth, y]));

  		this._updateScales(maxMeters);
  	},

  	_updateScales: function (maxMeters) {
  		if (this.options.metric && maxMeters) {
  			this._updateMetric(maxMeters);
  		}
  		if (this.options.imperial && maxMeters) {
  			this._updateImperial(maxMeters);
  		}
  	},

  	_updateMetric: function (maxMeters) {
  		var meters = this._getRoundNum(maxMeters),
  		    label = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';

  		this._updateScale(this._mScale, label, meters / maxMeters);
  	},

  	_updateImperial: function (maxMeters) {
  		var maxFeet = maxMeters * 3.2808399,
  		    maxMiles, miles, feet;

  		if (maxFeet > 5280) {
  			maxMiles = maxFeet / 5280;
  			miles = this._getRoundNum(maxMiles);
  			this._updateScale(this._iScale, miles + ' mi', miles / maxMiles);

  		} else {
  			feet = this._getRoundNum(maxFeet);
  			this._updateScale(this._iScale, feet + ' ft', feet / maxFeet);
  		}
  	},

  	_updateScale: function (scale, text, ratio) {
  		scale.style.width = Math.round(this.options.maxWidth * ratio) + 'px';
  		scale.innerHTML = text;
  	},

  	_getRoundNum: function (num) {
  		var pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),
  		    d = num / pow10;

  		d = d >= 10 ? 10 :
  		    d >= 5 ? 5 :
  		    d >= 3 ? 3 :
  		    d >= 2 ? 2 : 1;

  		return pow10 * d;
  	}
  });


  // @factory L.control.scale(options?: Control.Scale options)
  // Creates an scale control with the given options.
  var scale = function (options) {
  	return new Scale(options);
  };

  var ukrainianFlag = '<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>';


  /*
   * @class Control.Attribution
   * @aka L.Control.Attribution
   * @inherits Control
   *
   * The attribution control allows you to display attribution data in a small text box on a map. It is put on the map by default unless you set its [`attributionControl` option](#map-attributioncontrol) to `false`, and it fetches attribution texts from layers with the [`getAttribution` method](#layer-getattribution) automatically. Extends Control.
   */

  var Attribution = Control.extend({
  	// @section
  	// @aka Control.Attribution options
  	options: {
  		position: 'bottomright',

  		// @option prefix: String|false = 'Leaflet'
  		// The HTML text shown before the attributions. Pass `false` to disable.
  		prefix: '<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">' + (Browser.inlineSvg ? ukrainianFlag + ' ' : '') + 'Leaflet</a>'
  	},

  	initialize: function (options) {
  		setOptions(this, options);

  		this._attributions = {};
  	},

  	onAdd: function (map) {
  		map.attributionControl = this;
  		this._container = create$1('div', 'leaflet-control-attribution');
  		disableClickPropagation(this._container);

  		// TODO ugly, refactor
  		for (var i in map._layers) {
  			if (map._layers[i].getAttribution) {
  				this.addAttribution(map._layers[i].getAttribution());
  			}
  		}

  		this._update();

  		map.on('layeradd', this._addAttribution, this);

  		return this._container;
  	},

  	onRemove: function (map) {
  		map.off('layeradd', this._addAttribution, this);
  	},

  	_addAttribution: function (ev) {
  		if (ev.layer.getAttribution) {
  			this.addAttribution(ev.layer.getAttribution());
  			ev.layer.once('remove', function () {
  				this.removeAttribution(ev.layer.getAttribution());
  			}, this);
  		}
  	},

  	// @method setPrefix(prefix: String|false): this
  	// The HTML text shown before the attributions. Pass `false` to disable.
  	setPrefix: function (prefix) {
  		this.options.prefix = prefix;
  		this._update();
  		return this;
  	},

  	// @method addAttribution(text: String): this
  	// Adds an attribution text (e.g. `'&copy; OpenStreetMap contributors'`).
  	addAttribution: function (text) {
  		if (!text) { return this; }

  		if (!this._attributions[text]) {
  			this._attributions[text] = 0;
  		}
  		this._attributions[text]++;

  		this._update();

  		return this;
  	},

  	// @method removeAttribution(text: String): this
  	// Removes an attribution text.
  	removeAttribution: function (text) {
  		if (!text) { return this; }

  		if (this._attributions[text]) {
  			this._attributions[text]--;
  			this._update();
  		}

  		return this;
  	},

  	_update: function () {
  		if (!this._map) { return; }

  		var attribs = [];

  		for (var i in this._attributions) {
  			if (this._attributions[i]) {
  				attribs.push(i);
  			}
  		}

  		var prefixAndAttribs = [];

  		if (this.options.prefix) {
  			prefixAndAttribs.push(this.options.prefix);
  		}
  		if (attribs.length) {
  			prefixAndAttribs.push(attribs.join(', '));
  		}

  		this._container.innerHTML = prefixAndAttribs.join(' <span aria-hidden="true">|</span> ');
  	}
  });

  // @namespace Map
  // @section Control options
  // @option attributionControl: Boolean = true
  // Whether a [attribution control](#control-attribution) is added to the map by default.
  Map.mergeOptions({
  	attributionControl: true
  });

  Map.addInitHook(function () {
  	if (this.options.attributionControl) {
  		new Attribution().addTo(this);
  	}
  });

  // @namespace Control.Attribution
  // @factory L.control.attribution(options: Control.Attribution options)
  // Creates an attribution control.
  var attribution = function (options) {
  	return new Attribution(options);
  };

  Control.Layers = Layers;
  Control.Zoom = Zoom;
  Control.Scale = Scale;
  Control.Attribution = Attribution;

  control.layers = layers;
  control.zoom = zoom;
  control.scale = scale;
  control.attribution = attribution;

  /*
  	L.Handler is a base class for handler classes that are used internally to inject
  	interaction features like dragging to classes like Map and Marker.
  */

  // @class Handler
  // @aka L.Handler
  // Abstract class for map interaction handlers

  var Handler = Class.extend({
  	initialize: function (map) {
  		this._map = map;
  	},

  	// @method enable(): this
  	// Enables the handler
  	enable: function () {
  		if (this._enabled) { return this; }

  		this._enabled = true;
  		this.addHooks();
  		return this;
  	},

  	// @method disable(): this
  	// Disables the handler
  	disable: function () {
  		if (!this._enabled) { return this; }

  		this._enabled = false;
  		this.removeHooks();
  		return this;
  	},

  	// @method enabled(): Boolean
  	// Returns `true` if the handler is enabled
  	enabled: function () {
  		return !!this._enabled;
  	}

  	// @section Extension methods
  	// Classes inheriting from `Handler` must implement the two following methods:
  	// @method addHooks()
  	// Called when the handler is enabled, should add event hooks.
  	// @method removeHooks()
  	// Called when the handler is disabled, should remove the event hooks added previously.
  });

  // @section There is static function which can be called without instantiating L.Handler:
  // @function addTo(map: Map, name: String): this
  // Adds a new Handler to the given map with the given name.
  Handler.addTo = function (map, name) {
  	map.addHandler(name, this);
  	return this;
  };

  var Mixin = {Events: Events};

  /*
   * @class Draggable
   * @aka L.Draggable
   * @inherits Evented
   *
   * A class for making DOM elements draggable (including touch support).
   * Used internally for map and marker dragging. Only works for elements
   * that were positioned with [`L.DomUtil.setPosition`](#domutil-setposition).
   *
   * @example
   * ```js
   * var draggable = new L.Draggable(elementToDrag);
   * draggable.enable();
   * ```
   */

  var START = Browser.touch ? 'touchstart mousedown' : 'mousedown';

  var Draggable = Evented.extend({

  	options: {
  		// @section
  		// @aka Draggable options
  		// @option clickTolerance: Number = 3
  		// The max number of pixels a user can shift the mouse pointer during a click
  		// for it to be considered a valid click (as opposed to a mouse drag).
  		clickTolerance: 3
  	},

  	// @constructor L.Draggable(el: HTMLElement, dragHandle?: HTMLElement, preventOutline?: Boolean, options?: Draggable options)
  	// Creates a `Draggable` object for moving `el` when you start dragging the `dragHandle` element (equals `el` itself by default).
  	initialize: function (element, dragStartTarget, preventOutline, options) {
  		setOptions(this, options);

  		this._element = element;
  		this._dragStartTarget = dragStartTarget || element;
  		this._preventOutline = preventOutline;
  	},

  	// @method enable()
  	// Enables the dragging ability
  	enable: function () {
  		if (this._enabled) { return; }

  		on(this._dragStartTarget, START, this._onDown, this);

  		this._enabled = true;
  	},

  	// @method disable()
  	// Disables the dragging ability
  	disable: function () {
  		if (!this._enabled) { return; }

  		// If we're currently dragging this draggable,
  		// disabling it counts as first ending the drag.
  		if (Draggable._dragging === this) {
  			this.finishDrag(true);
  		}

  		off(this._dragStartTarget, START, this._onDown, this);

  		this._enabled = false;
  		this._moved = false;
  	},

  	_onDown: function (e) {
  		// Ignore the event if disabled; this happens in IE11
  		// under some circumstances, see #3666.
  		if (!this._enabled) { return; }

  		this._moved = false;

  		if (hasClass(this._element, 'leaflet-zoom-anim')) { return; }

  		if (e.touches && e.touches.length !== 1) {
  			// Finish dragging to avoid conflict with touchZoom
  			if (Draggable._dragging === this) {
  				this.finishDrag();
  			}
  			return;
  		}

  		if (Draggable._dragging || e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }
  		Draggable._dragging = this;  // Prevent dragging multiple objects at once.

  		if (this._preventOutline) {
  			preventOutline(this._element);
  		}

  		disableImageDrag();
  		disableTextSelection();

  		if (this._moving) { return; }

  		// @event down: Event
  		// Fired when a drag is about to start.
  		this.fire('down');

  		var first = e.touches ? e.touches[0] : e,
  		    sizedParent = getSizedParentNode(this._element);

  		this._startPoint = new Point(first.clientX, first.clientY);
  		this._startPos = getPosition(this._element);

  		// Cache the scale, so that we can continuously compensate for it during drag (_onMove).
  		this._parentScale = getScale(sizedParent);

  		var mouseevent = e.type === 'mousedown';
  		on(document, mouseevent ? 'mousemove' : 'touchmove', this._onMove, this);
  		on(document, mouseevent ? 'mouseup' : 'touchend touchcancel', this._onUp, this);
  	},

  	_onMove: function (e) {
  		// Ignore the event if disabled; this happens in IE11
  		// under some circumstances, see #3666.
  		if (!this._enabled) { return; }

  		if (e.touches && e.touches.length > 1) {
  			this._moved = true;
  			return;
  		}

  		var first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),
  		    offset = new Point(first.clientX, first.clientY)._subtract(this._startPoint);

  		if (!offset.x && !offset.y) { return; }
  		if (Math.abs(offset.x) + Math.abs(offset.y) < this.options.clickTolerance) { return; }

  		// We assume that the parent container's position, border and scale do not change for the duration of the drag.
  		// Therefore there is no need to account for the position and border (they are eliminated by the subtraction)
  		// and we can use the cached value for the scale.
  		offset.x /= this._parentScale.x;
  		offset.y /= this._parentScale.y;

  		preventDefault(e);

  		if (!this._moved) {
  			// @event dragstart: Event
  			// Fired when a drag starts
  			this.fire('dragstart');

  			this._moved = true;

  			addClass(document.body, 'leaflet-dragging');

  			this._lastTarget = e.target || e.srcElement;
  			// IE and Edge do not give the <use> element, so fetch it
  			// if necessary
  			if (window.SVGElementInstance && this._lastTarget instanceof window.SVGElementInstance) {
  				this._lastTarget = this._lastTarget.correspondingUseElement;
  			}
  			addClass(this._lastTarget, 'leaflet-drag-target');
  		}

  		this._newPos = this._startPos.add(offset);
  		this._moving = true;

  		this._lastEvent = e;
  		this._updatePosition();
  	},

  	_updatePosition: function () {
  		var e = {originalEvent: this._lastEvent};

  		// @event predrag: Event
  		// Fired continuously during dragging *before* each corresponding
  		// update of the element's position.
  		this.fire('predrag', e);
  		setPosition(this._element, this._newPos);

  		// @event drag: Event
  		// Fired continuously during dragging.
  		this.fire('drag', e);
  	},

  	_onUp: function () {
  		// Ignore the event if disabled; this happens in IE11
  		// under some circumstances, see #3666.
  		if (!this._enabled) { return; }
  		this.finishDrag();
  	},

  	finishDrag: function (noInertia) {
  		removeClass(document.body, 'leaflet-dragging');

  		if (this._lastTarget) {
  			removeClass(this._lastTarget, 'leaflet-drag-target');
  			this._lastTarget = null;
  		}

  		off(document, 'mousemove touchmove', this._onMove, this);
  		off(document, 'mouseup touchend touchcancel', this._onUp, this);

  		enableImageDrag();
  		enableTextSelection();

  		var fireDragend = this._moved && this._moving;

  		this._moving = false;
  		Draggable._dragging = false;

  		if (fireDragend) {
  			// @event dragend: DragEndEvent
  			// Fired when the drag ends.
  			this.fire('dragend', {
  				noInertia: noInertia,
  				distance: this._newPos.distanceTo(this._startPos)
  			});
  		}
  	}

  });

  /*
   * @namespace PolyUtil
   * Various utility functions for polygon geometries.
   */

  /* @function clipPolygon(points: Point[], bounds: Bounds, round?: Boolean): Point[]
   * Clips the polygon geometry defined by the given `points` by the given bounds (using the [Sutherland-Hodgman algorithm](https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm)).
   * Used by Leaflet to only show polygon points that are on the screen or near, increasing
   * performance. Note that polygon points needs different algorithm for clipping
   * than polyline, so there's a separate method for it.
   */
  function clipPolygon(points, bounds, round) {
  	var clippedPoints,
  	    edges = [1, 4, 2, 8],
  	    i, j, k,
  	    a, b,
  	    len, edge, p;

  	for (i = 0, len = points.length; i < len; i++) {
  		points[i]._code = _getBitCode(points[i], bounds);
  	}

  	// for each edge (left, bottom, right, top)
  	for (k = 0; k < 4; k++) {
  		edge = edges[k];
  		clippedPoints = [];

  		for (i = 0, len = points.length, j = len - 1; i < len; j = i++) {
  			a = points[i];
  			b = points[j];

  			// if a is inside the clip window
  			if (!(a._code & edge)) {
  				// if b is outside the clip window (a->b goes out of screen)
  				if (b._code & edge) {
  					p = _getEdgeIntersection(b, a, edge, bounds, round);
  					p._code = _getBitCode(p, bounds);
  					clippedPoints.push(p);
  				}
  				clippedPoints.push(a);

  			// else if b is inside the clip window (a->b enters the screen)
  			} else if (!(b._code & edge)) {
  				p = _getEdgeIntersection(b, a, edge, bounds, round);
  				p._code = _getBitCode(p, bounds);
  				clippedPoints.push(p);
  			}
  		}
  		points = clippedPoints;
  	}

  	return points;
  }

  /* @function polygonCenter(latlngs: LatLng[], crs: CRS): LatLng
   * Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the passed LatLngs (first ring) from a polygon.
   */
  function polygonCenter(latlngs, crs) {
  	var i, j, p1, p2, f, area, x, y, center;

  	if (!latlngs || latlngs.length === 0) {
  		throw new Error('latlngs not passed');
  	}

  	if (!isFlat(latlngs)) {
  		console.warn('latlngs are not flat! Only the first ring will be used');
  		latlngs = latlngs[0];
  	}

  	var centroidLatLng = toLatLng([0, 0]);

  	var bounds = toLatLngBounds(latlngs);
  	var areaBounds = bounds.getNorthWest().distanceTo(bounds.getSouthWest()) * bounds.getNorthEast().distanceTo(bounds.getNorthWest());
  	// tests showed that below 1700 rounding errors are happening
  	if (areaBounds < 1700) {
  		// getting a inexact center, to move the latlngs near to [0, 0] to prevent rounding errors
  		centroidLatLng = centroid(latlngs);
  	}

  	var len = latlngs.length;
  	var points = [];
  	for (i = 0; i < len; i++) {
  		var latlng = toLatLng(latlngs[i]);
  		points.push(crs.project(toLatLng([latlng.lat - centroidLatLng.lat, latlng.lng - centroidLatLng.lng])));
  	}

  	area = x = y = 0;

  	// polygon centroid algorithm;
  	for (i = 0, j = len - 1; i < len; j = i++) {
  		p1 = points[i];
  		p2 = points[j];

  		f = p1.y * p2.x - p2.y * p1.x;
  		x += (p1.x + p2.x) * f;
  		y += (p1.y + p2.y) * f;
  		area += f * 3;
  	}

  	if (area === 0) {
  		// Polygon is so small that all points are on same pixel.
  		center = points[0];
  	} else {
  		center = [x / area, y / area];
  	}

  	var latlngCenter = crs.unproject(toPoint(center));
  	return toLatLng([latlngCenter.lat + centroidLatLng.lat, latlngCenter.lng + centroidLatLng.lng]);
  }

  /* @function centroid(latlngs: LatLng[]): LatLng
   * Returns the 'center of mass' of the passed LatLngs.
   */
  function centroid(coords) {
  	var latSum = 0;
  	var lngSum = 0;
  	var len = 0;
  	for (var i = 0; i < coords.length; i++) {
  		var latlng = toLatLng(coords[i]);
  		latSum += latlng.lat;
  		lngSum += latlng.lng;
  		len++;
  	}
  	return toLatLng([latSum / len, lngSum / len]);
  }

  var PolyUtil = {
    __proto__: null,
    clipPolygon: clipPolygon,
    polygonCenter: polygonCenter,
    centroid: centroid
  };

  /*
   * @namespace LineUtil
   *
   * Various utility functions for polyline points processing, used by Leaflet internally to make polylines lightning-fast.
   */

  // Simplify polyline with vertex reduction and Douglas-Peucker simplification.
  // Improves rendering performance dramatically by lessening the number of points to draw.

  // @function simplify(points: Point[], tolerance: Number): Point[]
  // Dramatically reduces the number of points in a polyline while retaining
  // its shape and returns a new array of simplified points, using the
  // [Ramer-Douglas-Peucker algorithm](https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm).
  // Used for a huge performance boost when processing/displaying Leaflet polylines for
  // each zoom level and also reducing visual noise. tolerance affects the amount of
  // simplification (lesser value means higher quality but slower and with more points).
  // Also released as a separated micro-library [Simplify.js](https://mourner.github.io/simplify-js/).
  function simplify(points, tolerance) {
  	if (!tolerance || !points.length) {
  		return points.slice();
  	}

  	var sqTolerance = tolerance * tolerance;

  	    // stage 1: vertex reduction
  	    points = _reducePoints(points, sqTolerance);

  	    // stage 2: Douglas-Peucker simplification
  	    points = _simplifyDP(points, sqTolerance);

  	return points;
  }

  // @function pointToSegmentDistance(p: Point, p1: Point, p2: Point): Number
  // Returns the distance between point `p` and segment `p1` to `p2`.
  function pointToSegmentDistance(p, p1, p2) {
  	return Math.sqrt(_sqClosestPointOnSegment(p, p1, p2, true));
  }

  // @function closestPointOnSegment(p: Point, p1: Point, p2: Point): Number
  // Returns the closest point from a point `p` on a segment `p1` to `p2`.
  function closestPointOnSegment(p, p1, p2) {
  	return _sqClosestPointOnSegment(p, p1, p2);
  }

  // Ramer-Douglas-Peucker simplification, see https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm
  function _simplifyDP(points, sqTolerance) {

  	var len = points.length,
  	    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,
  	    markers = new ArrayConstructor(len);

  	    markers[0] = markers[len - 1] = 1;

  	_simplifyDPStep(points, markers, sqTolerance, 0, len - 1);

  	var i,
  	    newPoints = [];

  	for (i = 0; i < len; i++) {
  		if (markers[i]) {
  			newPoints.push(points[i]);
  		}
  	}

  	return newPoints;
  }

  function _simplifyDPStep(points, markers, sqTolerance, first, last) {

  	var maxSqDist = 0,
  	index, i, sqDist;

  	for (i = first + 1; i <= last - 1; i++) {
  		sqDist = _sqClosestPointOnSegment(points[i], points[first], points[last], true);

  		if (sqDist > maxSqDist) {
  			index = i;
  			maxSqDist = sqDist;
  		}
  	}

  	if (maxSqDist > sqTolerance) {
  		markers[index] = 1;

  		_simplifyDPStep(points, markers, sqTolerance, first, index);
  		_simplifyDPStep(points, markers, sqTolerance, index, last);
  	}
  }

  // reduce points that are too close to each other to a single point
  function _reducePoints(points, sqTolerance) {
  	var reducedPoints = [points[0]];

  	for (var i = 1, prev = 0, len = points.length; i < len; i++) {
  		if (_sqDist(points[i], points[prev]) > sqTolerance) {
  			reducedPoints.push(points[i]);
  			prev = i;
  		}
  	}
  	if (prev < len - 1) {
  		reducedPoints.push(points[len - 1]);
  	}
  	return reducedPoints;
  }

  var _lastCode;

  // @function clipSegment(a: Point, b: Point, bounds: Bounds, useLastCode?: Boolean, round?: Boolean): Point[]|Boolean
  // Clips the segment a to b by rectangular bounds with the
  // [Cohen-Sutherland algorithm](https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm)
  // (modifying the segment points directly!). Used by Leaflet to only show polyline
  // points that are on the screen or near, increasing performance.
  function clipSegment(a, b, bounds, useLastCode, round) {
  	var codeA = useLastCode ? _lastCode : _getBitCode(a, bounds),
  	    codeB = _getBitCode(b, bounds),

  	    codeOut, p, newCode;

  	    // save 2nd code to avoid calculating it on the next segment
  	    _lastCode = codeB;

  	while (true) {
  		// if a,b is inside the clip window (trivial accept)
  		if (!(codeA | codeB)) {
  			return [a, b];
  		}

  		// if a,b is outside the clip window (trivial reject)
  		if (codeA & codeB) {
  			return false;
  		}

  		// other cases
  		codeOut = codeA || codeB;
  		p = _getEdgeIntersection(a, b, codeOut, bounds, round);
  		newCode = _getBitCode(p, bounds);

  		if (codeOut === codeA) {
  			a = p;
  			codeA = newCode;
  		} else {
  			b = p;
  			codeB = newCode;
  		}
  	}
  }

  function _getEdgeIntersection(a, b, code, bounds, round) {
  	var dx = b.x - a.x,
  	    dy = b.y - a.y,
  	    min = bounds.min,
  	    max = bounds.max,
  	    x, y;

  	if (code & 8) { // top
  		x = a.x + dx * (max.y - a.y) / dy;
  		y = max.y;

  	} else if (code & 4) { // bottom
  		x = a.x + dx * (min.y - a.y) / dy;
  		y = min.y;

  	} else if (code & 2) { // right
  		x = max.x;
  		y = a.y + dy * (max.x - a.x) / dx;

  	} else if (code & 1) { // left
  		x = min.x;
  		y = a.y + dy * (min.x - a.x) / dx;
  	}

  	return new Point(x, y, round);
  }

  function _getBitCode(p, bounds) {
  	var code = 0;

  	if (p.x < bounds.min.x) { // left
  		code |= 1;
  	} else if (p.x > bounds.max.x) { // right
  		code |= 2;
  	}

  	if (p.y < bounds.min.y) { // bottom
  		code |= 4;
  	} else if (p.y > bounds.max.y) { // top
  		code |= 8;
  	}

  	return code;
  }

  // square distance (to avoid unnecessary Math.sqrt calls)
  function _sqDist(p1, p2) {
  	var dx = p2.x - p1.x,
  	    dy = p2.y - p1.y;
  	return dx * dx + dy * dy;
  }

  // return closest point on segment or distance to that point
  function _sqClosestPointOnSegment(p, p1, p2, sqDist) {
  	var x = p1.x,
  	    y = p1.y,
  	    dx = p2.x - x,
  	    dy = p2.y - y,
  	    dot = dx * dx + dy * dy,
  	    t;

  	if (dot > 0) {
  		t = ((p.x - x) * dx + (p.y - y) * dy) / dot;

  		if (t > 1) {
  			x = p2.x;
  			y = p2.y;
  		} else if (t > 0) {
  			x += dx * t;
  			y += dy * t;
  		}
  	}

  	dx = p.x - x;
  	dy = p.y - y;

  	return sqDist ? dx * dx + dy * dy : new Point(x, y);
  }


  // @function isFlat(latlngs: LatLng[]): Boolean
  // Returns true if `latlngs` is a flat array, false is nested.
  function isFlat(latlngs) {
  	return !isArray(latlngs[0]) || (typeof latlngs[0][0] !== 'object' && typeof latlngs[0][0] !== 'undefined');
  }

  function _flat(latlngs) {
  	console.warn('Deprecated use of _flat, please use L.LineUtil.isFlat instead.');
  	return isFlat(latlngs);
  }

  /* @function polylineCenter(latlngs: LatLng[], crs: CRS): LatLng
   * Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the passed LatLngs (first ring) from a polyline.
   */
  function polylineCenter(latlngs, crs) {
  	var i, halfDist, segDist, dist, p1, p2, ratio, center;

  	if (!latlngs || latlngs.length === 0) {
  		throw new Error('latlngs not passed');
  	}

  	if (!isFlat(latlngs)) {
  		console.warn('latlngs are not flat! Only the first ring will be used');
  		latlngs = latlngs[0];
  	}

  	var centroidLatLng = toLatLng([0, 0]);

  	var bounds = toLatLngBounds(latlngs);
  	var areaBounds = bounds.getNorthWest().distanceTo(bounds.getSouthWest()) * bounds.getNorthEast().distanceTo(bounds.getNorthWest());
  	// tests showed that below 1700 rounding errors are happening
  	if (areaBounds < 1700) {
  		// getting a inexact center, to move the latlngs near to [0, 0] to prevent rounding errors
  		centroidLatLng = centroid(latlngs);
  	}

  	var len = latlngs.length;
  	var points = [];
  	for (i = 0; i < len; i++) {
  		var latlng = toLatLng(latlngs[i]);
  		points.push(crs.project(toLatLng([latlng.lat - centroidLatLng.lat, latlng.lng - centroidLatLng.lng])));
  	}

  	for (i = 0, halfDist = 0; i < len - 1; i++) {
  		halfDist += points[i].distanceTo(points[i + 1]) / 2;
  	}

  	// The line is so small in the current view that all points are on the same pixel.
  	if (halfDist === 0) {
  		center = points[0];
  	} else {
  		for (i = 0, dist = 0; i < len - 1; i++) {
  			p1 = points[i];
  			p2 = points[i + 1];
  			segDist = p1.distanceTo(p2);
  			dist += segDist;

  			if (dist > halfDist) {
  				ratio = (dist - halfDist) / segDist;
  				center = [
  					p2.x - ratio * (p2.x - p1.x),
  					p2.y - ratio * (p2.y - p1.y)
  				];
  				break;
  			}
  		}
  	}

  	var latlngCenter = crs.unproject(toPoint(center));
  	return toLatLng([latlngCenter.lat + centroidLatLng.lat, latlngCenter.lng + centroidLatLng.lng]);
  }

  var LineUtil = {
    __proto__: null,
    simplify: simplify,
    pointToSegmentDistance: pointToSegmentDistance,
    closestPointOnSegment: closestPointOnSegment,
    clipSegment: clipSegment,
    _getEdgeIntersection: _getEdgeIntersection,
    _getBitCode: _getBitCode,
    _sqClosestPointOnSegment: _sqClosestPointOnSegment,
    isFlat: isFlat,
    _flat: _flat,
    polylineCenter: polylineCenter
  };

  /*
   * @namespace Projection
   * @section
   * Leaflet comes with a set of already defined Projections out of the box:
   *
   * @projection L.Projection.LonLat
   *
   * Equirectangular, or Plate Carree projection — the most simple projection,
   * mostly used by GIS enthusiasts. Directly maps `x` as longitude, and `y` as
   * latitude. Also suitable for flat worlds, e.g. game maps. Used by the
   * `EPSG:4326` and `Simple` CRS.
   */

  var LonLat = {
  	project: function (latlng) {
  		return new Point(latlng.lng, latlng.lat);
  	},

  	unproject: function (point) {
  		return new LatLng(point.y, point.x);
  	},

  	bounds: new Bounds([-180, -90], [180, 90])
  };

  /*
   * @namespace Projection
   * @projection L.Projection.Mercator
   *
   * Elliptical Mercator projection — more complex than Spherical Mercator. Assumes that Earth is an ellipsoid. Used by the EPSG:3395 CRS.
   */

  var Mercator = {
  	R: 6378137,
  	R_MINOR: 6356752.314245179,

  	bounds: new Bounds([-20037508.34279, -15496570.73972], [20037508.34279, 18764656.23138]),

  	project: function (latlng) {
  		var d = Math.PI / 180,
  		    r = this.R,
  		    y = latlng.lat * d,
  		    tmp = this.R_MINOR / r,
  		    e = Math.sqrt(1 - tmp * tmp),
  		    con = e * Math.sin(y);

  		var ts = Math.tan(Math.PI / 4 - y / 2) / Math.pow((1 - con) / (1 + con), e / 2);
  		y = -r * Math.log(Math.max(ts, 1E-10));

  		return new Point(latlng.lng * d * r, y);
  	},

  	unproject: function (point) {
  		var d = 180 / Math.PI,
  		    r = this.R,
  		    tmp = this.R_MINOR / r,
  		    e = Math.sqrt(1 - tmp * tmp),
  		    ts = Math.exp(-point.y / r),
  		    phi = Math.PI / 2 - 2 * Math.atan(ts);

  		for (var i = 0, dphi = 0.1, con; i < 15 && Math.abs(dphi) > 1e-7; i++) {
  			con = e * Math.sin(phi);
  			con = Math.pow((1 - con) / (1 + con), e / 2);
  			dphi = Math.PI / 2 - 2 * Math.atan(ts * con) - phi;
  			phi += dphi;
  		}

  		return new LatLng(phi * d, point.x * d / r);
  	}
  };

  /*
   * @class Projection

   * An object with methods for projecting geographical coordinates of the world onto
   * a flat surface (and back). See [Map projection](https://en.wikipedia.org/wiki/Map_projection).

   * @property bounds: Bounds
   * The bounds (specified in CRS units) where the projection is valid

   * @method project(latlng: LatLng): Point
   * Projects geographical coordinates into a 2D point.
   * Only accepts actual `L.LatLng` instances, not arrays.

   * @method unproject(point: Point): LatLng
   * The inverse of `project`. Projects a 2D point into a geographical location.
   * Only accepts actual `L.Point` instances, not arrays.

   * Note that the projection instances do not inherit from Leaflet's `Class` object,
   * and can't be instantiated. Also, new classes can't inherit from them,
   * and methods can't be added to them with the `include` function.

   */

  var index = {
    __proto__: null,
    LonLat: LonLat,
    Mercator: Mercator,
    SphericalMercator: SphericalMercator
  };

  /*
   * @namespace CRS
   * @crs L.CRS.EPSG3395
   *
   * Rarely used by some commercial tile providers. Uses Elliptical Mercator projection.
   */
  var EPSG3395 = extend({}, Earth, {
  	code: 'EPSG:3395',
  	projection: Mercator,

  	transformation: (function () {
  		var scale = 0.5 / (Math.PI * Mercator.R);
  		return toTransformation(scale, 0.5, -scale, 0.5);
  	}())
  });

  /*
   * @namespace CRS
   * @crs L.CRS.EPSG4326
   *
   * A common CRS among GIS enthusiasts. Uses simple Equirectangular projection.
   *
   * Leaflet 1.0.x complies with the [TMS coordinate scheme for EPSG:4326](https://wiki.osgeo.org/wiki/Tile_Map_Service_Specification#global-geodetic),
   * which is a breaking change from 0.7.x behaviour.  If you are using a `TileLayer`
   * with this CRS, ensure that there are two 256x256 pixel tiles covering the
   * whole earth at zoom level zero, and that the tile coordinate origin is (-180,+90),
   * or (-180,-90) for `TileLayer`s with [the `tms` option](#tilelayer-tms) set.
   */

  var EPSG4326 = extend({}, Earth, {
  	code: 'EPSG:4326',
  	projection: LonLat,
  	transformation: toTransformation(1 / 180, 1, -1 / 180, 0.5)
  });

  /*
   * @namespace CRS
   * @crs L.CRS.Simple
   *
   * A simple CRS that maps longitude and latitude into `x` and `y` directly.
   * May be used for maps of flat surfaces (e.g. game maps). Note that the `y`
   * axis should still be inverted (going from bottom to top). `distance()` returns
   * simple euclidean distance.
   */

  var Simple = extend({}, CRS, {
  	projection: LonLat,
  	transformation: toTransformation(1, 0, -1, 0),

  	scale: function (zoom) {
  		return Math.pow(2, zoom);
  	},

  	zoom: function (scale) {
  		return Math.log(scale) / Math.LN2;
  	},

  	distance: function (latlng1, latlng2) {
  		var dx = latlng2.lng - latlng1.lng,
  		    dy = latlng2.lat - latlng1.lat;

  		return Math.sqrt(dx * dx + dy * dy);
  	},

  	infinite: true
  });

  CRS.Earth = Earth;
  CRS.EPSG3395 = EPSG3395;
  CRS.EPSG3857 = EPSG3857;
  CRS.EPSG900913 = EPSG900913;
  CRS.EPSG4326 = EPSG4326;
  CRS.Simple = Simple;

  /*
   * @class Layer
   * @inherits Evented
   * @aka L.Layer
   * @aka ILayer
   *
   * A set of methods from the Layer base class that all Leaflet layers use.
   * Inherits all methods, options and events from `L.Evented`.
   *
   * @example
   *
   * ```js
   * var layer = L.marker(latlng).addTo(map);
   * layer.addTo(map);
   * layer.remove();
   * ```
   *
   * @event add: Event
   * Fired after the layer is added to a map
   *
   * @event remove: Event
   * Fired after the layer is removed from a map
   */


  var Layer = Evented.extend({

  	// Classes extending `L.Layer` will inherit the following options:
  	options: {
  		// @option pane: String = 'overlayPane'
  		// By default the layer will be added to the map's [overlay pane](#map-overlaypane). Overriding this option will cause the layer to be placed on another pane by default.
  		pane: 'overlayPane',

  		// @option attribution: String = null
  		// String to be shown in the attribution control, e.g. "© OpenStreetMap contributors". It describes the layer data and is often a legal obligation towards copyright holders and tile providers.
  		attribution: null,

  		bubblingMouseEvents: true
  	},

  	/* @section
  	 * Classes extending `L.Layer` will inherit the following methods:
  	 *
  	 * @method addTo(map: Map|LayerGroup): this
  	 * Adds the layer to the given map or layer group.
  	 */
  	addTo: function (map) {
  		map.addLayer(this);
  		return this;
  	},

  	// @method remove: this
  	// Removes the layer from the map it is currently active on.
  	remove: function () {
  		return this.removeFrom(this._map || this._mapToAdd);
  	},

  	// @method removeFrom(map: Map): this
  	// Removes the layer from the given map
  	//
  	// @alternative
  	// @method removeFrom(group: LayerGroup): this
  	// Removes the layer from the given `LayerGroup`
  	removeFrom: function (obj) {
  		if (obj) {
  			obj.removeLayer(this);
  		}
  		return this;
  	},

  	// @method getPane(name? : String): HTMLElement
  	// Returns the `HTMLElement` representing the named pane on the map. If `name` is omitted, returns the pane for this layer.
  	getPane: function (name) {
  		return this._map.getPane(name ? (this.options[name] || name) : this.options.pane);
  	},

  	addInteractiveTarget: function (targetEl) {
  		this._map._targets[stamp(targetEl)] = this;
  		return this;
  	},

  	removeInteractiveTarget: function (targetEl) {
  		delete this._map._targets[stamp(targetEl)];
  		return this;
  	},

  	// @method getAttribution: String
  	// Used by the `attribution control`, returns the [attribution option](#gridlayer-attribution).
  	getAttribution: function () {
  		return this.options.attribution;
  	},

  	_layerAdd: function (e) {
  		var map = e.target;

  		// check in case layer gets added and then removed before the map is ready
  		if (!map.hasLayer(this)) { return; }

  		this._map = map;
  		this._zoomAnimated = map._zoomAnimated;

  		if (this.getEvents) {
  			var events = this.getEvents();
  			map.on(events, this);
  			this.once('remove', function () {
  				map.off(events, this);
  			}, this);
  		}

  		this.onAdd(map);

  		this.fire('add');
  		map.fire('layeradd', {layer: this});
  	}
  });

  /* @section Extension methods
   * @uninheritable
   *
   * Every layer should extend from `L.Layer` and (re-)implement the following methods.
   *
   * @method onAdd(map: Map): this
   * Should contain code that creates DOM elements for the layer, adds them to `map panes` where they should belong and puts listeners on relevant map events. Called on [`map.addLayer(layer)`](#map-addlayer).
   *
   * @method onRemove(map: Map): this
   * Should contain all clean up code that removes the layer's elements from the DOM and removes listeners previously added in [`onAdd`](#layer-onadd). Called on [`map.removeLayer(layer)`](#map-removelayer).
   *
   * @method getEvents(): Object
   * This optional method should return an object like `{ viewreset: this._reset }` for [`addEventListener`](#evented-addeventlistener). The event handlers in this object will be automatically added and removed from the map with your layer.
   *
   * @method getAttribution(): String
   * This optional method should return a string containing HTML to be shown on the `Attribution control` whenever the layer is visible.
   *
   * @method beforeAdd(map: Map): this
   * Optional method. Called on [`map.addLayer(layer)`](#map-addlayer), before the layer is added to the map, before events are initialized, without waiting until the map is in a usable state. Use for early initialization only.
   */


  /* @namespace Map
   * @section Layer events
   *
   * @event layeradd: LayerEvent
   * Fired when a new layer is added to the map.
   *
   * @event layerremove: LayerEvent
   * Fired when some layer is removed from the map
   *
   * @section Methods for Layers and Controls
   */
  Map.include({
  	// @method addLayer(layer: Layer): this
  	// Adds the given layer to the map
  	addLayer: function (layer) {
  		if (!layer._layerAdd) {
  			throw new Error('The provided object is not a Layer.');
  		}

  		var id = stamp(layer);
  		if (this._layers[id]) { return this; }
  		this._layers[id] = layer;

  		layer._mapToAdd = this;

  		if (layer.beforeAdd) {
  			layer.beforeAdd(this);
  		}

  		this.whenReady(layer._layerAdd, layer);

  		return this;
  	},

  	// @method removeLayer(layer: Layer): this
  	// Removes the given layer from the map.
  	removeLayer: function (layer) {
  		var id = stamp(layer);

  		if (!this._layers[id]) { return this; }

  		if (this._loaded) {
  			layer.onRemove(this);
  		}

  		delete this._layers[id];

  		if (this._loaded) {
  			this.fire('layerremove', {layer: layer});
  			layer.fire('remove');
  		}

  		layer._map = layer._mapToAdd = null;

  		return this;
  	},

  	// @method hasLayer(layer: Layer): Boolean
  	// Returns `true` if the given layer is currently added to the map
  	hasLayer: function (layer) {
  		return stamp(layer) in this._layers;
  	},

  	/* @method eachLayer(fn: Function, context?: Object): this
  	 * Iterates over the layers of the map, optionally specifying context of the iterator function.
  	 * ```
  	 * map.eachLayer(function(layer){
  	 *     layer.bindPopup('Hello');
  	 * });
  	 * ```
  	 */
  	eachLayer: function (method, context) {
  		for (var i in this._layers) {
  			method.call(context, this._layers[i]);
  		}
  		return this;
  	},

  	_addLayers: function (layers) {
  		layers = layers ? (isArray(layers) ? layers : [layers]) : [];

  		for (var i = 0, len = layers.length; i < len; i++) {
  			this.addLayer(layers[i]);
  		}
  	},

  	_addZoomLimit: function (layer) {
  		if (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom)) {
  			this._zoomBoundLayers[stamp(layer)] = layer;
  			this._updateZoomLevels();
  		}
  	},

  	_removeZoomLimit: function (layer) {
  		var id = stamp(layer);

  		if (this._zoomBoundLayers[id]) {
  			delete this._zoomBoundLayers[id];
  			this._updateZoomLevels();
  		}
  	},

  	_updateZoomLevels: function () {
  		var minZoom = Infinity,
  		    maxZoom = -Infinity,
  		    oldZoomSpan = this._getZoomSpan();

  		for (var i in this._zoomBoundLayers) {
  			var options = this._zoomBoundLayers[i].options;

  			minZoom = options.minZoom === undefined ? minZoom : Math.min(minZoom, options.minZoom);
  			maxZoom = options.maxZoom === undefined ? maxZoom : Math.max(maxZoom, options.maxZoom);
  		}

  		this._layersMaxZoom = maxZoom === -Infinity ? undefined : maxZoom;
  		this._layersMinZoom = minZoom === Infinity ? undefined : minZoom;

  		// @section Map state change events
  		// @event zoomlevelschange: Event
  		// Fired when the number of zoomlevels on the map is changed due
  		// to adding or removing a layer.
  		if (oldZoomSpan !== this._getZoomSpan()) {
  			this.fire('zoomlevelschange');
  		}

  		if (this.options.maxZoom === undefined && this._layersMaxZoom && this.getZoom() > this._layersMaxZoom) {
  			this.setZoom(this._layersMaxZoom);
  		}
  		if (this.options.minZoom === undefined && this._layersMinZoom && this.getZoom() < this._layersMinZoom) {
  			this.setZoom(this._layersMinZoom);
  		}
  	}
  });

  /*
   * @class LayerGroup
   * @aka L.LayerGroup
   * @inherits Interactive layer
   *
   * Used to group several layers and handle them as one. If you add it to the map,
   * any layers added or removed from the group will be added/removed on the map as
   * well. Extends `Layer`.
   *
   * @example
   *
   * ```js
   * L.layerGroup([marker1, marker2])
   * 	.addLayer(polyline)
   * 	.addTo(map);
   * ```
   */

  var LayerGroup = Layer.extend({

  	initialize: function (layers, options) {
  		setOptions(this, options);

  		this._layers = {};

  		var i, len;

  		if (layers) {
  			for (i = 0, len = layers.length; i < len; i++) {
  				this.addLayer(layers[i]);
  			}
  		}
  	},

  	// @method addLayer(layer: Layer): this
  	// Adds the given layer to the group.
  	addLayer: function (layer) {
  		var id = this.getLayerId(layer);

  		this._layers[id] = layer;

  		if (this._map) {
  			this._map.addLayer(layer);
  		}

  		return this;
  	},

  	// @method removeLayer(layer: Layer): this
  	// Removes the given layer from the group.
  	// @alternative
  	// @method removeLayer(id: Number): this
  	// Removes the layer with the given internal ID from the group.
  	removeLayer: function (layer) {
  		var id = layer in this._layers ? layer : this.getLayerId(layer);

  		if (this._map && this._layers[id]) {
  			this._map.removeLayer(this._layers[id]);
  		}

  		delete this._layers[id];

  		return this;
  	},

  	// @method hasLayer(layer: Layer): Boolean
  	// Returns `true` if the given layer is currently added to the group.
  	// @alternative
  	// @method hasLayer(id: Number): Boolean
  	// Returns `true` if the given internal ID is currently added to the group.
  	hasLayer: function (layer) {
  		var layerId = typeof layer === 'number' ? layer : this.getLayerId(layer);
  		return layerId in this._layers;
  	},

  	// @method clearLayers(): this
  	// Removes all the layers from the group.
  	clearLayers: function () {
  		return this.eachLayer(this.removeLayer, this);
  	},

  	// @method invoke(methodName: String, …): this
  	// Calls `methodName` on every layer contained in this group, passing any
  	// additional parameters. Has no effect if the layers contained do not
  	// implement `methodName`.
  	invoke: function (methodName) {
  		var args = Array.prototype.slice.call(arguments, 1),
  		    i, layer;

  		for (i in this._layers) {
  			layer = this._layers[i];

  			if (layer[methodName]) {
  				layer[methodName].apply(layer, args);
  			}
  		}

  		return this;
  	},

  	onAdd: function (map) {
  		this.eachLayer(map.addLayer, map);
  	},

  	onRemove: function (map) {
  		this.eachLayer(map.removeLayer, map);
  	},

  	// @method eachLayer(fn: Function, context?: Object): this
  	// Iterates over the layers of the group, optionally specifying context of the iterator function.
  	// ```js
  	// group.eachLayer(function (layer) {
  	// 	layer.bindPopup('Hello');
  	// });
  	// ```
  	eachLayer: function (method, context) {
  		for (var i in this._layers) {
  			method.call(context, this._layers[i]);
  		}
  		return this;
  	},

  	// @method getLayer(id: Number): Layer
  	// Returns the layer with the given internal ID.
  	getLayer: function (id) {
  		return this._layers[id];
  	},

  	// @method getLayers(): Layer[]
  	// Returns an array of all the layers added to the group.
  	getLayers: function () {
  		var layers = [];
  		this.eachLayer(layers.push, layers);
  		return layers;
  	},

  	// @method setZIndex(zIndex: Number): this
  	// Calls `setZIndex` on every layer contained in this group, passing the z-index.
  	setZIndex: function (zIndex) {
  		return this.invoke('setZIndex', zIndex);
  	},

  	// @method getLayerId(layer: Layer): Number
  	// Returns the internal ID for a layer
  	getLayerId: function (layer) {
  		return stamp(layer);
  	}
  });


  // @factory L.layerGroup(layers?: Layer[], options?: Object)
  // Create a layer group, optionally given an initial set of layers and an `options` object.
  var layerGroup = function (layers, options) {
  	return new LayerGroup(layers, options);
  };

  /*
   * @class FeatureGroup
   * @aka L.FeatureGroup
   * @inherits LayerGroup
   *
   * Extended `LayerGroup` that makes it easier to do the same thing to all its member layers:
   *  * [`bindPopup`](#layer-bindpopup) binds a popup to all of the layers at once (likewise with [`bindTooltip`](#layer-bindtooltip))
   *  * Events are propagated to the `FeatureGroup`, so if the group has an event
   * handler, it will handle events from any of the layers. This includes mouse events
   * and custom events.
   *  * Has `layeradd` and `layerremove` events
   *
   * @example
   *
   * ```js
   * L.featureGroup([marker1, marker2, polyline])
   * 	.bindPopup('Hello world!')
   * 	.on('click', function() { alert('Clicked on a member of the group!'); })
   * 	.addTo(map);
   * ```
   */

  var FeatureGroup = LayerGroup.extend({

  	addLayer: function (layer) {
  		if (this.hasLayer(layer)) {
  			return this;
  		}

  		layer.addEventParent(this);

  		LayerGroup.prototype.addLayer.call(this, layer);

  		// @event layeradd: LayerEvent
  		// Fired when a layer is added to this `FeatureGroup`
  		return this.fire('layeradd', {layer: layer});
  	},

  	removeLayer: function (layer) {
  		if (!this.hasLayer(layer)) {
  			return this;
  		}
  		if (layer in this._layers) {
  			layer = this._layers[layer];
  		}

  		layer.removeEventParent(this);

  		LayerGroup.prototype.removeLayer.call(this, layer);

  		// @event layerremove: LayerEvent
  		// Fired when a layer is removed from this `FeatureGroup`
  		return this.fire('layerremove', {layer: layer});
  	},

  	// @method setStyle(style: Path options): this
  	// Sets the given path options to each layer of the group that has a `setStyle` method.
  	setStyle: function (style) {
  		return this.invoke('setStyle', style);
  	},

  	// @method bringToFront(): this
  	// Brings the layer group to the top of all other layers
  	bringToFront: function () {
  		return this.invoke('bringToFront');
  	},

  	// @method bringToBack(): this
  	// Brings the layer group to the back of all other layers
  	bringToBack: function () {
  		return this.invoke('bringToBack');
  	},

  	// @method getBounds(): LatLngBounds
  	// Returns the LatLngBounds of the Feature Group (created from bounds and coordinates of its children).
  	getBounds: function () {
  		var bounds = new LatLngBounds();

  		for (var id in this._layers) {
  			var layer = this._layers[id];
  			bounds.extend(layer.getBounds ? layer.getBounds() : layer.getLatLng());
  		}
  		return bounds;
  	}
  });

  // @factory L.featureGroup(layers?: Layer[], options?: Object)
  // Create a feature group, optionally given an initial set of layers and an `options` object.
  var featureGroup = function (layers, options) {
  	return new FeatureGroup(layers, options);
  };

  /*
   * @class Icon
   * @aka L.Icon
   *
   * Represents an icon to provide when creating a marker.
   *
   * @example
   *
   * ```js
   * var myIcon = L.icon({
   *     iconUrl: 'my-icon.png',
   *     iconRetinaUrl: 'my-icon@2x.png',
   *     iconSize: [38, 95],
   *     iconAnchor: [22, 94],
   *     popupAnchor: [-3, -76],
   *     shadowUrl: 'my-icon-shadow.png',
   *     shadowRetinaUrl: 'my-icon-shadow@2x.png',
   *     shadowSize: [68, 95],
   *     shadowAnchor: [22, 94]
   * });
   *
   * L.marker([50.505, 30.57], {icon: myIcon}).addTo(map);
   * ```
   *
   * `L.Icon.Default` extends `L.Icon` and is the blue icon Leaflet uses for markers by default.
   *
   */

  var Icon = Class.extend({

  	/* @section
  	 * @aka Icon options
  	 *
  	 * @option iconUrl: String = null
  	 * **(required)** The URL to the icon image (absolute or relative to your script path).
  	 *
  	 * @option iconRetinaUrl: String = null
  	 * The URL to a retina sized version of the icon image (absolute or relative to your
  	 * script path). Used for Retina screen devices.
  	 *
  	 * @option iconSize: Point = null
  	 * Size of the icon image in pixels.
  	 *
  	 * @option iconAnchor: Point = null
  	 * The coordinates of the "tip" of the icon (relative to its top left corner). The icon
  	 * will be aligned so that this point is at the marker's geographical location. Centered
  	 * by default if size is specified, also can be set in CSS with negative margins.
  	 *
  	 * @option popupAnchor: Point = [0, 0]
  	 * The coordinates of the point from which popups will "open", relative to the icon anchor.
  	 *
  	 * @option tooltipAnchor: Point = [0, 0]
  	 * The coordinates of the point from which tooltips will "open", relative to the icon anchor.
  	 *
  	 * @option shadowUrl: String = null
  	 * The URL to the icon shadow image. If not specified, no shadow image will be created.
  	 *
  	 * @option shadowRetinaUrl: String = null
  	 *
  	 * @option shadowSize: Point = null
  	 * Size of the shadow image in pixels.
  	 *
  	 * @option shadowAnchor: Point = null
  	 * The coordinates of the "tip" of the shadow (relative to its top left corner) (the same
  	 * as iconAnchor if not specified).
  	 *
  	 * @option className: String = ''
  	 * A custom class name to assign to both icon and shadow images. Empty by default.
  	 */

  	options: {
  		popupAnchor: [0, 0],
  		tooltipAnchor: [0, 0],

  		// @option crossOrigin: Boolean|String = false
  		// Whether the crossOrigin attribute will be added to the tiles.
  		// If a String is provided, all tiles will have their crossOrigin attribute set to the String provided. This is needed if you want to access tile pixel data.
  		// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.
  		crossOrigin: false
  	},

  	initialize: function (options) {
  		setOptions(this, options);
  	},

  	// @method createIcon(oldIcon?: HTMLElement): HTMLElement
  	// Called internally when the icon has to be shown, returns a `<img>` HTML element
  	// styled according to the options.
  	createIcon: function (oldIcon) {
  		return this._createIcon('icon', oldIcon);
  	},

  	// @method createShadow(oldIcon?: HTMLElement): HTMLElement
  	// As `createIcon`, but for the shadow beneath it.
  	createShadow: function (oldIcon) {
  		return this._createIcon('shadow', oldIcon);
  	},

  	_createIcon: function (name, oldIcon) {
  		var src = this._getIconUrl(name);

  		if (!src) {
  			if (name === 'icon') {
  				throw new Error('iconUrl not set in Icon options (see the docs).');
  			}
  			return null;
  		}

  		var img = this._createImg(src, oldIcon && oldIcon.tagName === 'IMG' ? oldIcon : null);
  		this._setIconStyles(img, name);

  		if (this.options.crossOrigin || this.options.crossOrigin === '') {
  			img.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;
  		}

  		return img;
  	},

  	_setIconStyles: function (img, name) {
  		var options = this.options;
  		var sizeOption = options[name + 'Size'];

  		if (typeof sizeOption === 'number') {
  			sizeOption = [sizeOption, sizeOption];
  		}

  		var size = toPoint(sizeOption),
  		    anchor = toPoint(name === 'shadow' && options.shadowAnchor || options.iconAnchor ||
  		            size && size.divideBy(2, true));

  		img.className = 'leaflet-marker-' + name + ' ' + (options.className || '');

  		if (anchor) {
  			img.style.marginLeft = (-anchor.x) + 'px';
  			img.style.marginTop  = (-anchor.y) + 'px';
  		}

  		if (size) {
  			img.style.width  = size.x + 'px';
  			img.style.height = size.y + 'px';
  		}
  	},

  	_createImg: function (src, el) {
  		el = el || document.createElement('img');
  		el.src = src;
  		return el;
  	},

  	_getIconUrl: function (name) {
  		return Browser.retina && this.options[name + 'RetinaUrl'] || this.options[name + 'Url'];
  	}
  });


  // @factory L.icon(options: Icon options)
  // Creates an icon instance with the given options.
  function icon(options) {
  	return new Icon(options);
  }

  /*
   * @miniclass Icon.Default (Icon)
   * @aka L.Icon.Default
   * @section
   *
   * A trivial subclass of `Icon`, represents the icon to use in `Marker`s when
   * no icon is specified. Points to the blue marker image distributed with Leaflet
   * releases.
   *
   * In order to customize the default icon, just change the properties of `L.Icon.Default.prototype.options`
   * (which is a set of `Icon options`).
   *
   * If you want to _completely_ replace the default icon, override the
   * `L.Marker.prototype.options.icon` with your own icon instead.
   */

  var IconDefault = Icon.extend({

  	options: {
  		iconUrl:       'marker-icon.png',
  		iconRetinaUrl: 'marker-icon-2x.png',
  		shadowUrl:     'marker-shadow.png',
  		iconSize:    [25, 41],
  		iconAnchor:  [12, 41],
  		popupAnchor: [1, -34],
  		tooltipAnchor: [16, -28],
  		shadowSize:  [41, 41]
  	},

  	_getIconUrl: function (name) {
  		if (typeof IconDefault.imagePath !== 'string') {	// Deprecated, backwards-compatibility only
  			IconDefault.imagePath = this._detectIconPath();
  		}

  		// @option imagePath: String
  		// `Icon.Default` will try to auto-detect the location of the
  		// blue icon images. If you are placing these images in a non-standard
  		// way, set this option to point to the right path.
  		return (this.options.imagePath || IconDefault.imagePath) + Icon.prototype._getIconUrl.call(this, name);
  	},

  	_stripUrl: function (path) {	// separate function to use in tests
  		var strip = function (str, re, idx) {
  			var match = re.exec(str);
  			return match && match[idx];
  		};
  		path = strip(path, /^url\((['"])?(.+)\1\)$/, 2);
  		return path && strip(path, /^(.*)marker-icon\.png$/, 1);
  	},

  	_detectIconPath: function () {
  		var el = create$1('div',  'leaflet-default-icon-path', document.body);
  		var path = getStyle(el, 'background-image') ||
  		           getStyle(el, 'backgroundImage');	// IE8

  		document.body.removeChild(el);
  		path = this._stripUrl(path);
  		if (path) { return path; }
  		var link = document.querySelector('link[href$="leaflet.css"]');
  		if (!link) { return ''; }
  		return link.href.substring(0, link.href.length - 'leaflet.css'.length - 1);
  	}
  });

  /*
   * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.
   */


  /* @namespace Marker
   * @section Interaction handlers
   *
   * Interaction handlers are properties of a marker instance that allow you to control interaction behavior in runtime, enabling or disabling certain features such as dragging (see `Handler` methods). Example:
   *
   * ```js
   * marker.dragging.disable();
   * ```
   *
   * @property dragging: Handler
   * Marker dragging handler (by both mouse and touch). Only valid when the marker is on the map (Otherwise set [`marker.options.draggable`](#marker-draggable)).
   */

  var MarkerDrag = Handler.extend({
  	initialize: function (marker) {
  		this._marker = marker;
  	},

  	addHooks: function () {
  		var icon = this._marker._icon;

  		if (!this._draggable) {
  			this._draggable = new Draggable(icon, icon, true);
  		}

  		this._draggable.on({
  			dragstart: this._onDragStart,
  			predrag: this._onPreDrag,
  			drag: this._onDrag,
  			dragend: this._onDragEnd
  		}, this).enable();

  		addClass(icon, 'leaflet-marker-draggable');
  	},

  	removeHooks: function () {
  		this._draggable.off({
  			dragstart: this._onDragStart,
  			predrag: this._onPreDrag,
  			drag: this._onDrag,
  			dragend: this._onDragEnd
  		}, this).disable();

  		if (this._marker._icon) {
  			removeClass(this._marker._icon, 'leaflet-marker-draggable');
  		}
  	},

  	moved: function () {
  		return this._draggable && this._draggable._moved;
  	},

  	_adjustPan: function (e) {
  		var marker = this._marker,
  		    map = marker._map,
  		    speed = this._marker.options.autoPanSpeed,
  		    padding = this._marker.options.autoPanPadding,
  		    iconPos = getPosition(marker._icon),
  		    bounds = map.getPixelBounds(),
  		    origin = map.getPixelOrigin();

  		var panBounds = toBounds(
  			bounds.min._subtract(origin).add(padding),
  			bounds.max._subtract(origin).subtract(padding)
  		);

  		if (!panBounds.contains(iconPos)) {
  			// Compute incremental movement
  			var movement = toPoint(
  				(Math.max(panBounds.max.x, iconPos.x) - panBounds.max.x) / (bounds.max.x - panBounds.max.x) -
  				(Math.min(panBounds.min.x, iconPos.x) - panBounds.min.x) / (bounds.min.x - panBounds.min.x),

  				(Math.max(panBounds.max.y, iconPos.y) - panBounds.max.y) / (bounds.max.y - panBounds.max.y) -
  				(Math.min(panBounds.min.y, iconPos.y) - panBounds.min.y) / (bounds.min.y - panBounds.min.y)
  			).multiplyBy(speed);

  			map.panBy(movement, {animate: false});

  			this._draggable._newPos._add(movement);
  			this._draggable._startPos._add(movement);

  			setPosition(marker._icon, this._draggable._newPos);
  			this._onDrag(e);

  			this._panRequest = requestAnimFrame(this._adjustPan.bind(this, e));
  		}
  	},

  	_onDragStart: function () {
  		// @section Dragging events
  		// @event dragstart: Event
  		// Fired when the user starts dragging the marker.

  		// @event movestart: Event
  		// Fired when the marker starts moving (because of dragging).

  		this._oldLatLng = this._marker.getLatLng();

  		// When using ES6 imports it could not be set when `Popup` was not imported as well
  		this._marker.closePopup && this._marker.closePopup();

  		this._marker
  			.fire('movestart')
  			.fire('dragstart');
  	},

  	_onPreDrag: function (e) {
  		if (this._marker.options.autoPan) {
  			cancelAnimFrame(this._panRequest);
  			this._panRequest = requestAnimFrame(this._adjustPan.bind(this, e));
  		}
  	},

  	_onDrag: function (e) {
  		var marker = this._marker,
  		    shadow = marker._shadow,
  		    iconPos = getPosition(marker._icon),
  		    latlng = marker._map.layerPointToLatLng(iconPos);

  		// update shadow position
  		if (shadow) {
  			setPosition(shadow, iconPos);
  		}

  		marker._latlng = latlng;
  		e.latlng = latlng;
  		e.oldLatLng = this._oldLatLng;

  		// @event drag: Event
  		// Fired repeatedly while the user drags the marker.
  		marker
  		    .fire('move', e)
  		    .fire('drag', e);
  	},

  	_onDragEnd: function (e) {
  		// @event dragend: DragEndEvent
  		// Fired when the user stops dragging the marker.

  		 cancelAnimFrame(this._panRequest);

  		// @event moveend: Event
  		// Fired when the marker stops moving (because of dragging).
  		delete this._oldLatLng;
  		this._marker
  		    .fire('moveend')
  		    .fire('dragend', e);
  	}
  });

  /*
   * @class Marker
   * @inherits Interactive layer
   * @aka L.Marker
   * L.Marker is used to display clickable/draggable icons on the map. Extends `Layer`.
   *
   * @example
   *
   * ```js
   * L.marker([50.5, 30.5]).addTo(map);
   * ```
   */

  var Marker = Layer.extend({

  	// @section
  	// @aka Marker options
  	options: {
  		// @option icon: Icon = *
  		// Icon instance to use for rendering the marker.
  		// See [Icon documentation](#L.Icon) for details on how to customize the marker icon.
  		// If not specified, a common instance of `L.Icon.Default` is used.
  		icon: new IconDefault(),

  		// Option inherited from "Interactive layer" abstract class
  		interactive: true,

  		// @option keyboard: Boolean = true
  		// Whether the marker can be tabbed to with a keyboard and clicked by pressing enter.
  		keyboard: true,

  		// @option title: String = ''
  		// Text for the browser tooltip that appear on marker hover (no tooltip by default).
  		// [Useful for accessibility](https://leafletjs.com/examples/accessibility/#markers-must-be-labelled).
  		title: '',

  		// @option alt: String = 'Marker'
  		// Text for the `alt` attribute of the icon image.
  		// [Useful for accessibility](https://leafletjs.com/examples/accessibility/#markers-must-be-labelled).
  		alt: 'Marker',

  		// @option zIndexOffset: Number = 0
  		// By default, marker images zIndex is set automatically based on its latitude. Use this option if you want to put the marker on top of all others (or below), specifying a high value like `1000` (or high negative value, respectively).
  		zIndexOffset: 0,

  		// @option opacity: Number = 1.0
  		// The opacity of the marker.
  		opacity: 1,

  		// @option riseOnHover: Boolean = false
  		// If `true`, the marker will get on top of others when you hover the mouse over it.
  		riseOnHover: false,

  		// @option riseOffset: Number = 250
  		// The z-index offset used for the `riseOnHover` feature.
  		riseOffset: 250,

  		// @option pane: String = 'markerPane'
  		// `Map pane` where the markers icon will be added.
  		pane: 'markerPane',

  		// @option shadowPane: String = 'shadowPane'
  		// `Map pane` where the markers shadow will be added.
  		shadowPane: 'shadowPane',

  		// @option bubblingMouseEvents: Boolean = false
  		// When `true`, a mouse event on this marker will trigger the same event on the map
  		// (unless [`L.DomEvent.stopPropagation`](#domevent-stoppropagation) is used).
  		bubblingMouseEvents: false,

  		// @option autoPanOnFocus: Boolean = true
  		// When `true`, the map will pan whenever the marker is focused (via
  		// e.g. pressing `tab` on the keyboard) to ensure the marker is
  		// visible within the map's bounds
  		autoPanOnFocus: true,

  		// @section Draggable marker options
  		// @option draggable: Boolean = false
  		// Whether the marker is draggable with mouse/touch or not.
  		draggable: false,

  		// @option autoPan: Boolean = false
  		// Whether to pan the map when dragging this marker near its edge or not.
  		autoPan: false,

  		// @option autoPanPadding: Point = Point(50, 50)
  		// Distance (in pixels to the left/right and to the top/bottom) of the
  		// map edge to start panning the map.
  		autoPanPadding: [50, 50],

  		// @option autoPanSpeed: Number = 10
  		// Number of pixels the map should pan by.
  		autoPanSpeed: 10
  	},

  	/* @section
  	 *
  	 * In addition to [shared layer methods](#Layer) like `addTo()` and `remove()` and [popup methods](#Popup) like bindPopup() you can also use the following methods:
  	 */

  	initialize: function (latlng, options) {
  		setOptions(this, options);
  		this._latlng = toLatLng(latlng);
  	},

  	onAdd: function (map) {
  		this._zoomAnimated = this._zoomAnimated && map.options.markerZoomAnimation;

  		if (this._zoomAnimated) {
  			map.on('zoomanim', this._animateZoom, this);
  		}

  		this._initIcon();
  		this.update();
  	},

  	onRemove: function (map) {
  		if (this.dragging && this.dragging.enabled()) {
  			this.options.draggable = true;
  			this.dragging.removeHooks();
  		}
  		delete this.dragging;

  		if (this._zoomAnimated) {
  			map.off('zoomanim', this._animateZoom, this);
  		}

  		this._removeIcon();
  		this._removeShadow();
  	},

  	getEvents: function () {
  		return {
  			zoom: this.update,
  			viewreset: this.update
  		};
  	},

  	// @method getLatLng: LatLng
  	// Returns the current geographical position of the marker.
  	getLatLng: function () {
  		return this._latlng;
  	},

  	// @method setLatLng(latlng: LatLng): this
  	// Changes the marker position to the given point.
  	setLatLng: function (latlng) {
  		var oldLatLng = this._latlng;
  		this._latlng = toLatLng(latlng);
  		this.update();

  		// @event move: Event
  		// Fired when the marker is moved via [`setLatLng`](#marker-setlatlng) or by [dragging](#marker-dragging). Old and new coordinates are included in event arguments as `oldLatLng`, `latlng`.
  		return this.fire('move', {oldLatLng: oldLatLng, latlng: this._latlng});
  	},

  	// @method setZIndexOffset(offset: Number): this
  	// Changes the [zIndex offset](#marker-zindexoffset) of the marker.
  	setZIndexOffset: function (offset) {
  		this.options.zIndexOffset = offset;
  		return this.update();
  	},

  	// @method getIcon: Icon
  	// Returns the current icon used by the marker
  	getIcon: function () {
  		return this.options.icon;
  	},

  	// @method setIcon(icon: Icon): this
  	// Changes the marker icon.
  	setIcon: function (icon) {

  		this.options.icon = icon;

  		if (this._map) {
  			this._initIcon();
  			this.update();
  		}

  		if (this._popup) {
  			this.bindPopup(this._popup, this._popup.options);
  		}

  		return this;
  	},

  	getElement: function () {
  		return this._icon;
  	},

  	update: function () {

  		if (this._icon && this._map) {
  			var pos = this._map.latLngToLayerPoint(this._latlng).round();
  			this._setPos(pos);
  		}

  		return this;
  	},

  	_initIcon: function () {
  		var options = this.options,
  		    classToAdd = 'leaflet-zoom-' + (this._zoomAnimated ? 'animated' : 'hide');

  		var icon = options.icon.createIcon(this._icon),
  		    addIcon = false;

  		// if we're not reusing the icon, remove the old one and init new one
  		if (icon !== this._icon) {
  			if (this._icon) {
  				this._removeIcon();
  			}
  			addIcon = true;

  			if (options.title) {
  				icon.title = options.title;
  			}

  			if (icon.tagName === 'IMG') {
  				icon.alt = options.alt || '';
  			}
  		}

  		addClass(icon, classToAdd);

  		if (options.keyboard) {
  			icon.tabIndex = '0';
  			icon.setAttribute('role', 'button');
  		}

  		this._icon = icon;

  		if (options.riseOnHover) {
  			this.on({
  				mouseover: this._bringToFront,
  				mouseout: this._resetZIndex
  			});
  		}

  		if (this.options.autoPanOnFocus) {
  			on(icon, 'focus', this._panOnFocus, this);
  		}

  		var newShadow = options.icon.createShadow(this._shadow),
  		    addShadow = false;

  		if (newShadow !== this._shadow) {
  			this._removeShadow();
  			addShadow = true;
  		}

  		if (newShadow) {
  			addClass(newShadow, classToAdd);
  			newShadow.alt = '';
  		}
  		this._shadow = newShadow;


  		if (options.opacity < 1) {
  			this._updateOpacity();
  		}


  		if (addIcon) {
  			this.getPane().appendChild(this._icon);
  		}
  		this._initInteraction();
  		if (newShadow && addShadow) {
  			this.getPane(options.shadowPane).appendChild(this._shadow);
  		}
  	},

  	_removeIcon: function () {
  		if (this.options.riseOnHover) {
  			this.off({
  				mouseover: this._bringToFront,
  				mouseout: this._resetZIndex
  			});
  		}

  		if (this.options.autoPanOnFocus) {
  			off(this._icon, 'focus', this._panOnFocus, this);
  		}

  		remove(this._icon);
  		this.removeInteractiveTarget(this._icon);

  		this._icon = null;
  	},

  	_removeShadow: function () {
  		if (this._shadow) {
  			remove(this._shadow);
  		}
  		this._shadow = null;
  	},

  	_setPos: function (pos) {

  		if (this._icon) {
  			setPosition(this._icon, pos);
  		}

  		if (this._shadow) {
  			setPosition(this._shadow, pos);
  		}

  		this._zIndex = pos.y + this.options.zIndexOffset;

  		this._resetZIndex();
  	},

  	_updateZIndex: function (offset) {
  		if (this._icon) {
  			this._icon.style.zIndex = this._zIndex + offset;
  		}
  	},

  	_animateZoom: function (opt) {
  		var pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();

  		this._setPos(pos);
  	},

  	_initInteraction: function () {

  		if (!this.options.interactive) { return; }

  		addClass(this._icon, 'leaflet-interactive');

  		this.addInteractiveTarget(this._icon);

  		if (MarkerDrag) {
  			var draggable = this.options.draggable;
  			if (this.dragging) {
  				draggable = this.dragging.enabled();
  				this.dragging.disable();
  			}

  			this.dragging = new MarkerDrag(this);

  			if (draggable) {
  				this.dragging.enable();
  			}
  		}
  	},

  	// @method setOpacity(opacity: Number): this
  	// Changes the opacity of the marker.
  	setOpacity: function (opacity) {
  		this.options.opacity = opacity;
  		if (this._map) {
  			this._updateOpacity();
  		}

  		return this;
  	},

  	_updateOpacity: function () {
  		var opacity = this.options.opacity;

  		if (this._icon) {
  			setOpacity(this._icon, opacity);
  		}

  		if (this._shadow) {
  			setOpacity(this._shadow, opacity);
  		}
  	},

  	_bringToFront: function () {
  		this._updateZIndex(this.options.riseOffset);
  	},

  	_resetZIndex: function () {
  		this._updateZIndex(0);
  	},

  	_panOnFocus: function () {
  		var map = this._map;
  		if (!map) { return; }

  		var iconOpts = this.options.icon.options;
  		var size = iconOpts.iconSize ? toPoint(iconOpts.iconSize) : toPoint(0, 0);
  		var anchor = iconOpts.iconAnchor ? toPoint(iconOpts.iconAnchor) : toPoint(0, 0);

  		map.panInside(this._latlng, {
  			paddingTopLeft: anchor,
  			paddingBottomRight: size.subtract(anchor)
  		});
  	},

  	_getPopupAnchor: function () {
  		return this.options.icon.options.popupAnchor;
  	},

  	_getTooltipAnchor: function () {
  		return this.options.icon.options.tooltipAnchor;
  	}
  });


  // factory L.marker(latlng: LatLng, options? : Marker options)

  // @factory L.marker(latlng: LatLng, options? : Marker options)
  // Instantiates a Marker object given a geographical point and optionally an options object.
  function marker(latlng, options) {
  	return new Marker(latlng, options);
  }

  /*
   * @class Path
   * @aka L.Path
   * @inherits Interactive layer
   *
   * An abstract class that contains options and constants shared between vector
   * overlays (Polygon, Polyline, Circle). Do not use it directly. Extends `Layer`.
   */

  var Path = Layer.extend({

  	// @section
  	// @aka Path options
  	options: {
  		// @option stroke: Boolean = true
  		// Whether to draw stroke along the path. Set it to `false` to disable borders on polygons or circles.
  		stroke: true,

  		// @option color: String = '#3388ff'
  		// Stroke color
  		color: '#3388ff',

  		// @option weight: Number = 3
  		// Stroke width in pixels
  		weight: 3,

  		// @option opacity: Number = 1.0
  		// Stroke opacity
  		opacity: 1,

  		// @option lineCap: String= 'round'
  		// A string that defines [shape to be used at the end](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-linecap) of the stroke.
  		lineCap: 'round',

  		// @option lineJoin: String = 'round'
  		// A string that defines [shape to be used at the corners](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-linejoin) of the stroke.
  		lineJoin: 'round',

  		// @option dashArray: String = null
  		// A string that defines the stroke [dash pattern](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-dasharray). Doesn't work on `Canvas`-powered layers in [some old browsers](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/setLineDash#Browser_compatibility).
  		dashArray: null,

  		// @option dashOffset: String = null
  		// A string that defines the [distance into the dash pattern to start the dash](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-dashoffset). Doesn't work on `Canvas`-powered layers in [some old browsers](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/setLineDash#Browser_compatibility).
  		dashOffset: null,

  		// @option fill: Boolean = depends
  		// Whether to fill the path with color. Set it to `false` to disable filling on polygons or circles.
  		fill: false,

  		// @option fillColor: String = *
  		// Fill color. Defaults to the value of the [`color`](#path-color) option
  		fillColor: null,

  		// @option fillOpacity: Number = 0.2
  		// Fill opacity.
  		fillOpacity: 0.2,

  		// @option fillRule: String = 'evenodd'
  		// A string that defines [how the inside of a shape](https://developer.mozilla.org/docs/Web/SVG/Attribute/fill-rule) is determined.
  		fillRule: 'evenodd',

  		// className: '',

  		// Option inherited from "Interactive layer" abstract class
  		interactive: true,

  		// @option bubblingMouseEvents: Boolean = true
  		// When `true`, a mouse event on this path will trigger the same event on the map
  		// (unless [`L.DomEvent.stopPropagation`](#domevent-stoppropagation) is used).
  		bubblingMouseEvents: true
  	},

  	beforeAdd: function (map) {
  		// Renderer is set here because we need to call renderer.getEvents
  		// before this.getEvents.
  		this._renderer = map.getRenderer(this);
  	},

  	onAdd: function () {
  		this._renderer._initPath(this);
  		this._reset();
  		this._renderer._addPath(this);
  	},

  	onRemove: function () {
  		this._renderer._removePath(this);
  	},

  	// @method redraw(): this
  	// Redraws the layer. Sometimes useful after you changed the coordinates that the path uses.
  	redraw: function () {
  		if (this._map) {
  			this._renderer._updatePath(this);
  		}
  		return this;
  	},

  	// @method setStyle(style: Path options): this
  	// Changes the appearance of a Path based on the options in the `Path options` object.
  	setStyle: function (style) {
  		setOptions(this, style);
  		if (this._renderer) {
  			this._renderer._updateStyle(this);
  			if (this.options.stroke && style && Object.prototype.hasOwnProperty.call(style, 'weight')) {
  				this._updateBounds();
  			}
  		}
  		return this;
  	},

  	// @method bringToFront(): this
  	// Brings the layer to the top of all path layers.
  	bringToFront: function () {
  		if (this._renderer) {
  			this._renderer._bringToFront(this);
  		}
  		return this;
  	},

  	// @method bringToBack(): this
  	// Brings the layer to the bottom of all path layers.
  	bringToBack: function () {
  		if (this._renderer) {
  			this._renderer._bringToBack(this);
  		}
  		return this;
  	},

  	getElement: function () {
  		return this._path;
  	},

  	_reset: function () {
  		// defined in child classes
  		this._project();
  		this._update();
  	},

  	_clickTolerance: function () {
  		// used when doing hit detection for Canvas layers
  		return (this.options.stroke ? this.options.weight / 2 : 0) +
  		  (this._renderer.options.tolerance || 0);
  	}
  });

  /*
   * @class CircleMarker
   * @aka L.CircleMarker
   * @inherits Path
   *
   * A circle of a fixed size with radius specified in pixels. Extends `Path`.
   */

  var CircleMarker = Path.extend({

  	// @section
  	// @aka CircleMarker options
  	options: {
  		fill: true,

  		// @option radius: Number = 10
  		// Radius of the circle marker, in pixels
  		radius: 10
  	},

  	initialize: function (latlng, options) {
  		setOptions(this, options);
  		this._latlng = toLatLng(latlng);
  		this._radius = this.options.radius;
  	},

  	// @method setLatLng(latLng: LatLng): this
  	// Sets the position of a circle marker to a new location.
  	setLatLng: function (latlng) {
  		var oldLatLng = this._latlng;
  		this._latlng = toLatLng(latlng);
  		this.redraw();

  		// @event move: Event
  		// Fired when the marker is moved via [`setLatLng`](#circlemarker-setlatlng). Old and new coordinates are included in event arguments as `oldLatLng`, `latlng`.
  		return this.fire('move', {oldLatLng: oldLatLng, latlng: this._latlng});
  	},

  	// @method getLatLng(): LatLng
  	// Returns the current geographical position of the circle marker
  	getLatLng: function () {
  		return this._latlng;
  	},

  	// @method setRadius(radius: Number): this
  	// Sets the radius of a circle marker. Units are in pixels.
  	setRadius: function (radius) {
  		this.options.radius = this._radius = radius;
  		return this.redraw();
  	},

  	// @method getRadius(): Number
  	// Returns the current radius of the circle
  	getRadius: function () {
  		return this._radius;
  	},

  	setStyle : function (options) {
  		var radius = options && options.radius || this._radius;
  		Path.prototype.setStyle.call(this, options);
  		this.setRadius(radius);
  		return this;
  	},

  	_project: function () {
  		this._point = this._map.latLngToLayerPoint(this._latlng);
  		this._updateBounds();
  	},

  	_updateBounds: function () {
  		var r = this._radius,
  		    r2 = this._radiusY || r,
  		    w = this._clickTolerance(),
  		    p = [r + w, r2 + w];
  		this._pxBounds = new Bounds(this._point.subtract(p), this._point.add(p));
  	},

  	_update: function () {
  		if (this._map) {
  			this._updatePath();
  		}
  	},

  	_updatePath: function () {
  		this._renderer._updateCircle(this);
  	},

  	_empty: function () {
  		return this._radius && !this._renderer._bounds.intersects(this._pxBounds);
  	},

  	// Needed by the `Canvas` renderer for interactivity
  	_containsPoint: function (p) {
  		return p.distanceTo(this._point) <= this._radius + this._clickTolerance();
  	}
  });


  // @factory L.circleMarker(latlng: LatLng, options?: CircleMarker options)
  // Instantiates a circle marker object given a geographical point, and an optional options object.
  function circleMarker(latlng, options) {
  	return new CircleMarker(latlng, options);
  }

  /*
   * @class Circle
   * @aka L.Circle
   * @inherits CircleMarker
   *
   * A class for drawing circle overlays on a map. Extends `CircleMarker`.
   *
   * It's an approximation and starts to diverge from a real circle closer to poles (due to projection distortion).
   *
   * @example
   *
   * ```js
   * L.circle([50.5, 30.5], {radius: 200}).addTo(map);
   * ```
   */

  var Circle = CircleMarker.extend({

  	initialize: function (latlng, options, legacyOptions) {
  		if (typeof options === 'number') {
  			// Backwards compatibility with 0.7.x factory (latlng, radius, options?)
  			options = extend({}, legacyOptions, {radius: options});
  		}
  		setOptions(this, options);
  		this._latlng = toLatLng(latlng);

  		if (isNaN(this.options.radius)) { throw new Error('Circle radius cannot be NaN'); }

  		// @section
  		// @aka Circle options
  		// @option radius: Number; Radius of the circle, in meters.
  		this._mRadius = this.options.radius;
  	},

  	// @method setRadius(radius: Number): this
  	// Sets the radius of a circle. Units are in meters.
  	setRadius: function (radius) {
  		this._mRadius = radius;
  		return this.redraw();
  	},

  	// @method getRadius(): Number
  	// Returns the current radius of a circle. Units are in meters.
  	getRadius: function () {
  		return this._mRadius;
  	},

  	// @method getBounds(): LatLngBounds
  	// Returns the `LatLngBounds` of the path.
  	getBounds: function () {
  		var half = [this._radius, this._radiusY || this._radius];

  		return new LatLngBounds(
  			this._map.layerPointToLatLng(this._point.subtract(half)),
  			this._map.layerPointToLatLng(this._point.add(half)));
  	},

  	setStyle: Path.prototype.setStyle,

  	_project: function () {

  		var lng = this._latlng.lng,
  		    lat = this._latlng.lat,
  		    map = this._map,
  		    crs = map.options.crs;

  		if (crs.distance === Earth.distance) {
  			var d = Math.PI / 180,
  			    latR = (this._mRadius / Earth.R) / d,
  			    top = map.project([lat + latR, lng]),
  			    bottom = map.project([lat - latR, lng]),
  			    p = top.add(bottom).divideBy(2),
  			    lat2 = map.unproject(p).lat,
  			    lngR = Math.acos((Math.cos(latR * d) - Math.sin(lat * d) * Math.sin(lat2 * d)) /
  			            (Math.cos(lat * d) * Math.cos(lat2 * d))) / d;

  			if (isNaN(lngR) || lngR === 0) {
  				lngR = latR / Math.cos(Math.PI / 180 * lat); // Fallback for edge case, #2425
  			}

  			this._point = p.subtract(map.getPixelOrigin());
  			this._radius = isNaN(lngR) ? 0 : p.x - map.project([lat2, lng - lngR]).x;
  			this._radiusY = p.y - top.y;

  		} else {
  			var latlng2 = crs.unproject(crs.project(this._latlng).subtract([this._mRadius, 0]));

  			this._point = map.latLngToLayerPoint(this._latlng);
  			this._radius = this._point.x - map.latLngToLayerPoint(latlng2).x;
  		}

  		this._updateBounds();
  	}
  });

  // @factory L.circle(latlng: LatLng, options?: Circle options)
  // Instantiates a circle object given a geographical point, and an options object
  // which contains the circle radius.
  // @alternative
  // @factory L.circle(latlng: LatLng, radius: Number, options?: Circle options)
  // Obsolete way of instantiating a circle, for compatibility with 0.7.x code.
  // Do not use in new applications or plugins.
  function circle(latlng, options, legacyOptions) {
  	return new Circle(latlng, options, legacyOptions);
  }

  /*
   * @class Polyline
   * @aka L.Polyline
   * @inherits Path
   *
   * A class for drawing polyline overlays on a map. Extends `Path`.
   *
   * @example
   *
   * ```js
   * // create a red polyline from an array of LatLng points
   * var latlngs = [
   * 	[45.51, -122.68],
   * 	[37.77, -122.43],
   * 	[34.04, -118.2]
   * ];
   *
   * var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
   *
   * // zoom the map to the polyline
   * map.fitBounds(polyline.getBounds());
   * ```
   *
   * You can also pass a multi-dimensional array to represent a `MultiPolyline` shape:
   *
   * ```js
   * // create a red polyline from an array of arrays of LatLng points
   * var latlngs = [
   * 	[[45.51, -122.68],
   * 	 [37.77, -122.43],
   * 	 [34.04, -118.2]],
   * 	[[40.78, -73.91],
   * 	 [41.83, -87.62],
   * 	 [32.76, -96.72]]
   * ];
   * ```
   */


  var Polyline = Path.extend({

  	// @section
  	// @aka Polyline options
  	options: {
  		// @option smoothFactor: Number = 1.0
  		// How much to simplify the polyline on each zoom level. More means
  		// better performance and smoother look, and less means more accurate representation.
  		smoothFactor: 1.0,

  		// @option noClip: Boolean = false
  		// Disable polyline clipping.
  		noClip: false
  	},

  	initialize: function (latlngs, options) {
  		setOptions(this, options);
  		this._setLatLngs(latlngs);
  	},

  	// @method getLatLngs(): LatLng[]
  	// Returns an array of the points in the path, or nested arrays of points in case of multi-polyline.
  	getLatLngs: function () {
  		return this._latlngs;
  	},

  	// @method setLatLngs(latlngs: LatLng[]): this
  	// Replaces all the points in the polyline with the given array of geographical points.
  	setLatLngs: function (latlngs) {
  		this._setLatLngs(latlngs);
  		return this.redraw();
  	},

  	// @method isEmpty(): Boolean
  	// Returns `true` if the Polyline has no LatLngs.
  	isEmpty: function () {
  		return !this._latlngs.length;
  	},

  	// @method closestLayerPoint(p: Point): Point
  	// Returns the point closest to `p` on the Polyline.
  	closestLayerPoint: function (p) {
  		var minDistance = Infinity,
  		    minPoint = null,
  		    closest = _sqClosestPointOnSegment,
  		    p1, p2;

  		for (var j = 0, jLen = this._parts.length; j < jLen; j++) {
  			var points = this._parts[j];

  			for (var i = 1, len = points.length; i < len; i++) {
  				p1 = points[i - 1];
  				p2 = points[i];

  				var sqDist = closest(p, p1, p2, true);

  				if (sqDist < minDistance) {
  					minDistance = sqDist;
  					minPoint = closest(p, p1, p2);
  				}
  			}
  		}
  		if (minPoint) {
  			minPoint.distance = Math.sqrt(minDistance);
  		}
  		return minPoint;
  	},

  	// @method getCenter(): LatLng
  	// Returns the center ([centroid](https://en.wikipedia.org/wiki/Centroid)) of the polyline.
  	getCenter: function () {
  		// throws error when not yet added to map as this center calculation requires projected coordinates
  		if (!this._map) {
  			throw new Error('Must add layer to map before using getCenter()');
  		}
  		return polylineCenter(this._defaultShape(), this._map.options.crs);
  	},

  	// @method getBounds(): LatLngBounds
  	// Returns the `LatLngBounds` of the path.
  	getBounds: function () {
  		return this._bounds;
  	},

  	// @method addLatLng(latlng: LatLng, latlngs?: LatLng[]): this
  	// Adds a given point to the polyline. By default, adds to the first ring of
  	// the polyline in case of a multi-polyline, but can be overridden by passing
  	// a specific ring as a LatLng array (that you can earlier access with [`getLatLngs`](#polyline-getlatlngs)).
  	addLatLng: function (latlng, latlngs) {
  		latlngs = latlngs || this._defaultShape();
  		latlng = toLatLng(latlng);
  		latlngs.push(latlng);
  		this._bounds.extend(latlng);
  		return this.redraw();
  	},

  	_setLatLngs: function (latlngs) {
  		this._bounds = new LatLngBounds();
  		this._latlngs = this._convertLatLngs(latlngs);
  	},

  	_defaultShape: function () {
  		return isFlat(this._latlngs) ? this._latlngs : this._latlngs[0];
  	},

  	// recursively convert latlngs input into actual LatLng instances; calculate bounds along the way
  	_convertLatLngs: function (latlngs) {
  		var result = [],
  		    flat = isFlat(latlngs);

  		for (var i = 0, len = latlngs.length; i < len; i++) {
  			if (flat) {
  				result[i] = toLatLng(latlngs[i]);
  				this._bounds.extend(result[i]);
  			} else {
  				result[i] = this._convertLatLngs(latlngs[i]);
  			}
  		}

  		return result;
  	},

  	_project: function () {
  		var pxBounds = new Bounds();
  		this._rings = [];
  		this._projectLatlngs(this._latlngs, this._rings, pxBounds);

  		if (this._bounds.isValid() && pxBounds.isValid()) {
  			this._rawPxBounds = pxBounds;
  			this._updateBounds();
  		}
  	},

  	_updateBounds: function () {
  		var w = this._clickTolerance(),
  		    p = new Point(w, w);

  		if (!this._rawPxBounds) {
  			return;
  		}

  		this._pxBounds = new Bounds([
  			this._rawPxBounds.min.subtract(p),
  			this._rawPxBounds.max.add(p)
  		]);
  	},

  	// recursively turns latlngs into a set of rings with projected coordinates
  	_projectLatlngs: function (latlngs, result, projectedBounds) {
  		var flat = latlngs[0] instanceof LatLng,
  		    len = latlngs.length,
  		    i, ring;

  		if (flat) {
  			ring = [];
  			for (i = 0; i < len; i++) {
  				ring[i] = this._map.latLngToLayerPoint(latlngs[i]);
  				projectedBounds.extend(ring[i]);
  			}
  			result.push(ring);
  		} else {
  			for (i = 0; i < len; i++) {
  				this._projectLatlngs(latlngs[i], result, projectedBounds);
  			}
  		}
  	},

  	// clip polyline by renderer bounds so that we have less to render for performance
  	_clipPoints: function () {
  		var bounds = this._renderer._bounds;

  		this._parts = [];
  		if (!this._pxBounds || !this._pxBounds.intersects(bounds)) {
  			return;
  		}

  		if (this.options.noClip) {
  			this._parts = this._rings;
  			return;
  		}

  		var parts = this._parts,
  		    i, j, k, len, len2, segment, points;

  		for (i = 0, k = 0, len = this._rings.length; i < len; i++) {
  			points = this._rings[i];

  			for (j = 0, len2 = points.length; j < len2 - 1; j++) {
  				segment = clipSegment(points[j], points[j + 1], bounds, j, true);

  				if (!segment) { continue; }

  				parts[k] = parts[k] || [];
  				parts[k].push(segment[0]);

  				// if segment goes out of screen, or it's the last one, it's the end of the line part
  				if ((segment[1] !== points[j + 1]) || (j === len2 - 2)) {
  					parts[k].push(segment[1]);
  					k++;
  				}
  			}
  		}
  	},

  	// simplify each clipped part of the polyline for performance
  	_simplifyPoints: function () {
  		var parts = this._parts,
  		    tolerance = this.options.smoothFactor;

  		for (var i = 0, len = parts.length; i < len; i++) {
  			parts[i] = simplify(parts[i], tolerance);
  		}
  	},

  	_update: function () {
  		if (!this._map) { return; }

  		this._clipPoints();
  		this._simplifyPoints();
  		this._updatePath();
  	},

  	_updatePath: function () {
  		this._renderer._updatePoly(this);
  	},

  	// Needed by the `Canvas` renderer for interactivity
  	_containsPoint: function (p, closed) {
  		var i, j, k, len, len2, part,
  		    w = this._clickTolerance();

  		if (!this._pxBounds || !this._pxBounds.contains(p)) { return false; }

  		// hit detection for polylines
  		for (i = 0, len = this._parts.length; i < len; i++) {
  			part = this._parts[i];

  			for (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {
  				if (!closed && (j === 0)) { continue; }

  				if (pointToSegmentDistance(p, part[k], part[j]) <= w) {
  					return true;
  				}
  			}
  		}
  		return false;
  	}
  });

  // @factory L.polyline(latlngs: LatLng[], options?: Polyline options)
  // Instantiates a polyline object given an array of geographical points and
  // optionally an options object. You can create a `Polyline` object with
  // multiple separate lines (`MultiPolyline`) by passing an array of arrays
  // of geographic points.
  function polyline(latlngs, options) {
  	return new Polyline(latlngs, options);
  }

  // Retrocompat. Allow plugins to support Leaflet versions before and after 1.1.
  Polyline._flat = _flat;

  /*
   * @class Polygon
   * @aka L.Polygon
   * @inherits Polyline
   *
   * A class for drawing polygon overlays on a map. Extends `Polyline`.
   *
   * Note that points you pass when creating a polygon shouldn't have an additional last point equal to the first one — it's better to filter out such points.
   *
   *
   * @example
   *
   * ```js
   * // create a red polygon from an array of LatLng points
   * var latlngs = [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]];
   *
   * var polygon = L.polygon(latlngs, {color: 'red'}).addTo(map);
   *
   * // zoom the map to the polygon
   * map.fitBounds(polygon.getBounds());
   * ```
   *
   * You can also pass an array of arrays of latlngs, with the first array representing the outer shape and the other arrays representing holes in the outer shape:
   *
   * ```js
   * var latlngs = [
   *   [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]], // outer ring
   *   [[37.29, -108.58],[40.71, -108.58],[40.71, -102.50],[37.29, -102.50]] // hole
   * ];
   * ```
   *
   * Additionally, you can pass a multi-dimensional array to represent a MultiPolygon shape.
   *
   * ```js
   * var latlngs = [
   *   [ // first polygon
   *     [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]], // outer ring
   *     [[37.29, -108.58],[40.71, -108.58],[40.71, -102.50],[37.29, -102.50]] // hole
   *   ],
   *   [ // second polygon
   *     [[41, -111.03],[45, -111.04],[45, -104.05],[41, -104.05]]
   *   ]
   * ];
   * ```
   */

  var Polygon = Polyline.extend({

  	options: {
  		fill: true
  	},

  	isEmpty: function () {
  		return !this._latlngs.length || !this._latlngs[0].length;
  	},

  	// @method getCenter(): LatLng
  	// Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the Polygon.
  	getCenter: function () {
  		// throws error when not yet added to map as this center calculation requires projected coordinates
  		if (!this._map) {
  			throw new Error('Must add layer to map before using getCenter()');
  		}
  		return polygonCenter(this._defaultShape(), this._map.options.crs);
  	},

  	_convertLatLngs: function (latlngs) {
  		var result = Polyline.prototype._convertLatLngs.call(this, latlngs),
  		    len = result.length;

  		// remove last point if it equals first one
  		if (len >= 2 && result[0] instanceof LatLng && result[0].equals(result[len - 1])) {
  			result.pop();
  		}
  		return result;
  	},

  	_setLatLngs: function (latlngs) {
  		Polyline.prototype._setLatLngs.call(this, latlngs);
  		if (isFlat(this._latlngs)) {
  			this._latlngs = [this._latlngs];
  		}
  	},

  	_defaultShape: function () {
  		return isFlat(this._latlngs[0]) ? this._latlngs[0] : this._latlngs[0][0];
  	},

  	_clipPoints: function () {
  		// polygons need a different clipping algorithm so we redefine that

  		var bounds = this._renderer._bounds,
  		    w = this.options.weight,
  		    p = new Point(w, w);

  		// increase clip padding by stroke width to avoid stroke on clip edges
  		bounds = new Bounds(bounds.min.subtract(p), bounds.max.add(p));

  		this._parts = [];
  		if (!this._pxBounds || !this._pxBounds.intersects(bounds)) {
  			return;
  		}

  		if (this.options.noClip) {
  			this._parts = this._rings;
  			return;
  		}

  		for (var i = 0, len = this._rings.length, clipped; i < len; i++) {
  			clipped = clipPolygon(this._rings[i], bounds, true);
  			if (clipped.length) {
  				this._parts.push(clipped);
  			}
  		}
  	},

  	_updatePath: function () {
  		this._renderer._updatePoly(this, true);
  	},

  	// Needed by the `Canvas` renderer for interactivity
  	_containsPoint: function (p) {
  		var inside = false,
  		    part, p1, p2, i, j, k, len, len2;

  		if (!this._pxBounds || !this._pxBounds.contains(p)) { return false; }

  		// ray casting algorithm for detecting if point is in polygon
  		for (i = 0, len = this._parts.length; i < len; i++) {
  			part = this._parts[i];

  			for (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {
  				p1 = part[j];
  				p2 = part[k];

  				if (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {
  					inside = !inside;
  				}
  			}
  		}

  		// also check if it's on polygon stroke
  		return inside || Polyline.prototype._containsPoint.call(this, p, true);
  	}

  });


  // @factory L.polygon(latlngs: LatLng[], options?: Polyline options)
  function polygon(latlngs, options) {
  	return new Polygon(latlngs, options);
  }

  /*
   * @class GeoJSON
   * @aka L.GeoJSON
   * @inherits FeatureGroup
   *
   * Represents a GeoJSON object or an array of GeoJSON objects. Allows you to parse
   * GeoJSON data and display it on the map. Extends `FeatureGroup`.
   *
   * @example
   *
   * ```js
   * L.geoJSON(data, {
   * 	style: function (feature) {
   * 		return {color: feature.properties.color};
   * 	}
   * }).bindPopup(function (layer) {
   * 	return layer.feature.properties.description;
   * }).addTo(map);
   * ```
   */

  var GeoJSON = FeatureGroup.extend({

  	/* @section
  	 * @aka GeoJSON options
  	 *
  	 * @option pointToLayer: Function = *
  	 * A `Function` defining how GeoJSON points spawn Leaflet layers. It is internally
  	 * called when data is added, passing the GeoJSON point feature and its `LatLng`.
  	 * The default is to spawn a default `Marker`:
  	 * ```js
  	 * function(geoJsonPoint, latlng) {
  	 * 	return L.marker(latlng);
  	 * }
  	 * ```
  	 *
  	 * @option style: Function = *
  	 * A `Function` defining the `Path options` for styling GeoJSON lines and polygons,
  	 * called internally when data is added.
  	 * The default value is to not override any defaults:
  	 * ```js
  	 * function (geoJsonFeature) {
  	 * 	return {}
  	 * }
  	 * ```
  	 *
  	 * @option onEachFeature: Function = *
  	 * A `Function` that will be called once for each created `Feature`, after it has
  	 * been created and styled. Useful for attaching events and popups to features.
  	 * The default is to do nothing with the newly created layers:
  	 * ```js
  	 * function (feature, layer) {}
  	 * ```
  	 *
  	 * @option filter: Function = *
  	 * A `Function` that will be used to decide whether to include a feature or not.
  	 * The default is to include all features:
  	 * ```js
  	 * function (geoJsonFeature) {
  	 * 	return true;
  	 * }
  	 * ```
  	 * Note: dynamically changing the `filter` option will have effect only on newly
  	 * added data. It will _not_ re-evaluate already included features.
  	 *
  	 * @option coordsToLatLng: Function = *
  	 * A `Function` that will be used for converting GeoJSON coordinates to `LatLng`s.
  	 * The default is the `coordsToLatLng` static method.
  	 *
  	 * @option markersInheritOptions: Boolean = false
  	 * Whether default Markers for "Point" type Features inherit from group options.
  	 */

  	initialize: function (geojson, options) {
  		setOptions(this, options);

  		this._layers = {};

  		if (geojson) {
  			this.addData(geojson);
  		}
  	},

  	// @method addData( <GeoJSON> data ): this
  	// Adds a GeoJSON object to the layer.
  	addData: function (geojson) {
  		var features = isArray(geojson) ? geojson : geojson.features,
  		    i, len, feature;

  		if (features) {
  			for (i = 0, len = features.length; i < len; i++) {
  				// only add this if geometry or geometries are set and not null
  				feature = features[i];
  				if (feature.geometries || feature.geometry || feature.features || feature.coordinates) {
  					this.addData(feature);
  				}
  			}
  			return this;
  		}

  		var options = this.options;

  		if (options.filter && !options.filter(geojson)) { return this; }

  		var layer = geometryToLayer(geojson, options);
  		if (!layer) {
  			return this;
  		}
  		layer.feature = asFeature(geojson);

  		layer.defaultOptions = layer.options;
  		this.resetStyle(layer);

  		if (options.onEachFeature) {
  			options.onEachFeature(geojson, layer);
  		}

  		return this.addLayer(layer);
  	},

  	// @method resetStyle( <Path> layer? ): this
  	// Resets the given vector layer's style to the original GeoJSON style, useful for resetting style after hover events.
  	// If `layer` is omitted, the style of all features in the current layer is reset.
  	resetStyle: function (layer) {
  		if (layer === undefined) {
  			return this.eachLayer(this.resetStyle, this);
  		}
  		// reset any custom styles
  		layer.options = extend({}, layer.defaultOptions);
  		this._setLayerStyle(layer, this.options.style);
  		return this;
  	},

  	// @method setStyle( <Function> style ): this
  	// Changes styles of GeoJSON vector layers with the given style function.
  	setStyle: function (style) {
  		return this.eachLayer(function (layer) {
  			this._setLayerStyle(layer, style);
  		}, this);
  	},

  	_setLayerStyle: function (layer, style) {
  		if (layer.setStyle) {
  			if (typeof style === 'function') {
  				style = style(layer.feature);
  			}
  			layer.setStyle(style);
  		}
  	}
  });

  // @section
  // There are several static functions which can be called without instantiating L.GeoJSON:

  // @function geometryToLayer(featureData: Object, options?: GeoJSON options): Layer
  // Creates a `Layer` from a given GeoJSON feature. Can use a custom
  // [`pointToLayer`](#geojson-pointtolayer) and/or [`coordsToLatLng`](#geojson-coordstolatlng)
  // functions if provided as options.
  function geometryToLayer(geojson, options) {

  	var geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,
  	    coords = geometry ? geometry.coordinates : null,
  	    layers = [],
  	    pointToLayer = options && options.pointToLayer,
  	    _coordsToLatLng = options && options.coordsToLatLng || coordsToLatLng,
  	    latlng, latlngs, i, len;

  	if (!coords && !geometry) {
  		return null;
  	}

  	switch (geometry.type) {
  	case 'Point':
  		latlng = _coordsToLatLng(coords);
  		return _pointToLayer(pointToLayer, geojson, latlng, options);

  	case 'MultiPoint':
  		for (i = 0, len = coords.length; i < len; i++) {
  			latlng = _coordsToLatLng(coords[i]);
  			layers.push(_pointToLayer(pointToLayer, geojson, latlng, options));
  		}
  		return new FeatureGroup(layers);

  	case 'LineString':
  	case 'MultiLineString':
  		latlngs = coordsToLatLngs(coords, geometry.type === 'LineString' ? 0 : 1, _coordsToLatLng);
  		return new Polyline(latlngs, options);

  	case 'Polygon':
  	case 'MultiPolygon':
  		latlngs = coordsToLatLngs(coords, geometry.type === 'Polygon' ? 1 : 2, _coordsToLatLng);
  		return new Polygon(latlngs, options);

  	case 'GeometryCollection':
  		for (i = 0, len = geometry.geometries.length; i < len; i++) {
  			var geoLayer = geometryToLayer({
  				geometry: geometry.geometries[i],
  				type: 'Feature',
  				properties: geojson.properties
  			}, options);

  			if (geoLayer) {
  				layers.push(geoLayer);
  			}
  		}
  		return new FeatureGroup(layers);

  	case 'FeatureCollection':
  		for (i = 0, len = geometry.features.length; i < len; i++) {
  			var featureLayer = geometryToLayer(geometry.features[i], options);

  			if (featureLayer) {
  				layers.push(featureLayer);
  			}
  		}
  		return new FeatureGroup(layers);

  	default:
  		throw new Error('Invalid GeoJSON object.');
  	}
  }

  function _pointToLayer(pointToLayerFn, geojson, latlng, options) {
  	return pointToLayerFn ?
  		pointToLayerFn(geojson, latlng) :
  		new Marker(latlng, options && options.markersInheritOptions && options);
  }

  // @function coordsToLatLng(coords: Array): LatLng
  // Creates a `LatLng` object from an array of 2 numbers (longitude, latitude)
  // or 3 numbers (longitude, latitude, altitude) used in GeoJSON for points.
  function coordsToLatLng(coords) {
  	return new LatLng(coords[1], coords[0], coords[2]);
  }

  // @function coordsToLatLngs(coords: Array, levelsDeep?: Number, coordsToLatLng?: Function): Array
  // Creates a multidimensional array of `LatLng`s from a GeoJSON coordinates array.
  // `levelsDeep` specifies the nesting level (0 is for an array of points, 1 for an array of arrays of points, etc., 0 by default).
  // Can use a custom [`coordsToLatLng`](#geojson-coordstolatlng) function.
  function coordsToLatLngs(coords, levelsDeep, _coordsToLatLng) {
  	var latlngs = [];

  	for (var i = 0, len = coords.length, latlng; i < len; i++) {
  		latlng = levelsDeep ?
  			coordsToLatLngs(coords[i], levelsDeep - 1, _coordsToLatLng) :
  			(_coordsToLatLng || coordsToLatLng)(coords[i]);

  		latlngs.push(latlng);
  	}

  	return latlngs;
  }

  // @function latLngToCoords(latlng: LatLng, precision?: Number|false): Array
  // Reverse of [`coordsToLatLng`](#geojson-coordstolatlng)
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function.
  function latLngToCoords(latlng, precision) {
  	latlng = toLatLng(latlng);
  	return latlng.alt !== undefined ?
  		[formatNum(latlng.lng, precision), formatNum(latlng.lat, precision), formatNum(latlng.alt, precision)] :
  		[formatNum(latlng.lng, precision), formatNum(latlng.lat, precision)];
  }

  // @function latLngsToCoords(latlngs: Array, levelsDeep?: Number, closed?: Boolean, precision?: Number|false): Array
  // Reverse of [`coordsToLatLngs`](#geojson-coordstolatlngs)
  // `closed` determines whether the first point should be appended to the end of the array to close the feature, only used when `levelsDeep` is 0. False by default.
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function.
  function latLngsToCoords(latlngs, levelsDeep, closed, precision) {
  	var coords = [];

  	for (var i = 0, len = latlngs.length; i < len; i++) {
  		// Check for flat arrays required to ensure unbalanced arrays are correctly converted in recursion
  		coords.push(levelsDeep ?
  			latLngsToCoords(latlngs[i], isFlat(latlngs[i]) ? 0 : levelsDeep - 1, closed, precision) :
  			latLngToCoords(latlngs[i], precision));
  	}

  	if (!levelsDeep && closed && coords.length > 0) {
  		coords.push(coords[0].slice());
  	}

  	return coords;
  }

  function getFeature(layer, newGeometry) {
  	return layer.feature ?
  		extend({}, layer.feature, {geometry: newGeometry}) :
  		asFeature(newGeometry);
  }

  // @function asFeature(geojson: Object): Object
  // Normalize GeoJSON geometries/features into GeoJSON features.
  function asFeature(geojson) {
  	if (geojson.type === 'Feature' || geojson.type === 'FeatureCollection') {
  		return geojson;
  	}

  	return {
  		type: 'Feature',
  		properties: {},
  		geometry: geojson
  	};
  }

  var PointToGeoJSON = {
  	toGeoJSON: function (precision) {
  		return getFeature(this, {
  			type: 'Point',
  			coordinates: latLngToCoords(this.getLatLng(), precision)
  		});
  	}
  };

  // @namespace Marker
  // @section Other methods
  // @method toGeoJSON(precision?: Number|false): Object
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.
  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the marker (as a GeoJSON `Point` Feature).
  Marker.include(PointToGeoJSON);

  // @namespace CircleMarker
  // @method toGeoJSON(precision?: Number|false): Object
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.
  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the circle marker (as a GeoJSON `Point` Feature).
  Circle.include(PointToGeoJSON);
  CircleMarker.include(PointToGeoJSON);


  // @namespace Polyline
  // @method toGeoJSON(precision?: Number|false): Object
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.
  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the polyline (as a GeoJSON `LineString` or `MultiLineString` Feature).
  Polyline.include({
  	toGeoJSON: function (precision) {
  		var multi = !isFlat(this._latlngs);

  		var coords = latLngsToCoords(this._latlngs, multi ? 1 : 0, false, precision);

  		return getFeature(this, {
  			type: (multi ? 'Multi' : '') + 'LineString',
  			coordinates: coords
  		});
  	}
  });

  // @namespace Polygon
  // @method toGeoJSON(precision?: Number|false): Object
  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.
  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the polygon (as a GeoJSON `Polygon` or `MultiPolygon` Feature).
  Polygon.include({
  	toGeoJSON: function (precision) {
  		var holes = !isFlat(this._latlngs),
  		    multi = holes && !isFlat(this._latlngs[0]);

  		var coords = latLngsToCoords(this._latlngs, multi ? 2 : holes ? 1 : 0, true, precision);

  		if (!holes) {
  			coords = [coords];
  		}

  		return getFeature(this, {
  			type: (multi ? 'Multi' : '') + 'Polygon',
  			coordinates: coords
  		});
  	}
  });


  // @namespace LayerGroup
  LayerGroup.include({
  	toMultiPoint: function (precision) {
  		var coords = [];

  		this.eachLayer(function (layer) {
  			coords.push(layer.toGeoJSON(precision).geometry.coordinates);
  		});

  		return getFeature(this, {
  			type: 'MultiPoint',
  			coordinates: coords
  		});
  	},

  	// @method toGeoJSON(precision?: Number|false): Object
  	// Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.
  	// Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the layer group (as a GeoJSON `FeatureCollection`, `GeometryCollection`, or `MultiPoint`).
  	toGeoJSON: function (precision) {

  		var type = this.feature && this.feature.geometry && this.feature.geometry.type;

  		if (type === 'MultiPoint') {
  			return this.toMultiPoint(precision);
  		}

  		var isGeometryCollection = type === 'GeometryCollection',
  		    jsons = [];

  		this.eachLayer(function (layer) {
  			if (layer.toGeoJSON) {
  				var json = layer.toGeoJSON(precision);
  				if (isGeometryCollection) {
  					jsons.push(json.geometry);
  				} else {
  					var feature = asFeature(json);
  					// Squash nested feature collections
  					if (feature.type === 'FeatureCollection') {
  						jsons.push.apply(jsons, feature.features);
  					} else {
  						jsons.push(feature);
  					}
  				}
  			}
  		});

  		if (isGeometryCollection) {
  			return getFeature(this, {
  				geometries: jsons,
  				type: 'GeometryCollection'
  			});
  		}

  		return {
  			type: 'FeatureCollection',
  			features: jsons
  		};
  	}
  });

  // @namespace GeoJSON
  // @factory L.geoJSON(geojson?: Object, options?: GeoJSON options)
  // Creates a GeoJSON layer. Optionally accepts an object in
  // [GeoJSON format](https://tools.ietf.org/html/rfc7946) to display on the map
  // (you can alternatively add it later with `addData` method) and an `options` object.
  function geoJSON(geojson, options) {
  	return new GeoJSON(geojson, options);
  }

  // Backward compatibility.
  var geoJson = geoJSON;

  /*
   * @class ImageOverlay
   * @aka L.ImageOverlay
   * @inherits Interactive layer
   *
   * Used to load and display a single image over specific bounds of the map. Extends `Layer`.
   *
   * @example
   *
   * ```js
   * var imageUrl = 'https://maps.lib.utexas.edu/maps/historical/newark_nj_1922.jpg',
   * 	imageBounds = [[40.712216, -74.22655], [40.773941, -74.12544]];
   * L.imageOverlay(imageUrl, imageBounds).addTo(map);
   * ```
   */

  var ImageOverlay = Layer.extend({

  	// @section
  	// @aka ImageOverlay options
  	options: {
  		// @option opacity: Number = 1.0
  		// The opacity of the image overlay.
  		opacity: 1,

  		// @option alt: String = ''
  		// Text for the `alt` attribute of the image (useful for accessibility).
  		alt: '',

  		// @option interactive: Boolean = false
  		// If `true`, the image overlay will emit [mouse events](#interactive-layer) when clicked or hovered.
  		interactive: false,

  		// @option crossOrigin: Boolean|String = false
  		// Whether the crossOrigin attribute will be added to the image.
  		// If a String is provided, the image will have its crossOrigin attribute set to the String provided. This is needed if you want to access image pixel data.
  		// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.
  		crossOrigin: false,

  		// @option errorOverlayUrl: String = ''
  		// URL to the overlay image to show in place of the overlay that failed to load.
  		errorOverlayUrl: '',

  		// @option zIndex: Number = 1
  		// The explicit [zIndex](https://developer.mozilla.org/docs/Web/CSS/CSS_Positioning/Understanding_z_index) of the overlay layer.
  		zIndex: 1,

  		// @option className: String = ''
  		// A custom class name to assign to the image. Empty by default.
  		className: ''
  	},

  	initialize: function (url, bounds, options) { // (String, LatLngBounds, Object)
  		this._url = url;
  		this._bounds = toLatLngBounds(bounds);

  		setOptions(this, options);
  	},

  	onAdd: function () {
  		if (!this._image) {
  			this._initImage();

  			if (this.options.opacity < 1) {
  				this._updateOpacity();
  			}
  		}

  		if (this.options.interactive) {
  			addClass(this._image, 'leaflet-interactive');
  			this.addInteractiveTarget(this._image);
  		}

  		this.getPane().appendChild(this._image);
  		this._reset();
  	},

  	onRemove: function () {
  		remove(this._image);
  		if (this.options.interactive) {
  			this.removeInteractiveTarget(this._image);
  		}
  	},

  	// @method setOpacity(opacity: Number): this
  	// Sets the opacity of the overlay.
  	setOpacity: function (opacity) {
  		this.options.opacity = opacity;

  		if (this._image) {
  			this._updateOpacity();
  		}
  		return this;
  	},

  	setStyle: function (styleOpts) {
  		if (styleOpts.opacity) {
  			this.setOpacity(styleOpts.opacity);
  		}
  		return this;
  	},

  	// @method bringToFront(): this
  	// Brings the layer to the top of all overlays.
  	bringToFront: function () {
  		if (this._map) {
  			toFront(this._image);
  		}
  		return this;
  	},

  	// @method bringToBack(): this
  	// Brings the layer to the bottom of all overlays.
  	bringToBack: function () {
  		if (this._map) {
  			toBack(this._image);
  		}
  		return this;
  	},

  	// @method setUrl(url: String): this
  	// Changes the URL of the image.
  	setUrl: function (url) {
  		this._url = url;

  		if (this._image) {
  			this._image.src = url;
  		}
  		return this;
  	},

  	// @method setBounds(bounds: LatLngBounds): this
  	// Update the bounds that this ImageOverlay covers
  	setBounds: function (bounds) {
  		this._bounds = toLatLngBounds(bounds);

  		if (this._map) {
  			this._reset();
  		}
  		return this;
  	},

  	getEvents: function () {
  		var events = {
  			zoom: this._reset,
  			viewreset: this._reset
  		};

  		if (this._zoomAnimated) {
  			events.zoomanim = this._animateZoom;
  		}

  		return events;
  	},

  	// @method setZIndex(value: Number): this
  	// Changes the [zIndex](#imageoverlay-zindex) of the image overlay.
  	setZIndex: function (value) {
  		this.options.zIndex = value;
  		this._updateZIndex();
  		return this;
  	},

  	// @method getBounds(): LatLngBounds
  	// Get the bounds that this ImageOverlay covers
  	getBounds: function () {
  		return this._bounds;
  	},

  	// @method getElement(): HTMLElement
  	// Returns the instance of [`HTMLImageElement`](https://developer.mozilla.org/docs/Web/API/HTMLImageElement)
  	// used by this overlay.
  	getElement: function () {
  		return this._image;
  	},

  	_initImage: function () {
  		var wasElementSupplied = this._url.tagName === 'IMG';
  		var img = this._image = wasElementSupplied ? this._url : create$1('img');

  		addClass(img, 'leaflet-image-layer');
  		if (this._zoomAnimated) { addClass(img, 'leaflet-zoom-animated'); }
  		if (this.options.className) { addClass(img, this.options.className); }

  		img.onselectstart = falseFn;
  		img.onmousemove = falseFn;

  		// @event load: Event
  		// Fired when the ImageOverlay layer has loaded its image
  		img.onload = bind(this.fire, this, 'load');
  		img.onerror = bind(this._overlayOnError, this, 'error');

  		if (this.options.crossOrigin || this.options.crossOrigin === '') {
  			img.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;
  		}

  		if (this.options.zIndex) {
  			this._updateZIndex();
  		}

  		if (wasElementSupplied) {
  			this._url = img.src;
  			return;
  		}

  		img.src = this._url;
  		img.alt = this.options.alt;
  	},

  	_animateZoom: function (e) {
  		var scale = this._map.getZoomScale(e.zoom),
  		    offset = this._map._latLngBoundsToNewLayerBounds(this._bounds, e.zoom, e.center).min;

  		setTransform(this._image, offset, scale);
  	},

  	_reset: function () {
  		var image = this._image,
  		    bounds = new Bounds(
  		        this._map.latLngToLayerPoint(this._bounds.getNorthWest()),
  		        this._map.latLngToLayerPoint(this._bounds.getSouthEast())),
  		    size = bounds.getSize();

  		setPosition(image, bounds.min);

  		image.style.width  = size.x + 'px';
  		image.style.height = size.y + 'px';
  	},

  	_updateOpacity: function () {
  		setOpacity(this._image, this.options.opacity);
  	},

  	_updateZIndex: function () {
  		if (this._image && this.options.zIndex !== undefined && this.options.zIndex !== null) {
  			this._image.style.zIndex = this.options.zIndex;
  		}
  	},

  	_overlayOnError: function () {
  		// @event error: Event
  		// Fired when the ImageOverlay layer fails to load its image
  		this.fire('error');

  		var errorUrl = this.options.errorOverlayUrl;
  		if (errorUrl && this._url !== errorUrl) {
  			this._url = errorUrl;
  			this._image.src = errorUrl;
  		}
  	},

  	// @method getCenter(): LatLng
  	// Returns the center of the ImageOverlay.
  	getCenter: function () {
  		return this._bounds.getCenter();
  	}
  });

  // @factory L.imageOverlay(imageUrl: String, bounds: LatLngBounds, options?: ImageOverlay options)
  // Instantiates an image overlay object given the URL of the image and the
  // geographical bounds it is tied to.
  var imageOverlay = function (url, bounds, options) {
  	return new ImageOverlay(url, bounds, options);
  };

  /*
   * @class VideoOverlay
   * @aka L.VideoOverlay
   * @inherits ImageOverlay
   *
   * Used to load and display a video player over specific bounds of the map. Extends `ImageOverlay`.
   *
   * A video overlay uses the [`<video>`](https://developer.mozilla.org/docs/Web/HTML/Element/video)
   * HTML5 element.
   *
   * @example
   *
   * ```js
   * var videoUrl = 'https://www.mapbox.com/bites/00188/patricia_nasa.webm',
   * 	videoBounds = [[ 32, -130], [ 13, -100]];
   * L.videoOverlay(videoUrl, videoBounds ).addTo(map);
   * ```
   */

  var VideoOverlay = ImageOverlay.extend({

  	// @section
  	// @aka VideoOverlay options
  	options: {
  		// @option autoplay: Boolean = true
  		// Whether the video starts playing automatically when loaded.
  		// On some browsers autoplay will only work with `muted: true`
  		autoplay: true,

  		// @option loop: Boolean = true
  		// Whether the video will loop back to the beginning when played.
  		loop: true,

  		// @option keepAspectRatio: Boolean = true
  		// Whether the video will save aspect ratio after the projection.
  		// Relevant for supported browsers. See [browser compatibility](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)
  		keepAspectRatio: true,

  		// @option muted: Boolean = false
  		// Whether the video starts on mute when loaded.
  		muted: false,

  		// @option playsInline: Boolean = true
  		// Mobile browsers will play the video right where it is instead of open it up in fullscreen mode.
  		playsInline: true
  	},

  	_initImage: function () {
  		var wasElementSupplied = this._url.tagName === 'VIDEO';
  		var vid = this._image = wasElementSupplied ? this._url : create$1('video');

  		addClass(vid, 'leaflet-image-layer');
  		if (this._zoomAnimated) { addClass(vid, 'leaflet-zoom-animated'); }
  		if (this.options.className) { addClass(vid, this.options.className); }

  		vid.onselectstart = falseFn;
  		vid.onmousemove = falseFn;

  		// @event load: Event
  		// Fired when the video has finished loading the first frame
  		vid.onloadeddata = bind(this.fire, this, 'load');

  		if (wasElementSupplied) {
  			var sourceElements = vid.getElementsByTagName('source');
  			var sources = [];
  			for (var j = 0; j < sourceElements.length; j++) {
  				sources.push(sourceElements[j].src);
  			}

  			this._url = (sourceElements.length > 0) ? sources : [vid.src];
  			return;
  		}

  		if (!isArray(this._url)) { this._url = [this._url]; }

  		if (!this.options.keepAspectRatio && Object.prototype.hasOwnProperty.call(vid.style, 'objectFit')) {
  			vid.style['objectFit'] = 'fill';
  		}
  		vid.autoplay = !!this.options.autoplay;
  		vid.loop = !!this.options.loop;
  		vid.muted = !!this.options.muted;
  		vid.playsInline = !!this.options.playsInline;
  		for (var i = 0; i < this._url.length; i++) {
  			var source = create$1('source');
  			source.src = this._url[i];
  			vid.appendChild(source);
  		}
  	}

  	// @method getElement(): HTMLVideoElement
  	// Returns the instance of [`HTMLVideoElement`](https://developer.mozilla.org/docs/Web/API/HTMLVideoElement)
  	// used by this overlay.
  });


  // @factory L.videoOverlay(video: String|Array|HTMLVideoElement, bounds: LatLngBounds, options?: VideoOverlay options)
  // Instantiates an image overlay object given the URL of the video (or array of URLs, or even a video element) and the
  // geographical bounds it is tied to.

  function videoOverlay(video, bounds, options) {
  	return new VideoOverlay(video, bounds, options);
  }

  /*
   * @class SVGOverlay
   * @aka L.SVGOverlay
   * @inherits ImageOverlay
   *
   * Used to load, display and provide DOM access to an SVG file over specific bounds of the map. Extends `ImageOverlay`.
   *
   * An SVG overlay uses the [`<svg>`](https://developer.mozilla.org/docs/Web/SVG/Element/svg) element.
   *
   * @example
   *
   * ```js
   * var svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
   * svgElement.setAttribute('xmlns', "http://www.w3.org/2000/svg");
   * svgElement.setAttribute('viewBox', "0 0 200 200");
   * svgElement.innerHTML = '<rect width="200" height="200"/><rect x="75" y="23" width="50" height="50" style="fill:red"/><rect x="75" y="123" width="50" height="50" style="fill:#0013ff"/>';
   * var svgElementBounds = [ [ 32, -130 ], [ 13, -100 ] ];
   * L.svgOverlay(svgElement, svgElementBounds).addTo(map);
   * ```
   */

  var SVGOverlay = ImageOverlay.extend({
  	_initImage: function () {
  		var el = this._image = this._url;

  		addClass(el, 'leaflet-image-layer');
  		if (this._zoomAnimated) { addClass(el, 'leaflet-zoom-animated'); }
  		if (this.options.className) { addClass(el, this.options.className); }

  		el.onselectstart = falseFn;
  		el.onmousemove = falseFn;
  	}

  	// @method getElement(): SVGElement
  	// Returns the instance of [`SVGElement`](https://developer.mozilla.org/docs/Web/API/SVGElement)
  	// used by this overlay.
  });


  // @factory L.svgOverlay(svg: String|SVGElement, bounds: LatLngBounds, options?: SVGOverlay options)
  // Instantiates an image overlay object given an SVG element and the geographical bounds it is tied to.
  // A viewBox attribute is required on the SVG element to zoom in and out properly.

  function svgOverlay(el, bounds, options) {
  	return new SVGOverlay(el, bounds, options);
  }

  /*
   * @class DivOverlay
   * @inherits Interactive layer
   * @aka L.DivOverlay
   * Base model for L.Popup and L.Tooltip. Inherit from it for custom overlays like plugins.
   */

  // @namespace DivOverlay
  var DivOverlay = Layer.extend({

  	// @section
  	// @aka DivOverlay options
  	options: {
  		// @option interactive: Boolean = false
  		// If true, the popup/tooltip will listen to the mouse events.
  		interactive: false,

  		// @option offset: Point = Point(0, 0)
  		// The offset of the overlay position.
  		offset: [0, 0],

  		// @option className: String = ''
  		// A custom CSS class name to assign to the overlay.
  		className: '',

  		// @option pane: String = undefined
  		// `Map pane` where the overlay will be added.
  		pane: undefined,

  		// @option content: String|HTMLElement|Function = ''
  		// Sets the HTML content of the overlay while initializing. If a function is passed the source layer will be
  		// passed to the function. The function should return a `String` or `HTMLElement` to be used in the overlay.
  		content: ''
  	},

  	initialize: function (options, source) {
  		if (options && (options instanceof LatLng || isArray(options))) {
  			this._latlng = toLatLng(options);
  			setOptions(this, source);
  		} else {
  			setOptions(this, options);
  			this._source = source;
  		}
  		if (this.options.content) {
  			this._content = this.options.content;
  		}
  	},

  	// @method openOn(map: Map): this
  	// Adds the overlay to the map.
  	// Alternative to `map.openPopup(popup)`/`.openTooltip(tooltip)`.
  	openOn: function (map) {
  		map = arguments.length ? map : this._source._map; // experimental, not the part of public api
  		if (!map.hasLayer(this)) {
  			map.addLayer(this);
  		}
  		return this;
  	},

  	// @method close(): this
  	// Closes the overlay.
  	// Alternative to `map.closePopup(popup)`/`.closeTooltip(tooltip)`
  	// and `layer.closePopup()`/`.closeTooltip()`.
  	close: function () {
  		if (this._map) {
  			this._map.removeLayer(this);
  		}
  		return this;
  	},

  	// @method toggle(layer?: Layer): this
  	// Opens or closes the overlay bound to layer depending on its current state.
  	// Argument may be omitted only for overlay bound to layer.
  	// Alternative to `layer.togglePopup()`/`.toggleTooltip()`.
  	toggle: function (layer) {
  		if (this._map) {
  			this.close();
  		} else {
  			if (arguments.length) {
  				this._source = layer;
  			} else {
  				layer = this._source;
  			}
  			this._prepareOpen();

  			// open the overlay on the map
  			this.openOn(layer._map);
  		}
  		return this;
  	},

  	onAdd: function (map) {
  		this._zoomAnimated = map._zoomAnimated;

  		if (!this._container) {
  			this._initLayout();
  		}

  		if (map._fadeAnimated) {
  			setOpacity(this._container, 0);
  		}

  		clearTimeout(this._removeTimeout);
  		this.getPane().appendChild(this._container);
  		this.update();

  		if (map._fadeAnimated) {
  			setOpacity(this._container, 1);
  		}

  		this.bringToFront();

  		if (this.options.interactive) {
  			addClass(this._container, 'leaflet-interactive');
  			this.addInteractiveTarget(this._container);
  		}
  	},

  	onRemove: function (map) {
  		if (map._fadeAnimated) {
  			setOpacity(this._container, 0);
  			this._removeTimeout = setTimeout(bind(remove, undefined, this._container), 200);
  		} else {
  			remove(this._container);
  		}

  		if (this.options.interactive) {
  			removeClass(this._container, 'leaflet-interactive');
  			this.removeInteractiveTarget(this._container);
  		}
  	},

  	// @namespace DivOverlay
  	// @method getLatLng: LatLng
  	// Returns the geographical point of the overlay.
  	getLatLng: function () {
  		return this._latlng;
  	},

  	// @method setLatLng(latlng: LatLng): this
  	// Sets the geographical point where the overlay will open.
  	setLatLng: function (latlng) {
  		this._latlng = toLatLng(latlng);
  		if (this._map) {
  			this._updatePosition();
  			this._adjustPan();
  		}
  		return this;
  	},

  	// @method getContent: String|HTMLElement
  	// Returns the content of the overlay.
  	getContent: function () {
  		return this._content;
  	},

  	// @method setContent(htmlContent: String|HTMLElement|Function): this
  	// Sets the HTML content of the overlay. If a function is passed the source layer will be passed to the function.
  	// The function should return a `String` or `HTMLElement` to be used in the overlay.
  	setContent: function (content) {
  		this._content = content;
  		this.update();
  		return this;
  	},

  	// @method getElement: String|HTMLElement
  	// Returns the HTML container of the overlay.
  	getElement: function () {
  		return this._container;
  	},

  	// @method update: null
  	// Updates the overlay content, layout and position. Useful for updating the overlay after something inside changed, e.g. image loaded.
  	update: function () {
  		if (!this._map) { return; }

  		this._container.style.visibility = 'hidden';

  		this._updateContent();
  		this._updateLayout();
  		this._updatePosition();

  		this._container.style.visibility = '';

  		this._adjustPan();
  	},

  	getEvents: function () {
  		var events = {
  			zoom: this._updatePosition,
  			viewreset: this._updatePosition
  		};

  		if (this._zoomAnimated) {
  			events.zoomanim = this._animateZoom;
  		}
  		return events;
  	},

  	// @method isOpen: Boolean
  	// Returns `true` when the overlay is visible on the map.
  	isOpen: function () {
  		return !!this._map && this._map.hasLayer(this);
  	},

  	// @method bringToFront: this
  	// Brings this overlay in front of other overlays (in the same map pane).
  	bringToFront: function () {
  		if (this._map) {
  			toFront(this._container);
  		}
  		return this;
  	},

  	// @method bringToBack: this
  	// Brings this overlay to the back of other overlays (in the same map pane).
  	bringToBack: function () {
  		if (this._map) {
  			toBack(this._container);
  		}
  		return this;
  	},

  	// prepare bound overlay to open: update latlng pos / content source (for FeatureGroup)
  	_prepareOpen: function (latlng) {
  		var source = this._source;
  		if (!source._map) { return false; }

  		if (source instanceof FeatureGroup) {
  			source = null;
  			var layers = this._source._layers;
  			for (var id in layers) {
  				if (layers[id]._map) {
  					source = layers[id];
  					break;
  				}
  			}
  			if (!source) { return false; } // Unable to get source layer.

  			// set overlay source to this layer
  			this._source = source;
  		}

  		if (!latlng) {
  			if (source.getCenter) {
  				latlng = source.getCenter();
  			} else if (source.getLatLng) {
  				latlng = source.getLatLng();
  			} else if (source.getBounds) {
  				latlng = source.getBounds().getCenter();
  			} else {
  				throw new Error('Unable to get source layer LatLng.');
  			}
  		}
  		this.setLatLng(latlng);

  		if (this._map) {
  			// update the overlay (content, layout, etc...)
  			this.update();
  		}

  		return true;
  	},

  	_updateContent: function () {
  		if (!this._content) { return; }

  		var node = this._contentNode;
  		var content = (typeof this._content === 'function') ? this._content(this._source || this) : this._content;

  		if (typeof content === 'string') {
  			node.innerHTML = content;
  		} else {
  			while (node.hasChildNodes()) {
  				node.removeChild(node.firstChild);
  			}
  			node.appendChild(content);
  		}

  		// @namespace DivOverlay
  		// @section DivOverlay events
  		// @event contentupdate: Event
  		// Fired when the content of the overlay is updated
  		this.fire('contentupdate');
  	},

  	_updatePosition: function () {
  		if (!this._map) { return; }

  		var pos = this._map.latLngToLayerPoint(this._latlng),
  		    offset = toPoint(this.options.offset),
  		    anchor = this._getAnchor();

  		if (this._zoomAnimated) {
  			setPosition(this._container, pos.add(anchor));
  		} else {
  			offset = offset.add(pos).add(anchor);
  		}

  		var bottom = this._containerBottom = -offset.y,
  		    left = this._containerLeft = -Math.round(this._containerWidth / 2) + offset.x;

  		// bottom position the overlay in case the height of the overlay changes (images loading etc)
  		this._container.style.bottom = bottom + 'px';
  		this._container.style.left = left + 'px';
  	},

  	_getAnchor: function () {
  		return [0, 0];
  	}

  });

  Map.include({
  	_initOverlay: function (OverlayClass, content, latlng, options) {
  		var overlay = content;
  		if (!(overlay instanceof OverlayClass)) {
  			overlay = new OverlayClass(options).setContent(content);
  		}
  		if (latlng) {
  			overlay.setLatLng(latlng);
  		}
  		return overlay;
  	}
  });


  Layer.include({
  	_initOverlay: function (OverlayClass, old, content, options) {
  		var overlay = content;
  		if (overlay instanceof OverlayClass) {
  			setOptions(overlay, options);
  			overlay._source = this;
  		} else {
  			overlay = (old && !options) ? old : new OverlayClass(options, this);
  			overlay.setContent(content);
  		}
  		return overlay;
  	}
  });

  /*
   * @class Popup
   * @inherits DivOverlay
   * @aka L.Popup
   * Used to open popups in certain places of the map. Use [Map.openPopup](#map-openpopup) to
   * open popups while making sure that only one popup is open at one time
   * (recommended for usability), or use [Map.addLayer](#map-addlayer) to open as many as you want.
   *
   * @example
   *
   * If you want to just bind a popup to marker click and then open it, it's really easy:
   *
   * ```js
   * marker.bindPopup(popupContent).openPopup();
   * ```
   * Path overlays like polylines also have a `bindPopup` method.
   *
   * A popup can be also standalone:
   *
   * ```js
   * var popup = L.popup()
   * 	.setLatLng(latlng)
   * 	.setContent('<p>Hello world!<br />This is a nice popup.</p>')
   * 	.openOn(map);
   * ```
   * or
   * ```js
   * var popup = L.popup(latlng, {content: '<p>Hello world!<br />This is a nice popup.</p>')
   * 	.openOn(map);
   * ```
   */


  // @namespace Popup
  var Popup = DivOverlay.extend({

  	// @section
  	// @aka Popup options
  	options: {
  		// @option pane: String = 'popupPane'
  		// `Map pane` where the popup will be added.
  		pane: 'popupPane',

  		// @option offset: Point = Point(0, 7)
  		// The offset of the popup position.
  		offset: [0, 7],

  		// @option maxWidth: Number = 300
  		// Max width of the popup, in pixels.
  		maxWidth: 300,

  		// @option minWidth: Number = 50
  		// Min width of the popup, in pixels.
  		minWidth: 50,

  		// @option maxHeight: Number = null
  		// If set, creates a scrollable container of the given height
  		// inside a popup if its content exceeds it.
  		// The scrollable container can be styled using the
  		// `leaflet-popup-scrolled` CSS class selector.
  		maxHeight: null,

  		// @option autoPan: Boolean = true
  		// Set it to `false` if you don't want the map to do panning animation
  		// to fit the opened popup.
  		autoPan: true,

  		// @option autoPanPaddingTopLeft: Point = null
  		// The margin between the popup and the top left corner of the map
  		// view after autopanning was performed.
  		autoPanPaddingTopLeft: null,

  		// @option autoPanPaddingBottomRight: Point = null
  		// The margin between the popup and the bottom right corner of the map
  		// view after autopanning was performed.
  		autoPanPaddingBottomRight: null,

  		// @option autoPanPadding: Point = Point(5, 5)
  		// Equivalent of setting both top left and bottom right autopan padding to the same value.
  		autoPanPadding: [5, 5],

  		// @option keepInView: Boolean = false
  		// Set it to `true` if you want to prevent users from panning the popup
  		// off of the screen while it is open.
  		keepInView: false,

  		// @option closeButton: Boolean = true
  		// Controls the presence of a close button in the popup.
  		closeButton: true,

  		// @option autoClose: Boolean = true
  		// Set it to `false` if you want to override the default behavior of
  		// the popup closing when another popup is opened.
  		autoClose: true,

  		// @option closeOnEscapeKey: Boolean = true
  		// Set it to `false` if you want to override the default behavior of
  		// the ESC key for closing of the popup.
  		closeOnEscapeKey: true,

  		// @option closeOnClick: Boolean = *
  		// Set it if you want to override the default behavior of the popup closing when user clicks
  		// on the map. Defaults to the map's [`closePopupOnClick`](#map-closepopuponclick) option.

  		// @option className: String = ''
  		// A custom CSS class name to assign to the popup.
  		className: ''
  	},

  	// @namespace Popup
  	// @method openOn(map: Map): this
  	// Alternative to `map.openPopup(popup)`.
  	// Adds the popup to the map and closes the previous one.
  	openOn: function (map) {
  		map = arguments.length ? map : this._source._map; // experimental, not the part of public api

  		if (!map.hasLayer(this) && map._popup && map._popup.options.autoClose) {
  			map.removeLayer(map._popup);
  		}
  		map._popup = this;

  		return DivOverlay.prototype.openOn.call(this, map);
  	},

  	onAdd: function (map) {
  		DivOverlay.prototype.onAdd.call(this, map);

  		// @namespace Map
  		// @section Popup events
  		// @event popupopen: PopupEvent
  		// Fired when a popup is opened in the map
  		map.fire('popupopen', {popup: this});

  		if (this._source) {
  			// @namespace Layer
  			// @section Popup events
  			// @event popupopen: PopupEvent
  			// Fired when a popup bound to this layer is opened
  			this._source.fire('popupopen', {popup: this}, true);
  			// For non-path layers, we toggle the popup when clicking
  			// again the layer, so prevent the map to reopen it.
  			if (!(this._source instanceof Path)) {
  				this._source.on('preclick', stopPropagation);
  			}
  		}
  	},

  	onRemove: function (map) {
  		DivOverlay.prototype.onRemove.call(this, map);

  		// @namespace Map
  		// @section Popup events
  		// @event popupclose: PopupEvent
  		// Fired when a popup in the map is closed
  		map.fire('popupclose', {popup: this});

  		if (this._source) {
  			// @namespace Layer
  			// @section Popup events
  			// @event popupclose: PopupEvent
  			// Fired when a popup bound to this layer is closed
  			this._source.fire('popupclose', {popup: this}, true);
  			if (!(this._source instanceof Path)) {
  				this._source.off('preclick', stopPropagation);
  			}
  		}
  	},

  	getEvents: function () {
  		var events = DivOverlay.prototype.getEvents.call(this);

  		if (this.options.closeOnClick !== undefined ? this.options.closeOnClick : this._map.options.closePopupOnClick) {
  			events.preclick = this.close;
  		}

  		if (this.options.keepInView) {
  			events.moveend = this._adjustPan;
  		}

  		return events;
  	},

  	_initLayout: function () {
  		var prefix = 'leaflet-popup',
  		    container = this._container = create$1('div',
  			prefix + ' ' + (this.options.className || '') +
  			' leaflet-zoom-animated');

  		var wrapper = this._wrapper = create$1('div', prefix + '-content-wrapper', container);
  		this._contentNode = create$1('div', prefix + '-content', wrapper);

  		disableClickPropagation(container);
  		disableScrollPropagation(this._contentNode);
  		on(container, 'contextmenu', stopPropagation);

  		this._tipContainer = create$1('div', prefix + '-tip-container', container);
  		this._tip = create$1('div', prefix + '-tip', this._tipContainer);

  		if (this.options.closeButton) {
  			var closeButton = this._closeButton = create$1('a', prefix + '-close-button', container);
  			closeButton.setAttribute('role', 'button'); // overrides the implicit role=link of <a> elements #7399
  			closeButton.setAttribute('aria-label', 'Close popup');
  			closeButton.href = '#close';
  			closeButton.innerHTML = '<span aria-hidden="true">&#215;</span>';

  			on(closeButton, 'click', function (ev) {
  				preventDefault(ev);
  				this.close();
  			}, this);
  		}
  	},

  	_updateLayout: function () {
  		var container = this._contentNode,
  		    style = container.style;

  		style.width = '';
  		style.whiteSpace = 'nowrap';

  		var width = container.offsetWidth;
  		width = Math.min(width, this.options.maxWidth);
  		width = Math.max(width, this.options.minWidth);

  		style.width = (width + 1) + 'px';
  		style.whiteSpace = '';

  		style.height = '';

  		var height = container.offsetHeight,
  		    maxHeight = this.options.maxHeight,
  		    scrolledClass = 'leaflet-popup-scrolled';

  		if (maxHeight && height > maxHeight) {
  			style.height = maxHeight + 'px';
  			addClass(container, scrolledClass);
  		} else {
  			removeClass(container, scrolledClass);
  		}

  		this._containerWidth = this._container.offsetWidth;
  	},

  	_animateZoom: function (e) {
  		var pos = this._map._latLngToNewLayerPoint(this._latlng, e.zoom, e.center),
  		    anchor = this._getAnchor();
  		setPosition(this._container, pos.add(anchor));
  	},

  	_adjustPan: function () {
  		if (!this.options.autoPan) { return; }
  		if (this._map._panAnim) { this._map._panAnim.stop(); }

  		// We can endlessly recurse if keepInView is set and the view resets.
  		// Let's guard against that by exiting early if we're responding to our own autopan.
  		if (this._autopanning) {
  			this._autopanning = false;
  			return;
  		}

  		var map = this._map,
  		    marginBottom = parseInt(getStyle(this._container, 'marginBottom'), 10) || 0,
  		    containerHeight = this._container.offsetHeight + marginBottom,
  		    containerWidth = this._containerWidth,
  		    layerPos = new Point(this._containerLeft, -containerHeight - this._containerBottom);

  		layerPos._add(getPosition(this._container));

  		var containerPos = map.layerPointToContainerPoint(layerPos),
  		    padding = toPoint(this.options.autoPanPadding),
  		    paddingTL = toPoint(this.options.autoPanPaddingTopLeft || padding),
  		    paddingBR = toPoint(this.options.autoPanPaddingBottomRight || padding),
  		    size = map.getSize(),
  		    dx = 0,
  		    dy = 0;

  		if (containerPos.x + containerWidth + paddingBR.x > size.x) { // right
  			dx = containerPos.x + containerWidth - size.x + paddingBR.x;
  		}
  		if (containerPos.x - dx - paddingTL.x < 0) { // left
  			dx = containerPos.x - paddingTL.x;
  		}
  		if (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom
  			dy = containerPos.y + containerHeight - size.y + paddingBR.y;
  		}
  		if (containerPos.y - dy - paddingTL.y < 0) { // top
  			dy = containerPos.y - paddingTL.y;
  		}

  		// @namespace Map
  		// @section Popup events
  		// @event autopanstart: Event
  		// Fired when the map starts autopanning when opening a popup.
  		if (dx || dy) {
  			// Track that we're autopanning, as this function will be re-ran on moveend
  			if (this.options.keepInView) {
  				this._autopanning = true;
  			}

  			map
  			    .fire('autopanstart')
  			    .panBy([dx, dy]);
  		}
  	},

  	_getAnchor: function () {
  		// Where should we anchor the popup on the source layer?
  		return toPoint(this._source && this._source._getPopupAnchor ? this._source._getPopupAnchor() : [0, 0]);
  	}

  });

  // @namespace Popup
  // @factory L.popup(options?: Popup options, source?: Layer)
  // Instantiates a `Popup` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the popup with a reference to the Layer to which it refers.
  // @alternative
  // @factory L.popup(latlng: LatLng, options?: Popup options)
  // Instantiates a `Popup` object given `latlng` where the popup will open and an optional `options` object that describes its appearance and location.
  var popup = function (options, source) {
  	return new Popup(options, source);
  };


  /* @namespace Map
   * @section Interaction Options
   * @option closePopupOnClick: Boolean = true
   * Set it to `false` if you don't want popups to close when user clicks the map.
   */
  Map.mergeOptions({
  	closePopupOnClick: true
  });


  // @namespace Map
  // @section Methods for Layers and Controls
  Map.include({
  	// @method openPopup(popup: Popup): this
  	// Opens the specified popup while closing the previously opened (to make sure only one is opened at one time for usability).
  	// @alternative
  	// @method openPopup(content: String|HTMLElement, latlng: LatLng, options?: Popup options): this
  	// Creates a popup with the specified content and options and opens it in the given point on a map.
  	openPopup: function (popup, latlng, options) {
  		this._initOverlay(Popup, popup, latlng, options)
  		  .openOn(this);

  		return this;
  	},

  	// @method closePopup(popup?: Popup): this
  	// Closes the popup previously opened with [openPopup](#map-openpopup) (or the given one).
  	closePopup: function (popup) {
  		popup = arguments.length ? popup : this._popup;
  		if (popup) {
  			popup.close();
  		}
  		return this;
  	}
  });

  /*
   * @namespace Layer
   * @section Popup methods example
   *
   * All layers share a set of methods convenient for binding popups to it.
   *
   * ```js
   * var layer = L.Polygon(latlngs).bindPopup('Hi There!').addTo(map);
   * layer.openPopup();
   * layer.closePopup();
   * ```
   *
   * Popups will also be automatically opened when the layer is clicked on and closed when the layer is removed from the map or another popup is opened.
   */

  // @section Popup methods
  Layer.include({

  	// @method bindPopup(content: String|HTMLElement|Function|Popup, options?: Popup options): this
  	// Binds a popup to the layer with the passed `content` and sets up the
  	// necessary event listeners. If a `Function` is passed it will receive
  	// the layer as the first argument and should return a `String` or `HTMLElement`.
  	bindPopup: function (content, options) {
  		this._popup = this._initOverlay(Popup, this._popup, content, options);
  		if (!this._popupHandlersAdded) {
  			this.on({
  				click: this._openPopup,
  				keypress: this._onKeyPress,
  				remove: this.closePopup,
  				move: this._movePopup
  			});
  			this._popupHandlersAdded = true;
  		}

  		return this;
  	},

  	// @method unbindPopup(): this
  	// Removes the popup previously bound with `bindPopup`.
  	unbindPopup: function () {
  		if (this._popup) {
  			this.off({
  				click: this._openPopup,
  				keypress: this._onKeyPress,
  				remove: this.closePopup,
  				move: this._movePopup
  			});
  			this._popupHandlersAdded = false;
  			this._popup = null;
  		}
  		return this;
  	},

  	// @method openPopup(latlng?: LatLng): this
  	// Opens the bound popup at the specified `latlng` or at the default popup anchor if no `latlng` is passed.
  	openPopup: function (latlng) {
  		if (this._popup) {
  			if (!(this instanceof FeatureGroup)) {
  				this._popup._source = this;
  			}
  			if (this._popup._prepareOpen(latlng || this._latlng)) {
  				// open the popup on the map
  				this._popup.openOn(this._map);
  			}
  		}
  		return this;
  	},

  	// @method closePopup(): this
  	// Closes the popup bound to this layer if it is open.
  	closePopup: function () {
  		if (this._popup) {
  			this._popup.close();
  		}
  		return this;
  	},

  	// @method togglePopup(): this
  	// Opens or closes the popup bound to this layer depending on its current state.
  	togglePopup: function () {
  		if (this._popup) {
  			this._popup.toggle(this);
  		}
  		return this;
  	},

  	// @method isPopupOpen(): boolean
  	// Returns `true` if the popup bound to this layer is currently open.
  	isPopupOpen: function () {
  		return (this._popup ? this._popup.isOpen() : false);
  	},

  	// @method setPopupContent(content: String|HTMLElement|Popup): this
  	// Sets the content of the popup bound to this layer.
  	setPopupContent: function (content) {
  		if (this._popup) {
  			this._popup.setContent(content);
  		}
  		return this;
  	},

  	// @method getPopup(): Popup
  	// Returns the popup bound to this layer.
  	getPopup: function () {
  		return this._popup;
  	},

  	_openPopup: function (e) {
  		if (!this._popup || !this._map) {
  			return;
  		}
  		// prevent map click
  		stop(e);

  		var target = e.layer || e.target;
  		if (this._popup._source === target && !(target instanceof Path)) {
  			// treat it like a marker and figure out
  			// if we should toggle it open/closed
  			if (this._map.hasLayer(this._popup)) {
  				this.closePopup();
  			} else {
  				this.openPopup(e.latlng);
  			}
  			return;
  		}
  		this._popup._source = target;
  		this.openPopup(e.latlng);
  	},

  	_movePopup: function (e) {
  		this._popup.setLatLng(e.latlng);
  	},

  	_onKeyPress: function (e) {
  		if (e.originalEvent.keyCode === 13) {
  			this._openPopup(e);
  		}
  	}
  });

  /*
   * @class Tooltip
   * @inherits DivOverlay
   * @aka L.Tooltip
   * Used to display small texts on top of map layers.
   *
   * @example
   * If you want to just bind a tooltip to marker:
   *
   * ```js
   * marker.bindTooltip("my tooltip text").openTooltip();
   * ```
   * Path overlays like polylines also have a `bindTooltip` method.
   *
   * A tooltip can be also standalone:
   *
   * ```js
   * var tooltip = L.tooltip()
   * 	.setLatLng(latlng)
   * 	.setContent('Hello world!<br />This is a nice tooltip.')
   * 	.addTo(map);
   * ```
   * or
   * ```js
   * var tooltip = L.tooltip(latlng, {content: 'Hello world!<br />This is a nice tooltip.'})
   * 	.addTo(map);
   * ```
   *
   *
   * Note about tooltip offset. Leaflet takes two options in consideration
   * for computing tooltip offsetting:
   * - the `offset` Tooltip option: it defaults to [0, 0], and it's specific to one tooltip.
   *   Add a positive x offset to move the tooltip to the right, and a positive y offset to
   *   move it to the bottom. Negatives will move to the left and top.
   * - the `tooltipAnchor` Icon option: this will only be considered for Marker. You
   *   should adapt this value if you use a custom icon.
   */


  // @namespace Tooltip
  var Tooltip = DivOverlay.extend({

  	// @section
  	// @aka Tooltip options
  	options: {
  		// @option pane: String = 'tooltipPane'
  		// `Map pane` where the tooltip will be added.
  		pane: 'tooltipPane',

  		// @option offset: Point = Point(0, 0)
  		// Optional offset of the tooltip position.
  		offset: [0, 0],

  		// @option direction: String = 'auto'
  		// Direction where to open the tooltip. Possible values are: `right`, `left`,
  		// `top`, `bottom`, `center`, `auto`.
  		// `auto` will dynamically switch between `right` and `left` according to the tooltip
  		// position on the map.
  		direction: 'auto',

  		// @option permanent: Boolean = false
  		// Whether to open the tooltip permanently or only on mouseover.
  		permanent: false,

  		// @option sticky: Boolean = false
  		// If true, the tooltip will follow the mouse instead of being fixed at the feature center.
  		sticky: false,

  		// @option opacity: Number = 0.9
  		// Tooltip container opacity.
  		opacity: 0.9
  	},

  	onAdd: function (map) {
  		DivOverlay.prototype.onAdd.call(this, map);
  		this.setOpacity(this.options.opacity);

  		// @namespace Map
  		// @section Tooltip events
  		// @event tooltipopen: TooltipEvent
  		// Fired when a tooltip is opened in the map.
  		map.fire('tooltipopen', {tooltip: this});

  		if (this._source) {
  			this.addEventParent(this._source);

  			// @namespace Layer
  			// @section Tooltip events
  			// @event tooltipopen: TooltipEvent
  			// Fired when a tooltip bound to this layer is opened.
  			this._source.fire('tooltipopen', {tooltip: this}, true);
  		}
  	},

  	onRemove: function (map) {
  		DivOverlay.prototype.onRemove.call(this, map);

  		// @namespace Map
  		// @section Tooltip events
  		// @event tooltipclose: TooltipEvent
  		// Fired when a tooltip in the map is closed.
  		map.fire('tooltipclose', {tooltip: this});

  		if (this._source) {
  			this.removeEventParent(this._source);

  			// @namespace Layer
  			// @section Tooltip events
  			// @event tooltipclose: TooltipEvent
  			// Fired when a tooltip bound to this layer is closed.
  			this._source.fire('tooltipclose', {tooltip: this}, true);
  		}
  	},

  	getEvents: function () {
  		var events = DivOverlay.prototype.getEvents.call(this);

  		if (!this.options.permanent) {
  			events.preclick = this.close;
  		}

  		return events;
  	},

  	_initLayout: function () {
  		var prefix = 'leaflet-tooltip',
  		    className = prefix + ' ' + (this.options.className || '') + ' leaflet-zoom-' + (this._zoomAnimated ? 'animated' : 'hide');

  		this._contentNode = this._container = create$1('div', className);

  		this._container.setAttribute('role', 'tooltip');
  		this._container.setAttribute('id', 'leaflet-tooltip-' + stamp(this));
  	},

  	_updateLayout: function () {},

  	_adjustPan: function () {},

  	_setPosition: function (pos) {
  		var subX, subY,
  		    map = this._map,
  		    container = this._container,
  		    centerPoint = map.latLngToContainerPoint(map.getCenter()),
  		    tooltipPoint = map.layerPointToContainerPoint(pos),
  		    direction = this.options.direction,
  		    tooltipWidth = container.offsetWidth,
  		    tooltipHeight = container.offsetHeight,
  		    offset = toPoint(this.options.offset),
  		    anchor = this._getAnchor();

  		if (direction === 'top') {
  			subX = tooltipWidth / 2;
  			subY = tooltipHeight;
  		} else if (direction === 'bottom') {
  			subX = tooltipWidth / 2;
  			subY = 0;
  		} else if (direction === 'center') {
  			subX = tooltipWidth / 2;
  			subY = tooltipHeight / 2;
  		} else if (direction === 'right') {
  			subX = 0;
  			subY = tooltipHeight / 2;
  		} else if (direction === 'left') {
  			subX = tooltipWidth;
  			subY = tooltipHeight / 2;
  		} else if (tooltipPoint.x < centerPoint.x) {
  			direction = 'right';
  			subX = 0;
  			subY = tooltipHeight / 2;
  		} else {
  			direction = 'left';
  			subX = tooltipWidth + (offset.x + anchor.x) * 2;
  			subY = tooltipHeight / 2;
  		}

  		pos = pos.subtract(toPoint(subX, subY, true)).add(offset).add(anchor);

  		removeClass(container, 'leaflet-tooltip-right');
  		removeClass(container, 'leaflet-tooltip-left');
  		removeClass(container, 'leaflet-tooltip-top');
  		removeClass(container, 'leaflet-tooltip-bottom');
  		addClass(container, 'leaflet-tooltip-' + direction);
  		setPosition(container, pos);
  	},

  	_updatePosition: function () {
  		var pos = this._map.latLngToLayerPoint(this._latlng);
  		this._setPosition(pos);
  	},

  	setOpacity: function (opacity) {
  		this.options.opacity = opacity;

  		if (this._container) {
  			setOpacity(this._container, opacity);
  		}
  	},

  	_animateZoom: function (e) {
  		var pos = this._map._latLngToNewLayerPoint(this._latlng, e.zoom, e.center);
  		this._setPosition(pos);
  	},

  	_getAnchor: function () {
  		// Where should we anchor the tooltip on the source layer?
  		return toPoint(this._source && this._source._getTooltipAnchor && !this.options.sticky ? this._source._getTooltipAnchor() : [0, 0]);
  	}

  });

  // @namespace Tooltip
  // @factory L.tooltip(options?: Tooltip options, source?: Layer)
  // Instantiates a `Tooltip` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the tooltip with a reference to the Layer to which it refers.
  // @alternative
  // @factory L.tooltip(latlng: LatLng, options?: Tooltip options)
  // Instantiates a `Tooltip` object given `latlng` where the tooltip will open and an optional `options` object that describes its appearance and location.
  var tooltip = function (options, source) {
  	return new Tooltip(options, source);
  };

  // @namespace Map
  // @section Methods for Layers and Controls
  Map.include({

  	// @method openTooltip(tooltip: Tooltip): this
  	// Opens the specified tooltip.
  	// @alternative
  	// @method openTooltip(content: String|HTMLElement, latlng: LatLng, options?: Tooltip options): this
  	// Creates a tooltip with the specified content and options and open it.
  	openTooltip: function (tooltip, latlng, options) {
  		this._initOverlay(Tooltip, tooltip, latlng, options)
  		  .openOn(this);

  		return this;
  	},

  	// @method closeTooltip(tooltip: Tooltip): this
  	// Closes the tooltip given as parameter.
  	closeTooltip: function (tooltip) {
  		tooltip.close();
  		return this;
  	}

  });

  /*
   * @namespace Layer
   * @section Tooltip methods example
   *
   * All layers share a set of methods convenient for binding tooltips to it.
   *
   * ```js
   * var layer = L.Polygon(latlngs).bindTooltip('Hi There!').addTo(map);
   * layer.openTooltip();
   * layer.closeTooltip();
   * ```
   */

  // @section Tooltip methods
  Layer.include({

  	// @method bindTooltip(content: String|HTMLElement|Function|Tooltip, options?: Tooltip options): this
  	// Binds a tooltip to the layer with the passed `content` and sets up the
  	// necessary event listeners. If a `Function` is passed it will receive
  	// the layer as the first argument and should return a `String` or `HTMLElement`.
  	bindTooltip: function (content, options) {

  		if (this._tooltip && this.isTooltipOpen()) {
  			this.unbindTooltip();
  		}

  		this._tooltip = this._initOverlay(Tooltip, this._tooltip, content, options);
  		this._initTooltipInteractions();

  		if (this._tooltip.options.permanent && this._map && this._map.hasLayer(this)) {
  			this.openTooltip();
  		}

  		return this;
  	},

  	// @method unbindTooltip(): this
  	// Removes the tooltip previously bound with `bindTooltip`.
  	unbindTooltip: function () {
  		if (this._tooltip) {
  			this._initTooltipInteractions(true);
  			this.closeTooltip();
  			this._tooltip = null;
  		}
  		return this;
  	},

  	_initTooltipInteractions: function (remove) {
  		if (!remove && this._tooltipHandlersAdded) { return; }
  		var onOff = remove ? 'off' : 'on',
  		    events = {
  			remove: this.closeTooltip,
  			move: this._moveTooltip
  		    };
  		if (!this._tooltip.options.permanent) {
  			events.mouseover = this._openTooltip;
  			events.mouseout = this.closeTooltip;
  			events.click = this._openTooltip;
  			if (this._map) {
  				this._addFocusListeners();
  			} else {
  				events.add = this._addFocusListeners;
  			}
  		} else {
  			events.add = this._openTooltip;
  		}
  		if (this._tooltip.options.sticky) {
  			events.mousemove = this._moveTooltip;
  		}
  		this[onOff](events);
  		this._tooltipHandlersAdded = !remove;
  	},

  	// @method openTooltip(latlng?: LatLng): this
  	// Opens the bound tooltip at the specified `latlng` or at the default tooltip anchor if no `latlng` is passed.
  	openTooltip: function (latlng) {
  		if (this._tooltip) {
  			if (!(this instanceof FeatureGroup)) {
  				this._tooltip._source = this;
  			}
  			if (this._tooltip._prepareOpen(latlng)) {
  				// open the tooltip on the map
  				this._tooltip.openOn(this._map);

  				if (this.getElement) {
  					this._setAriaDescribedByOnLayer(this);
  				} else if (this.eachLayer) {
  					this.eachLayer(this._setAriaDescribedByOnLayer, this);
  				}
  			}
  		}
  		return this;
  	},

  	// @method closeTooltip(): this
  	// Closes the tooltip bound to this layer if it is open.
  	closeTooltip: function () {
  		if (this._tooltip) {
  			return this._tooltip.close();
  		}
  	},

  	// @method toggleTooltip(): this
  	// Opens or closes the tooltip bound to this layer depending on its current state.
  	toggleTooltip: function () {
  		if (this._tooltip) {
  			this._tooltip.toggle(this);
  		}
  		return this;
  	},

  	// @method isTooltipOpen(): boolean
  	// Returns `true` if the tooltip bound to this layer is currently open.
  	isTooltipOpen: function () {
  		return this._tooltip.isOpen();
  	},

  	// @method setTooltipContent(content: String|HTMLElement|Tooltip): this
  	// Sets the content of the tooltip bound to this layer.
  	setTooltipContent: function (content) {
  		if (this._tooltip) {
  			this._tooltip.setContent(content);
  		}
  		return this;
  	},

  	// @method getTooltip(): Tooltip
  	// Returns the tooltip bound to this layer.
  	getTooltip: function () {
  		return this._tooltip;
  	},

  	_addFocusListeners: function () {
  		if (this.getElement) {
  			this._addFocusListenersOnLayer(this);
  		} else if (this.eachLayer) {
  			this.eachLayer(this._addFocusListenersOnLayer, this);
  		}
  	},

  	_addFocusListenersOnLayer: function (layer) {
  		var el = typeof layer.getElement === 'function' && layer.getElement();
  		if (el) {
  			on(el, 'focus', function () {
  				this._tooltip._source = layer;
  				this.openTooltip();
  			}, this);
  			on(el, 'blur', this.closeTooltip, this);
  		}
  	},

  	_setAriaDescribedByOnLayer: function (layer) {
  		var el = typeof layer.getElement === 'function' && layer.getElement();
  		if (el) {
  			el.setAttribute('aria-describedby', this._tooltip._container.id);
  		}
  	},


  	_openTooltip: function (e) {
  		if (!this._tooltip || !this._map) {
  			return;
  		}

  		// If the map is moving, we will show the tooltip after it's done.
  		if (this._map.dragging && this._map.dragging.moving() && !this._openOnceFlag) {
  			this._openOnceFlag = true;
  			var that = this;
  			this._map.once('moveend', function () {
  				that._openOnceFlag = false;
  				that._openTooltip(e);
  			});
  			return;
  		}

  		this._tooltip._source = e.layer || e.target;

  		this.openTooltip(this._tooltip.options.sticky ? e.latlng : undefined);
  	},

  	_moveTooltip: function (e) {
  		var latlng = e.latlng, containerPoint, layerPoint;
  		if (this._tooltip.options.sticky && e.originalEvent) {
  			containerPoint = this._map.mouseEventToContainerPoint(e.originalEvent);
  			layerPoint = this._map.containerPointToLayerPoint(containerPoint);
  			latlng = this._map.layerPointToLatLng(layerPoint);
  		}
  		this._tooltip.setLatLng(latlng);
  	}
  });

  /*
   * @class DivIcon
   * @aka L.DivIcon
   * @inherits Icon
   *
   * Represents a lightweight icon for markers that uses a simple `<div>`
   * element instead of an image. Inherits from `Icon` but ignores the `iconUrl` and shadow options.
   *
   * @example
   * ```js
   * var myIcon = L.divIcon({className: 'my-div-icon'});
   * // you can set .my-div-icon styles in CSS
   *
   * L.marker([50.505, 30.57], {icon: myIcon}).addTo(map);
   * ```
   *
   * By default, it has a 'leaflet-div-icon' CSS class and is styled as a little white square with a shadow.
   */

  var DivIcon = Icon.extend({
  	options: {
  		// @section
  		// @aka DivIcon options
  		iconSize: [12, 12], // also can be set through CSS

  		// iconAnchor: (Point),
  		// popupAnchor: (Point),

  		// @option html: String|HTMLElement = ''
  		// Custom HTML code to put inside the div element, empty by default. Alternatively,
  		// an instance of `HTMLElement`.
  		html: false,

  		// @option bgPos: Point = [0, 0]
  		// Optional relative position of the background, in pixels
  		bgPos: null,

  		className: 'leaflet-div-icon'
  	},

  	createIcon: function (oldIcon) {
  		var div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),
  		    options = this.options;

  		if (options.html instanceof Element) {
  			empty(div);
  			div.appendChild(options.html);
  		} else {
  			div.innerHTML = options.html !== false ? options.html : '';
  		}

  		if (options.bgPos) {
  			var bgPos = toPoint(options.bgPos);
  			div.style.backgroundPosition = (-bgPos.x) + 'px ' + (-bgPos.y) + 'px';
  		}
  		this._setIconStyles(div, 'icon');

  		return div;
  	},

  	createShadow: function () {
  		return null;
  	}
  });

  // @factory L.divIcon(options: DivIcon options)
  // Creates a `DivIcon` instance with the given options.
  function divIcon(options) {
  	return new DivIcon(options);
  }

  Icon.Default = IconDefault;

  /*
   * @class GridLayer
   * @inherits Layer
   * @aka L.GridLayer
   *
   * Generic class for handling a tiled grid of HTML elements. This is the base class for all tile layers and replaces `TileLayer.Canvas`.
   * GridLayer can be extended to create a tiled grid of HTML elements like `<canvas>`, `<img>` or `<div>`. GridLayer will handle creating and animating these DOM elements for you.
   *
   *
   * @section Synchronous usage
   * @example
   *
   * To create a custom layer, extend GridLayer and implement the `createTile()` method, which will be passed a `Point` object with the `x`, `y`, and `z` (zoom level) coordinates to draw your tile.
   *
   * ```js
   * var CanvasLayer = L.GridLayer.extend({
   *     createTile: function(coords){
   *         // create a <canvas> element for drawing
   *         var tile = L.DomUtil.create('canvas', 'leaflet-tile');
   *
   *         // setup tile width and height according to the options
   *         var size = this.getTileSize();
   *         tile.width = size.x;
   *         tile.height = size.y;
   *
   *         // get a canvas context and draw something on it using coords.x, coords.y and coords.z
   *         var ctx = tile.getContext('2d');
   *
   *         // return the tile so it can be rendered on screen
   *         return tile;
   *     }
   * });
   * ```
   *
   * @section Asynchronous usage
   * @example
   *
   * Tile creation can also be asynchronous, this is useful when using a third-party drawing library. Once the tile is finished drawing it can be passed to the `done()` callback.
   *
   * ```js
   * var CanvasLayer = L.GridLayer.extend({
   *     createTile: function(coords, done){
   *         var error;
   *
   *         // create a <canvas> element for drawing
   *         var tile = L.DomUtil.create('canvas', 'leaflet-tile');
   *
   *         // setup tile width and height according to the options
   *         var size = this.getTileSize();
   *         tile.width = size.x;
   *         tile.height = size.y;
   *
   *         // draw something asynchronously and pass the tile to the done() callback
   *         setTimeout(function() {
   *             done(error, tile);
   *         }, 1000);
   *
   *         return tile;
   *     }
   * });
   * ```
   *
   * @section
   */


  var GridLayer = Layer.extend({

  	// @section
  	// @aka GridLayer options
  	options: {
  		// @option tileSize: Number|Point = 256
  		// Width and height of tiles in the grid. Use a number if width and height are equal, or `L.point(width, height)` otherwise.
  		tileSize: 256,

  		// @option opacity: Number = 1.0
  		// Opacity of the tiles. Can be used in the `createTile()` function.
  		opacity: 1,

  		// @option updateWhenIdle: Boolean = (depends)
  		// Load new tiles only when panning ends.
  		// `true` by default on mobile browsers, in order to avoid too many requests and keep smooth navigation.
  		// `false` otherwise in order to display new tiles _during_ panning, since it is easy to pan outside the
  		// [`keepBuffer`](#gridlayer-keepbuffer) option in desktop browsers.
  		updateWhenIdle: Browser.mobile,

  		// @option updateWhenZooming: Boolean = true
  		// By default, a smooth zoom animation (during a [touch zoom](#map-touchzoom) or a [`flyTo()`](#map-flyto)) will update grid layers every integer zoom level. Setting this option to `false` will update the grid layer only when the smooth animation ends.
  		updateWhenZooming: true,

  		// @option updateInterval: Number = 200
  		// Tiles will not update more than once every `updateInterval` milliseconds when panning.
  		updateInterval: 200,

  		// @option zIndex: Number = 1
  		// The explicit zIndex of the tile layer.
  		zIndex: 1,

  		// @option bounds: LatLngBounds = undefined
  		// If set, tiles will only be loaded inside the set `LatLngBounds`.
  		bounds: null,

  		// @option minZoom: Number = 0
  		// The minimum zoom level down to which this layer will be displayed (inclusive).
  		minZoom: 0,

  		// @option maxZoom: Number = undefined
  		// The maximum zoom level up to which this layer will be displayed (inclusive).
  		maxZoom: undefined,

  		// @option maxNativeZoom: Number = undefined
  		// Maximum zoom number the tile source has available. If it is specified,
  		// the tiles on all zoom levels higher than `maxNativeZoom` will be loaded
  		// from `maxNativeZoom` level and auto-scaled.
  		maxNativeZoom: undefined,

  		// @option minNativeZoom: Number = undefined
  		// Minimum zoom number the tile source has available. If it is specified,
  		// the tiles on all zoom levels lower than `minNativeZoom` will be loaded
  		// from `minNativeZoom` level and auto-scaled.
  		minNativeZoom: undefined,

  		// @option noWrap: Boolean = false
  		// Whether the layer is wrapped around the antimeridian. If `true`, the
  		// GridLayer will only be displayed once at low zoom levels. Has no
  		// effect when the [map CRS](#map-crs) doesn't wrap around. Can be used
  		// in combination with [`bounds`](#gridlayer-bounds) to prevent requesting
  		// tiles outside the CRS limits.
  		noWrap: false,

  		// @option pane: String = 'tilePane'
  		// `Map pane` where the grid layer will be added.
  		pane: 'tilePane',

  		// @option className: String = ''
  		// A custom class name to assign to the tile layer. Empty by default.
  		className: '',

  		// @option keepBuffer: Number = 2
  		// When panning the map, keep this many rows and columns of tiles before unloading them.
  		keepBuffer: 2
  	},

  	initialize: function (options) {
  		setOptions(this, options);
  	},

  	onAdd: function () {
  		this._initContainer();

  		this._levels = {};
  		this._tiles = {};

  		this._resetView(); // implicit _update() call
  	},

  	beforeAdd: function (map) {
  		map._addZoomLimit(this);
  	},

  	onRemove: function (map) {
  		this._removeAllTiles();
  		remove(this._container);
  		map._removeZoomLimit(this);
  		this._container = null;
  		this._tileZoom = undefined;
  	},

  	// @method bringToFront: this
  	// Brings the tile layer to the top of all tile layers.
  	bringToFront: function () {
  		if (this._map) {
  			toFront(this._container);
  			this._setAutoZIndex(Math.max);
  		}
  		return this;
  	},

  	// @method bringToBack: this
  	// Brings the tile layer to the bottom of all tile layers.
  	bringToBack: function () {
  		if (this._map) {
  			toBack(this._container);
  			this._setAutoZIndex(Math.min);
  		}
  		return this;
  	},

  	// @method getContainer: HTMLElement
  	// Returns the HTML element that contains the tiles for this layer.
  	getContainer: function () {
  		return this._container;
  	},

  	// @method setOpacity(opacity: Number): this
  	// Changes the [opacity](#gridlayer-opacity) of the grid layer.
  	setOpacity: function (opacity) {
  		this.options.opacity = opacity;
  		this._updateOpacity();
  		return this;
  	},

  	// @method setZIndex(zIndex: Number): this
  	// Changes the [zIndex](#gridlayer-zindex) of the grid layer.
  	setZIndex: function (zIndex) {
  		this.options.zIndex = zIndex;
  		this._updateZIndex();

  		return this;
  	},

  	// @method isLoading: Boolean
  	// Returns `true` if any tile in the grid layer has not finished loading.
  	isLoading: function () {
  		return this._loading;
  	},

  	// @method redraw: this
  	// Causes the layer to clear all the tiles and request them again.
  	redraw: function () {
  		if (this._map) {
  			this._removeAllTiles();
  			var tileZoom = this._clampZoom(this._map.getZoom());
  			if (tileZoom !== this._tileZoom) {
  				this._tileZoom = tileZoom;
  				this._updateLevels();
  			}
  			this._update();
  		}
  		return this;
  	},

  	getEvents: function () {
  		var events = {
  			viewprereset: this._invalidateAll,
  			viewreset: this._resetView,
  			zoom: this._resetView,
  			moveend: this._onMoveEnd
  		};

  		if (!this.options.updateWhenIdle) {
  			// update tiles on move, but not more often than once per given interval
  			if (!this._onMove) {
  				this._onMove = throttle(this._onMoveEnd, this.options.updateInterval, this);
  			}

  			events.move = this._onMove;
  		}

  		if (this._zoomAnimated) {
  			events.zoomanim = this._animateZoom;
  		}

  		return events;
  	},

  	// @section Extension methods
  	// Layers extending `GridLayer` shall reimplement the following method.
  	// @method createTile(coords: Object, done?: Function): HTMLElement
  	// Called only internally, must be overridden by classes extending `GridLayer`.
  	// Returns the `HTMLElement` corresponding to the given `coords`. If the `done` callback
  	// is specified, it must be called when the tile has finished loading and drawing.
  	createTile: function () {
  		return document.createElement('div');
  	},

  	// @section
  	// @method getTileSize: Point
  	// Normalizes the [tileSize option](#gridlayer-tilesize) into a point. Used by the `createTile()` method.
  	getTileSize: function () {
  		var s = this.options.tileSize;
  		return s instanceof Point ? s : new Point(s, s);
  	},

  	_updateZIndex: function () {
  		if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {
  			this._container.style.zIndex = this.options.zIndex;
  		}
  	},

  	_setAutoZIndex: function (compare) {
  		// go through all other layers of the same pane, set zIndex to max + 1 (front) or min - 1 (back)

  		var layers = this.getPane().children,
  		    edgeZIndex = -compare(-Infinity, Infinity); // -Infinity for max, Infinity for min

  		for (var i = 0, len = layers.length, zIndex; i < len; i++) {

  			zIndex = layers[i].style.zIndex;

  			if (layers[i] !== this._container && zIndex) {
  				edgeZIndex = compare(edgeZIndex, +zIndex);
  			}
  		}

  		if (isFinite(edgeZIndex)) {
  			this.options.zIndex = edgeZIndex + compare(-1, 1);
  			this._updateZIndex();
  		}
  	},

  	_updateOpacity: function () {
  		if (!this._map) { return; }

  		// IE doesn't inherit filter opacity properly, so we're forced to set it on tiles
  		if (Browser.ielt9) { return; }

  		setOpacity(this._container, this.options.opacity);

  		var now = +new Date(),
  		    nextFrame = false,
  		    willPrune = false;

  		for (var key in this._tiles) {
  			var tile = this._tiles[key];
  			if (!tile.current || !tile.loaded) { continue; }

  			var fade = Math.min(1, (now - tile.loaded) / 200);

  			setOpacity(tile.el, fade);
  			if (fade < 1) {
  				nextFrame = true;
  			} else {
  				if (tile.active) {
  					willPrune = true;
  				} else {
  					this._onOpaqueTile(tile);
  				}
  				tile.active = true;
  			}
  		}

  		if (willPrune && !this._noPrune) { this._pruneTiles(); }

  		if (nextFrame) {
  			cancelAnimFrame(this._fadeFrame);
  			this._fadeFrame = requestAnimFrame(this._updateOpacity, this);
  		}
  	},

  	_onOpaqueTile: falseFn,

  	_initContainer: function () {
  		if (this._container) { return; }

  		this._container = create$1('div', 'leaflet-layer ' + (this.options.className || ''));
  		this._updateZIndex();

  		if (this.options.opacity < 1) {
  			this._updateOpacity();
  		}

  		this.getPane().appendChild(this._container);
  	},

  	_updateLevels: function () {

  		var zoom = this._tileZoom,
  		    maxZoom = this.options.maxZoom;

  		if (zoom === undefined) { return undefined; }

  		for (var z in this._levels) {
  			z = Number(z);
  			if (this._levels[z].el.children.length || z === zoom) {
  				this._levels[z].el.style.zIndex = maxZoom - Math.abs(zoom - z);
  				this._onUpdateLevel(z);
  			} else {
  				remove(this._levels[z].el);
  				this._removeTilesAtZoom(z);
  				this._onRemoveLevel(z);
  				delete this._levels[z];
  			}
  		}

  		var level = this._levels[zoom],
  		    map = this._map;

  		if (!level) {
  			level = this._levels[zoom] = {};

  			level.el = create$1('div', 'leaflet-tile-container leaflet-zoom-animated', this._container);
  			level.el.style.zIndex = maxZoom;

  			level.origin = map.project(map.unproject(map.getPixelOrigin()), zoom).round();
  			level.zoom = zoom;

  			this._setZoomTransform(level, map.getCenter(), map.getZoom());

  			// force the browser to consider the newly added element for transition
  			falseFn(level.el.offsetWidth);

  			this._onCreateLevel(level);
  		}

  		this._level = level;

  		return level;
  	},

  	_onUpdateLevel: falseFn,

  	_onRemoveLevel: falseFn,

  	_onCreateLevel: falseFn,

  	_pruneTiles: function () {
  		if (!this._map) {
  			return;
  		}

  		var key, tile;

  		var zoom = this._map.getZoom();
  		if (zoom > this.options.maxZoom ||
  			zoom < this.options.minZoom) {
  			this._removeAllTiles();
  			return;
  		}

  		for (key in this._tiles) {
  			tile = this._tiles[key];
  			tile.retain = tile.current;
  		}

  		for (key in this._tiles) {
  			tile = this._tiles[key];
  			if (tile.current && !tile.active) {
  				var coords = tile.coords;
  				if (!this._retainParent(coords.x, coords.y, coords.z, coords.z - 5)) {
  					this._retainChildren(coords.x, coords.y, coords.z, coords.z + 2);
  				}
  			}
  		}

  		for (key in this._tiles) {
  			if (!this._tiles[key].retain) {
  				this._removeTile(key);
  			}
  		}
  	},

  	_removeTilesAtZoom: function (zoom) {
  		for (var key in this._tiles) {
  			if (this._tiles[key].coords.z !== zoom) {
  				continue;
  			}
  			this._removeTile(key);
  		}
  	},

  	_removeAllTiles: function () {
  		for (var key in this._tiles) {
  			this._removeTile(key);
  		}
  	},

  	_invalidateAll: function () {
  		for (var z in this._levels) {
  			remove(this._levels[z].el);
  			this._onRemoveLevel(Number(z));
  			delete this._levels[z];
  		}
  		this._removeAllTiles();

  		this._tileZoom = undefined;
  	},

  	_retainParent: function (x, y, z, minZoom) {
  		var x2 = Math.floor(x / 2),
  		    y2 = Math.floor(y / 2),
  		    z2 = z - 1,
  		    coords2 = new Point(+x2, +y2);
  		coords2.z = +z2;

  		var key = this._tileCoordsToKey(coords2),
  		    tile = this._tiles[key];

  		if (tile && tile.active) {
  			tile.retain = true;
  			return true;

  		} else if (tile && tile.loaded) {
  			tile.retain = true;
  		}

  		if (z2 > minZoom) {
  			return this._retainParent(x2, y2, z2, minZoom);
  		}

  		return false;
  	},

  	_retainChildren: function (x, y, z, maxZoom) {

  		for (var i = 2 * x; i < 2 * x + 2; i++) {
  			for (var j = 2 * y; j < 2 * y + 2; j++) {

  				var coords = new Point(i, j);
  				coords.z = z + 1;

  				var key = this._tileCoordsToKey(coords),
  				    tile = this._tiles[key];

  				if (tile && tile.active) {
  					tile.retain = true;
  					continue;

  				} else if (tile && tile.loaded) {
  					tile.retain = true;
  				}

  				if (z + 1 < maxZoom) {
  					this._retainChildren(i, j, z + 1, maxZoom);
  				}
  			}
  		}
  	},

  	_resetView: function (e) {
  		var animating = e && (e.pinch || e.flyTo);
  		this._setView(this._map.getCenter(), this._map.getZoom(), animating, animating);
  	},

  	_animateZoom: function (e) {
  		this._setView(e.center, e.zoom, true, e.noUpdate);
  	},

  	_clampZoom: function (zoom) {
  		var options = this.options;

  		if (undefined !== options.minNativeZoom && zoom < options.minNativeZoom) {
  			return options.minNativeZoom;
  		}

  		if (undefined !== options.maxNativeZoom && options.maxNativeZoom < zoom) {
  			return options.maxNativeZoom;
  		}

  		return zoom;
  	},

  	_setView: function (center, zoom, noPrune, noUpdate) {
  		var tileZoom = Math.round(zoom);
  		if ((this.options.maxZoom !== undefined && tileZoom > this.options.maxZoom) ||
  		    (this.options.minZoom !== undefined && tileZoom < this.options.minZoom)) {
  			tileZoom = undefined;
  		} else {
  			tileZoom = this._clampZoom(tileZoom);
  		}

  		var tileZoomChanged = this.options.updateWhenZooming && (tileZoom !== this._tileZoom);

  		if (!noUpdate || tileZoomChanged) {

  			this._tileZoom = tileZoom;

  			if (this._abortLoading) {
  				this._abortLoading();
  			}

  			this._updateLevels();
  			this._resetGrid();

  			if (tileZoom !== undefined) {
  				this._update(center);
  			}

  			if (!noPrune) {
  				this._pruneTiles();
  			}

  			// Flag to prevent _updateOpacity from pruning tiles during
  			// a zoom anim or a pinch gesture
  			this._noPrune = !!noPrune;
  		}

  		this._setZoomTransforms(center, zoom);
  	},

  	_setZoomTransforms: function (center, zoom) {
  		for (var i in this._levels) {
  			this._setZoomTransform(this._levels[i], center, zoom);
  		}
  	},

  	_setZoomTransform: function (level, center, zoom) {
  		var scale = this._map.getZoomScale(zoom, level.zoom),
  		    translate = level.origin.multiplyBy(scale)
  		        .subtract(this._map._getNewPixelOrigin(center, zoom)).round();

  		if (Browser.any3d) {
  			setTransform(level.el, translate, scale);
  		} else {
  			setPosition(level.el, translate);
  		}
  	},

  	_resetGrid: function () {
  		var map = this._map,
  		    crs = map.options.crs,
  		    tileSize = this._tileSize = this.getTileSize(),
  		    tileZoom = this._tileZoom;

  		var bounds = this._map.getPixelWorldBounds(this._tileZoom);
  		if (bounds) {
  			this._globalTileRange = this._pxBoundsToTileRange(bounds);
  		}

  		this._wrapX = crs.wrapLng && !this.options.noWrap && [
  			Math.floor(map.project([0, crs.wrapLng[0]], tileZoom).x / tileSize.x),
  			Math.ceil(map.project([0, crs.wrapLng[1]], tileZoom).x / tileSize.y)
  		];
  		this._wrapY = crs.wrapLat && !this.options.noWrap && [
  			Math.floor(map.project([crs.wrapLat[0], 0], tileZoom).y / tileSize.x),
  			Math.ceil(map.project([crs.wrapLat[1], 0], tileZoom).y / tileSize.y)
  		];
  	},

  	_onMoveEnd: function () {
  		if (!this._map || this._map._animatingZoom) { return; }

  		this._update();
  	},

  	_getTiledPixelBounds: function (center) {
  		var map = this._map,
  		    mapZoom = map._animatingZoom ? Math.max(map._animateToZoom, map.getZoom()) : map.getZoom(),
  		    scale = map.getZoomScale(mapZoom, this._tileZoom),
  		    pixelCenter = map.project(center, this._tileZoom).floor(),
  		    halfSize = map.getSize().divideBy(scale * 2);

  		return new Bounds(pixelCenter.subtract(halfSize), pixelCenter.add(halfSize));
  	},

  	// Private method to load tiles in the grid's active zoom level according to map bounds
  	_update: function (center) {
  		var map = this._map;
  		if (!map) { return; }
  		var zoom = this._clampZoom(map.getZoom());

  		if (center === undefined) { center = map.getCenter(); }
  		if (this._tileZoom === undefined) { return; }	// if out of minzoom/maxzoom

  		var pixelBounds = this._getTiledPixelBounds(center),
  		    tileRange = this._pxBoundsToTileRange(pixelBounds),
  		    tileCenter = tileRange.getCenter(),
  		    queue = [],
  		    margin = this.options.keepBuffer,
  		    noPruneRange = new Bounds(tileRange.getBottomLeft().subtract([margin, -margin]),
  		                              tileRange.getTopRight().add([margin, -margin]));

  		// Sanity check: panic if the tile range contains Infinity somewhere.
  		if (!(isFinite(tileRange.min.x) &&
  		      isFinite(tileRange.min.y) &&
  		      isFinite(tileRange.max.x) &&
  		      isFinite(tileRange.max.y))) { throw new Error('Attempted to load an infinite number of tiles'); }

  		for (var key in this._tiles) {
  			var c = this._tiles[key].coords;
  			if (c.z !== this._tileZoom || !noPruneRange.contains(new Point(c.x, c.y))) {
  				this._tiles[key].current = false;
  			}
  		}

  		// _update just loads more tiles. If the tile zoom level differs too much
  		// from the map's, let _setView reset levels and prune old tiles.
  		if (Math.abs(zoom - this._tileZoom) > 1) { this._setView(center, zoom); return; }

  		// create a queue of coordinates to load tiles from
  		for (var j = tileRange.min.y; j <= tileRange.max.y; j++) {
  			for (var i = tileRange.min.x; i <= tileRange.max.x; i++) {
  				var coords = new Point(i, j);
  				coords.z = this._tileZoom;

  				if (!this._isValidTile(coords)) { continue; }

  				var tile = this._tiles[this._tileCoordsToKey(coords)];
  				if (tile) {
  					tile.current = true;
  				} else {
  					queue.push(coords);
  				}
  			}
  		}

  		// sort tile queue to load tiles in order of their distance to center
  		queue.sort(function (a, b) {
  			return a.distanceTo(tileCenter) - b.distanceTo(tileCenter);
  		});

  		if (queue.length !== 0) {
  			// if it's the first batch of tiles to load
  			if (!this._loading) {
  				this._loading = true;
  				// @event loading: Event
  				// Fired when the grid layer starts loading tiles.
  				this.fire('loading');
  			}

  			// create DOM fragment to append tiles in one batch
  			var fragment = document.createDocumentFragment();

  			for (i = 0; i < queue.length; i++) {
  				this._addTile(queue[i], fragment);
  			}

  			this._level.el.appendChild(fragment);
  		}
  	},

  	_isValidTile: function (coords) {
  		var crs = this._map.options.crs;

  		if (!crs.infinite) {
  			// don't load tile if it's out of bounds and not wrapped
  			var bounds = this._globalTileRange;
  			if ((!crs.wrapLng && (coords.x < bounds.min.x || coords.x > bounds.max.x)) ||
  			    (!crs.wrapLat && (coords.y < bounds.min.y || coords.y > bounds.max.y))) { return false; }
  		}

  		if (!this.options.bounds) { return true; }

  		// don't load tile if it doesn't intersect the bounds in options
  		var tileBounds = this._tileCoordsToBounds(coords);
  		return toLatLngBounds(this.options.bounds).overlaps(tileBounds);
  	},

  	_keyToBounds: function (key) {
  		return this._tileCoordsToBounds(this._keyToTileCoords(key));
  	},

  	_tileCoordsToNwSe: function (coords) {
  		var map = this._map,
  		    tileSize = this.getTileSize(),
  		    nwPoint = coords.scaleBy(tileSize),
  		    sePoint = nwPoint.add(tileSize),
  		    nw = map.unproject(nwPoint, coords.z),
  		    se = map.unproject(sePoint, coords.z);
  		return [nw, se];
  	},

  	// converts tile coordinates to its geographical bounds
  	_tileCoordsToBounds: function (coords) {
  		var bp = this._tileCoordsToNwSe(coords),
  		    bounds = new LatLngBounds(bp[0], bp[1]);

  		if (!this.options.noWrap) {
  			bounds = this._map.wrapLatLngBounds(bounds);
  		}
  		return bounds;
  	},
  	// converts tile coordinates to key for the tile cache
  	_tileCoordsToKey: function (coords) {
  		return coords.x + ':' + coords.y + ':' + coords.z;
  	},

  	// converts tile cache key to coordinates
  	_keyToTileCoords: function (key) {
  		var k = key.split(':'),
  		    coords = new Point(+k[0], +k[1]);
  		coords.z = +k[2];
  		return coords;
  	},

  	_removeTile: function (key) {
  		var tile = this._tiles[key];
  		if (!tile) { return; }

  		remove(tile.el);

  		delete this._tiles[key];

  		// @event tileunload: TileEvent
  		// Fired when a tile is removed (e.g. when a tile goes off the screen).
  		this.fire('tileunload', {
  			tile: tile.el,
  			coords: this._keyToTileCoords(key)
  		});
  	},

  	_initTile: function (tile) {
  		addClass(tile, 'leaflet-tile');

  		var tileSize = this.getTileSize();
  		tile.style.width = tileSize.x + 'px';
  		tile.style.height = tileSize.y + 'px';

  		tile.onselectstart = falseFn;
  		tile.onmousemove = falseFn;

  		// update opacity on tiles in IE7-8 because of filter inheritance problems
  		if (Browser.ielt9 && this.options.opacity < 1) {
  			setOpacity(tile, this.options.opacity);
  		}
  	},

  	_addTile: function (coords, container) {
  		var tilePos = this._getTilePos(coords),
  		    key = this._tileCoordsToKey(coords);

  		var tile = this.createTile(this._wrapCoords(coords), bind(this._tileReady, this, coords));

  		this._initTile(tile);

  		// if createTile is defined with a second argument ("done" callback),
  		// we know that tile is async and will be ready later; otherwise
  		if (this.createTile.length < 2) {
  			// mark tile as ready, but delay one frame for opacity animation to happen
  			requestAnimFrame(bind(this._tileReady, this, coords, null, tile));
  		}

  		setPosition(tile, tilePos);

  		// save tile in cache
  		this._tiles[key] = {
  			el: tile,
  			coords: coords,
  			current: true
  		};

  		container.appendChild(tile);
  		// @event tileloadstart: TileEvent
  		// Fired when a tile is requested and starts loading.
  		this.fire('tileloadstart', {
  			tile: tile,
  			coords: coords
  		});
  	},

  	_tileReady: function (coords, err, tile) {
  		if (err) {
  			// @event tileerror: TileErrorEvent
  			// Fired when there is an error loading a tile.
  			this.fire('tileerror', {
  				error: err,
  				tile: tile,
  				coords: coords
  			});
  		}

  		var key = this._tileCoordsToKey(coords);

  		tile = this._tiles[key];
  		if (!tile) { return; }

  		tile.loaded = +new Date();
  		if (this._map._fadeAnimated) {
  			setOpacity(tile.el, 0);
  			cancelAnimFrame(this._fadeFrame);
  			this._fadeFrame = requestAnimFrame(this._updateOpacity, this);
  		} else {
  			tile.active = true;
  			this._pruneTiles();
  		}

  		if (!err) {
  			addClass(tile.el, 'leaflet-tile-loaded');

  			// @event tileload: TileEvent
  			// Fired when a tile loads.
  			this.fire('tileload', {
  				tile: tile.el,
  				coords: coords
  			});
  		}

  		if (this._noTilesToLoad()) {
  			this._loading = false;
  			// @event load: Event
  			// Fired when the grid layer loaded all visible tiles.
  			this.fire('load');

  			if (Browser.ielt9 || !this._map._fadeAnimated) {
  				requestAnimFrame(this._pruneTiles, this);
  			} else {
  				// Wait a bit more than 0.2 secs (the duration of the tile fade-in)
  				// to trigger a pruning.
  				setTimeout(bind(this._pruneTiles, this), 250);
  			}
  		}
  	},

  	_getTilePos: function (coords) {
  		return coords.scaleBy(this.getTileSize()).subtract(this._level.origin);
  	},

  	_wrapCoords: function (coords) {
  		var newCoords = new Point(
  			this._wrapX ? wrapNum(coords.x, this._wrapX) : coords.x,
  			this._wrapY ? wrapNum(coords.y, this._wrapY) : coords.y);
  		newCoords.z = coords.z;
  		return newCoords;
  	},

  	_pxBoundsToTileRange: function (bounds) {
  		var tileSize = this.getTileSize();
  		return new Bounds(
  			bounds.min.unscaleBy(tileSize).floor(),
  			bounds.max.unscaleBy(tileSize).ceil().subtract([1, 1]));
  	},

  	_noTilesToLoad: function () {
  		for (var key in this._tiles) {
  			if (!this._tiles[key].loaded) { return false; }
  		}
  		return true;
  	}
  });

  // @factory L.gridLayer(options?: GridLayer options)
  // Creates a new instance of GridLayer with the supplied options.
  function gridLayer(options) {
  	return new GridLayer(options);
  }

  /*
   * @class TileLayer
   * @inherits GridLayer
   * @aka L.TileLayer
   * Used to load and display tile layers on the map. Note that most tile servers require attribution, which you can set under `Layer`. Extends `GridLayer`.
   *
   * @example
   *
   * ```js
   * L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', {foo: 'bar', attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);
   * ```
   *
   * @section URL template
   * @example
   *
   * A string of the following form:
   *
   * ```
   * 'https://{s}.somedomain.com/blabla/{z}/{x}/{y}{r}.png'
   * ```
   *
   * `{s}` means one of the available subdomains (used sequentially to help with browser parallel requests per domain limitation; subdomain values are specified in options; `a`, `b` or `c` by default, can be omitted), `{z}` — zoom level, `{x}` and `{y}` — tile coordinates. `{r}` can be used to add "&commat;2x" to the URL to load retina tiles.
   *
   * You can use custom keys in the template, which will be [evaluated](#util-template) from TileLayer options, like this:
   *
   * ```
   * L.tileLayer('https://{s}.somedomain.com/{foo}/{z}/{x}/{y}.png', {foo: 'bar'});
   * ```
   */


  var TileLayer = GridLayer.extend({

  	// @section
  	// @aka TileLayer options
  	options: {
  		// @option minZoom: Number = 0
  		// The minimum zoom level down to which this layer will be displayed (inclusive).
  		minZoom: 0,

  		// @option maxZoom: Number = 18
  		// The maximum zoom level up to which this layer will be displayed (inclusive).
  		maxZoom: 18,

  		// @option subdomains: String|String[] = 'abc'
  		// Subdomains of the tile service. Can be passed in the form of one string (where each letter is a subdomain name) or an array of strings.
  		subdomains: 'abc',

  		// @option errorTileUrl: String = ''
  		// URL to the tile image to show in place of the tile that failed to load.
  		errorTileUrl: '',

  		// @option zoomOffset: Number = 0
  		// The zoom number used in tile URLs will be offset with this value.
  		zoomOffset: 0,

  		// @option tms: Boolean = false
  		// If `true`, inverses Y axis numbering for tiles (turn this on for [TMS](https://en.wikipedia.org/wiki/Tile_Map_Service) services).
  		tms: false,

  		// @option zoomReverse: Boolean = false
  		// If set to true, the zoom number used in tile URLs will be reversed (`maxZoom - zoom` instead of `zoom`)
  		zoomReverse: false,

  		// @option detectRetina: Boolean = false
  		// If `true` and user is on a retina display, it will request four tiles of half the specified size and a bigger zoom level in place of one to utilize the high resolution.
  		detectRetina: false,

  		// @option crossOrigin: Boolean|String = false
  		// Whether the crossOrigin attribute will be added to the tiles.
  		// If a String is provided, all tiles will have their crossOrigin attribute set to the String provided. This is needed if you want to access tile pixel data.
  		// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.
  		crossOrigin: false,

  		// @option referrerPolicy: Boolean|String = false
  		// Whether the referrerPolicy attribute will be added to the tiles.
  		// If a String is provided, all tiles will have their referrerPolicy attribute set to the String provided.
  		// This may be needed if your map's rendering context has a strict default but your tile provider expects a valid referrer
  		// (e.g. to validate an API token).
  		// Refer to [HTMLImageElement.referrerPolicy](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/referrerPolicy) for valid String values.
  		referrerPolicy: false
  	},

  	initialize: function (url, options) {

  		this._url = url;

  		options = setOptions(this, options);

  		// detecting retina displays, adjusting tileSize and zoom levels
  		if (options.detectRetina && Browser.retina && options.maxZoom > 0) {

  			options.tileSize = Math.floor(options.tileSize / 2);

  			if (!options.zoomReverse) {
  				options.zoomOffset++;
  				options.maxZoom = Math.max(options.minZoom, options.maxZoom - 1);
  			} else {
  				options.zoomOffset--;
  				options.minZoom = Math.min(options.maxZoom, options.minZoom + 1);
  			}

  			options.minZoom = Math.max(0, options.minZoom);
  		} else if (!options.zoomReverse) {
  			// make sure maxZoom is gte minZoom
  			options.maxZoom = Math.max(options.minZoom, options.maxZoom);
  		} else {
  			// make sure minZoom is lte maxZoom
  			options.minZoom = Math.min(options.maxZoom, options.minZoom);
  		}

  		if (typeof options.subdomains === 'string') {
  			options.subdomains = options.subdomains.split('');
  		}

  		this.on('tileunload', this._onTileRemove);
  	},

  	// @method setUrl(url: String, noRedraw?: Boolean): this
  	// Updates the layer's URL template and redraws it (unless `noRedraw` is set to `true`).
  	// If the URL does not change, the layer will not be redrawn unless
  	// the noRedraw parameter is set to false.
  	setUrl: function (url, noRedraw) {
  		if (this._url === url && noRedraw === undefined) {
  			noRedraw = true;
  		}

  		this._url = url;

  		if (!noRedraw) {
  			this.redraw();
  		}
  		return this;
  	},

  	// @method createTile(coords: Object, done?: Function): HTMLElement
  	// Called only internally, overrides GridLayer's [`createTile()`](#gridlayer-createtile)
  	// to return an `<img>` HTML element with the appropriate image URL given `coords`. The `done`
  	// callback is called when the tile has been loaded.
  	createTile: function (coords, done) {
  		var tile = document.createElement('img');

  		on(tile, 'load', bind(this._tileOnLoad, this, done, tile));
  		on(tile, 'error', bind(this._tileOnError, this, done, tile));

  		if (this.options.crossOrigin || this.options.crossOrigin === '') {
  			tile.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;
  		}

  		// for this new option we follow the documented behavior
  		// more closely by only setting the property when string
  		if (typeof this.options.referrerPolicy === 'string') {
  			tile.referrerPolicy = this.options.referrerPolicy;
  		}

  		// The alt attribute is set to the empty string,
  		// allowing screen readers to ignore the decorative image tiles.
  		// https://www.w3.org/WAI/tutorials/images/decorative/
  		// https://www.w3.org/TR/html-aria/#el-img-empty-alt
  		tile.alt = '';

  		tile.src = this.getTileUrl(coords);

  		return tile;
  	},

  	// @section Extension methods
  	// @uninheritable
  	// Layers extending `TileLayer` might reimplement the following method.
  	// @method getTileUrl(coords: Object): String
  	// Called only internally, returns the URL for a tile given its coordinates.
  	// Classes extending `TileLayer` can override this function to provide custom tile URL naming schemes.
  	getTileUrl: function (coords) {
  		var data = {
  			r: Browser.retina ? '@2x' : '',
  			s: this._getSubdomain(coords),
  			x: coords.x,
  			y: coords.y,
  			z: this._getZoomForUrl()
  		};
  		if (this._map && !this._map.options.crs.infinite) {
  			var invertedY = this._globalTileRange.max.y - coords.y;
  			if (this.options.tms) {
  				data['y'] = invertedY;
  			}
  			data['-y'] = invertedY;
  		}

  		return template(this._url, extend(data, this.options));
  	},

  	_tileOnLoad: function (done, tile) {
  		// For https://github.com/Leaflet/Leaflet/issues/3332
  		if (Browser.ielt9) {
  			setTimeout(bind(done, this, null, tile), 0);
  		} else {
  			done(null, tile);
  		}
  	},

  	_tileOnError: function (done, tile, e) {
  		var errorUrl = this.options.errorTileUrl;
  		if (errorUrl && tile.getAttribute('src') !== errorUrl) {
  			tile.src = errorUrl;
  		}
  		done(e, tile);
  	},

  	_onTileRemove: function (e) {
  		e.tile.onload = null;
  	},

  	_getZoomForUrl: function () {
  		var zoom = this._tileZoom,
  		maxZoom = this.options.maxZoom,
  		zoomReverse = this.options.zoomReverse,
  		zoomOffset = this.options.zoomOffset;

  		if (zoomReverse) {
  			zoom = maxZoom - zoom;
  		}

  		return zoom + zoomOffset;
  	},

  	_getSubdomain: function (tilePoint) {
  		var index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;
  		return this.options.subdomains[index];
  	},

  	// stops loading all tiles in the background layer
  	_abortLoading: function () {
  		var i, tile;
  		for (i in this._tiles) {
  			if (this._tiles[i].coords.z !== this._tileZoom) {
  				tile = this._tiles[i].el;

  				tile.onload = falseFn;
  				tile.onerror = falseFn;

  				if (!tile.complete) {
  					tile.src = emptyImageUrl;
  					var coords = this._tiles[i].coords;
  					remove(tile);
  					delete this._tiles[i];
  					// @event tileabort: TileEvent
  					// Fired when a tile was loading but is now not wanted.
  					this.fire('tileabort', {
  						tile: tile,
  						coords: coords
  					});
  				}
  			}
  		}
  	},

  	_removeTile: function (key) {
  		var tile = this._tiles[key];
  		if (!tile) { return; }

  		// Cancels any pending http requests associated with the tile
  		tile.el.setAttribute('src', emptyImageUrl);

  		return GridLayer.prototype._removeTile.call(this, key);
  	},

  	_tileReady: function (coords, err, tile) {
  		if (!this._map || (tile && tile.getAttribute('src') === emptyImageUrl)) {
  			return;
  		}

  		return GridLayer.prototype._tileReady.call(this, coords, err, tile);
  	}
  });


  // @factory L.tilelayer(urlTemplate: String, options?: TileLayer options)
  // Instantiates a tile layer object given a `URL template` and optionally an options object.

  function tileLayer(url, options) {
  	return new TileLayer(url, options);
  }

  /*
   * @class TileLayer.WMS
   * @inherits TileLayer
   * @aka L.TileLayer.WMS
   * Used to display [WMS](https://en.wikipedia.org/wiki/Web_Map_Service) services as tile layers on the map. Extends `TileLayer`.
   *
   * @example
   *
   * ```js
   * var nexrad = L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
   * 	layers: 'nexrad-n0r-900913',
   * 	format: 'image/png',
   * 	transparent: true,
   * 	attribution: "Weather data © 2012 IEM Nexrad"
   * });
   * ```
   */

  var TileLayerWMS = TileLayer.extend({

  	// @section
  	// @aka TileLayer.WMS options
  	// If any custom options not documented here are used, they will be sent to the
  	// WMS server as extra parameters in each request URL. This can be useful for
  	// [non-standard vendor WMS parameters](https://docs.geoserver.org/stable/en/user/services/wms/vendor.html).
  	defaultWmsParams: {
  		service: 'WMS',
  		request: 'GetMap',

  		// @option layers: String = ''
  		// **(required)** Comma-separated list of WMS layers to show.
  		layers: '',

  		// @option styles: String = ''
  		// Comma-separated list of WMS styles.
  		styles: '',

  		// @option format: String = 'image/jpeg'
  		// WMS image format (use `'image/png'` for layers with transparency).
  		format: 'image/jpeg',

  		// @option transparent: Boolean = false
  		// If `true`, the WMS service will return images with transparency.
  		transparent: false,

  		// @option version: String = '1.1.1'
  		// Version of the WMS service to use
  		version: '1.1.1'
  	},

  	options: {
  		// @option crs: CRS = null
  		// Coordinate Reference System to use for the WMS requests, defaults to
  		// map CRS. Don't change this if you're not sure what it means.
  		crs: null,

  		// @option uppercase: Boolean = false
  		// If `true`, WMS request parameter keys will be uppercase.
  		uppercase: false
  	},

  	initialize: function (url, options) {

  		this._url = url;

  		var wmsParams = extend({}, this.defaultWmsParams);

  		// all keys that are not TileLayer options go to WMS params
  		for (var i in options) {
  			if (!(i in this.options)) {
  				wmsParams[i] = options[i];
  			}
  		}

  		options = setOptions(this, options);

  		var realRetina = options.detectRetina && Browser.retina ? 2 : 1;
  		var tileSize = this.getTileSize();
  		wmsParams.width = tileSize.x * realRetina;
  		wmsParams.height = tileSize.y * realRetina;

  		this.wmsParams = wmsParams;
  	},

  	onAdd: function (map) {

  		this._crs = this.options.crs || map.options.crs;
  		this._wmsVersion = parseFloat(this.wmsParams.version);

  		var projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';
  		this.wmsParams[projectionKey] = this._crs.code;

  		TileLayer.prototype.onAdd.call(this, map);
  	},

  	getTileUrl: function (coords) {

  		var tileBounds = this._tileCoordsToNwSe(coords),
  		    crs = this._crs,
  		    bounds = toBounds(crs.project(tileBounds[0]), crs.project(tileBounds[1])),
  		    min = bounds.min,
  		    max = bounds.max,
  		    bbox = (this._wmsVersion >= 1.3 && this._crs === EPSG4326 ?
  		    [min.y, min.x, max.y, max.x] :
  		    [min.x, min.y, max.x, max.y]).join(','),
  		    url = TileLayer.prototype.getTileUrl.call(this, coords);
  		return url +
  			getParamString(this.wmsParams, url, this.options.uppercase) +
  			(this.options.uppercase ? '&BBOX=' : '&bbox=') + bbox;
  	},

  	// @method setParams(params: Object, noRedraw?: Boolean): this
  	// Merges an object with the new parameters and re-requests tiles on the current screen (unless `noRedraw` was set to true).
  	setParams: function (params, noRedraw) {

  		extend(this.wmsParams, params);

  		if (!noRedraw) {
  			this.redraw();
  		}

  		return this;
  	}
  });


  // @factory L.tileLayer.wms(baseUrl: String, options: TileLayer.WMS options)
  // Instantiates a WMS tile layer object given a base URL of the WMS service and a WMS parameters/options object.
  function tileLayerWMS(url, options) {
  	return new TileLayerWMS(url, options);
  }

  TileLayer.WMS = TileLayerWMS;
  tileLayer.wms = tileLayerWMS;

  /*
   * @class Renderer
   * @inherits Layer
   * @aka L.Renderer
   *
   * Base class for vector renderer implementations (`SVG`, `Canvas`). Handles the
   * DOM container of the renderer, its bounds, and its zoom animation.
   *
   * A `Renderer` works as an implicit layer group for all `Path`s - the renderer
   * itself can be added or removed to the map. All paths use a renderer, which can
   * be implicit (the map will decide the type of renderer and use it automatically)
   * or explicit (using the [`renderer`](#path-renderer) option of the path).
   *
   * Do not use this class directly, use `SVG` and `Canvas` instead.
   *
   * @event update: Event
   * Fired when the renderer updates its bounds, center and zoom, for example when
   * its map has moved
   */

  var Renderer = Layer.extend({

  	// @section
  	// @aka Renderer options
  	options: {
  		// @option padding: Number = 0.1
  		// How much to extend the clip area around the map view (relative to its size)
  		// e.g. 0.1 would be 10% of map view in each direction
  		padding: 0.1
  	},

  	initialize: function (options) {
  		setOptions(this, options);
  		stamp(this);
  		this._layers = this._layers || {};
  	},

  	onAdd: function () {
  		if (!this._container) {
  			this._initContainer(); // defined by renderer implementations

  			// always keep transform-origin as 0 0
  			addClass(this._container, 'leaflet-zoom-animated');
  		}

  		this.getPane().appendChild(this._container);
  		this._update();
  		this.on('update', this._updatePaths, this);
  	},

  	onRemove: function () {
  		this.off('update', this._updatePaths, this);
  		this._destroyContainer();
  	},

  	getEvents: function () {
  		var events = {
  			viewreset: this._reset,
  			zoom: this._onZoom,
  			moveend: this._update,
  			zoomend: this._onZoomEnd
  		};
  		if (this._zoomAnimated) {
  			events.zoomanim = this._onAnimZoom;
  		}
  		return events;
  	},

  	_onAnimZoom: function (ev) {
  		this._updateTransform(ev.center, ev.zoom);
  	},

  	_onZoom: function () {
  		this._updateTransform(this._map.getCenter(), this._map.getZoom());
  	},

  	_updateTransform: function (center, zoom) {
  		var scale = this._map.getZoomScale(zoom, this._zoom),
  		    viewHalf = this._map.getSize().multiplyBy(0.5 + this.options.padding),
  		    currentCenterPoint = this._map.project(this._center, zoom),

  		    topLeftOffset = viewHalf.multiplyBy(-scale).add(currentCenterPoint)
  				  .subtract(this._map._getNewPixelOrigin(center, zoom));

  		if (Browser.any3d) {
  			setTransform(this._container, topLeftOffset, scale);
  		} else {
  			setPosition(this._container, topLeftOffset);
  		}
  	},

  	_reset: function () {
  		this._update();
  		this._updateTransform(this._center, this._zoom);

  		for (var id in this._layers) {
  			this._layers[id]._reset();
  		}
  	},

  	_onZoomEnd: function () {
  		for (var id in this._layers) {
  			this._layers[id]._project();
  		}
  	},

  	_updatePaths: function () {
  		for (var id in this._layers) {
  			this._layers[id]._update();
  		}
  	},

  	_update: function () {
  		// Update pixel bounds of renderer container (for positioning/sizing/clipping later)
  		// Subclasses are responsible of firing the 'update' event.
  		var p = this.options.padding,
  		    size = this._map.getSize(),
  		    min = this._map.containerPointToLayerPoint(size.multiplyBy(-p)).round();

  		this._bounds = new Bounds(min, min.add(size.multiplyBy(1 + p * 2)).round());

  		this._center = this._map.getCenter();
  		this._zoom = this._map.getZoom();
  	}
  });

  /*
   * @class Canvas
   * @inherits Renderer
   * @aka L.Canvas
   *
   * Allows vector layers to be displayed with [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).
   * Inherits `Renderer`.
   *
   * Due to [technical limitations](https://caniuse.com/canvas), Canvas is not
   * available in all web browsers, notably IE8, and overlapping geometries might
   * not display properly in some edge cases.
   *
   * @example
   *
   * Use Canvas by default for all paths in the map:
   *
   * ```js
   * var map = L.map('map', {
   * 	renderer: L.canvas()
   * });
   * ```
   *
   * Use a Canvas renderer with extra padding for specific vector geometries:
   *
   * ```js
   * var map = L.map('map');
   * var myRenderer = L.canvas({ padding: 0.5 });
   * var line = L.polyline( coordinates, { renderer: myRenderer } );
   * var circle = L.circle( center, { renderer: myRenderer } );
   * ```
   */

  var Canvas = Renderer.extend({

  	// @section
  	// @aka Canvas options
  	options: {
  		// @option tolerance: Number = 0
  		// How much to extend the click tolerance around a path/object on the map.
  		tolerance: 0
  	},

  	getEvents: function () {
  		var events = Renderer.prototype.getEvents.call(this);
  		events.viewprereset = this._onViewPreReset;
  		return events;
  	},

  	_onViewPreReset: function () {
  		// Set a flag so that a viewprereset+moveend+viewreset only updates&redraws once
  		this._postponeUpdatePaths = true;
  	},

  	onAdd: function () {
  		Renderer.prototype.onAdd.call(this);

  		// Redraw vectors since canvas is cleared upon removal,
  		// in case of removing the renderer itself from the map.
  		this._draw();
  	},

  	_initContainer: function () {
  		var container = this._container = document.createElement('canvas');

  		on(container, 'mousemove', this._onMouseMove, this);
  		on(container, 'click dblclick mousedown mouseup contextmenu', this._onClick, this);
  		on(container, 'mouseout', this._handleMouseOut, this);
  		container['_leaflet_disable_events'] = true;

  		this._ctx = container.getContext('2d');
  	},

  	_destroyContainer: function () {
  		cancelAnimFrame(this._redrawRequest);
  		delete this._ctx;
  		remove(this._container);
  		off(this._container);
  		delete this._container;
  	},

  	_updatePaths: function () {
  		if (this._postponeUpdatePaths) { return; }

  		var layer;
  		this._redrawBounds = null;
  		for (var id in this._layers) {
  			layer = this._layers[id];
  			layer._update();
  		}
  		this._redraw();
  	},

  	_update: function () {
  		if (this._map._animatingZoom && this._bounds) { return; }

  		Renderer.prototype._update.call(this);

  		var b = this._bounds,
  		    container = this._container,
  		    size = b.getSize(),
  		    m = Browser.retina ? 2 : 1;

  		setPosition(container, b.min);

  		// set canvas size (also clearing it); use double size on retina
  		container.width = m * size.x;
  		container.height = m * size.y;
  		container.style.width = size.x + 'px';
  		container.style.height = size.y + 'px';

  		if (Browser.retina) {
  			this._ctx.scale(2, 2);
  		}

  		// translate so we use the same path coordinates after canvas element moves
  		this._ctx.translate(-b.min.x, -b.min.y);

  		// Tell paths to redraw themselves
  		this.fire('update');
  	},

  	_reset: function () {
  		Renderer.prototype._reset.call(this);

  		if (this._postponeUpdatePaths) {
  			this._postponeUpdatePaths = false;
  			this._updatePaths();
  		}
  	},

  	_initPath: function (layer) {
  		this._updateDashArray(layer);
  		this._layers[stamp(layer)] = layer;

  		var order = layer._order = {
  			layer: layer,
  			prev: this._drawLast,
  			next: null
  		};
  		if (this._drawLast) { this._drawLast.next = order; }
  		this._drawLast = order;
  		this._drawFirst = this._drawFirst || this._drawLast;
  	},

  	_addPath: function (layer) {
  		this._requestRedraw(layer);
  	},

  	_removePath: function (layer) {
  		var order = layer._order;
  		var next = order.next;
  		var prev = order.prev;

  		if (next) {
  			next.prev = prev;
  		} else {
  			this._drawLast = prev;
  		}
  		if (prev) {
  			prev.next = next;
  		} else {
  			this._drawFirst = next;
  		}

  		delete layer._order;

  		delete this._layers[stamp(layer)];

  		this._requestRedraw(layer);
  	},

  	_updatePath: function (layer) {
  		// Redraw the union of the layer's old pixel
  		// bounds and the new pixel bounds.
  		this._extendRedrawBounds(layer);
  		layer._project();
  		layer._update();
  		// The redraw will extend the redraw bounds
  		// with the new pixel bounds.
  		this._requestRedraw(layer);
  	},

  	_updateStyle: function (layer) {
  		this._updateDashArray(layer);
  		this._requestRedraw(layer);
  	},

  	_updateDashArray: function (layer) {
  		if (typeof layer.options.dashArray === 'string') {
  			var parts = layer.options.dashArray.split(/[, ]+/),
  			    dashArray = [],
  			    dashValue,
  			    i;
  			for (i = 0; i < parts.length; i++) {
  				dashValue = Number(parts[i]);
  				// Ignore dash array containing invalid lengths
  				if (isNaN(dashValue)) { return; }
  				dashArray.push(dashValue);
  			}
  			layer.options._dashArray = dashArray;
  		} else {
  			layer.options._dashArray = layer.options.dashArray;
  		}
  	},

  	_requestRedraw: function (layer) {
  		if (!this._map) { return; }

  		this._extendRedrawBounds(layer);
  		this._redrawRequest = this._redrawRequest || requestAnimFrame(this._redraw, this);
  	},

  	_extendRedrawBounds: function (layer) {
  		if (layer._pxBounds) {
  			var padding = (layer.options.weight || 0) + 1;
  			this._redrawBounds = this._redrawBounds || new Bounds();
  			this._redrawBounds.extend(layer._pxBounds.min.subtract([padding, padding]));
  			this._redrawBounds.extend(layer._pxBounds.max.add([padding, padding]));
  		}
  	},

  	_redraw: function () {
  		this._redrawRequest = null;

  		if (this._redrawBounds) {
  			this._redrawBounds.min._floor();
  			this._redrawBounds.max._ceil();
  		}

  		this._clear(); // clear layers in redraw bounds
  		this._draw(); // draw layers

  		this._redrawBounds = null;
  	},

  	_clear: function () {
  		var bounds = this._redrawBounds;
  		if (bounds) {
  			var size = bounds.getSize();
  			this._ctx.clearRect(bounds.min.x, bounds.min.y, size.x, size.y);
  		} else {
  			this._ctx.save();
  			this._ctx.setTransform(1, 0, 0, 1, 0, 0);
  			this._ctx.clearRect(0, 0, this._container.width, this._container.height);
  			this._ctx.restore();
  		}
  	},

  	_draw: function () {
  		var layer, bounds = this._redrawBounds;
  		this._ctx.save();
  		if (bounds) {
  			var size = bounds.getSize();
  			this._ctx.beginPath();
  			this._ctx.rect(bounds.min.x, bounds.min.y, size.x, size.y);
  			this._ctx.clip();
  		}

  		this._drawing = true;

  		for (var order = this._drawFirst; order; order = order.next) {
  			layer = order.layer;
  			if (!bounds || (layer._pxBounds && layer._pxBounds.intersects(bounds))) {
  				layer._updatePath();
  			}
  		}

  		this._drawing = false;

  		this._ctx.restore();  // Restore state before clipping.
  	},

  	_updatePoly: function (layer, closed) {
  		if (!this._drawing) { return; }

  		var i, j, len2, p,
  		    parts = layer._parts,
  		    len = parts.length,
  		    ctx = this._ctx;

  		if (!len) { return; }

  		ctx.beginPath();

  		for (i = 0; i < len; i++) {
  			for (j = 0, len2 = parts[i].length; j < len2; j++) {
  				p = parts[i][j];
  				ctx[j ? 'lineTo' : 'moveTo'](p.x, p.y);
  			}
  			if (closed) {
  				ctx.closePath();
  			}
  		}

  		this._fillStroke(ctx, layer);

  		// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature
  	},

  	_updateCircle: function (layer) {

  		if (!this._drawing || layer._empty()) { return; }

  		var p = layer._point,
  		    ctx = this._ctx,
  		    r = Math.max(Math.round(layer._radius), 1),
  		    s = (Math.max(Math.round(layer._radiusY), 1) || r) / r;

  		if (s !== 1) {
  			ctx.save();
  			ctx.scale(1, s);
  		}

  		ctx.beginPath();
  		ctx.arc(p.x, p.y / s, r, 0, Math.PI * 2, false);

  		if (s !== 1) {
  			ctx.restore();
  		}

  		this._fillStroke(ctx, layer);
  	},

  	_fillStroke: function (ctx, layer) {
  		var options = layer.options;

  		if (options.fill) {
  			ctx.globalAlpha = options.fillOpacity;
  			ctx.fillStyle = options.fillColor || options.color;
  			ctx.fill(options.fillRule || 'evenodd');
  		}

  		if (options.stroke && options.weight !== 0) {
  			if (ctx.setLineDash) {
  				ctx.setLineDash(layer.options && layer.options._dashArray || []);
  			}
  			ctx.globalAlpha = options.opacity;
  			ctx.lineWidth = options.weight;
  			ctx.strokeStyle = options.color;
  			ctx.lineCap = options.lineCap;
  			ctx.lineJoin = options.lineJoin;
  			ctx.stroke();
  		}
  	},

  	// Canvas obviously doesn't have mouse events for individual drawn objects,
  	// so we emulate that by calculating what's under the mouse on mousemove/click manually

  	_onClick: function (e) {
  		var point = this._map.mouseEventToLayerPoint(e), layer, clickedLayer;

  		for (var order = this._drawFirst; order; order = order.next) {
  			layer = order.layer;
  			if (layer.options.interactive && layer._containsPoint(point)) {
  				if (!(e.type === 'click' || e.type === 'preclick') || !this._map._draggableMoved(layer)) {
  					clickedLayer = layer;
  				}
  			}
  		}
  		this._fireEvent(clickedLayer ? [clickedLayer] : false, e);
  	},

  	_onMouseMove: function (e) {
  		if (!this._map || this._map.dragging.moving() || this._map._animatingZoom) { return; }

  		var point = this._map.mouseEventToLayerPoint(e);
  		this._handleMouseHover(e, point);
  	},


  	_handleMouseOut: function (e) {
  		var layer = this._hoveredLayer;
  		if (layer) {
  			// if we're leaving the layer, fire mouseout
  			removeClass(this._container, 'leaflet-interactive');
  			this._fireEvent([layer], e, 'mouseout');
  			this._hoveredLayer = null;
  			this._mouseHoverThrottled = false;
  		}
  	},

  	_handleMouseHover: function (e, point) {
  		if (this._mouseHoverThrottled) {
  			return;
  		}

  		var layer, candidateHoveredLayer;

  		for (var order = this._drawFirst; order; order = order.next) {
  			layer = order.layer;
  			if (layer.options.interactive && layer._containsPoint(point)) {
  				candidateHoveredLayer = layer;
  			}
  		}

  		if (candidateHoveredLayer !== this._hoveredLayer) {
  			this._handleMouseOut(e);

  			if (candidateHoveredLayer) {
  				addClass(this._container, 'leaflet-interactive'); // change cursor
  				this._fireEvent([candidateHoveredLayer], e, 'mouseover');
  				this._hoveredLayer = candidateHoveredLayer;
  			}
  		}

  		this._fireEvent(this._hoveredLayer ? [this._hoveredLayer] : false, e);

  		this._mouseHoverThrottled = true;
  		setTimeout(bind(function () {
  			this._mouseHoverThrottled = false;
  		}, this), 32);
  	},

  	_fireEvent: function (layers, e, type) {
  		this._map._fireDOMEvent(e, type || e.type, layers);
  	},

  	_bringToFront: function (layer) {
  		var order = layer._order;

  		if (!order) { return; }

  		var next = order.next;
  		var prev = order.prev;

  		if (next) {
  			next.prev = prev;
  		} else {
  			// Already last
  			return;
  		}
  		if (prev) {
  			prev.next = next;
  		} else if (next) {
  			// Update first entry unless this is the
  			// single entry
  			this._drawFirst = next;
  		}

  		order.prev = this._drawLast;
  		this._drawLast.next = order;

  		order.next = null;
  		this._drawLast = order;

  		this._requestRedraw(layer);
  	},

  	_bringToBack: function (layer) {
  		var order = layer._order;

  		if (!order) { return; }

  		var next = order.next;
  		var prev = order.prev;

  		if (prev) {
  			prev.next = next;
  		} else {
  			// Already first
  			return;
  		}
  		if (next) {
  			next.prev = prev;
  		} else if (prev) {
  			// Update last entry unless this is the
  			// single entry
  			this._drawLast = prev;
  		}

  		order.prev = null;

  		order.next = this._drawFirst;
  		this._drawFirst.prev = order;
  		this._drawFirst = order;

  		this._requestRedraw(layer);
  	}
  });

  // @factory L.canvas(options?: Renderer options)
  // Creates a Canvas renderer with the given options.
  function canvas(options) {
  	return Browser.canvas ? new Canvas(options) : null;
  }

  /*
   * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!
   */


  var vmlCreate = (function () {
  	try {
  		document.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');
  		return function (name) {
  			return document.createElement('<lvml:' + name + ' class="lvml">');
  		};
  	} catch (e) {
  		// Do not return fn from catch block so `e` can be garbage collected
  		// See https://github.com/Leaflet/Leaflet/pull/7279
  	}
  	return function (name) {
  		return document.createElement('<' + name + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">');
  	};
  })();


  /*
   * @class SVG
   *
   *
   * VML was deprecated in 2012, which means VML functionality exists only for backwards compatibility
   * with old versions of Internet Explorer.
   */

  // mixin to redefine some SVG methods to handle VML syntax which is similar but with some differences
  var vmlMixin = {

  	_initContainer: function () {
  		this._container = create$1('div', 'leaflet-vml-container');
  	},

  	_update: function () {
  		if (this._map._animatingZoom) { return; }
  		Renderer.prototype._update.call(this);
  		this.fire('update');
  	},

  	_initPath: function (layer) {
  		var container = layer._container = vmlCreate('shape');

  		addClass(container, 'leaflet-vml-shape ' + (this.options.className || ''));

  		container.coordsize = '1 1';

  		layer._path = vmlCreate('path');
  		container.appendChild(layer._path);

  		this._updateStyle(layer);
  		this._layers[stamp(layer)] = layer;
  	},

  	_addPath: function (layer) {
  		var container = layer._container;
  		this._container.appendChild(container);

  		if (layer.options.interactive) {
  			layer.addInteractiveTarget(container);
  		}
  	},

  	_removePath: function (layer) {
  		var container = layer._container;
  		remove(container);
  		layer.removeInteractiveTarget(container);
  		delete this._layers[stamp(layer)];
  	},

  	_updateStyle: function (layer) {
  		var stroke = layer._stroke,
  		    fill = layer._fill,
  		    options = layer.options,
  		    container = layer._container;

  		container.stroked = !!options.stroke;
  		container.filled = !!options.fill;

  		if (options.stroke) {
  			if (!stroke) {
  				stroke = layer._stroke = vmlCreate('stroke');
  			}
  			container.appendChild(stroke);
  			stroke.weight = options.weight + 'px';
  			stroke.color = options.color;
  			stroke.opacity = options.opacity;

  			if (options.dashArray) {
  				stroke.dashStyle = isArray(options.dashArray) ?
  				    options.dashArray.join(' ') :
  				    options.dashArray.replace(/( *, *)/g, ' ');
  			} else {
  				stroke.dashStyle = '';
  			}
  			stroke.endcap = options.lineCap.replace('butt', 'flat');
  			stroke.joinstyle = options.lineJoin;

  		} else if (stroke) {
  			container.removeChild(stroke);
  			layer._stroke = null;
  		}

  		if (options.fill) {
  			if (!fill) {
  				fill = layer._fill = vmlCreate('fill');
  			}
  			container.appendChild(fill);
  			fill.color = options.fillColor || options.color;
  			fill.opacity = options.fillOpacity;

  		} else if (fill) {
  			container.removeChild(fill);
  			layer._fill = null;
  		}
  	},

  	_updateCircle: function (layer) {
  		var p = layer._point.round(),
  		    r = Math.round(layer._radius),
  		    r2 = Math.round(layer._radiusY || r);

  		this._setPath(layer, layer._empty() ? 'M0 0' :
  			'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r2 + ' 0,' + (65535 * 360));
  	},

  	_setPath: function (layer, path) {
  		layer._path.v = path;
  	},

  	_bringToFront: function (layer) {
  		toFront(layer._container);
  	},

  	_bringToBack: function (layer) {
  		toBack(layer._container);
  	}
  };

  var create = Browser.vml ? vmlCreate : svgCreate;

  /*
   * @class SVG
   * @inherits Renderer
   * @aka L.SVG
   *
   * Allows vector layers to be displayed with [SVG](https://developer.mozilla.org/docs/Web/SVG).
   * Inherits `Renderer`.
   *
   * Due to [technical limitations](https://caniuse.com/svg), SVG is not
   * available in all web browsers, notably Android 2.x and 3.x.
   *
   * Although SVG is not available on IE7 and IE8, these browsers support
   * [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language)
   * (a now deprecated technology), and the SVG renderer will fall back to VML in
   * this case.
   *
   * @example
   *
   * Use SVG by default for all paths in the map:
   *
   * ```js
   * var map = L.map('map', {
   * 	renderer: L.svg()
   * });
   * ```
   *
   * Use a SVG renderer with extra padding for specific vector geometries:
   *
   * ```js
   * var map = L.map('map');
   * var myRenderer = L.svg({ padding: 0.5 });
   * var line = L.polyline( coordinates, { renderer: myRenderer } );
   * var circle = L.circle( center, { renderer: myRenderer } );
   * ```
   */

  var SVG = Renderer.extend({

  	_initContainer: function () {
  		this._container = create('svg');

  		// makes it possible to click through svg root; we'll reset it back in individual paths
  		this._container.setAttribute('pointer-events', 'none');

  		this._rootGroup = create('g');
  		this._container.appendChild(this._rootGroup);
  	},

  	_destroyContainer: function () {
  		remove(this._container);
  		off(this._container);
  		delete this._container;
  		delete this._rootGroup;
  		delete this._svgSize;
  	},

  	_update: function () {
  		if (this._map._animatingZoom && this._bounds) { return; }

  		Renderer.prototype._update.call(this);

  		var b = this._bounds,
  		    size = b.getSize(),
  		    container = this._container;

  		// set size of svg-container if changed
  		if (!this._svgSize || !this._svgSize.equals(size)) {
  			this._svgSize = size;
  			container.setAttribute('width', size.x);
  			container.setAttribute('height', size.y);
  		}

  		// movement: update container viewBox so that we don't have to change coordinates of individual layers
  		setPosition(container, b.min);
  		container.setAttribute('viewBox', [b.min.x, b.min.y, size.x, size.y].join(' '));

  		this.fire('update');
  	},

  	// methods below are called by vector layers implementations

  	_initPath: function (layer) {
  		var path = layer._path = create('path');

  		// @namespace Path
  		// @option className: String = null
  		// Custom class name set on an element. Only for SVG renderer.
  		if (layer.options.className) {
  			addClass(path, layer.options.className);
  		}

  		if (layer.options.interactive) {
  			addClass(path, 'leaflet-interactive');
  		}

  		this._updateStyle(layer);
  		this._layers[stamp(layer)] = layer;
  	},

  	_addPath: function (layer) {
  		if (!this._rootGroup) { this._initContainer(); }
  		this._rootGroup.appendChild(layer._path);
  		layer.addInteractiveTarget(layer._path);
  	},

  	_removePath: function (layer) {
  		remove(layer._path);
  		layer.removeInteractiveTarget(layer._path);
  		delete this._layers[stamp(layer)];
  	},

  	_updatePath: function (layer) {
  		layer._project();
  		layer._update();
  	},

  	_updateStyle: function (layer) {
  		var path = layer._path,
  		    options = layer.options;

  		if (!path) { return; }

  		if (options.stroke) {
  			path.setAttribute('stroke', options.color);
  			path.setAttribute('stroke-opacity', options.opacity);
  			path.setAttribute('stroke-width', options.weight);
  			path.setAttribute('stroke-linecap', options.lineCap);
  			path.setAttribute('stroke-linejoin', options.lineJoin);

  			if (options.dashArray) {
  				path.setAttribute('stroke-dasharray', options.dashArray);
  			} else {
  				path.removeAttribute('stroke-dasharray');
  			}

  			if (options.dashOffset) {
  				path.setAttribute('stroke-dashoffset', options.dashOffset);
  			} else {
  				path.removeAttribute('stroke-dashoffset');
  			}
  		} else {
  			path.setAttribute('stroke', 'none');
  		}

  		if (options.fill) {
  			path.setAttribute('fill', options.fillColor || options.color);
  			path.setAttribute('fill-opacity', options.fillOpacity);
  			path.setAttribute('fill-rule', options.fillRule || 'evenodd');
  		} else {
  			path.setAttribute('fill', 'none');
  		}
  	},

  	_updatePoly: function (layer, closed) {
  		this._setPath(layer, pointsToPath(layer._parts, closed));
  	},

  	_updateCircle: function (layer) {
  		var p = layer._point,
  		    r = Math.max(Math.round(layer._radius), 1),
  		    r2 = Math.max(Math.round(layer._radiusY), 1) || r,
  		    arc = 'a' + r + ',' + r2 + ' 0 1,0 ';

  		// drawing a circle with two half-arcs
  		var d = layer._empty() ? 'M0 0' :
  			'M' + (p.x - r) + ',' + p.y +
  			arc + (r * 2) + ',0 ' +
  			arc + (-r * 2) + ',0 ';

  		this._setPath(layer, d);
  	},

  	_setPath: function (layer, path) {
  		layer._path.setAttribute('d', path);
  	},

  	// SVG does not have the concept of zIndex so we resort to changing the DOM order of elements
  	_bringToFront: function (layer) {
  		toFront(layer._path);
  	},

  	_bringToBack: function (layer) {
  		toBack(layer._path);
  	}
  });

  if (Browser.vml) {
  	SVG.include(vmlMixin);
  }

  // @namespace SVG
  // @factory L.svg(options?: Renderer options)
  // Creates a SVG renderer with the given options.
  function svg(options) {
  	return Browser.svg || Browser.vml ? new SVG(options) : null;
  }

  Map.include({
  	// @namespace Map; @method getRenderer(layer: Path): Renderer
  	// Returns the instance of `Renderer` that should be used to render the given
  	// `Path`. It will ensure that the `renderer` options of the map and paths
  	// are respected, and that the renderers do exist on the map.
  	getRenderer: function (layer) {
  		// @namespace Path; @option renderer: Renderer
  		// Use this specific instance of `Renderer` for this path. Takes
  		// precedence over the map's [default renderer](#map-renderer).
  		var renderer = layer.options.renderer || this._getPaneRenderer(layer.options.pane) || this.options.renderer || this._renderer;

  		if (!renderer) {
  			renderer = this._renderer = this._createRenderer();
  		}

  		if (!this.hasLayer(renderer)) {
  			this.addLayer(renderer);
  		}
  		return renderer;
  	},

  	_getPaneRenderer: function (name) {
  		if (name === 'overlayPane' || name === undefined) {
  			return false;
  		}

  		var renderer = this._paneRenderers[name];
  		if (renderer === undefined) {
  			renderer = this._createRenderer({pane: name});
  			this._paneRenderers[name] = renderer;
  		}
  		return renderer;
  	},

  	_createRenderer: function (options) {
  		// @namespace Map; @option preferCanvas: Boolean = false
  		// Whether `Path`s should be rendered on a `Canvas` renderer.
  		// By default, all `Path`s are rendered in a `SVG` renderer.
  		return (this.options.preferCanvas && canvas(options)) || svg(options);
  	}
  });

  /*
   * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.
   */

  /*
   * @class Rectangle
   * @aka L.Rectangle
   * @inherits Polygon
   *
   * A class for drawing rectangle overlays on a map. Extends `Polygon`.
   *
   * @example
   *
   * ```js
   * // define rectangle geographical bounds
   * var bounds = [[54.559322, -5.767822], [56.1210604, -3.021240]];
   *
   * // create an orange rectangle
   * L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(map);
   *
   * // zoom the map to the rectangle bounds
   * map.fitBounds(bounds);
   * ```
   *
   */


  var Rectangle = Polygon.extend({
  	initialize: function (latLngBounds, options) {
  		Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);
  	},

  	// @method setBounds(latLngBounds: LatLngBounds): this
  	// Redraws the rectangle with the passed bounds.
  	setBounds: function (latLngBounds) {
  		return this.setLatLngs(this._boundsToLatLngs(latLngBounds));
  	},

  	_boundsToLatLngs: function (latLngBounds) {
  		latLngBounds = toLatLngBounds(latLngBounds);
  		return [
  			latLngBounds.getSouthWest(),
  			latLngBounds.getNorthWest(),
  			latLngBounds.getNorthEast(),
  			latLngBounds.getSouthEast()
  		];
  	}
  });


  // @factory L.rectangle(latLngBounds: LatLngBounds, options?: Polyline options)
  function rectangle(latLngBounds, options) {
  	return new Rectangle(latLngBounds, options);
  }

  SVG.create = create;
  SVG.pointsToPath = pointsToPath;

  GeoJSON.geometryToLayer = geometryToLayer;
  GeoJSON.coordsToLatLng = coordsToLatLng;
  GeoJSON.coordsToLatLngs = coordsToLatLngs;
  GeoJSON.latLngToCoords = latLngToCoords;
  GeoJSON.latLngsToCoords = latLngsToCoords;
  GeoJSON.getFeature = getFeature;
  GeoJSON.asFeature = asFeature;

  /*
   * L.Handler.BoxZoom is used to add shift-drag zoom interaction to the map
   * (zoom to a selected bounding box), enabled by default.
   */

  // @namespace Map
  // @section Interaction Options
  Map.mergeOptions({
  	// @option boxZoom: Boolean = true
  	// Whether the map can be zoomed to a rectangular area specified by
  	// dragging the mouse while pressing the shift key.
  	boxZoom: true
  });

  var BoxZoom = Handler.extend({
  	initialize: function (map) {
  		this._map = map;
  		this._container = map._container;
  		this._pane = map._panes.overlayPane;
  		this._resetStateTimeout = 0;
  		map.on('unload', this._destroy, this);
  	},

  	addHooks: function () {
  		on(this._container, 'mousedown', this._onMouseDown, this);
  	},

  	removeHooks: function () {
  		off(this._container, 'mousedown', this._onMouseDown, this);
  	},

  	moved: function () {
  		return this._moved;
  	},

  	_destroy: function () {
  		remove(this._pane);
  		delete this._pane;
  	},

  	_resetState: function () {
  		this._resetStateTimeout = 0;
  		this._moved = false;
  	},

  	_clearDeferredResetState: function () {
  		if (this._resetStateTimeout !== 0) {
  			clearTimeout(this._resetStateTimeout);
  			this._resetStateTimeout = 0;
  		}
  	},

  	_onMouseDown: function (e) {
  		if (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }

  		// Clear the deferred resetState if it hasn't executed yet, otherwise it
  		// will interrupt the interaction and orphan a box element in the container.
  		this._clearDeferredResetState();
  		this._resetState();

  		disableTextSelection();
  		disableImageDrag();

  		this._startPoint = this._map.mouseEventToContainerPoint(e);

  		on(document, {
  			contextmenu: stop,
  			mousemove: this._onMouseMove,
  			mouseup: this._onMouseUp,
  			keydown: this._onKeyDown
  		}, this);
  	},

  	_onMouseMove: function (e) {
  		if (!this._moved) {
  			this._moved = true;

  			this._box = create$1('div', 'leaflet-zoom-box', this._container);
  			addClass(this._container, 'leaflet-crosshair');

  			this._map.fire('boxzoomstart');
  		}

  		this._point = this._map.mouseEventToContainerPoint(e);

  		var bounds = new Bounds(this._point, this._startPoint),
  		    size = bounds.getSize();

  		setPosition(this._box, bounds.min);

  		this._box.style.width  = size.x + 'px';
  		this._box.style.height = size.y + 'px';
  	},

  	_finish: function () {
  		if (this._moved) {
  			remove(this._box);
  			removeClass(this._container, 'leaflet-crosshair');
  		}

  		enableTextSelection();
  		enableImageDrag();

  		off(document, {
  			contextmenu: stop,
  			mousemove: this._onMouseMove,
  			mouseup: this._onMouseUp,
  			keydown: this._onKeyDown
  		}, this);
  	},

  	_onMouseUp: function (e) {
  		if ((e.which !== 1) && (e.button !== 1)) { return; }

  		this._finish();

  		if (!this._moved) { return; }
  		// Postpone to next JS tick so internal click event handling
  		// still see it as "moved".
  		this._clearDeferredResetState();
  		this._resetStateTimeout = setTimeout(bind(this._resetState, this), 0);

  		var bounds = new LatLngBounds(
  		        this._map.containerPointToLatLng(this._startPoint),
  		        this._map.containerPointToLatLng(this._point));

  		this._map
  			.fitBounds(bounds)
  			.fire('boxzoomend', {boxZoomBounds: bounds});
  	},

  	_onKeyDown: function (e) {
  		if (e.keyCode === 27) {
  			this._finish();
  			this._clearDeferredResetState();
  			this._resetState();
  		}
  	}
  });

  // @section Handlers
  // @property boxZoom: Handler
  // Box (shift-drag with mouse) zoom handler.
  Map.addInitHook('addHandler', 'boxZoom', BoxZoom);

  /*
   * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.
   */

  // @namespace Map
  // @section Interaction Options

  Map.mergeOptions({
  	// @option doubleClickZoom: Boolean|String = true
  	// Whether the map can be zoomed in by double clicking on it and
  	// zoomed out by double clicking while holding shift. If passed
  	// `'center'`, double-click zoom will zoom to the center of the
  	//  view regardless of where the mouse was.
  	doubleClickZoom: true
  });

  var DoubleClickZoom = Handler.extend({
  	addHooks: function () {
  		this._map.on('dblclick', this._onDoubleClick, this);
  	},

  	removeHooks: function () {
  		this._map.off('dblclick', this._onDoubleClick, this);
  	},

  	_onDoubleClick: function (e) {
  		var map = this._map,
  		    oldZoom = map.getZoom(),
  		    delta = map.options.zoomDelta,
  		    zoom = e.originalEvent.shiftKey ? oldZoom - delta : oldZoom + delta;

  		if (map.options.doubleClickZoom === 'center') {
  			map.setZoom(zoom);
  		} else {
  			map.setZoomAround(e.containerPoint, zoom);
  		}
  	}
  });

  // @section Handlers
  //
  // Map properties include interaction handlers that allow you to control
  // interaction behavior in runtime, enabling or disabling certain features such
  // as dragging or touch zoom (see `Handler` methods). For example:
  //
  // ```js
  // map.doubleClickZoom.disable();
  // ```
  //
  // @property doubleClickZoom: Handler
  // Double click zoom handler.
  Map.addInitHook('addHandler', 'doubleClickZoom', DoubleClickZoom);

  /*
   * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.
   */

  // @namespace Map
  // @section Interaction Options
  Map.mergeOptions({
  	// @option dragging: Boolean = true
  	// Whether the map is draggable with mouse/touch or not.
  	dragging: true,

  	// @section Panning Inertia Options
  	// @option inertia: Boolean = *
  	// If enabled, panning of the map will have an inertia effect where
  	// the map builds momentum while dragging and continues moving in
  	// the same direction for some time. Feels especially nice on touch
  	// devices. Enabled by default.
  	inertia: true,

  	// @option inertiaDeceleration: Number = 3000
  	// The rate with which the inertial movement slows down, in pixels/second².
  	inertiaDeceleration: 3400, // px/s^2

  	// @option inertiaMaxSpeed: Number = Infinity
  	// Max speed of the inertial movement, in pixels/second.
  	inertiaMaxSpeed: Infinity, // px/s

  	// @option easeLinearity: Number = 0.2
  	easeLinearity: 0.2,

  	// TODO refactor, move to CRS
  	// @option worldCopyJump: Boolean = false
  	// With this option enabled, the map tracks when you pan to another "copy"
  	// of the world and seamlessly jumps to the original one so that all overlays
  	// like markers and vector layers are still visible.
  	worldCopyJump: false,

  	// @option maxBoundsViscosity: Number = 0.0
  	// If `maxBounds` is set, this option will control how solid the bounds
  	// are when dragging the map around. The default value of `0.0` allows the
  	// user to drag outside the bounds at normal speed, higher values will
  	// slow down map dragging outside bounds, and `1.0` makes the bounds fully
  	// solid, preventing the user from dragging outside the bounds.
  	maxBoundsViscosity: 0.0
  });

  var Drag = Handler.extend({
  	addHooks: function () {
  		if (!this._draggable) {
  			var map = this._map;

  			this._draggable = new Draggable(map._mapPane, map._container);

  			this._draggable.on({
  				dragstart: this._onDragStart,
  				drag: this._onDrag,
  				dragend: this._onDragEnd
  			}, this);

  			this._draggable.on('predrag', this._onPreDragLimit, this);
  			if (map.options.worldCopyJump) {
  				this._draggable.on('predrag', this._onPreDragWrap, this);
  				map.on('zoomend', this._onZoomEnd, this);

  				map.whenReady(this._onZoomEnd, this);
  			}
  		}
  		addClass(this._map._container, 'leaflet-grab leaflet-touch-drag');
  		this._draggable.enable();
  		this._positions = [];
  		this._times = [];
  	},

  	removeHooks: function () {
  		removeClass(this._map._container, 'leaflet-grab');
  		removeClass(this._map._container, 'leaflet-touch-drag');
  		this._draggable.disable();
  	},

  	moved: function () {
  		return this._draggable && this._draggable._moved;
  	},

  	moving: function () {
  		return this._draggable && this._draggable._moving;
  	},

  	_onDragStart: function () {
  		var map = this._map;

  		map._stop();
  		if (this._map.options.maxBounds && this._map.options.maxBoundsViscosity) {
  			var bounds = toLatLngBounds(this._map.options.maxBounds);

  			this._offsetLimit = toBounds(
  				this._map.latLngToContainerPoint(bounds.getNorthWest()).multiplyBy(-1),
  				this._map.latLngToContainerPoint(bounds.getSouthEast()).multiplyBy(-1)
  					.add(this._map.getSize()));

  			this._viscosity = Math.min(1.0, Math.max(0.0, this._map.options.maxBoundsViscosity));
  		} else {
  			this._offsetLimit = null;
  		}

  		map
  		    .fire('movestart')
  		    .fire('dragstart');

  		if (map.options.inertia) {
  			this._positions = [];
  			this._times = [];
  		}
  	},

  	_onDrag: function (e) {
  		if (this._map.options.inertia) {
  			var time = this._lastTime = +new Date(),
  			    pos = this._lastPos = this._draggable._absPos || this._draggable._newPos;

  			this._positions.push(pos);
  			this._times.push(time);

  			this._prunePositions(time);
  		}

  		this._map
  		    .fire('move', e)
  		    .fire('drag', e);
  	},

  	_prunePositions: function (time) {
  		while (this._positions.length > 1 && time - this._times[0] > 50) {
  			this._positions.shift();
  			this._times.shift();
  		}
  	},

  	_onZoomEnd: function () {
  		var pxCenter = this._map.getSize().divideBy(2),
  		    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);

  		this._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;
  		this._worldWidth = this._map.getPixelWorldBounds().getSize().x;
  	},

  	_viscousLimit: function (value, threshold) {
  		return value - (value - threshold) * this._viscosity;
  	},

  	_onPreDragLimit: function () {
  		if (!this._viscosity || !this._offsetLimit) { return; }

  		var offset = this._draggable._newPos.subtract(this._draggable._startPos);

  		var limit = this._offsetLimit;
  		if (offset.x < limit.min.x) { offset.x = this._viscousLimit(offset.x, limit.min.x); }
  		if (offset.y < limit.min.y) { offset.y = this._viscousLimit(offset.y, limit.min.y); }
  		if (offset.x > limit.max.x) { offset.x = this._viscousLimit(offset.x, limit.max.x); }
  		if (offset.y > limit.max.y) { offset.y = this._viscousLimit(offset.y, limit.max.y); }

  		this._draggable._newPos = this._draggable._startPos.add(offset);
  	},

  	_onPreDragWrap: function () {
  		// TODO refactor to be able to adjust map pane position after zoom
  		var worldWidth = this._worldWidth,
  		    halfWidth = Math.round(worldWidth / 2),
  		    dx = this._initialWorldOffset,
  		    x = this._draggable._newPos.x,
  		    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,
  		    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,
  		    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;

  		this._draggable._absPos = this._draggable._newPos.clone();
  		this._draggable._newPos.x = newX;
  	},

  	_onDragEnd: function (e) {
  		var map = this._map,
  		    options = map.options,

  		    noInertia = !options.inertia || e.noInertia || this._times.length < 2;

  		map.fire('dragend', e);

  		if (noInertia) {
  			map.fire('moveend');

  		} else {
  			this._prunePositions(+new Date());

  			var direction = this._lastPos.subtract(this._positions[0]),
  			    duration = (this._lastTime - this._times[0]) / 1000,
  			    ease = options.easeLinearity,

  			    speedVector = direction.multiplyBy(ease / duration),
  			    speed = speedVector.distanceTo([0, 0]),

  			    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),
  			    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),

  			    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),
  			    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();

  			if (!offset.x && !offset.y) {
  				map.fire('moveend');

  			} else {
  				offset = map._limitOffset(offset, map.options.maxBounds);

  				requestAnimFrame(function () {
  					map.panBy(offset, {
  						duration: decelerationDuration,
  						easeLinearity: ease,
  						noMoveStart: true,
  						animate: true
  					});
  				});
  			}
  		}
  	}
  });

  // @section Handlers
  // @property dragging: Handler
  // Map dragging handler (by both mouse and touch).
  Map.addInitHook('addHandler', 'dragging', Drag);

  /*
   * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.
   */

  // @namespace Map
  // @section Keyboard Navigation Options
  Map.mergeOptions({
  	// @option keyboard: Boolean = true
  	// Makes the map focusable and allows users to navigate the map with keyboard
  	// arrows and `+`/`-` keys.
  	keyboard: true,

  	// @option keyboardPanDelta: Number = 80
  	// Amount of pixels to pan when pressing an arrow key.
  	keyboardPanDelta: 80
  });

  var Keyboard = Handler.extend({

  	keyCodes: {
  		left:    [37],
  		right:   [39],
  		down:    [40],
  		up:      [38],
  		zoomIn:  [187, 107, 61, 171],
  		zoomOut: [189, 109, 54, 173]
  	},

  	initialize: function (map) {
  		this._map = map;

  		this._setPanDelta(map.options.keyboardPanDelta);
  		this._setZoomDelta(map.options.zoomDelta);
  	},

  	addHooks: function () {
  		var container = this._map._container;

  		// make the container focusable by tabbing
  		if (container.tabIndex <= 0) {
  			container.tabIndex = '0';
  		}

  		on(container, {
  			focus: this._onFocus,
  			blur: this._onBlur,
  			mousedown: this._onMouseDown
  		}, this);

  		this._map.on({
  			focus: this._addHooks,
  			blur: this._removeHooks
  		}, this);
  	},

  	removeHooks: function () {
  		this._removeHooks();

  		off(this._map._container, {
  			focus: this._onFocus,
  			blur: this._onBlur,
  			mousedown: this._onMouseDown
  		}, this);

  		this._map.off({
  			focus: this._addHooks,
  			blur: this._removeHooks
  		}, this);
  	},

  	_onMouseDown: function () {
  		if (this._focused) { return; }

  		var body = document.body,
  		    docEl = document.documentElement,
  		    top = body.scrollTop || docEl.scrollTop,
  		    left = body.scrollLeft || docEl.scrollLeft;

  		this._map._container.focus();

  		window.scrollTo(left, top);
  	},

  	_onFocus: function () {
  		this._focused = true;
  		this._map.fire('focus');
  	},

  	_onBlur: function () {
  		this._focused = false;
  		this._map.fire('blur');
  	},

  	_setPanDelta: function (panDelta) {
  		var keys = this._panKeys = {},
  		    codes = this.keyCodes,
  		    i, len;

  		for (i = 0, len = codes.left.length; i < len; i++) {
  			keys[codes.left[i]] = [-1 * panDelta, 0];
  		}
  		for (i = 0, len = codes.right.length; i < len; i++) {
  			keys[codes.right[i]] = [panDelta, 0];
  		}
  		for (i = 0, len = codes.down.length; i < len; i++) {
  			keys[codes.down[i]] = [0, panDelta];
  		}
  		for (i = 0, len = codes.up.length; i < len; i++) {
  			keys[codes.up[i]] = [0, -1 * panDelta];
  		}
  	},

  	_setZoomDelta: function (zoomDelta) {
  		var keys = this._zoomKeys = {},
  		    codes = this.keyCodes,
  		    i, len;

  		for (i = 0, len = codes.zoomIn.length; i < len; i++) {
  			keys[codes.zoomIn[i]] = zoomDelta;
  		}
  		for (i = 0, len = codes.zoomOut.length; i < len; i++) {
  			keys[codes.zoomOut[i]] = -zoomDelta;
  		}
  	},

  	_addHooks: function () {
  		on(document, 'keydown', this._onKeyDown, this);
  	},

  	_removeHooks: function () {
  		off(document, 'keydown', this._onKeyDown, this);
  	},

  	_onKeyDown: function (e) {
  		if (e.altKey || e.ctrlKey || e.metaKey) { return; }

  		var key = e.keyCode,
  		    map = this._map,
  		    offset;

  		if (key in this._panKeys) {
  			if (!map._panAnim || !map._panAnim._inProgress) {
  				offset = this._panKeys[key];
  				if (e.shiftKey) {
  					offset = toPoint(offset).multiplyBy(3);
  				}

  				if (map.options.maxBounds) {
  					offset = map._limitOffset(toPoint(offset), map.options.maxBounds);
  				}

  				if (map.options.worldCopyJump) {
  					var newLatLng = map.wrapLatLng(map.unproject(map.project(map.getCenter()).add(offset)));
  					map.panTo(newLatLng);
  				} else {
  					map.panBy(offset);
  				}
  			}
  		} else if (key in this._zoomKeys) {
  			map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);

  		} else if (key === 27 && map._popup && map._popup.options.closeOnEscapeKey) {
  			map.closePopup();

  		} else {
  			return;
  		}

  		stop(e);
  	}
  });

  // @section Handlers
  // @section Handlers
  // @property keyboard: Handler
  // Keyboard navigation handler.
  Map.addInitHook('addHandler', 'keyboard', Keyboard);

  /*
   * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.
   */

  // @namespace Map
  // @section Interaction Options
  Map.mergeOptions({
  	// @section Mouse wheel options
  	// @option scrollWheelZoom: Boolean|String = true
  	// Whether the map can be zoomed by using the mouse wheel. If passed `'center'`,
  	// it will zoom to the center of the view regardless of where the mouse was.
  	scrollWheelZoom: true,

  	// @option wheelDebounceTime: Number = 40
  	// Limits the rate at which a wheel can fire (in milliseconds). By default
  	// user can't zoom via wheel more often than once per 40 ms.
  	wheelDebounceTime: 40,

  	// @option wheelPxPerZoomLevel: Number = 60
  	// How many scroll pixels (as reported by [L.DomEvent.getWheelDelta](#domevent-getwheeldelta))
  	// mean a change of one full zoom level. Smaller values will make wheel-zooming
  	// faster (and vice versa).
  	wheelPxPerZoomLevel: 60
  });

  var ScrollWheelZoom = Handler.extend({
  	addHooks: function () {
  		on(this._map._container, 'wheel', this._onWheelScroll, this);

  		this._delta = 0;
  	},

  	removeHooks: function () {
  		off(this._map._container, 'wheel', this._onWheelScroll, this);
  	},

  	_onWheelScroll: function (e) {
  		var delta = getWheelDelta(e);

  		var debounce = this._map.options.wheelDebounceTime;

  		this._delta += delta;
  		this._lastMousePos = this._map.mouseEventToContainerPoint(e);

  		if (!this._startTime) {
  			this._startTime = +new Date();
  		}

  		var left = Math.max(debounce - (+new Date() - this._startTime), 0);

  		clearTimeout(this._timer);
  		this._timer = setTimeout(bind(this._performZoom, this), left);

  		stop(e);
  	},

  	_performZoom: function () {
  		var map = this._map,
  		    zoom = map.getZoom(),
  		    snap = this._map.options.zoomSnap || 0;

  		map._stop(); // stop panning and fly animations if any

  		// map the delta with a sigmoid function to -4..4 range leaning on -1..1
  		var d2 = this._delta / (this._map.options.wheelPxPerZoomLevel * 4),
  		    d3 = 4 * Math.log(2 / (1 + Math.exp(-Math.abs(d2)))) / Math.LN2,
  		    d4 = snap ? Math.ceil(d3 / snap) * snap : d3,
  		    delta = map._limitZoom(zoom + (this._delta > 0 ? d4 : -d4)) - zoom;

  		this._delta = 0;
  		this._startTime = null;

  		if (!delta) { return; }

  		if (map.options.scrollWheelZoom === 'center') {
  			map.setZoom(zoom + delta);
  		} else {
  			map.setZoomAround(this._lastMousePos, zoom + delta);
  		}
  	}
  });

  // @section Handlers
  // @property scrollWheelZoom: Handler
  // Scroll wheel zoom handler.
  Map.addInitHook('addHandler', 'scrollWheelZoom', ScrollWheelZoom);

  /*
   * L.Map.TapHold is used to simulate `contextmenu` event on long hold,
   * which otherwise is not fired by mobile Safari.
   */

  var tapHoldDelay = 600;

  // @namespace Map
  // @section Interaction Options
  Map.mergeOptions({
  	// @section Touch interaction options
  	// @option tapHold: Boolean
  	// Enables simulation of `contextmenu` event, default is `true` for mobile Safari.
  	tapHold: Browser.touchNative && Browser.safari && Browser.mobile,

  	// @option tapTolerance: Number = 15
  	// The max number of pixels a user can shift his finger during touch
  	// for it to be considered a valid tap.
  	tapTolerance: 15
  });

  var TapHold = Handler.extend({
  	addHooks: function () {
  		on(this._map._container, 'touchstart', this._onDown, this);
  	},

  	removeHooks: function () {
  		off(this._map._container, 'touchstart', this._onDown, this);
  	},

  	_onDown: function (e) {
  		clearTimeout(this._holdTimeout);
  		if (e.touches.length !== 1) { return; }

  		var first = e.touches[0];
  		this._startPos = this._newPos = new Point(first.clientX, first.clientY);

  		this._holdTimeout = setTimeout(bind(function () {
  			this._cancel();
  			if (!this._isTapValid()) { return; }

  			// prevent simulated mouse events https://w3c.github.io/touch-events/#mouse-events
  			on(document, 'touchend', preventDefault);
  			on(document, 'touchend touchcancel', this._cancelClickPrevent);
  			this._simulateEvent('contextmenu', first);
  		}, this), tapHoldDelay);

  		on(document, 'touchend touchcancel contextmenu', this._cancel, this);
  		on(document, 'touchmove', this._onMove, this);
  	},

  	_cancelClickPrevent: function cancelClickPrevent() {
  		off(document, 'touchend', preventDefault);
  		off(document, 'touchend touchcancel', cancelClickPrevent);
  	},

  	_cancel: function () {
  		clearTimeout(this._holdTimeout);
  		off(document, 'touchend touchcancel contextmenu', this._cancel, this);
  		off(document, 'touchmove', this._onMove, this);
  	},

  	_onMove: function (e) {
  		var first = e.touches[0];
  		this._newPos = new Point(first.clientX, first.clientY);
  	},

  	_isTapValid: function () {
  		return this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;
  	},

  	_simulateEvent: function (type, e) {
  		var simulatedEvent = new MouseEvent(type, {
  			bubbles: true,
  			cancelable: true,
  			view: window,
  			// detail: 1,
  			screenX: e.screenX,
  			screenY: e.screenY,
  			clientX: e.clientX,
  			clientY: e.clientY,
  			// button: 2,
  			// buttons: 2
  		});

  		simulatedEvent._simulated = true;

  		e.target.dispatchEvent(simulatedEvent);
  	}
  });

  // @section Handlers
  // @property tapHold: Handler
  // Long tap handler to simulate `contextmenu` event (useful in mobile Safari).
  Map.addInitHook('addHandler', 'tapHold', TapHold);

  /*
   * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.
   */

  // @namespace Map
  // @section Interaction Options
  Map.mergeOptions({
  	// @section Touch interaction options
  	// @option touchZoom: Boolean|String = *
  	// Whether the map can be zoomed by touch-dragging with two fingers. If
  	// passed `'center'`, it will zoom to the center of the view regardless of
  	// where the touch events (fingers) were. Enabled for touch-capable web
  	// browsers.
  	touchZoom: Browser.touch,

  	// @option bounceAtZoomLimits: Boolean = true
  	// Set it to false if you don't want the map to zoom beyond min/max zoom
  	// and then bounce back when pinch-zooming.
  	bounceAtZoomLimits: true
  });

  var TouchZoom = Handler.extend({
  	addHooks: function () {
  		addClass(this._map._container, 'leaflet-touch-zoom');
  		on(this._map._container, 'touchstart', this._onTouchStart, this);
  	},

  	removeHooks: function () {
  		removeClass(this._map._container, 'leaflet-touch-zoom');
  		off(this._map._container, 'touchstart', this._onTouchStart, this);
  	},

  	_onTouchStart: function (e) {
  		var map = this._map;
  		if (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }

  		var p1 = map.mouseEventToContainerPoint(e.touches[0]),
  		    p2 = map.mouseEventToContainerPoint(e.touches[1]);

  		this._centerPoint = map.getSize()._divideBy(2);
  		this._startLatLng = map.containerPointToLatLng(this._centerPoint);
  		if (map.options.touchZoom !== 'center') {
  			this._pinchStartLatLng = map.containerPointToLatLng(p1.add(p2)._divideBy(2));
  		}

  		this._startDist = p1.distanceTo(p2);
  		this._startZoom = map.getZoom();

  		this._moved = false;
  		this._zooming = true;

  		map._stop();

  		on(document, 'touchmove', this._onTouchMove, this);
  		on(document, 'touchend touchcancel', this._onTouchEnd, this);

  		preventDefault(e);
  	},

  	_onTouchMove: function (e) {
  		if (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }

  		var map = this._map,
  		    p1 = map.mouseEventToContainerPoint(e.touches[0]),
  		    p2 = map.mouseEventToContainerPoint(e.touches[1]),
  		    scale = p1.distanceTo(p2) / this._startDist;

  		this._zoom = map.getScaleZoom(scale, this._startZoom);

  		if (!map.options.bounceAtZoomLimits && (
  			(this._zoom < map.getMinZoom() && scale < 1) ||
  			(this._zoom > map.getMaxZoom() && scale > 1))) {
  			this._zoom = map._limitZoom(this._zoom);
  		}

  		if (map.options.touchZoom === 'center') {
  			this._center = this._startLatLng;
  			if (scale === 1) { return; }
  		} else {
  			// Get delta from pinch to center, so centerLatLng is delta applied to initial pinchLatLng
  			var delta = p1._add(p2)._divideBy(2)._subtract(this._centerPoint);
  			if (scale === 1 && delta.x === 0 && delta.y === 0) { return; }
  			this._center = map.unproject(map.project(this._pinchStartLatLng, this._zoom).subtract(delta), this._zoom);
  		}

  		if (!this._moved) {
  			map._moveStart(true, false);
  			this._moved = true;
  		}

  		cancelAnimFrame(this._animRequest);

  		var moveFn = bind(map._move, map, this._center, this._zoom, {pinch: true, round: false}, undefined);
  		this._animRequest = requestAnimFrame(moveFn, this, true);

  		preventDefault(e);
  	},

  	_onTouchEnd: function () {
  		if (!this._moved || !this._zooming) {
  			this._zooming = false;
  			return;
  		}

  		this._zooming = false;
  		cancelAnimFrame(this._animRequest);

  		off(document, 'touchmove', this._onTouchMove, this);
  		off(document, 'touchend touchcancel', this._onTouchEnd, this);

  		// Pinch updates GridLayers' levels only when zoomSnap is off, so zoomSnap becomes noUpdate.
  		if (this._map.options.zoomAnimation) {
  			this._map._animateZoom(this._center, this._map._limitZoom(this._zoom), true, this._map.options.zoomSnap);
  		} else {
  			this._map._resetView(this._center, this._map._limitZoom(this._zoom));
  		}
  	}
  });

  // @section Handlers
  // @property touchZoom: Handler
  // Touch zoom handler.
  Map.addInitHook('addHandler', 'touchZoom', TouchZoom);

  Map.BoxZoom = BoxZoom;
  Map.DoubleClickZoom = DoubleClickZoom;
  Map.Drag = Drag;
  Map.Keyboard = Keyboard;
  Map.ScrollWheelZoom = ScrollWheelZoom;
  Map.TapHold = TapHold;
  Map.TouchZoom = TouchZoom;

  exports.Bounds = Bounds;
  exports.Browser = Browser;
  exports.CRS = CRS;
  exports.Canvas = Canvas;
  exports.Circle = Circle;
  exports.CircleMarker = CircleMarker;
  exports.Class = Class;
  exports.Control = Control;
  exports.DivIcon = DivIcon;
  exports.DivOverlay = DivOverlay;
  exports.DomEvent = DomEvent;
  exports.DomUtil = DomUtil;
  exports.Draggable = Draggable;
  exports.Evented = Evented;
  exports.FeatureGroup = FeatureGroup;
  exports.GeoJSON = GeoJSON;
  exports.GridLayer = GridLayer;
  exports.Handler = Handler;
  exports.Icon = Icon;
  exports.ImageOverlay = ImageOverlay;
  exports.LatLng = LatLng;
  exports.LatLngBounds = LatLngBounds;
  exports.Layer = Layer;
  exports.LayerGroup = LayerGroup;
  exports.LineUtil = LineUtil;
  exports.Map = Map;
  exports.Marker = Marker;
  exports.Mixin = Mixin;
  exports.Path = Path;
  exports.Point = Point;
  exports.PolyUtil = PolyUtil;
  exports.Polygon = Polygon;
  exports.Polyline = Polyline;
  exports.Popup = Popup;
  exports.PosAnimation = PosAnimation;
  exports.Projection = index;
  exports.Rectangle = Rectangle;
  exports.Renderer = Renderer;
  exports.SVG = SVG;
  exports.SVGOverlay = SVGOverlay;
  exports.TileLayer = TileLayer;
  exports.Tooltip = Tooltip;
  exports.Transformation = Transformation;
  exports.Util = Util;
  exports.VideoOverlay = VideoOverlay;
  exports.bind = bind;
  exports.bounds = toBounds;
  exports.canvas = canvas;
  exports.circle = circle;
  exports.circleMarker = circleMarker;
  exports.control = control;
  exports.divIcon = divIcon;
  exports.extend = extend;
  exports.featureGroup = featureGroup;
  exports.geoJSON = geoJSON;
  exports.geoJson = geoJson;
  exports.gridLayer = gridLayer;
  exports.icon = icon;
  exports.imageOverlay = imageOverlay;
  exports.latLng = toLatLng;
  exports.latLngBounds = toLatLngBounds;
  exports.layerGroup = layerGroup;
  exports.map = createMap;
  exports.marker = marker;
  exports.point = toPoint;
  exports.polygon = polygon;
  exports.polyline = polyline;
  exports.popup = popup;
  exports.rectangle = rectangle;
  exports.setOptions = setOptions;
  exports.stamp = stamp;
  exports.svg = svg;
  exports.svgOverlay = svgOverlay;
  exports.tileLayer = tileLayer;
  exports.tooltip = tooltip;
  exports.transformation = toTransformation;
  exports.version = version;
  exports.videoOverlay = videoOverlay;

  var oldL = window.L;
  exports.noConflict = function() {
  	window.L = oldL;
  	return this;
  }
  // Always export us to window global (see #2364)
  window.L = exports;

}));
//# sourceMappingURL=leaflet-src.js.map


/***/ }),

/***/ 540:
/***/ ((module) => {

"use strict";


/* istanbul ignore next  */
function insertStyleElement(options) {
  var element = document.createElement("style");
  options.setAttributes(element, options.attributes);
  options.insert(element, options.options);
  return element;
}
module.exports = insertStyleElement;

/***/ }),

/***/ 601:
/***/ ((module) => {

"use strict";


module.exports = function (i) {
  return i[1];
};

/***/ }),

/***/ 659:
/***/ ((module) => {

"use strict";


var memo = {};

/* istanbul ignore next  */
function getTarget(target) {
  if (typeof memo[target] === "undefined") {
    var styleTarget = document.querySelector(target);

    // Special case to return head of iframe instead of iframe itself
    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
      try {
        // This will throw an exception if access to iframe is blocked
        // due to cross-origin restrictions
        styleTarget = styleTarget.contentDocument.head;
      } catch (e) {
        // istanbul ignore next
        styleTarget = null;
      }
    }
    memo[target] = styleTarget;
  }
  return memo[target];
}

/* istanbul ignore next  */
function insertBySelector(insert, style) {
  var target = getTarget(insert);
  if (!target) {
    throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");
  }
  target.appendChild(style);
}
module.exports = insertBySelector;

/***/ }),

/***/ 825:
/***/ ((module) => {

"use strict";


/* istanbul ignore next  */
function apply(styleElement, options, obj) {
  var css = "";
  if (obj.supports) {
    css += "@supports (".concat(obj.supports, ") {");
  }
  if (obj.media) {
    css += "@media ".concat(obj.media, " {");
  }
  var needLayer = typeof obj.layer !== "undefined";
  if (needLayer) {
    css += "@layer".concat(obj.layer.length > 0 ? " ".concat(obj.layer) : "", " {");
  }
  css += obj.css;
  if (needLayer) {
    css += "}";
  }
  if (obj.media) {
    css += "}";
  }
  if (obj.supports) {
    css += "}";
  }
  var sourceMap = obj.sourceMap;
  if (sourceMap && typeof btoa !== "undefined") {
    css += "\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), " */");
  }

  // For old IE
  /* istanbul ignore if  */
  options.styleTagTransform(css, styleElement, options.options);
}
function removeStyleElement(styleElement) {
  // istanbul ignore if
  if (styleElement.parentNode === null) {
    return false;
  }
  styleElement.parentNode.removeChild(styleElement);
}

/* istanbul ignore next  */
function domAPI(options) {
  if (typeof document === "undefined") {
    return {
      update: function update() {},
      remove: function remove() {}
    };
  }
  var styleElement = options.insertStyleElement(options);
  return {
    update: function update(obj) {
      apply(styleElement, options, obj);
    },
    remove: function remove() {
      removeStyleElement(styleElement);
    }
  };
}
module.exports = domAPI;

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/nonce */
/******/ 	(() => {
/******/ 		__webpack_require__.nc = undefined;
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be in strict mode.
(() => {
"use strict";

// NAMESPACE OBJECT: ./node_modules/socket.io-parser/build/esm/index.js
var socket_io_parser_build_esm_namespaceObject = {};
__webpack_require__.r(socket_io_parser_build_esm_namespaceObject);
__webpack_require__.d(socket_io_parser_build_esm_namespaceObject, {
  Decoder: () => (Decoder),
  Encoder: () => (Encoder),
  PacketType: () => (PacketType),
  protocol: () => (build_esm_protocol)
});

;// ./user/src/script/data/local/product.js
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var productData = [{
  id: 'hobby-1-1',
  category: 'Photography',
  name: 'Canon EOS 80D',
  description: 'DSLR camera for enthusiasts',
  price: 12000000,
  imageUrl: './logo-pinjemin.png',
  type: 'buy' // 'buy' or 'rent'
}, {
  id: 'hobby-1-2',
  category: 'Photography',
  name: 'Sony Alpha a6000',
  description: 'Mirrorless camera with fast autofocus',
  price: 9000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '24 hours' // '12 hours' or '24 hours' (only if type is 'rent')
}, {
  id: 'hobby-2-1',
  category: 'Gaming',
  name: 'PlayStation 5',
  description: 'Next-gen gaming console',
  price: 8000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '24 hours'
}, {
  id: 'hobby-2-2',
  category: 'Gaming',
  name: 'Gaming PC',
  description: 'Custom-built high-end gaming PC',
  price: 25000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-3-1',
  category: 'Reading',
  name: 'Kindle Paperwhite',
  description: 'E-reader with adjustable warm light',
  price: 2000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-3-2',
  category: 'Reading',
  name: 'Noise Cancelling Headphones',
  description: 'Headphones for distraction-free reading',
  price: 3500000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-4-1',
  category: 'Cooking',
  name: 'KitchenAid Stand Mixer',
  description: 'Versatile stand mixer for baking',
  price: 7000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-4-2',
  category: 'Cooking',
  name: 'Sous Vide Immersion Circulator',
  description: 'Precision cooking device',
  price: 3000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '24 hours'
}, {
  id: 'hobby-5-1',
  category: 'Gardening',
  name: 'Gardening Tool Set',
  description: 'Complete gardening tool set',
  price: 1000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '12 hours'
}, {
  id: 'hobby-5-2',
  category: 'Gardening',
  name: 'Raised Garden Bed',
  description: 'Elevated garden bed',
  price: 2000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-6-1',
  category: 'Music',
  name: 'Acoustic Guitar',
  description: 'Beginner-friendly acoustic guitar',
  price: 1500000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '24 hours'
}, {
  id: 'hobby-6-2',
  category: 'Music',
  name: 'Headphones',
  description: 'Studio-quality headphones',
  price: 2500000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-7-1',
  category: 'Sports',
  name: 'Basketball',
  description: 'Official size basketball',
  price: 300000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-7-2',
  category: 'Sports',
  name: 'Tennis Racket',
  description: 'Lightweight tennis racket',
  price: 1200000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '12 hours'
}, {
  id: 'hobby-8-1',
  category: 'Drawing',
  name: 'Drawing Pencils',
  description: 'Set of drawing pencils',
  price: 200000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-8-2',
  category: 'Drawing',
  name: 'Easel',
  description: 'Adjustable easel',
  price: 1000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-9-1',
  category: 'Traveling',
  name: 'Backpack',
  description: 'Travel backpack',
  price: 1000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-9-2',
  category: 'Traveling',
  name: 'Camera',
  description: 'Compact camera',
  price: 3000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'rent',
  rentDuration: '24 hours'
}, {
  id: 'hobby-10-1',
  category: 'Writing',
  name: 'Laptop',
  description: 'Lightweight laptop',
  price: 8000000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}, {
  id: 'hobby-10-2',
  category: 'Writing',
  name: 'Keyboard',
  description: 'Mechanical keyboard',
  price: 1500000,
  imageUrl: 'https://via.placeholder.com/150',
  type: 'buy'
}];
console.log(productData);
var Products = /*#__PURE__*/function () {
  function Products() {
    _classCallCheck(this, Products);
  }
  return _createClass(Products, null, [{
    key: "getAll",
    value: function getAll() {
      return productData;
    }
  }, {
    key: "getByCategory",
    value: function getByCategory(category) {
      var loweredCaseCategory = category.toLowerCase();
      return productData.filter(function (product) {
        var loweredCaseProductCategory = (product.category || '').toLowerCase();
        return loweredCaseProductCategory.includes(loweredCaseCategory);
      });
    }
  }, {
    key: "getByType",
    value: function getByType(type) {
      var loweredCaseType = type.toLowerCase();
      return productData.filter(function (product) {
        var loweredCaseProductType = (product.type || '').toLowerCase();
        return loweredCaseProductType.includes(loweredCaseType);
      });
    }
  }, {
    key: "searchProduct",
    value: function searchProduct(query) {
      var loweredCaseQuery = query.toLowerCase();
      return productData.filter(function (product) {
        var loweredCaseProductName = (product.name || '').toLowerCase();
        return loweredCaseProductName.includes(loweredCaseQuery);
      });
    }
  }, {
    key: "addProduct",
    value: function addProduct(product) {
      productData.push(product);
    }
  }]);
}();
/* harmony default export */ const product = (Products);
;// ./user/src/script/utils/apiService.js
function apiService_typeof(o) { "@babel/helpers - typeof"; return apiService_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, apiService_typeof(o); }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == apiService_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(apiService_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
// Define your backend base URL
var BASE_URL = 'https://api.pinjemin.site/api'; // <-- Pastikan URL ini benar

// Function to get the JWT token from localStorage
var getToken = function getToken() {
  return localStorage.getItem('token');
};

/**
 * Menghapus data autentikasi dari localStorage dan melakukan redirect ke halaman login.
 */
var clearAuthData = function clearAuthData() {
  localStorage.removeItem('token');
  localStorage.removeItem('user');
  // Dispatch event untuk memberi tahu komponen lain (misalnya navbar) bahwa pengguna telah logout
  var logoutEvent = new CustomEvent('userLoggedOut');
  window.dispatchEvent(logoutEvent);
  // Redirect ke halaman login
  window.location.hash = '#/login';
  alert('Sesi Anda telah berakhir. Silakan login kembali.'); // Beri tahu pengguna
};
var setAuthData = function setAuthData(token, user) {
  localStorage.setItem("token", token);
  localStorage.setItem("user", JSON.stringify(user));

  // Dispatch login event
  console.log("Dispatching userLoggedIn event...");
  window.dispatchEvent(new CustomEvent("userLoggedIn"));
};

/**
 * Melakukan permintaan terautentikasi ke API backend (dengan JSON body).
 * @param {string} endpoint - Endpoint API (misal '/auth/me').
 * @param {string} method - Metode HTTP (misal 'GET', 'POST', 'PATCH', 'DELETE').
 * @param {Object} [body=null] - Body permintaan dalam format JSON (untuk metode selain GET).
 * @returns {Promise<Object>} Respons dari API.
 */
var authenticatedRequest = /*#__PURE__*/function () {
  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(endpoint, method) {
    var body,
      url,
      token,
      options,
      response,
      errorBody,
      result,
      _args = arguments;
    return _regeneratorRuntime().wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          body = _args.length > 2 && _args[2] !== undefined ? _args[2] : null;
          url = "".concat(BASE_URL).concat(endpoint);
          token = localStorage.getItem('token');
          options = {
            method: method,
            headers: {
              'Content-Type': 'application/json'
            }
          };
          if (token) {
            options.headers['Authorization'] = "Bearer ".concat(token);
          }
          if (body && method !== 'GET') {
            options.body = JSON.stringify(body);
          }
          _context.prev = 6;
          _context.next = 9;
          return fetch(url, options);
        case 9:
          response = _context.sent;
          if (response.ok) {
            _context.next = 19;
            break;
          }
          if (!(response.status === 401 || response.status === 403)) {
            _context.next = 14;
            break;
          }
          // Clear data autentikasi lama
          clearAuthData();
          // Redirect ke halaman login
          // window.location.hash = '#/login'; // Sudah di dalam clearAuthData
          // Lempar error atau return indikator agar pemanggil tahu request gagal
          throw new Error('Authentication failed or expired.');
        case 14:
          _context.next = 16;
          return response.json();
        case 16:
          errorBody = _context.sent;
          // Coba parse JSON error body
          console.error("HTTP error! Status: ".concat(response.status), errorBody);
          // Lempar error dengan informasi yang lebih detail jika tersedia
          throw new Error("HTTP error! Status: ".concat(response.status, ": ").concat(errorBody.message || 'Unknown error'));
        case 19:
          _context.next = 21;
          return response.json();
        case 21:
          result = _context.sent;
          return _context.abrupt("return", result);
        case 25:
          _context.prev = 25;
          _context.t0 = _context["catch"](6);
          console.error('Error during API request:', _context.t0);
          // Jika error bukan dari response.ok (misal network error, type error, etc.)
          // dan belum ditangani redirect 401/403, re-throw error
          throw _context.t0;
        case 29:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[6, 25]]);
  }));
  return function authenticatedRequest(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

/**
 * Wrapper untuk permintaan GET terautentikasi (juga bisa digunakan untuk endpoint tanpa auth).
 * @param {string} endpoint - Endpoint API.
 * @returns {Promise<Object>} Respons dari API.
 */
var apiGet = function apiGet(endpoint) {
  return authenticatedRequest(endpoint, 'GET');
};

/**
 * Wrapper untuk permintaan POST terautentikasi (JSON body).
 * @param {string} endpoint - Endpoint API.
 * @param {Object} body - Body permintaan.
 * @returns {Promise<Object>} Respons dari API.
 */
var apiPost = function apiPost(endpoint, body) {
  return authenticatedRequest(endpoint, 'POST', body);
};

/**
 * Wrapper untuk permintaan PATCH terautentikasi (JSON body).
 * Saat ini endpoint PATCH item butuh FormData, jadi wrapper ini mungkin hanya untuk endpoint PATCH lain.
 * Jika backend memungkinkan PATCH item dengan JSON tanpa file, ini bisa digunakan.
 * @param {string} endpoint - Endpoint API.
 * @param {Object} body - Body permintaan.
 * @returns {Promise<Object>} Respons dari API.
 */
var apiPatch = function apiPatch(endpoint, body) {
  return authenticatedRequest(endpoint, 'PATCH', body);
};

/**
 * Wrapper untuk permintaan DELETE terautentikasi.
 * @param {string} endpoint - Endpoint API.
 * @returns {Promise<Object>} Respons dari API.
 */
var apiDelete = function apiDelete(endpoint) {
  return authenticatedRequest(endpoint, 'DELETE');
};

/**
 * Melakukan permintaan POST atau PATCH yang memerlukan autentikasi dengan Content-Type multipart/form-data (untuk file upload).
 * @param {string} method - Metode HTTP ('POST' atau 'PATCH').
 * @param {string} endpoint - Endpoint API (misal '/items' atau '/items/:id').
 * @param {FormData} formData - Objek FormData yang berisi data form dan file.
 * @returns {Promise<Object>} Respons dari API.
 */
var apiFormDataRequest = /*#__PURE__*/function () {
  var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(method, endpoint, formData) {
    var url, token, options, response, errorBody, result;
    return _regeneratorRuntime().wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          url = "".concat(BASE_URL).concat(endpoint);
          token = localStorage.getItem('token');
          options = {
            method: method,
            // Menggunakan parameter method
            body: formData,
            // Gunakan objek FormData sebagai body
            headers: {
              // JANGAN set 'Content-Type': 'multipart/form-data' di sini.
              // Browser akan menanganinya secara otomatis saat menggunakan FormData,
              // termasuk boundary yang benar.
            }
          }; // Tambahkan header Authorization jika token ada
          if (token) {
            options.headers['Authorization'] = "Bearer ".concat(token);
          }
          _context2.prev = 4;
          _context2.next = 7;
          return fetch(url, options);
        case 7:
          response = _context2.sent;
          if (response.ok) {
            _context2.next = 17;
            break;
          }
          if (!(response.status === 401 || response.status === 403)) {
            _context2.next = 12;
            break;
          }
          // Clear data autentikasi lama
          clearAuthData();
          // Redirect ke halaman login
          // window.location.hash = '#/login'; // Sudah di dalam clearAuthData
          // Lempar error atau return indikator agar pemanggil tahu request gagal
          throw new Error('Authentication failed or expired.');
        case 12:
          _context2.next = 14;
          return response.json();
        case 14:
          errorBody = _context2.sent;
          // Coba parse JSON error body
          console.error("HTTP error! Status: ".concat(response.status), errorBody);
          // Lempar error dengan informasi yang lebih detail jika tersedia
          throw new Error("HTTP error! Status: ".concat(response.status, ": ").concat(errorBody.message || 'Unknown error'));
        case 17:
          _context2.next = 19;
          return response.json();
        case 19:
          result = _context2.sent;
          return _context2.abrupt("return", result);
        case 23:
          _context2.prev = 23;
          _context2.t0 = _context2["catch"](4);
          console.error('Error during API request:', _context2.t0);
          // Jika error bukan dari response.ok (misal network error, type error, etc.)
          // dan belum ditangani redirect 401/403, re-throw error
          throw _context2.t0;
        case 27:
        case "end":
          return _context2.stop();
      }
    }, _callee2, null, [[4, 23]]);
  }));
  return function apiFormDataRequest(_x3, _x4, _x5) {
    return _ref2.apply(this, arguments);
  };
}();

/**
 * Subscribe to push notifications
 * @param {Object} subscription - Push subscription object
 * @returns {Promise<Object>} - Response from API
 */
var subscribeNotification = function subscribeNotification(subscription) {
  return apiPost('/notifications/subscribe', subscription);
};

/**
 * Unsubscribe from push notifications
 * @param {string} endpoint - Subscription endpoint
 * @returns {Promise<Object>} - Response from API
 */
var unsubscribeNotification = function unsubscribeNotification(endpoint) {
  return apiPost('/notifications/unsubscribe', {
    endpoint: endpoint
  });
};

/**
 * Get unread notification count
 * @returns {Promise<Object>} - Response from API with unread count
 */
var getUnreadNotificationCount = function getUnreadNotificationCount() {
  return apiGet('/notifications/unread-count');
};

/**
 * Get user notifications
 * @param {number} page - Page number
 * @param {number} limit - Number of notifications per page
 * @returns {Promise<Object>} - Response from API with notifications
 */
var getNotifications = function getNotifications() {
  var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
  var limit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
  return apiGet("/notifications?page=".concat(page, "&limit=").concat(limit));
};

/**
 * Mark notification as read
 * @param {number} id - Notification ID
 * @returns {Promise<Object>} - Response from API
 */
var markNotificationAsRead = function markNotificationAsRead(id) {
  return apiPatch("/notifications/".concat(id, "/read"));
};

/**
 * Mark all notifications as read
 * @returns {Promise<Object>} - Response from API
 */
var markAllNotificationsAsRead = function markAllNotificationsAsRead() {
  return apiPatch('/notifications/read-all');
};

// Export semua fungsi yang tersedia dalam satu statement kolektif di akhir file

;// ./user/src/script/components/navbar/app-bar.js
function app_bar_typeof(o) { "@babel/helpers - typeof"; return app_bar_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, app_bar_typeof(o); }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function app_bar_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function app_bar_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, app_bar_toPropertyKey(o.key), o); } }
function app_bar_createClass(e, r, t) { return r && app_bar_defineProperties(e.prototype, r), t && app_bar_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == app_bar_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
function _defineProperty(e, r, t) { return (r = app_bar_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function app_bar_toPropertyKey(t) { var i = app_bar_toPrimitive(t, "string"); return "symbol" == app_bar_typeof(i) ? i : i + ""; }
function app_bar_toPrimitive(t, r) { if ("object" != app_bar_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != app_bar_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


var AppBar = /*#__PURE__*/function (_HTMLElement) {
  function AppBar() {
    var _this;
    app_bar_classCallCheck(this, AppBar);
    _this = _callSuper(this, AppBar);
    // Methods defined with arrow functions are automatically bound
    // Toggle profile dropdown visibility
    _defineProperty(_this, "toggleProfileDropdown", function (event) {
      event.stopPropagation();
      var profileDropdownMenu = _this.querySelector('#profileDropdownMenu');
      if (profileDropdownMenu) {
        profileDropdownMenu.classList.toggle('hidden');
      }
    });
    // Hide profile dropdown when clicking outside
    _defineProperty(_this, "hideProfileDropdown", function (event) {
      var profileArea = _this.querySelector('.profile-area');
      var profileDropdownMenu = _this.querySelector('#profileDropdownMenu');
      if (profileArea && profileDropdownMenu && event.target && !profileArea.contains(event.target) && !profileDropdownMenu.contains(event.target)) {
        profileDropdownMenu.classList.add('hidden');
      }
    });
    _defineProperty(_this, "handleLogout", function () {
      _this.showLogoutModal();
    });
    _defineProperty(_this, "handleLoginStatusChange", function () {
      _this.updateNavbarBasedOnLoginStatus();
      _this.setupProfileDropdownToggle();
      _this.setupLogoutListener();
    });
    _defineProperty(_this, "openDrawer", function () {
      var mobileDrawer = _this.querySelector('#mobile-drawer');
      var drawerOverlay = _this.querySelector('#drawer-overlay');
      if (mobileDrawer && drawerOverlay) {
        // Show overlay
        drawerOverlay.classList.remove('hidden');
        // Force reflow before adding transform classes for smooth animation
        drawerOverlay.offsetHeight;

        // Slide in drawer
        mobileDrawer.classList.remove('-translate-x-full');

        // Prevent body scroll when drawer is open
        document.body.style.overflow = 'hidden';
      }
    });
    _defineProperty(_this, "closeDrawer", function () {
      var mobileDrawer = _this.querySelector('#mobile-drawer');
      var drawerOverlay = _this.querySelector('#drawer-overlay');
      if (mobileDrawer && drawerOverlay) {
        // Slide out drawer
        mobileDrawer.classList.add('-translate-x-full');

        // Hide overlay after animation completes
        setTimeout(function () {
          drawerOverlay.classList.add('hidden');
        }, 300); // Match transition duration

        // Restore body scroll
        document.body.style.overflow = '';
      }
    });
    return _this;
  }
  _inherits(AppBar, _HTMLElement);
  return app_bar_createClass(AppBar, [{
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }
  }, {
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
      this._setupCategoryDropdownToggle();
      this.setupProfileDropdownToggle();
      this.setupLogoutListener();
      this.setupMobileMenuToggle();

      // Add event listeners for login/logout
      window.addEventListener('userLoggedIn', this.handleLoginStatusChange);
      window.addEventListener('userLoggedOut', this.handleLoginStatusChange);

      // Check login status on first load
      this.updateNavbarBasedOnLoginStatus();

      // Add body padding to compensate for fixed header
      this.addBodyPadding();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      // Remove event listeners
      window.removeEventListener('userLoggedIn', this.handleLoginStatusChange);
      window.removeEventListener('userLoggedOut', this.handleLoginStatusChange);

      // Remove profile dropdown listeners
      var profileArea = this.querySelector('.profile-area');
      if (profileArea) {
        profileArea.removeEventListener('click', this.toggleProfileDropdown);
      }
      document.removeEventListener('click', this.hideProfileDropdown);

      // Remove logout listener
      var profileDropdownMenu = this.querySelector('#profileDropdownMenu');
      if (profileDropdownMenu && this.handleLogoutClickDelegate) {
        profileDropdownMenu.removeEventListener('click', this.handleLogoutClickDelegate);
      }

      // Remove mobile menu listeners
      var mobileMenuButton = this.querySelector('#mobile-menu-button');
      if (mobileMenuButton && this._mobileMenuButtonHandler) {
        mobileMenuButton.removeEventListener('click', this._mobileMenuButtonHandler);
        this._mobileMenuButtonHandler = null;
      }

      // Remove drawer overlay listener
      if (this._drawerOverlayHandler) {
        document.removeEventListener('click', this._drawerOverlayHandler);
        this._drawerOverlayHandler = null;
      }

      // Remove body padding
      this.removeBodyPadding();
    }
  }, {
    key: "addBodyPadding",
    value: function addBodyPadding() {
      // Add padding-top to body to compensate for fixed header
      document.body.style.paddingTop = '100px'; // Adjust based on header height
    }
  }, {
    key: "removeBodyPadding",
    value: function removeBodyPadding() {
      // Remove padding when component is disconnected
      document.body.style.paddingTop = '';
    }
  }, {
    key: "render",
    value: function render() {
      this._emptyContent();
      var categories = typeof product !== 'undefined' && product.getAll ? _toConsumableArray(new Set(product.getAll().map(function (product) {
        return product.category;
      }))) : [];
      this.innerHTML = "\n        <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n                /* Modal animation */\n#logout-modal.show {\n    animation: fadeIn 0.3s ease-out;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: scale(0.9);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n        </style>\n            <!-- Fixed Header -->\n            <div class=\"fixed top-0 left-0 right-0 bg-white shadow-sm z-50\">\n                <div class=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n                    \n                    <!-- Mobile Menu Button (Left) -->\n                    <div class=\"flex items-center md:hidden\">\n                        <button id=\"mobile-menu-button\" type=\"button\" class=\"text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-200 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                            <span class=\"sr-only\">Open main menu</span>\n                            <!-- Hamburger icon -->\n                            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n                            </svg>\n                        </button>\n                    </div>\n\n                    <!-- Logo (Center on mobile, Left on desktop) -->\n                    <div class=\"flex items-center justify-center md:justify-start flex-1 md:flex-none\">\n                        <div class=\"text-xl font-bold text-gray-800 flex items-center\">\n                            <img src=\"./logo-pinjemin.png\" class=\"mr-2 h-16 inline-block\" alt=\"Pinjemin Logo\">\n                        </div>\n                    </div>\n\n                    <!-- Desktop Navigation (Hidden on mobile) -->\n                    <nav class=\"hidden md:flex items-center space-x-8 flex-1 justify-center\">\n                        <a href=\"/#/home\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                            Home\n                        </a>\n                        <a href=\"/#/community\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                            Komunitas\n                        </a>\n                        <a href=\"/#/hobby\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200\">\n                            Hobby\n                        </a>\n                        <a href=\"/#/my-rentals\" class=\"text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200 user-authenticated-nav-link hidden\">\n                            Pinjaman Saya\n                        </a>\n                    </nav>\n\n                    <!-- Right Section: Auth/Profile -->\n                    <div class=\"flex items-center space-x-3\">\n                        <notification-badge class=\"user-authenticated-nav-link hidden\"></notification-badge>\n                        <!-- Authentication Links (Show when NOT logged in) -->\n                        <!-- Authentication Links (Show when NOT logged in) -->\n                        <div class=\"auth-links flex items-center space-x-2\">\n                            <a href=\"/#/login\" class=\"text-sm font-medium text-gray-700 hover:text-blue-600 px-3 py-2 rounded-lg hover:bg-gray-50 transition-all duration-200\">\n                                Sign In\n                            </a>\n                            <a href=\"/#/register\" class=\"text-sm font-medium bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200\">\n                                Register\n                            </a>\n                        </div>\n\n                        <!-- User Info Area (Visible when logged in) -->\n                        <div class=\"user-info-area relative hidden\">\n                            <div class=\"profile-area flex items-center space-x-2 cursor-pointer text-gray-700 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-50 transition-all duration-200\">\n                                <div class=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"w-5 h-5 text-blue-600\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 0 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z\" />\n                                    </svg>\n                                </div>\n                                <span class=\"font-medium text-sm hidden sm:inline\" id=\"navbar-user-name\"></span>\n                                <svg class=\"w-4 h-4 transition-transform duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n                                </svg>\n                            </div>\n                            \n                            <!-- Profile Dropdown Menu -->\n                            <div id=\"profileDropdownMenu\" class=\"absolute right-0 top-full mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 hidden z-20\">\n                                <div class=\"px-4 py-3 border-b border-gray-100\">\n                                    <p class=\"text-sm font-medium text-gray-900\" id=\"dropdown-user-name\"></p>\n                                    <p class=\"text-xs text-gray-500\">Selamat datang kembali!</p>\n                                </div>\n                                <a href=\"/#/profile\" class=\"flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                                    </svg>\n                                    Profil Saya\n                                </a>\n                                <a href=\"/#/my-items\" class=\"flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                                    </svg>\n                                    Item Saya\n                                </a>\n                                <a href=\"/#/my-transactions\" class=\"flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\"></path>\n                                    </svg>\n                                    Transaksi Pembelian\n                                </a>\n                                <a href=\"/#/my-sales\" class=\"flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 00-2-2z\"></path>\n                                    </svg>\n                                    Penjualan Saya\n                                </a>\n                                <hr class=\"my-2\">\n                                <button id=\"logout-button\" class=\"flex items-center w-full px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200\">\n                                    <svg class=\"w-4 h-4 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"></path>\n                                    </svg>\n                                    Logout\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Mobile Drawer Overlay -->\n            <div id=\"drawer-overlay\" class=\"fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden transition-opacity duration-300\"></div>\n\n            <!-- Mobile Drawer Menu -->\n            <div id=\"mobile-drawer\" class=\"fixed top-0 left-0 h-full w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden\">\n                <!-- Drawer Header -->\n                <div class=\"flex items-center justify-between p-4 border-b border-gray-200\">\n                    <div class=\"flex items-center space-x-3\">\n                        <img src=\"./logo-pinjemin.png\" class=\"h-8\" alt=\"Pinjemin Logo\">\n                        <span class=\"text-lg font-bold text-gray-800\">Pinjemin</span>\n                    </div>\n                    <button id=\"close-drawer-button\" class=\"text-gray-400 hover:text-gray-600 focus:outline-none p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                        </svg>\n                    </button>\n                </div>\n\n                <!-- Drawer Content -->\n                <div class=\"flex flex-col h-full overflow-y-auto\">\n                    <!-- User Info Section (When logged in) -->\n                    <div class=\"drawer-user-info hidden border-b border-gray-200 p-4\">\n                        <div class=\"flex items-center space-x-3\">\n                            <div class=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"w-6 h-6 text-blue-600\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 0 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z\" />\n                                </svg>\n                            </div>\n                            <div>\n                                <p class=\"font-medium text-gray-900\" id=\"drawer-user-name\"></p>\n                                <p class=\"text-sm text-gray-500\">Selamat datang!</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Auth Links (When not logged in) -->\n                    <div class=\"drawer-auth-links border-b border-gray-200 p-4\">\n                        <div class=\"space-y-3\">\n                            <a href=\"/#/login\" class=\"flex items-center justify-center w-full py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors duration-200 font-medium\">\n                                Sign In\n                            </a>\n                            <a href=\"/#/register\" class=\"flex items-center justify-center w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium\">\n                                Register\n                            </a>\n                        </div>\n                    </div>\n\n                    <!-- Navigation Links -->\n                    <nav class=\"flex-1 px-4 py-4\">\n                        <ul class=\"space-y-2\">\n                            <li>\n                                <a href=\"/#/home\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"></path>\n                                    </svg>\n                                    Home\n                                </a>\n                            </li>\n                            <li>\n                                <a href=\"/#/community\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                                    </svg>\n                                    Komunitas\n                                </a>\n                            </li>\n                            <li>\n                                <a href=\"/#/hobby\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                                    </svg>\n                                    Hobby\n                                </a>\n                            </li>\n                            \n                            <!-- Authenticated Links -->\n                            <li class=\"drawer-authenticated-nav-link hidden\">\n                                <a href=\"/#/my-rentals\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"></path>\n                                    </svg>\n                                    Pinjaman Saya\n                                </a>\n                            </li>\n                            <li class=\"drawer-authenticated-nav-link hidden\">\n                                <a href=\"/#/my-items\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                                    </svg>\n                                    Item Saya\n                                </a>\n                            </li>\n                            <li class=\"drawer-authenticated-nav-link hidden\">\n                                <a href=\"/#/my-transactions\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\"></path>\n                                    </svg>\n                                    Transaksi Pembelian\n                                </a>\n                            </li>\n                            <li class=\"drawer-authenticated-nav-link hidden\">\n                                <a href=\"/#/my-sales\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200\">\n                                    <svg class=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 00-2-2z\"></path>\n                                    </svg>\n                                    Penjualan Saya\n                                </a>\n                            </li>\n                        </ul>\n                    </nav>\n\n                    <!-- Logout Button (When logged in) -->\n                    <div class=\"drawer-logout-section hidden border-t border-gray-200 p-4\">\n                        <button id=\"drawer-logout-button\" class=\"flex items-center w-full px-4 py-3 text-red-600 rounded-lg hover:bg-red-50 transition-colors duration-200\">\n                            <svg class=\"w-5 h-5 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"></path>\n                            </svg>\n                            Logout\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <!-- Logout Confirmation Modal -->\n<div id=\"logout-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden\">\n    <div class=\"bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl\">\n        <div class=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <svg class=\"w-8 h-8 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"></path>\n            </svg>\n        </div>\n        <h3 class=\"text-xl font-bold text-gray-800 mb-2\">Konfirmasi Logout</h3>\n        <p class=\"text-gray-600 mb-6\">Apakah Anda yakin ingin keluar?</p>\n        <div class=\"flex gap-3\">\n            <button id=\"cancel-logout-btn\" class=\"flex-1 bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-xl hover:bg-gray-300 transition-all duration-200\">\n                Batal\n            </button>\n            <button id=\"confirm-logout-btn\" class=\"flex-1 bg-gradient-to-r from-red-600 to-red-700 text-white font-bold py-3 px-6 rounded-xl hover:from-red-700 hover:to-red-800 transition-all duration-200\">\n                Ya, Keluar\n            </button>\n        </div>\n    </div>\n</div>\n        ";
    }

    // Setup event listener for the profile dropdown toggle
  }, {
    key: "setupProfileDropdownToggle",
    value: function setupProfileDropdownToggle() {
      var profileArea = this.querySelector('.profile-area');
      var profileDropdownMenu = this.querySelector('#profileDropdownMenu');
      if (profileArea && profileDropdownMenu) {
        profileArea.addEventListener('click', this.toggleProfileDropdown);
        document.addEventListener('click', this.hideProfileDropdown);
      }
    }
  }, {
    key: "setupLogoutListener",
    value:
    // Setup logout listener using event delegation
    function setupLogoutListener() {
      var _this2 = this;
      var profileDropdownMenu = this.querySelector('#profileDropdownMenu');
      if (profileDropdownMenu) {
        if (this.handleLogoutClickDelegate) {
          profileDropdownMenu.removeEventListener('click', this.handleLogoutClickDelegate);
        }
        this.handleLogoutClickDelegate = function (event) {
          if (event.target && event.target.id === 'logout-button') {
            event.preventDefault();
            _this2.handleLogout();
          }
        };
        profileDropdownMenu.addEventListener('click', this.handleLogoutClickDelegate);
      }

      // Setup drawer logout button
      var drawerLogoutButton = this.querySelector('#drawer-logout-button');
      if (drawerLogoutButton) {
        drawerLogoutButton.addEventListener('click', this.handleLogout);
      }
    }
  }, {
    key: "showLogoutModal",
    value: function showLogoutModal() {
      var _this3 = this;
      var modal = this.querySelector('#logout-modal');
      var cancelBtn = this.querySelector('#cancel-logout-btn');
      var confirmBtn = this.querySelector('#confirm-logout-btn');
      if (modal) {
        modal.classList.remove('hidden');

        // Setup event listeners
        if (cancelBtn) {
          cancelBtn.onclick = function () {
            modal.classList.add('hidden');
          };
        }
        if (confirmBtn) {
          confirmBtn.onclick = function () {
            modal.classList.add('hidden');
            clearAuthData();
            _this3.closeDrawer();
          };
        }

        // Close modal when clicking outside
        modal.onclick = function (e) {
          if (e.target === modal) {
            modal.classList.add('hidden');
          }
        };
      }
    }
  }, {
    key: "updateNavbarBasedOnLoginStatus",
    value: function updateNavbarBasedOnLoginStatus() {
      var user = localStorage.getItem('user');
      var token = localStorage.getItem('token');

      // Header elements
      var authLinksElement = this.querySelector('.auth-links');
      var userInfoAreaElement = this.querySelector('.user-info-area');
      var userNameElement = this.querySelector('#navbar-user-name');
      var dropdownUserNameElement = this.querySelector('#dropdown-user-name');

      // Desktop navigation
      var authenticatedNavLinks = this.querySelectorAll('.user-authenticated-nav-link');

      // Drawer elements
      var drawerAuthLinks = this.querySelector('.drawer-auth-links');
      var drawerUserInfo = this.querySelector('.drawer-user-info');
      var drawerUserNameElement = this.querySelector('#drawer-user-name');
      var drawerAuthenticatedLinks = this.querySelectorAll('.drawer-authenticated-nav-link');
      var drawerLogoutSection = this.querySelector('.drawer-logout-section');
      if (user && token) {
        var userData = JSON.parse(user);

        // Header Bar
        if (authLinksElement) {
          authLinksElement.classList.add('hidden');
        }
        if (userInfoAreaElement) {
          userInfoAreaElement.classList.remove('hidden');
          if (userNameElement) {
            userNameElement.textContent = userData.name;
          }
          if (dropdownUserNameElement) {
            dropdownUserNameElement.textContent = userData.name;
          }
        }

        // Desktop Navigation
        authenticatedNavLinks.forEach(function (link) {
          link.classList.remove('hidden');
        });

        // Drawer
        if (drawerAuthLinks) {
          drawerAuthLinks.classList.add('hidden');
        }
        if (drawerUserInfo) {
          drawerUserInfo.classList.remove('hidden');
          if (drawerUserNameElement) {
            drawerUserNameElement.textContent = userData.name;
          }
        }
        drawerAuthenticatedLinks.forEach(function (link) {
          link.classList.remove('hidden');
        });
        if (drawerLogoutSection) {
          drawerLogoutSection.classList.remove('hidden');
        }
      } else {
        // Header Bar
        if (authLinksElement) {
          authLinksElement.classList.remove('hidden');
        }
        if (userInfoAreaElement) {
          userInfoAreaElement.classList.add('hidden');
          var profileDropdownMenu = userInfoAreaElement.querySelector('#profileDropdownMenu');
          if (profileDropdownMenu) {
            profileDropdownMenu.classList.add('hidden');
          }
        }
        if (userNameElement) {
          userNameElement.textContent = '';
        }
        if (dropdownUserNameElement) {
          dropdownUserNameElement.textContent = '';
        }

        // Desktop Navigation
        authenticatedNavLinks.forEach(function (link) {
          link.classList.add('hidden');
        });

        // Drawer
        if (drawerAuthLinks) {
          drawerAuthLinks.classList.remove('hidden');
        }
        if (drawerUserInfo) {
          drawerUserInfo.classList.add('hidden');
        }
        if (drawerUserNameElement) {
          drawerUserNameElement.textContent = '';
        }
        drawerAuthenticatedLinks.forEach(function (link) {
          link.classList.add('hidden');
        });
        if (drawerLogoutSection) {
          drawerLogoutSection.classList.add('hidden');
        }
      }
    }

    // Mobile Menu Drawer Toggle
  }, {
    key: "setupMobileMenuToggle",
    value: function setupMobileMenuToggle() {
      var _this4 = this;
      var mobileMenuButton = this.querySelector('#mobile-menu-button');
      var mobileDrawer = this.querySelector('#mobile-drawer');
      var drawerOverlay = this.querySelector('#drawer-overlay');
      var closeDrawerButton = this.querySelector('#close-drawer-button');
      if (mobileMenuButton && mobileDrawer && drawerOverlay) {
        // Open drawer
        this._mobileMenuButtonHandler = function (event) {
          _this4.openDrawer();
        };
        mobileMenuButton.addEventListener('click', this._mobileMenuButtonHandler);

        // Close drawer via close button
        if (closeDrawerButton) {
          closeDrawerButton.addEventListener('click', function () {
            _this4.closeDrawer();
          });
        }

        // Close drawer via overlay click
        this._drawerOverlayHandler = function (event) {
          if (event.target === drawerOverlay) {
            _this4.closeDrawer();
          }
        };
        drawerOverlay.addEventListener('click', this._drawerOverlayHandler);

        // Close drawer when clicking navigation links
        var drawerLinks = mobileDrawer.querySelectorAll('a');
        drawerLinks.forEach(function (link) {
          link.addEventListener('click', function () {
            _this4.closeDrawer();
          });
        });

        // Close drawer on escape key
        document.addEventListener('keydown', function (event) {
          if (event.key === 'Escape' && !mobileDrawer.classList.contains('-translate-x-full')) {
            _this4.closeDrawer();
          }
        });
      } else {
        console.error("Mobile drawer elements not found:", {
          mobileMenuButton: mobileMenuButton,
          mobileDrawer: mobileDrawer,
          drawerOverlay: drawerOverlay
        });
      }
    }
  }, {
    key: "_setupCategoryDropdownToggle",
    value:
    // Category Dropdown (kept as is, adjusted slightly)
    function _setupCategoryDropdownToggle() {
      var categoryButton = this.querySelector('#categoryDropdownButton');
      var categoryMenu = this.querySelector('#categoryDropdownMenu');
      if (categoryButton && categoryMenu) {
        var toggleDropdown = function toggleDropdown(event) {
          event.stopPropagation();
          categoryMenu.classList.toggle('hidden');
        };
        categoryButton.addEventListener('click', toggleDropdown);
        var hideDropdown = function hideDropdown(event) {
          if (event.target && !categoryButton.contains(event.target) && !categoryMenu.contains(event.target) && !categoryMenu.classList.contains('hidden')) {
            categoryMenu.classList.add('hidden');
          }
        };
        document.addEventListener('click', hideDropdown);
        var hideDropdownOnScroll = function hideDropdownOnScroll() {
          if (categoryMenu && !categoryMenu.classList.contains('hidden')) {
            categoryMenu.classList.add('hidden');
          }
        };
        window.addEventListener('scroll', hideDropdownOnScroll);
      }
    }
  }]);
}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));
customElements.define("app-bar", AppBar);
;// ./user/src/script/utils/mlApiService.js
function mlApiService_typeof(o) { "@babel/helpers - typeof"; return mlApiService_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, mlApiService_typeof(o); }
function mlApiService_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ mlApiService_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == mlApiService_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(mlApiService_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function mlApiService_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function mlApiService_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { mlApiService_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { mlApiService_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
// Define the base URL for your ML/Recommendation APIs
var ML_BASE_URL = "https://exml.pinjemin.site/api"; // <-- Base URL for ML services

// Function to get the JWT token from localStorage (needed for user-based recs)
var mlApiService_getToken = function getToken() {
  return localStorage.getItem("token");
};

// Function to get user ID from token or localStorage
var getUserId = function getUserId() {
  var token = mlApiService_getToken();
  if (token) {
    try {
      // Decode JWT token to get user_id
      var payload = JSON.parse(atob(token.split(".")[1]));
      return payload.user_id || payload.id || payload.userId;
    } catch (error) {
      console.warn("Failed to decode token for user_id:", error);
    }
  }

  // Fallback: check if user_id is stored separately in localStorage
  var storedUserId = localStorage.getItem("user_id");
  if (storedUserId) {
    return Number.parseInt(storedUserId);
  }

  // If no user_id found, return null
  console.warn("No user_id found in token or localStorage");
  return null;
};

/**
 * Melakukan permintaan terautentikasi (jika token ada) atau tidak terautentikasi
 * ke API ML/Rekomendasi dengan body JSON.
 * Ini mirip dengan authenticatedRequest tapi dengan base URL yang berbeda.
 * @param {string} endpoint - Endpoint API ML (misal '/recommend/user').
 * @param {string} method - Metode HTTP (misal 'POST').
 * @param {Object} [body=null] - Body permintaan dalam format JSON.
 * @returns {Promise<Object>} Respons dari API ML.
 */
var mlRequest = /*#__PURE__*/function () {
  var _ref = mlApiService_asyncToGenerator(/*#__PURE__*/mlApiService_regeneratorRuntime().mark(function _callee(endpoint, method) {
    var body,
      url,
      token,
      options,
      response,
      errorBody,
      errorMessage,
      error,
      result,
      _args = arguments;
    return mlApiService_regeneratorRuntime().wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          body = _args.length > 2 && _args[2] !== undefined ? _args[2] : null;
          url = "".concat(ML_BASE_URL).concat(endpoint);
          token = mlApiService_getToken(); // Ambil token
          options = {
            method: method,
            headers: {
              "Content-Type": "application/json"
            }
          }; // Tambahkan header Authorization HANYA jika token ada
          if (token) {
            options.headers["Authorization"] = "Bearer ".concat(token);
          }
          if (body && method !== "GET") {
            // Rekomendasi API menggunakan POST dengan body
            options.body = JSON.stringify(body);
          }
          _context.prev = 6;
          _context.next = 9;
          return fetch(url, options);
        case 9:
          response = _context.sent;
          if (response.ok) {
            _context.next = 20;
            break;
          }
          _context.next = 13;
          return response.json()["catch"](function () {
            return null;
          });
        case 13:
          errorBody = _context.sent;
          console.error("ML API HTTP error! Status: ".concat(response.status), errorBody);
          errorMessage = errorBody && errorBody.message ? errorBody.message : "Unknown ML API error"; // Lempar error dengan informasi status dan pesan
          error = new Error("ML API Error: HTTP status ".concat(response.status, ": ").concat(errorMessage));
          error.status = response.status;
          error.body = errorBody;
          throw error;
        case 20:
          _context.next = 22;
          return response.json();
        case 22:
          result = _context.sent;
          return _context.abrupt("return", result);
        case 26:
          _context.prev = 26;
          _context.t0 = _context["catch"](6);
          console.error("Error during ML API request:", _context.t0);
          // Re-throw error untuk ditangani pemanggil
          throw _context.t0;
        case 30:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[6, 26]]);
  }));
  return function mlRequest(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

/**
 * Mengambil rekomendasi berdasarkan pengguna.
 * @param {number} userId - ID pengguna.
 * @param {number} topN - Jumlah rekomendasi yang diinginkan.
 * @returns {Promise<Object>} Daftar rekomendasi.
 */
var mlApiService_fetchUserRecommendations = function fetchUserRecommendations(userId) {
  var topN = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
  if (!userId) {
    throw new Error("User ID is required for user recommendations");
  }
  return mlRequest("/recommend/user", "POST", {
    user_id: userId,
    top_n: topN
  });
};

/**
 * Mengambil rekomendasi berdasarkan item.
 * @param {number} productId - ID item.
 * @param {number} topN - Jumlah rekomendasi yang diinginkan.
 * @param {number} [userId] - ID pengguna (optional, akan diambil otomatis jika tidak disediakan).
 * @returns {Promise<Object>} Daftar rekomendasi.
 */
var fetchItemRecommendations = function fetchItemRecommendations(productId) {
  var topN = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
  var userId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
  if (!productId) {
    throw new Error("Product ID is required for item recommendations");
  }

  // ✅ Ambil user_id otomatis jika tidak disediakan
  var finalUserId = userId || getUserId();
  if (!finalUserId) {
    throw new Error("User ID is required for item recommendations. Please login first.");
  }
  return mlRequest("/recommend/item", "POST", {
    product_id: productId,
    user_id: finalUserId,
    top_n: topN
  });
};

/**
 * Mengambil rekomendasi berdasarkan kata kunci pencarian.
 * @param {string} keyword - Kata kunci pencarian.
 * @param {number} topN - Jumlah rekomendasi yang diinginkan.
 * @param {number} [userId] - ID pengguna (optional, akan diambil otomatis jika tidak disediakan).
 * @returns {Promise<Object>} Daftar rekomendasi.
 */
var mlApiService_fetchSearchRecommendations = function fetchSearchRecommendations(keyword) {
  var topN = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
  var userId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
  if (!keyword || keyword.trim() === "") {
    throw new Error("Keyword is required for search recommendations");
  }

  // ✅ Ambil user_id otomatis jika tidak disediakan
  var finalUserId = userId || getUserId();
  if (!finalUserId) {
    throw new Error("User ID is required for search recommendations. Please login first.");
  }
  return mlRequest("/recommend/search", "POST", {
    keyword: keyword.trim(),
    user_id: finalUserId,
    top_n: topN
  });
};

/**
 * Refresh data ML (untuk admin atau maintenance)
 * @returns {Promise<Object>} Status refresh.
 */
var refreshMLData = function refreshMLData() {
  return mlRequest("/refresh_data", "POST", {});
};

// Export semua fungsi yang tersedia

// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet-src.js
var leaflet_src = __webpack_require__(481);
var leaflet_src_default = /*#__PURE__*/__webpack_require__.n(leaflet_src);
;// ./user/src/script/utils/geocodingUtils.js
function geocodingUtils_typeof(o) { "@babel/helpers - typeof"; return geocodingUtils_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, geocodingUtils_typeof(o); }
function geocodingUtils_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ geocodingUtils_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == geocodingUtils_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(geocodingUtils_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function geocodingUtils_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function geocodingUtils_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { geocodingUtils_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { geocodingUtils_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function geocodingUtils_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function geocodingUtils_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, geocodingUtils_toPropertyKey(o.key), o); } }
function geocodingUtils_createClass(e, r, t) { return r && geocodingUtils_defineProperties(e.prototype, r), t && geocodingUtils_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function geocodingUtils_defineProperty(e, r, t) { return (r = geocodingUtils_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function geocodingUtils_toPropertyKey(t) { var i = geocodingUtils_toPrimitive(t, "string"); return "symbol" == geocodingUtils_typeof(i) ? i : i + ""; }
function geocodingUtils_toPrimitive(t, r) { if ("object" != geocodingUtils_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != geocodingUtils_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
// Utility functions for geocoding and map operations

var GeocodingUtils = /*#__PURE__*/function () {
  function GeocodingUtils() {
    geocodingUtils_classCallCheck(this, GeocodingUtils);
  }
  return geocodingUtils_createClass(GeocodingUtils, null, [{
    key: "geocodeLocation",
    value: function () {
      var _geocodeLocation = geocodingUtils_asyncToGenerator(/*#__PURE__*/geocodingUtils_regeneratorRuntime().mark(function _callee(provinceName) {
        var cityName,
          cacheKey,
          normalizedProvince,
          normalizedCity,
          result,
          _result,
          query,
          controller,
          timeoutId,
          response,
          data,
          _result2,
          _result3,
          _result4,
          defaultResult,
          _args = arguments;
        return geocodingUtils_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              cityName = _args.length > 1 && _args[1] !== undefined ? _args[1] : null;
              if (provinceName) {
                _context.next = 4;
                break;
              }
              console.warn("No province name provided for geocoding");
              return _context.abrupt("return", {
                lat: -2.5489,
                lng: 118.0149,
                display_name: "Indonesia"
              });
            case 4:
              // Buat cache key berdasarkan provinsi dan kota
              cacheKey = cityName ? "".concat(provinceName.toUpperCase(), ":").concat(cityName.toUpperCase()) : provinceName.toUpperCase(); // Cek cache terlebih dahulu
              if (!this.geocodeCache[cacheKey]) {
                _context.next = 8;
                break;
              }
              console.log("Using cached geocode for ".concat(cacheKey));
              return _context.abrupt("return", this.geocodeCache[cacheKey]);
            case 8:
              // Cek fallback coordinates terlebih dahulu sebelum API call
              normalizedProvince = provinceName.toUpperCase();
              normalizedCity = cityName ? cityName.toUpperCase() : null; // Prioritas: Kota dulu, baru provinsi
              if (!(normalizedCity && this.fallbackCoords[normalizedCity])) {
                _context.next = 15;
                break;
              }
              console.log("Using fallback coordinates for city: ".concat(normalizedCity));
              result = this.fallbackCoords[normalizedCity];
              this.geocodeCache[cacheKey] = result;
              return _context.abrupt("return", result);
            case 15:
              if (!this.fallbackCoords[normalizedProvince]) {
                _context.next = 20;
                break;
              }
              console.log("Using fallback coordinates for province: ".concat(normalizedProvince));
              _result = this.fallbackCoords[normalizedProvince];
              this.geocodeCache[cacheKey] = _result;
              return _context.abrupt("return", _result);
            case 20:
              _context.prev = 20;
              query = cityName ? "".concat(cityName, ", ").concat(provinceName, ", Indonesia") : "".concat(provinceName, ", Indonesia");
              console.log("Geocoding: ".concat(query));

              // Tambahkan timeout untuk fetch request
              controller = new AbortController();
              timeoutId = setTimeout(function () {
                console.warn("Geocoding timeout for: ".concat(query));
                controller.abort();
              }, 8000); // 8 detik timeout
              _context.next = 27;
              return fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(query), "&limit=1&countrycodes=id"), {
                signal: controller.signal,
                headers: {
                  "User-Agent": "ProductMapApp/1.0"
                }
              });
            case 27:
              response = _context.sent;
              clearTimeout(timeoutId);
              if (response.ok) {
                _context.next = 31;
                break;
              }
              throw new Error("HTTP error! status: ".concat(response.status));
            case 31:
              _context.next = 33;
              return response.json();
            case 33:
              data = _context.sent;
              if (!(data && data.length > 0)) {
                _context.next = 41;
                break;
              }
              _result2 = {
                lat: Number.parseFloat(data[0].lat),
                lng: Number.parseFloat(data[0].lon),
                display_name: data[0].display_name
              }; // Cache hasil yang berhasil
              this.geocodeCache[cacheKey] = _result2;
              console.log("Successfully geocoded: ".concat(query));
              return _context.abrupt("return", _result2);
            case 41:
              console.warn("No geocoding results for: ".concat(query));
            case 42:
              _context.next = 57;
              break;
            case 44:
              _context.prev = 44;
              _context.t0 = _context["catch"](20);
              console.error("Geocoding API error:", _context.t0.message);

              // Jika API gagal, gunakan fallback lagi sebagai last resort
              if (!(normalizedCity && this.fallbackCoords[normalizedCity])) {
                _context.next = 52;
                break;
              }
              console.log("Using fallback after API error for city: ".concat(normalizedCity));
              _result3 = this.fallbackCoords[normalizedCity];
              this.geocodeCache[cacheKey] = _result3;
              return _context.abrupt("return", _result3);
            case 52:
              if (!this.fallbackCoords[normalizedProvince]) {
                _context.next = 57;
                break;
              }
              console.log("Using fallback after API error for province: ".concat(normalizedProvince));
              _result4 = this.fallbackCoords[normalizedProvince];
              this.geocodeCache[cacheKey] = _result4;
              return _context.abrupt("return", _result4);
            case 57:
              // Jika semua gagal, return koordinat default Indonesia
              console.warn("Fallback to Indonesia center for: ".concat(provinceName, ", ").concat(cityName || "no city"));
              defaultResult = {
                lat: -2.5489,
                lng: 118.0149,
                display_name: "Indonesia"
              };
              this.geocodeCache[cacheKey] = defaultResult;
              return _context.abrupt("return", defaultResult);
            case 61:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[20, 44]]);
      }));
      function geocodeLocation(_x) {
        return _geocodeLocation.apply(this, arguments);
      }
      return geocodeLocation;
    }()
  }, {
    key: "reverseGeocode",
    value: function () {
      var _reverseGeocode = geocodingUtils_asyncToGenerator(/*#__PURE__*/geocodingUtils_regeneratorRuntime().mark(function _callee2(lat, lng) {
        var controller, timeoutId, response, data;
        return geocodingUtils_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.prev = 0;
              controller = new AbortController();
              timeoutId = setTimeout(function () {
                return controller.abort();
              }, 8000);
              _context2.next = 5;
              return fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(lat, "&lon=").concat(lng, "&zoom=10&addressdetails=1"), {
                signal: controller.signal,
                headers: {
                  "User-Agent": "ProductMapApp/1.0"
                }
              });
            case 5:
              response = _context2.sent;
              clearTimeout(timeoutId);
              if (response.ok) {
                _context2.next = 9;
                break;
              }
              throw new Error("HTTP error! status: ".concat(response.status));
            case 9:
              _context2.next = 11;
              return response.json();
            case 11:
              data = _context2.sent;
              if (!(data && data.address)) {
                _context2.next = 14;
                break;
              }
              return _context2.abrupt("return", {
                province: data.address.state || data.address.province,
                city: data.address.city || data.address.town || data.address.village,
                display_name: data.display_name
              });
            case 14:
              return _context2.abrupt("return", null);
            case 17:
              _context2.prev = 17;
              _context2.t0 = _context2["catch"](0);
              console.error("Reverse geocoding error:", _context2.t0);
              return _context2.abrupt("return", null);
            case 21:
            case "end":
              return _context2.stop();
          }
        }, _callee2, null, [[0, 17]]);
      }));
      function reverseGeocode(_x2, _x3) {
        return _reverseGeocode.apply(this, arguments);
      }
      return reverseGeocode;
    }()
  }, {
    key: "getCurrentLocation",
    value: function getCurrentLocation() {
      return new Promise(function (resolve, reject) {
        if (!navigator.geolocation) {
          reject(new Error("Geolocation is not supported by this browser."));
          return;
        }
        navigator.geolocation.getCurrentPosition(function (position) {
          resolve({
            lat: position.coords.latitude,
            lng: position.coords.longitude
          });
        }, function (error) {
          reject(error);
        }, {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 600000
        });
      });
    }
  }, {
    key: "createMapIcon",
    value: function createMapIcon() {
      var isAvailable = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      // Check if L is available
      if (typeof (leaflet_src_default()) === "undefined") {
        console.error("Leaflet is not loaded");
        return null;
      }
      var color = isAvailable ? "#10b981" : "#ef4444";
      return leaflet_src_default().divIcon({
        html: "<div style=\"background-color: ".concat(color, "; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center;\">\n        <div style=\"width: 8px; height: 8px; background-color: white; border-radius: 50%;\"></div>\n      </div>"),
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12],
        className: "custom-marker"
      });
    }

    // Method untuk clear cache jika diperlukan
  }, {
    key: "clearCache",
    value: function clearCache() {
      this.geocodeCache = {};
      console.log("Geocoding cache cleared");
    }

    // Method untuk mendapatkan koordinat berdasarkan user location
  }, {
    key: "getUserLocationCoords",
    value: function () {
      var _getUserLocationCoords = geocodingUtils_asyncToGenerator(/*#__PURE__*/geocodingUtils_regeneratorRuntime().mark(function _callee3(user) {
        var provinceName, cityName;
        return geocodingUtils_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (user) {
                _context3.next = 2;
                break;
              }
              return _context3.abrupt("return", {
                lat: -2.5489,
                lng: 118.0149,
                display_name: "Indonesia"
              });
            case 2:
              provinceName = user.province_name;
              cityName = user.city_name;
              if (!provinceName) {
                _context3.next = 8;
                break;
              }
              _context3.next = 7;
              return this.geocodeLocation(provinceName, cityName);
            case 7:
              return _context3.abrupt("return", _context3.sent);
            case 8:
              return _context3.abrupt("return", {
                lat: -2.5489,
                lng: 118.0149,
                display_name: "Indonesia"
              });
            case 9:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function getUserLocationCoords(_x4) {
        return _getUserLocationCoords.apply(this, arguments);
      }
      return getUserLocationCoords;
    }()
  }]);
}();
// Static cache untuk menyimpan hasil geocoding
geocodingUtils_defineProperty(GeocodingUtils, "geocodeCache", {});
// Fallback coordinates untuk provinsi-provinsi di Indonesia
geocodingUtils_defineProperty(GeocodingUtils, "fallbackCoords", {
  // Sumatera
  ACEH: {
    lat: 4.695135,
    lng: 96.749397,
    display_name: "Aceh, Indonesia"
  },
  "SUMATERA UTARA": {
    lat: 3.597031,
    lng: 98.678513,
    display_name: "North Sumatra, Indonesia"
  },
  "SUMATERA BARAT": {
    lat: -0.789275,
    lng: 100.650863,
    display_name: "West Sumatra, Indonesia"
  },
  RIAU: {
    lat: 0.533333,
    lng: 101.447777,
    display_name: "Riau, Indonesia"
  },
  "KEPULAUAN RIAU": {
    lat: 0.916667,
    lng: 104.45,
    display_name: "Riau Islands, Indonesia"
  },
  JAMBI: {
    lat: -1.4851,
    lng: 102.4381,
    display_name: "Jambi, Indonesia"
  },
  "SUMATERA SELATAN": {
    lat: -3.3194,
    lng: 103.9144,
    display_name: "South Sumatra, Indonesia"
  },
  "BANGKA BELITUNG": {
    lat: -2.741,
    lng: 106.4405,
    display_name: "Bangka Belitung, Indonesia"
  },
  BENGKULU: {
    lat: -3.8004,
    lng: 102.2655,
    display_name: "Bengkulu, Indonesia"
  },
  LAMPUNG: {
    lat: -4.5585,
    lng: 105.4068,
    display_name: "Lampung, Indonesia"
  },
  // Jawa
  "DKI JAKARTA": {
    lat: -6.208763,
    lng: 106.845599,
    display_name: "Jakarta, Indonesia"
  },
  "JAWA BARAT": {
    lat: -6.914744,
    lng: 107.60981,
    display_name: "West Java, Indonesia"
  },
  "JAWA TENGAH": {
    lat: -7.150975,
    lng: 110.140259,
    display_name: "Central Java, Indonesia"
  },
  "DI YOGYAKARTA": {
    lat: -7.797068,
    lng: 110.370529,
    display_name: "Yogyakarta, Indonesia"
  },
  "JAWA TIMUR": {
    lat: -7.250445,
    lng: 112.768845,
    display_name: "East Java, Indonesia"
  },
  BANTEN: {
    lat: -6.4058,
    lng: 106.064,
    display_name: "Banten, Indonesia"
  },
  // Kalimantan
  "KALIMANTAN BARAT": {
    lat: -0.2787,
    lng: 111.4752,
    display_name: "West Kalimantan, Indonesia"
  },
  "KALIMANTAN TENGAH": {
    lat: -1.6814,
    lng: 113.3823,
    display_name: "Central Kalimantan, Indonesia"
  },
  "KALIMANTAN SELATAN": {
    lat: -3.0926,
    lng: 115.2838,
    display_name: "South Kalimantan, Indonesia"
  },
  "KALIMANTAN TIMUR": {
    lat: 1.5709,
    lng: 116.0187,
    display_name: "East Kalimantan, Indonesia"
  },
  "KALIMANTAN UTARA": {
    lat: 3.073,
    lng: 116.0413,
    display_name: "North Kalimantan, Indonesia"
  },
  // Sulawesi
  "SULAWESI UTARA": {
    lat: 0.6246,
    lng: 123.975,
    display_name: "North Sulawesi, Indonesia"
  },
  "SULAWESI TENGAH": {
    lat: -1.43,
    lng: 121.4456,
    display_name: "Central Sulawesi, Indonesia"
  },
  "SULAWESI SELATAN": {
    lat: -3.6687,
    lng: 119.974,
    display_name: "South Sulawesi, Indonesia"
  },
  "SULAWESI TENGGARA": {
    lat: -4.14491,
    lng: 122.174605,
    display_name: "Southeast Sulawesi, Indonesia"
  },
  GORONTALO: {
    lat: 0.6999,
    lng: 122.4467,
    display_name: "Gorontalo, Indonesia"
  },
  "SULAWESI BARAT": {
    lat: -2.8441,
    lng: 119.232,
    display_name: "West Sulawesi, Indonesia"
  },
  // Bali & Nusa Tenggara
  BALI: {
    lat: -8.4095,
    lng: 115.1889,
    display_name: "Bali, Indonesia"
  },
  "NUSA TENGGARA BARAT": {
    lat: -8.6529,
    lng: 117.3616,
    display_name: "West Nusa Tenggara, Indonesia"
  },
  "NUSA TENGGARA TIMUR": {
    lat: -8.6574,
    lng: 121.0794,
    display_name: "East Nusa Tenggara, Indonesia"
  },
  // Maluku & Papua
  MALUKU: {
    lat: -3.2385,
    lng: 130.1453,
    display_name: "Maluku, Indonesia"
  },
  "MALUKU UTARA": {
    lat: 1.5709,
    lng: 127.8089,
    display_name: "North Maluku, Indonesia"
  },
  "PAPUA BARAT": {
    lat: -1.3361,
    lng: 133.1747,
    display_name: "West Papua, Indonesia"
  },
  PAPUA: {
    lat: -4.269928,
    lng: 138.080353,
    display_name: "Papua, Indonesia"
  },
  // Kota-kota besar
  MEDAN: {
    lat: 3.5952,
    lng: 98.6722,
    display_name: "Medan, North Sumatra, Indonesia"
  },
  "KOTA MEDAN": {
    lat: 3.5952,
    lng: 98.6722,
    display_name: "Medan, North Sumatra, Indonesia"
  },
  JAKARTA: {
    lat: -6.208763,
    lng: 106.845599,
    display_name: "Jakarta, Indonesia"
  },
  BANDUNG: {
    lat: -6.917464,
    lng: 107.619123,
    display_name: "Bandung, West Java, Indonesia"
  },
  SURABAYA: {
    lat: -7.257472,
    lng: 112.752088,
    display_name: "Surabaya, East Java, Indonesia"
  },
  YOGYAKARTA: {
    lat: -7.797068,
    lng: 110.370529,
    display_name: "Yogyakarta, Indonesia"
  },
  SEMARANG: {
    lat: -6.966667,
    lng: 110.416664,
    display_name: "Semarang, Central Java, Indonesia"
  },
  MAKASSAR: {
    lat: -5.147665,
    lng: 119.432732,
    display_name: "Makassar, South Sulawesi, Indonesia"
  },
  PALEMBANG: {
    lat: -2.998169,
    lng: 104.756554,
    display_name: "Palembang, South Sumatra, Indonesia"
  },
  DENPASAR: {
    lat: -8.670458,
    lng: 115.212629,
    display_name: "Denpasar, Bali, Indonesia"
  }
});
;// ./user/src/script/components/ProductMap.js
function ProductMap_typeof(o) { "@babel/helpers - typeof"; return ProductMap_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, ProductMap_typeof(o); }
function ProductMap_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ ProductMap_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == ProductMap_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(ProductMap_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function ProductMap_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function ProductMap_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { ProductMap_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { ProductMap_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { ProductMap_defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function ProductMap_defineProperty(e, r, t) { return (r = ProductMap_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function ProductMap_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function ProductMap_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, ProductMap_toPropertyKey(o.key), o); } }
function ProductMap_createClass(e, r, t) { return r && ProductMap_defineProperties(e.prototype, r), t && ProductMap_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function ProductMap_toPropertyKey(t) { var i = ProductMap_toPrimitive(t, "string"); return "symbol" == ProductMap_typeof(i) ? i : i + ""; }
function ProductMap_toPrimitive(t, r) { if ("object" != ProductMap_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != ProductMap_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
// ProductMap.js

 // Import Leaflet library

var ProductMap = /*#__PURE__*/function () {
  function ProductMap(containerId) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    ProductMap_classCallCheck(this, ProductMap);
    this.containerId = containerId;
    this.options = _objectSpread({
      height: "400px",
      defaultZoom: 10,
      useMarkerClustering: false
    }, options);
    this.map = null;
    this.markers = [];
    this.markersGroup = null;
    this.isInitialized = false;
    this.userProvince = null;
    this.userCity = null;
    this.initialCenter = null;
    this.initialZoom = null;
    this.isInitializing = false;
    this.initializationPromise = null; // Track initialization promise
  }

  /**
   * Menunggu elemen kontainer peta tersedia di DOM dan memiliki dimensi.
   */
  return ProductMap_createClass(ProductMap, [{
    key: "waitForContainer",
    value: (function () {
      var _waitForContainer = ProductMap_asyncToGenerator(/*#__PURE__*/ProductMap_regeneratorRuntime().mark(function _callee() {
        var maxAttempts,
          attempts,
          container,
          currentWidth,
          currentHeight,
          _args = arguments;
        return ProductMap_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              maxAttempts = _args.length > 0 && _args[0] !== undefined ? _args[0] : 50;
              attempts = 0;
            case 2:
              if (!(attempts < maxAttempts)) {
                _context.next = 24;
                break;
              }
              container = document.getElementById(this.containerId);
              if (!container) {
                _context.next = 19;
                break;
              }
              // Pastikan kontainer terlihat dan memiliki dimensi
              container.style.width = "100%";
              container.style.height = this.options.height;
              container.style.display = "block";
              container.style.visibility = "visible";
              container.style.position = "relative";

              // Paksa reflow browser
              currentWidth = container.offsetWidth;
              currentHeight = container.offsetHeight;
              if (!(currentWidth > 0 && currentHeight > 0)) {
                _context.next = 16;
                break;
              }
              return _context.abrupt("return", container);
            case 16:
              console.log("Container ".concat(this.containerId, " found but not yet sized (").concat(currentWidth, "x").concat(currentHeight, "), retrying..."));
            case 17:
              _context.next = 19;
              break;
            case 19:
              _context.next = 21;
              return new Promise(function (resolve) {
                return setTimeout(resolve, 100);
              });
            case 21:
              attempts++;
              _context.next = 2;
              break;
            case 24:
              throw new Error("Container ".concat(this.containerId, " not found or not visible/sized after ").concat(maxAttempts, " attempts"));
            case 25:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function waitForContainer() {
        return _waitForContainer.apply(this, arguments);
      }
      return waitForContainer;
    }()
    /**
     * Menginisialisasi instance peta Leaflet.
     */
    )
  }, {
    key: "initializeMap",
    value: (function () {
      var _initializeMap = ProductMap_asyncToGenerator(/*#__PURE__*/ProductMap_regeneratorRuntime().mark(function _callee2() {
        var provinceName,
          cityName,
          result,
          _args2 = arguments;
        return ProductMap_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              provinceName = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : null;
              cityName = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : null;
              if (!this.initializationPromise) {
                _context2.next = 6;
                break;
              }
              _context2.next = 5;
              return this.initializationPromise;
            case 5:
              return _context2.abrupt("return", _context2.sent);
            case 6:
              if (!(this.isInitialized && this.map)) {
                _context2.next = 8;
                break;
              }
              return _context2.abrupt("return", true);
            case 8:
              // Buat promise untuk initialization
              this.initializationPromise = this._performInitialization(provinceName, cityName);
              _context2.prev = 9;
              _context2.next = 12;
              return this.initializationPromise;
            case 12:
              result = _context2.sent;
              return _context2.abrupt("return", result);
            case 14:
              _context2.prev = 14;
              this.initializationPromise = null; // Reset promise setelah selesai
              return _context2.finish(14);
            case 17:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[9,, 14, 17]]);
      }));
      function initializeMap() {
        return _initializeMap.apply(this, arguments);
      }
      return initializeMap;
    }())
  }, {
    key: "_performInitialization",
    value: function () {
      var _performInitialization2 = ProductMap_asyncToGenerator(/*#__PURE__*/ProductMap_regeneratorRuntime().mark(function _callee3() {
        var _this = this;
        var provinceName,
          cityName,
          container,
          center,
          zoom,
          coords,
          fallbackCoords,
          _args3 = arguments;
        return ProductMap_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              provinceName = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : null;
              cityName = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : null;
              if (!this.isInitializing) {
                _context3.next = 4;
                break;
              }
              return _context3.abrupt("return", false);
            case 4:
              this.isInitializing = true;
              _context3.prev = 5;
              if (!(typeof (leaflet_src_default()) === "undefined")) {
                _context3.next = 8;
                break;
              }
              throw new Error("Leaflet is not loaded. Please include Leaflet CSS and JS files.");
            case 8:
              _context3.next = 10;
              return this.destroy();
            case 10:
              _context3.next = 12;
              return this.waitForContainer();
            case 12:
              container = _context3.sent;
              // Simpan informasi user untuk pemfilteran nanti
              this.userProvince = provinceName;
              this.userCity = cityName;

              // Pastikan kontainer benar-benar bersih
              container.innerHTML = "";

              // Hapus referensi Leaflet internal
              if (container._leaflet_id) {
                delete container._leaflet_id;
              }
              container._leaflet_id = null;

              // Dapatkan koordinat berdasarkan lokasi user
              center = [-2.5489, 118.0149]; // Default Indonesia
              zoom = 5;
              if (!provinceName) {
                _context3.next = 36;
                break;
              }
              _context3.prev = 21;
              _context3.next = 24;
              return GeocodingUtils.geocodeLocation(provinceName, cityName);
            case 24:
              coords = _context3.sent;
              if (coords) {
                center = [coords.lat, coords.lng];
                zoom = cityName ? this.options.defaultZoom : 8; // Zoom lebih dekat jika ada kota
              }
              _context3.next = 36;
              break;
            case 28:
              _context3.prev = 28;
              _context3.t0 = _context3["catch"](21);
              console.error("Error geocoding user location:", _context3.t0);
              // Gunakan fallback coordinates
              _context3.next = 33;
              return GeocodingUtils.getUserLocationCoords({
                province_name: provinceName,
                city_name: cityName
              });
            case 33:
              fallbackCoords = _context3.sent;
              center = [fallbackCoords.lat, fallbackCoords.lng];
              zoom = cityName ? this.options.defaultZoom : 8;
            case 36:
              // Simpan posisi awal
              this.initialCenter = center;
              this.initialZoom = zoom;

              // Inisialisasi peta dengan kontainer dan opsi yang benar
              this.map = leaflet_src_default().map(this.containerId, {
                center: center,
                zoom: zoom,
                attributionControl: true,
                zoomControl: true,
                dragging: true,
                touchZoom: true,
                doubleClickZoom: true,
                scrollWheelZoom: true,
                boxZoom: true,
                keyboard: true,
                zoomAnimation: true,
                fadeAnimation: true,
                markerZoomAnimation: true,
                preferCanvas: false // Use SVG for better quality
              });

              // Tambahkan tile OpenStreetMap
              leaflet_src_default().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                attribution: "© OpenStreetMap contributors",
                maxZoom: 19,
                minZoom: 3
              }).addTo(this.map);

              // Inisialisasi grup marker
              this.markersGroup = leaflet_src_default().layerGroup().addTo(this.map);

              // Set flags
              this.isInitialized = true;
              this.isInitializing = false;

              // Paksa resize setelah inisialisasi
              setTimeout(function () {
                // --- FIXED --- Add a guard to ensure map exists after timeout
                if (_this.map) {
                  _this.map.invalidateSize(true);
                }
              }, 500);
              return _context3.abrupt("return", true);
            case 47:
              _context3.prev = 47;
              _context3.t1 = _context3["catch"](5);
              console.error("Error initializing ProductMap:", _context3.t1);
              this.isInitialized = false;
              this.isInitializing = false;
              this.map = null;
              throw _context3.t1;
            case 54:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[5, 47], [21, 28]]);
      }));
      function _performInitialization() {
        return _performInitialization2.apply(this, arguments);
      }
      return _performInitialization;
    }()
    /**
     * Menghapus semua marker dari peta.
     */
  }, {
    key: "clearMarkers",
    value: function clearMarkers() {
      if (this.markersGroup) {
        this.markersGroup.clearLayers();
      }
      this.markers = [];
    }

    /**
     * Menambahkan marker item ke peta.
     */
  }, {
    key: "addItemMarkers",
    value: function addItemMarkers(items) {
      var _this2 = this;
      var focusProvince = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      if (!this.isMapReady()) {
        console.error("Cannot add markers: map is not ready");
        return;
      }
      this.clearMarkers();
      var validItems = items.filter(function (item) {
        return item.latitude && item.longitude && !isNaN(Number.parseFloat(item.latitude)) && !isNaN(Number.parseFloat(item.longitude));
      });
      if (validItems.length === 0) {
        // Reset ke posisi awal user jika tidak ada marker
        if (this.initialCenter && this.initialZoom) {
          this.map.setView(this.initialCenter, this.initialZoom);
        }
        return;
      }

      // Filter item berdasarkan provinsi user jika ditentukan
      var itemsToShow = validItems;
      var provinceItemsOnly = [];
      if (focusProvince) {
        provinceItemsOnly = validItems.filter(function (item) {
          return item.province_name && item.province_name.toLowerCase().includes(focusProvince.toLowerCase());
        });
        if (provinceItemsOnly.length > 0) {
          itemsToShow = provinceItemsOnly;
        } else {}
      }

      // Buat markers
      var newMarkers = [];
      itemsToShow.forEach(function (item, index) {
        var lat = Number.parseFloat(item.latitude);
        var lng = Number.parseFloat(item.longitude);

        // Buat ikon kustom berdasarkan ketersediaan item
        var iconColor = "#6b7280"; // abu-abu default
        var iconClass = "fa-box";
        if (item.is_available_for_sell && item.is_available_for_rent) {
          iconColor = "#8b5cf6"; // ungu untuk keduanya
          iconClass = "fa-tags";
        } else if (item.is_available_for_sell) {
          iconColor = "#10b981"; // hijau untuk jual
          iconClass = "fa-tag";
        } else if (item.is_available_for_rent) {
          iconColor = "#3b82f6"; // biru untuk sewa
          iconClass = "fa-calendar-days";
        }

        // Tambahkan sedikit offset untuk marker yang terlalu dekat
        var adjustedLat = lat;
        var adjustedLng = lng;
        var proximityThreshold = 0.001;
        var hasCloseMarker = newMarkers.some(function (m) {
          var pos = m.getLatLng();
          return Math.abs(pos.lat - lat) < proximityThreshold && Math.abs(pos.lng - lng) < proximityThreshold;
        });
        if (hasCloseMarker) {
          var offset = 0.002;
          adjustedLat = lat + (Math.random() * offset - offset / 2);
          adjustedLng = lng + (Math.random() * offset - offset / 2);
        }

        // Buat marker kustom
        var customIcon = leaflet_src_default().divIcon({
          html: "\n          <div style=\"\n            background-color: ".concat(iconColor, ";\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            border: 3px solid white;\n            box-shadow: 0 3px 10px rgba(0,0,0,0.4);\n            cursor: pointer;\n            transition: all 0.3s ease;\n          \">\n            <i class=\"fa-solid ").concat(iconClass, "\" style=\"color: white; font-size: 14px;\"></i>\n          </div>\n        "),
          className: "custom-marker",
          iconSize: [32, 32],
          iconAnchor: [16, 16]
        });

        // Format harga untuk popup
        var formatRupiah = function formatRupiah(money) {
          if (money === null || money === undefined) return "-";
          var numericMoney = typeof money === "string" ? Number.parseFloat(money) : money;
          if (isNaN(numericMoney)) return "-";
          return new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0
          }).format(numericMoney);
        };

        // Buat konten popup
        var backendBaseUrl = "https://api.pinjemin.site";
        var popupContent = "\n        <div style=\"min-width: 220px; font-family: 'Poppins', sans-serif;\">\n          <div style=\"margin-bottom: 10px;\">\n            ".concat(item.thumbnail ? "<img src=\"".concat(backendBaseUrl).concat(item.thumbnail, "\" alt=\"").concat(item.name, "\" style=\"width: 100%; height: 130px; object-fit: cover; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">") : "<div style=\"width: 100%; height: 130px; background: linear-gradient(135deg, #f3f4f6, #e5e7eb); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #6b7280;\">\n                <i class=\"fa-solid fa-image\" style=\"font-size: 28px;\"></i>\n              </div>", "\n          </div>\n          <h4 style=\"margin: 0 0 10px 0; font-size: 15px; font-weight: 700; color: #1f2937; line-height: 1.4;\">").concat(item.name, "</h4>\n          <div style=\"margin-bottom: 10px;\">\n            ").concat(item.is_available_for_sell ? "<div style=\"color: #059669; font-size: 13px; font-weight: 600; margin-bottom: 4px; display: flex; align-items: center;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right: 6px; color: #10b981;\"></i>Jual: ".concat(formatRupiah(item.price_sell), "\n              </div>") : "", "\n            ").concat(item.is_available_for_rent ? "<div style=\"color: #2563eb; font-size: 13px; font-weight: 600; margin-bottom: 4px; display: flex; align-items: center;\">\n                <i class=\"fa-solid fa-calendar-days\" style=\"margin-right: 6px; color: #3b82f6;\"></i>Sewa: ".concat(formatRupiah(item.price_rent), "/hari\n              </div>") : "", "\n          </div>\n          <div style=\"margin-bottom: 12px; font-size: 12px; color: #6b7280; display: flex; align-items: center;\">\n            <i class=\"fa-solid fa-location-dot\" style=\"margin-right: 6px; color: #ef4444;\"></i>").concat(item.city_name || "Unknown", ", ").concat(item.province_name || "Unknown", "\n          </div>\n          <a href=\"/#/items/").concat(item.id, "\" style=\"\n            display: inline-block;\n            background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n            color: white;\n            padding: 8px 16px;\n            border-radius: 8px;\n            text-decoration: none;\n            font-size: 13px;\n            font-weight: 600;\n            transition: all 0.3s ease;\n            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n          \">\n            <i class=\"fa-solid fa-eye\" style=\"margin-right: 6px;\"></i>Lihat Detail\n          </a>\n        </div>\n      ");
        var marker = leaflet_src_default().marker([adjustedLat, adjustedLng], {
          icon: customIcon
        }).bindPopup(popupContent, {
          maxWidth: 280,
          className: "custom-popup",
          closeButton: true,
          autoClose: false,
          closeOnEscapeKey: true
        });
        _this2.markersGroup.addLayer(marker);
        newMarkers.push(marker);
      });
      this.markers = newMarkers;

      // Atur tampilan peta berdasarkan marker
      if (this.markers.length > 0) {
        setTimeout(function () {
          // --- FIXED --- Add a guard to ensure the entire block is safe
          if (!_this2.map) {
            console.warn("Adjusting map bounds skipped because map was destroyed during timeout.");
            return;
          }
          try {
            if (focusProvince && provinceItemsOnly.length > 0) {
              // Jika ada filter provinsi dan ada item di provinsi tersebut, fit bounds ke marker provinsi
              var group = new (leaflet_src_default()).featureGroup(_this2.markers);
              var bounds = group.getBounds();
              if (bounds.isValid()) {
                _this2.map.fitBounds(bounds.pad(0.1), {
                  maxZoom: _this2.options.defaultZoom,
                  animate: true,
                  duration: 1
                });
              }
            } else if (!focusProvince && _this2.markers.length > 1) {
              // Jika tidak ada filter provinsi dan ada banyak marker, fit bounds ke semua marker
              var _group = new (leaflet_src_default()).featureGroup(_this2.markers);
              var _bounds = _group.getBounds();
              if (_bounds.isValid()) {
                _this2.map.fitBounds(_bounds.pad(0.1), {
                  maxZoom: 8,
                  animate: true,
                  duration: 1
                });
              }
            } else {
              // Jika hanya satu marker atau ada filter provinsi tapi tidak ada item, kembali ke posisi user
              if (_this2.initialCenter && _this2.initialZoom) {
                _this2.map.setView(_this2.initialCenter, _this2.initialZoom, {
                  animate: true,
                  duration: 1
                });
              }
            }
          } catch (error) {
            console.error("Error adjusting map bounds:", error);
          }
        }, 500);
      }
    }

    /**
     * Memperbarui lokasi pusat peta berdasarkan user.
     */
  }, {
    key: "updateUserLocation",
    value: (function () {
      var _updateUserLocation = ProductMap_asyncToGenerator(/*#__PURE__*/ProductMap_regeneratorRuntime().mark(function _callee4(provinceName, cityName) {
        var coords, zoom;
        return ProductMap_regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              if (this.isMapReady()) {
                _context4.next = 3;
                break;
              }
              console.error("Cannot update location: map is not ready");
              return _context4.abrupt("return");
            case 3:
              if (provinceName) {
                _context4.next = 5;
                break;
              }
              return _context4.abrupt("return");
            case 5:
              _context4.prev = 5;
              _context4.next = 8;
              return GeocodingUtils.geocodeLocation(provinceName, cityName);
            case 8:
              coords = _context4.sent;
              if (coords) {
                zoom = cityName ? this.options.defaultZoom : 8;
                this.map.setView([coords.lat, coords.lng], zoom, {
                  animate: true,
                  duration: 1
                });

                // Update posisi awal
                this.initialCenter = [coords.lat, coords.lng];
                this.initialZoom = zoom;
                this.userProvince = provinceName;
                this.userCity = cityName;
              }
              _context4.next = 15;
              break;
            case 12:
              _context4.prev = 12;
              _context4.t0 = _context4["catch"](5);
              console.error("Error updating map location:", _context4.t0);
            case 15:
            case "end":
              return _context4.stop();
          }
        }, _callee4, this, [[5, 12]]);
      }));
      function updateUserLocation(_x, _x2) {
        return _updateUserLocation.apply(this, arguments);
      }
      return updateUserLocation;
    }()
    /**
     * Menghancurkan instance peta Leaflet dan membersihkan elemen DOM.
     */
    )
  }, {
    key: "destroy",
    value: (function () {
      var _destroy = ProductMap_asyncToGenerator(/*#__PURE__*/ProductMap_regeneratorRuntime().mark(function _callee5() {
        var container;
        return ProductMap_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              if (this.map) {
                try {
                  this.clearMarkers();
                  if (this.markersGroup) {
                    this.map.removeLayer(this.markersGroup);
                    this.markersGroup = null;
                  }
                  this.map.remove();
                } catch (error) {
                  console.error("Error destroying ProductMap:", error);
                }
              }

              // Bersihkan kontainer
              container = document.getElementById(this.containerId);
              if (container) {
                container.innerHTML = "";
                if (container._leaflet_id) {
                  delete container._leaflet_id;
                }
                container._leaflet_id = null;
                container.className = container.className.replace(/leaflet-[^\s]*/g, "");
              }

              // Reset semua state
              this.map = null;
              this.markers = [];
              this.markersGroup = null;
              this.isInitialized = false;
              this.isInitializing = false;
              this.userProvince = null;
              this.userCity = null;
              this.initialCenter = null;
              this.initialZoom = null;
              this.initializationPromise = null;
            case 13:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this);
      }));
      function destroy() {
        return _destroy.apply(this, arguments);
      }
      return destroy;
    }()
    /**
     * Memeriksa apakah peta sudah siap digunakan.
     */
    )
  }, {
    key: "isMapReady",
    value: function isMapReady() {
      return this.isInitialized && this.map !== null && !this.isInitializing;
    }

    /**
     * Memperbarui marker pada peta.
     */
  }, {
    key: "refreshMarkers",
    value: function refreshMarkers(items) {
      var focusProvince = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      if (this.isMapReady()) {
        this.addItemMarkers(items, focusProvince);
      } else {
        console.warn("Map not ready to refresh markers. Please ensure map is initialized.");
      }
    }

    /**
     * Memaksa peta untuk menyesuaikan ukurannya.
     */
  }, {
    key: "resizeMap",
    value: function resizeMap() {
      var _this3 = this;
      if (this.isMapReady()) {
        setTimeout(function () {
          // --- FIXED --- Add a guard to ensure map exists after timeout
          if (_this3.map) {
            _this3.map.invalidateSize(true);
          } else {
            console.warn("resizeMap was skipped because the map was destroyed during the timeout.");
          }
        }, 500);
      }
    }

    /**
     * Mengatur ulang tampilan peta ke posisi awal user.
     */
  }, {
    key: "resetToUserPosition",
    value: function resetToUserPosition() {
      if (this.isMapReady() && this.initialCenter && this.initialZoom) {
        this.map.setView(this.initialCenter, this.initialZoom, {
          animate: true,
          duration: 1
        });
      }
    }

    /**
     * Mendapatkan informasi lokasi user yang tersimpan.
     */
  }, {
    key: "getUserLocation",
    value: function getUserLocation() {
      return {
        province: this.userProvince,
        city: this.userCity,
        center: this.initialCenter,
        zoom: this.initialZoom
      };
    }
  }]);
}();
;// ./user/src/script/components/product/all-product.js
function all_product_typeof(o) { "@babel/helpers - typeof"; return all_product_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, all_product_typeof(o); }
function all_product_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function all_product_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? all_product_ownKeys(Object(t), !0).forEach(function (r) { all_product_defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : all_product_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function all_product_defineProperty(e, r, t) { return (r = all_product_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function all_product_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ all_product_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == all_product_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(all_product_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function all_product_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function all_product_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { all_product_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { all_product_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function all_product_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function all_product_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, all_product_toPropertyKey(o.key), o); } }
function all_product_createClass(e, r, t) { return r && all_product_defineProperties(e.prototype, r), t && all_product_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function all_product_toPropertyKey(t) { var i = all_product_toPrimitive(t, "string"); return "symbol" == all_product_typeof(i) ? i : i + ""; }
function all_product_toPrimitive(t, r) { if ("object" != all_product_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != all_product_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function all_product_callSuper(t, o, e) { return o = all_product_getPrototypeOf(o), all_product_possibleConstructorReturn(t, all_product_isNativeReflectConstruct() ? Reflect.construct(o, e || [], all_product_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function all_product_possibleConstructorReturn(t, e) { if (e && ("object" == all_product_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return all_product_assertThisInitialized(t); }
function all_product_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function all_product_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && all_product_setPrototypeOf(t, e); }
function all_product_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return all_product_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !all_product_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return all_product_construct(t, arguments, all_product_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), all_product_setPrototypeOf(Wrapper, t); }, all_product_wrapNativeSuper(t); }
function all_product_construct(t, e, r) { if (all_product_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && all_product_setPrototypeOf(p, r.prototype), p; }
function all_product_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (all_product_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function all_product_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function all_product_setPrototypeOf(t, e) { return all_product_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, all_product_setPrototypeOf(t, e); }
function all_product_getPrototypeOf(t) { return all_product_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, all_product_getPrototypeOf(t); }



var AllProduct = /*#__PURE__*/function (_HTMLElement) {
  function AllProduct() {
    var _this;
    all_product_classCallCheck(this, AllProduct);
    _this = all_product_callSuper(this, AllProduct);
    _this.items = [];
    _this.isLoading = true;
    _this.error = null;
    _this.searchRecommendations = [];
    _this.isLoadingSearchRecommendations = false;
    _this.searchRecommendationsError = null;
    _this.currentSearchKeyword = "";

    // User recommendations state
    _this.userRecommendations = [];
    _this.isLoadingUserRecommendations = true;
    _this.userRecommendationsError = null;

    // Pagination state
    _this.pagination = {
      total: 0,
      page: 1,
      limit: 20,
      totalPages: 1
    };

    // Map instance
    _this.productMap = null;
    _this.user = null;
    _this.mapInitialized = false;
    _this.isFetchingItems = false;

    // Binding methods to 'this'
    _this.fetchItems = _this.fetchItems.bind(_this);
    _this.handleSearchEvent = _this.handleSearchEvent.bind(_this);
    _this.fetchSearchRecommendations = _this.fetchSearchRecommendations.bind(_this);
    _this.fetchUserRecommendations = _this.fetchUserRecommendations.bind(_this);
    _this.handlePaginationClick = _this.handlePaginationClick.bind(_this);
    _this.initializeMap = _this.initializeMap.bind(_this);
    _this.updateMapMarkers = _this.updateMapMarkers.bind(_this);
    return _this;
  }
  all_product_inherits(AllProduct, _HTMLElement);
  return all_product_createClass(AllProduct, [{
    key: "connectedCallback",
    value: function () {
      var _connectedCallback = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee() {
        var startupPromises;
        return all_product_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              this.loadUserData();
              this.innerHTML = this.renderStructure();
              document.addEventListener("search", this.handleSearchEvent);
              startupPromises = [this.initializeMap(), this.fetchItems(), this.fetchUserRecommendations()];
              _context.prev = 4;
              _context.next = 7;
              return Promise.all(startupPromises);
            case 7:
              this.updateMapMarkers(); // Panggilan terakhir sebagai pengaman (safeguard).
              _context.next = 13;
              break;
            case 10:
              _context.prev = 10;
              _context.t0 = _context["catch"](4);
              console.error("An error occurred during the component's initial loading sequence:", _context.t0);
            case 13:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[4, 10]]);
      }));
      function connectedCallback() {
        return _connectedCallback.apply(this, arguments);
      }
      return connectedCallback;
    }()
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      document.removeEventListener("search", this.handleSearchEvent);
      if (this.productMap) {
        this.productMap.destroy();
        this.productMap = null;
        this.mapInitialized = false;
      }
    }
  }, {
    key: "loadUserData",
    value: function loadUserData() {
      var userData = localStorage.getItem("user");
      if (userData) {
        this.user = JSON.parse(userData);
      }
    }
  }, {
    key: "getUserIdFromToken",
    value: function getUserIdFromToken() {
      var token = localStorage.getItem("token");
      if (!token) return null;
      try {
        var payload = JSON.parse(atob(token.split(".")[1]));
        return payload.userId || payload.id || payload.user_id;
      } catch (error) {
        console.error("Error parsing token:", error);
        return null;
      }
    }

    /**
     * Metode baru untuk membuat kerangka HTML statis dari komponen.
     */
  }, {
    key: "renderStructure",
    value: function renderStructure() {
      var _this$user;
      return "\n      <style>\n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        html, body { margin: 0; padding: 0; }\n        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n        * { font-family: 'Poppins', sans-serif; }\n        #product-map { height: 400px !important; width: 100% !important; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); border: 2px solid #e5e7eb; position: relative !important; z-index: 1 !important; display: block !important; visibility: visible !important; }\n        #product-map-container { position: relative; z-index: 1; width: 100%; height: auto; margin-bottom: 2rem; }\n        .leaflet-container { cursor: grab !important; touch-action: pan-x pan-y !important; }\n        .map-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); position: relative; z-index: 1; }\n        .map-header { color: white; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem; }\n        .map-description { color: rgba(255, 255, 255, 0.9); font-size: 0.875rem; margin-bottom: 1.5rem; }\n        .section-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700; font-size: 1.875rem; margin-bottom: 1.5rem; }\n        .section-divider { height: 4px; background: linear-gradient(90deg, #3b82f6, #10b981); border-radius: 2px; margin: 2rem 0; }\n        .shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 2s infinite; }\n        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }\n        .pagination-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; }\n        .pagination-btn-enabled { background-color: white; border: 1px solid #d1d5db; color: #374151; }\n        .pagination-btn-enabled:hover { background-color: #f9fafb; border-color: #9ca3af; }\n        .pagination-btn-disabled { background-color: #f9fafb; border: 1px solid #e5e7eb; color: #9ca3af; cursor: not-allowed; }\n        .pagination-number { min-width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; background-color: white; border: 1px solid #d1d5db; color: #374151; }\n        .pagination-number:hover { background-color: #f3f4f6; border-color: #9ca3af; }\n        .pagination-number-active { background-color: #3b82f6; border-color: #3b82f6; color: white; }\n        .product-recommendation-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); background: #ffffff; border: 2px solid #e5e7eb; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); border-radius: 0.75rem; overflow: hidden; }\n        .product-recommendation-card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); border-color: #3b82f6; }\n        .product-recommendation-img { transition: all 0.3s ease; }\n        .product-recommendation-card:hover .product-recommendation-img { transform: scale(1.05); }\n        .product-status-badge { display: inline-block; padding: 6px 16px; border-radius: 9999px; font-size: 14px; font-weight: 600; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); }\n        .product-availability-tag { background: #3b82f6; color: white; padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }\n        .product-availability-tag.rent { background: linear-gradient(135deg, #3b82f6, #2563eb); }\n        .product-availability-tag.sell { background: linear-gradient(135deg, #10b981, #059669); }\n        .recommendation-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); background: #ffffff; border: 2px solid #e5e7eb; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }\n        .recommendation-card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); border-color: #3b82f6; }\n        .recommendation-img { transition: all 0.3s ease; }\n        .recommendation-card:hover .recommendation-img { transform: scale(1.05); }\n        .custom-scrollbar::-webkit-scrollbar { height: 8px; }\n        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: linear-gradient(90deg, #3b82f6, #10b981); border-radius: 4px; }\n      </style>\n      <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n\n      <div class=\"bg-white rounded-lg\">\n        <div class=\"mx-auto max-w-2xl px-4 py-6 sm:px-6 lg:max-w-7xl lg:px-8\">\n          <div class=\"map-section\" id=\"product-map-container\">\n            <h2 class=\"map-header\">\n              <i class=\"fa-solid fa-map-location-dot\"></i>\n              Peta Lokasi Produk".concat((_this$user = this.user) !== null && _this$user !== void 0 && _this$user.province_name ? " - ".concat(this.user.province_name) : "", "\n            </h2>\n            <p class=\"map-description\">\n              Temukan produk di sekitar Anda dengan mudah. Klik pada marker untuk melihat detail.\n            </p>\n            <div id=\"product-map\"></div>\n          </div>\n        </div>\n\n        <div class=\"py-6\">\n          <search-bar></search-bar>\n        </div>\n        \n        <div id=\"user-recs-container\"></div>\n        <div id=\"search-recs-container\"></div>\n        \n        <div class=\"mx-auto max-w-2xl px-4 py-4 sm:px-6 sm:py-8 lg:max-w-7xl lg:px-8\">\n          <div class=\"section-divider\"></div>\n          <h2 class=\"section-header text-center\">Semua Produk</h2>\n          <div id=\"product-list-container\">\n             ").concat(this.renderContent(), "\n          </div>\n          <div id=\"pagination-container\"></div>\n        </div>\n      </div>\n    ");
    }

    /**
     * metode untuk mengatasi dinamis rendering
     */
  }, {
    key: "updateDynamicContent",
    value: function updateDynamicContent() {
      var userRecsContainer = this.querySelector('#user-recs-container');
      if (userRecsContainer) userRecsContainer.innerHTML = this.renderUserRecommendationsSection();
      var searchRecsContainer = this.querySelector('#search-recs-container');
      if (searchRecsContainer) searchRecsContainer.innerHTML = this.renderSearchRecommendationsSection();
      var productListContainer = this.querySelector('#product-list-container');
      if (productListContainer) productListContainer.innerHTML = this.renderContent();
      var paginationContainer = this.querySelector('#pagination-container');
      if (paginationContainer) paginationContainer.innerHTML = this.renderPagination();
      this.attachDynamicListeners();
    }

    /**
     * Metode untuk memasang listener pada konten yang baru dirender.
     */
  }, {
    key: "attachDynamicListeners",
    value: function attachDynamicListeners() {
      var _this2 = this;
      var paginationControls = this.querySelector("#pagination-controls");
      if (paginationControls) {
        paginationControls.removeEventListener("click", this.handlePaginationClick);
        paginationControls.addEventListener("click", this.handlePaginationClick);
      }
      setTimeout(function () {
        var wrappers = _this2.querySelectorAll(".recommendations-wrapper");
        var leftButtons = _this2.querySelectorAll(".scroll-left");
        var rightButtons = _this2.querySelectorAll(".scroll-right");
        leftButtons.forEach(function (btn, index) {
          var oldHandler = btn.__scrollHandlerLeft;
          if (oldHandler) btn.removeEventListener("click", oldHandler);
          var newHandler = function newHandler() {
            var _wrappers$index;
            return (_wrappers$index = wrappers[index]) === null || _wrappers$index === void 0 ? void 0 : _wrappers$index.scrollBy({
              left: -300,
              behavior: "smooth"
            });
          };
          btn.addEventListener("click", newHandler);
          btn.__scrollHandlerLeft = newHandler;
        });
        rightButtons.forEach(function (btn, index) {
          var oldHandler = btn.__scrollHandlerRight;
          if (oldHandler) btn.removeEventListener("click", oldHandler);
          var newHandler = function newHandler() {
            var _wrappers$index2;
            return (_wrappers$index2 = wrappers[index]) === null || _wrappers$index2 === void 0 ? void 0 : _wrappers$index2.scrollBy({
              left: 300,
              behavior: "smooth"
            });
          };
          btn.addEventListener("click", newHandler);
          btn.__scrollHandlerRight = newHandler;
        });
      }, 0);
    }
  }, {
    key: "initializeMap",
    value: function () {
      var _initializeMap = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee2() {
        var _this$user2, _this$user3, success;
        return all_product_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              if (!this.mapInitialized) {
                _context2.next = 2;
                break;
              }
              return _context2.abrupt("return", true);
            case 2:
              _context2.prev = 2;
              this.productMap = new ProductMap("product-map", {
                height: "400px",
                defaultZoom: 10
              });
              _context2.next = 6;
              return this.productMap.initializeMap((_this$user2 = this.user) === null || _this$user2 === void 0 ? void 0 : _this$user2.province_name, (_this$user3 = this.user) === null || _this$user3 === void 0 ? void 0 : _this$user3.city_name);
            case 6:
              success = _context2.sent;
              if (!success) {
                _context2.next = 10;
                break;
              }
              this.mapInitialized = true;
              return _context2.abrupt("return", true);
            case 10:
              return _context2.abrupt("return", false);
            case 13:
              _context2.prev = 13;
              _context2.t0 = _context2["catch"](2);
              console.error("Critical error during ProductMap initialization:", _context2.t0);
              this.mapInitialized = false;
              return _context2.abrupt("return", false);
            case 18:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[2, 13]]);
      }));
      function initializeMap() {
        return _initializeMap.apply(this, arguments);
      }
      return initializeMap;
    }()
  }, {
    key: "updateMapMarkers",
    value: function updateMapMarkers() {
      if (this.productMap && this.mapInitialized && this.productMap.isMapReady()) {
        var _this$user4;
        this.productMap.refreshMarkers(this.items, (_this$user4 = this.user) === null || _this$user4 === void 0 ? void 0 : _this$user4.province_name);
        this.productMap.resizeMap();
      } else {
        console.warn("Map not ready to update markers yet. Skipping for now.");
      }
    }
  }, {
    key: "fetchItems",
    value: function () {
      var _fetchItems = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee3() {
        var params,
          queryParams,
          queryString,
          url,
          result,
          _args3 = arguments;
        return all_product_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              params = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : {};
              if (!this.isFetchingItems) {
                _context3.next = 3;
                break;
              }
              return _context3.abrupt("return");
            case 3:
              this.isFetchingItems = true;
              this.isLoading = true;
              this.error = null;
              this.updateDynamicContent();
              _context3.prev = 7;
              queryParams = all_product_objectSpread({
                limit: this.pagination.limit,
                page: params.page || this.pagination.page
              }, params);
              queryString = Object.keys(queryParams).map(function (key) {
                return "".concat(encodeURIComponent(key), "=").concat(encodeURIComponent(queryParams[key]));
              }).join("&");
              url = "/items?".concat(queryString);
              _context3.next = 13;
              return apiGet(url);
            case 13:
              result = _context3.sent;
              if (!(result.status === "success")) {
                _context3.next = 22;
                break;
              }
              this.items = Array.isArray(result.data) ? result.data : [];
              if (result.pagination) this.pagination = result.pagination;
              this.isLoading = false;
              this.error = null;
              this.updateMapMarkers();
              _context3.next = 23;
              break;
            case 22:
              throw new Error(result.message || "Gagal memuat item.");
            case 23:
              _context3.next = 31;
              break;
            case 25:
              _context3.prev = 25;
              _context3.t0 = _context3["catch"](7);
              console.error("Error fetching items:", _context3.t0);
              this.items = [];
              this.error = _context3.t0.message;
              this.isLoading = false;
            case 31:
              _context3.prev = 31;
              this.isFetchingItems = false;
              this.updateDynamicContent();
              return _context3.finish(31);
            case 35:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[7, 25, 31, 35]]);
      }));
      function fetchItems() {
        return _fetchItems.apply(this, arguments);
      }
      return fetchItems;
    }()
  }, {
    key: "fetchUserRecommendations",
    value: function () {
      var _fetchUserRecommendations2 = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee5() {
        var _mlResult$recommendat, userId, mlResult, promises;
        return all_product_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              this.isLoadingUserRecommendations = true;
              this.userRecommendationsError = null;
              this.updateDynamicContent();
              _context5.prev = 3;
              userId = this.getUserIdFromToken();
              if (userId) {
                _context5.next = 8;
                break;
              }
              this.userRecommendations = [];
              return _context5.abrupt("return");
            case 8:
              _context5.next = 10;
              return mlApiService_fetchUserRecommendations(userId, 8);
            case 10:
              mlResult = _context5.sent;
              if (!(mlResult && ((_mlResult$recommendat = mlResult.recommendations) === null || _mlResult$recommendat === void 0 ? void 0 : _mlResult$recommendat.length) > 0)) {
                _context5.next = 18;
                break;
              }
              promises = mlResult.recommendations.map(/*#__PURE__*/function () {
                var _ref = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee4(rec) {
                  var itemDetailResponse;
                  return all_product_regeneratorRuntime().wrap(function _callee4$(_context4) {
                    while (1) switch (_context4.prev = _context4.next) {
                      case 0:
                        _context4.prev = 0;
                        _context4.next = 3;
                        return apiGet("/items/".concat(rec.product_id));
                      case 3:
                        itemDetailResponse = _context4.sent;
                        return _context4.abrupt("return", itemDetailResponse.status === "success" && itemDetailResponse.data ? all_product_objectSpread(all_product_objectSpread({}, rec), itemDetailResponse.data) : null);
                      case 7:
                        _context4.prev = 7;
                        _context4.t0 = _context4["catch"](0);
                        return _context4.abrupt("return", null);
                      case 10:
                      case "end":
                        return _context4.stop();
                    }
                  }, _callee4, null, [[0, 7]]);
                }));
                return function (_x) {
                  return _ref.apply(this, arguments);
                };
              }());
              _context5.next = 15;
              return Promise.all(promises);
            case 15:
              this.userRecommendations = _context5.sent.filter(Boolean);
              _context5.next = 19;
              break;
            case 18:
              this.userRecommendations = [];
            case 19:
              _context5.next = 24;
              break;
            case 21:
              _context5.prev = 21;
              _context5.t0 = _context5["catch"](3);
              this.userRecommendationsError = _context5.t0.message;
            case 24:
              _context5.prev = 24;
              this.isLoadingUserRecommendations = false;
              this.updateDynamicContent();
              return _context5.finish(24);
            case 28:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this, [[3, 21, 24, 28]]);
      }));
      function fetchUserRecommendations() {
        return _fetchUserRecommendations2.apply(this, arguments);
      }
      return fetchUserRecommendations;
    }()
  }, {
    key: "fetchSearchRecommendations",
    value: function () {
      var _fetchSearchRecommendations2 = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee7(keyword) {
        var _mlResult$recommendat2, mlResult, promises;
        return all_product_regeneratorRuntime().wrap(function _callee7$(_context7) {
          while (1) switch (_context7.prev = _context7.next) {
            case 0:
              this.isLoadingSearchRecommendations = true;
              this.searchRecommendationsError = null;
              this.updateDynamicContent();
              _context7.prev = 3;
              if (keyword) {
                _context7.next = 7;
                break;
              }
              this.searchRecommendations = [];
              return _context7.abrupt("return");
            case 7:
              _context7.next = 9;
              return mlApiService_fetchSearchRecommendations(keyword, 5);
            case 9:
              mlResult = _context7.sent;
              if (!(mlResult && ((_mlResult$recommendat2 = mlResult.recommendations) === null || _mlResult$recommendat2 === void 0 ? void 0 : _mlResult$recommendat2.length) > 0)) {
                _context7.next = 17;
                break;
              }
              promises = mlResult.recommendations.map(/*#__PURE__*/function () {
                var _ref2 = all_product_asyncToGenerator(/*#__PURE__*/all_product_regeneratorRuntime().mark(function _callee6(rec) {
                  var itemDetailResponse;
                  return all_product_regeneratorRuntime().wrap(function _callee6$(_context6) {
                    while (1) switch (_context6.prev = _context6.next) {
                      case 0:
                        _context6.prev = 0;
                        _context6.next = 3;
                        return apiGet("/items/".concat(rec.product_id));
                      case 3:
                        itemDetailResponse = _context6.sent;
                        return _context6.abrupt("return", itemDetailResponse.status === "success" && itemDetailResponse.data ? all_product_objectSpread(all_product_objectSpread({}, rec), itemDetailResponse.data) : null);
                      case 7:
                        _context6.prev = 7;
                        _context6.t0 = _context6["catch"](0);
                        return _context6.abrupt("return", null);
                      case 10:
                      case "end":
                        return _context6.stop();
                    }
                  }, _callee6, null, [[0, 7]]);
                }));
                return function (_x3) {
                  return _ref2.apply(this, arguments);
                };
              }());
              _context7.next = 14;
              return Promise.all(promises);
            case 14:
              this.searchRecommendations = _context7.sent.filter(Boolean);
              _context7.next = 18;
              break;
            case 17:
              this.searchRecommendations = [];
            case 18:
              _context7.next = 23;
              break;
            case 20:
              _context7.prev = 20;
              _context7.t0 = _context7["catch"](3);
              this.searchRecommendationsError = _context7.t0.message;
            case 23:
              _context7.prev = 23;
              this.isLoadingSearchRecommendations = false;
              this.updateDynamicContent();
              return _context7.finish(23);
            case 27:
            case "end":
              return _context7.stop();
          }
        }, _callee7, this, [[3, 20, 23, 27]]);
      }));
      function fetchSearchRecommendations(_x2) {
        return _fetchSearchRecommendations2.apply(this, arguments);
      }
      return fetchSearchRecommendations;
    }()
  }, {
    key: "handleSearchEvent",
    value: function handleSearchEvent(event) {
      var searchTerm = event.detail.params.search || "";
      this.currentSearchKeyword = searchTerm;
      this.pagination.page = 1;
      this.fetchItems({
        search: searchTerm,
        page: 1
      });
      if (searchTerm) {
        this.fetchSearchRecommendations(searchTerm);
      } else {
        this.searchRecommendations = [];
        this.updateDynamicContent();
      }
    }
  }, {
    key: "handlePaginationClick",
    value: function handlePaginationClick(event) {
      var target = event.target.closest("[data-page]");
      if (!target) return;
      var page = Number.parseInt(target.dataset.page, 10);
      if (page && page !== this.pagination.page && page >= 1 && page <= this.pagination.totalPages) {
        this.pagination.page = page;
        this.fetchItems({
          search: this.currentSearchKeyword,
          page: page
        });
      }
    }
  }, {
    key: "getStatusInfo",
    value: function getStatusInfo(item) {
      var status = item.status || "available";
      switch (status) {
        case "available":
          return {
            display: "Available",
            "class": "bg-green-100 text-green-800",
            showAvailabilityBadges: true
          };
        case "pending":
          return {
            display: "Pending",
            "class": "bg-yellow-100 text-yellow-800",
            showAvailabilityBadges: false
          };
        case "rented":
          return {
            display: "Rented",
            "class": "bg-blue-100 text-blue-800",
            showAvailabilityBadges: false
          };
        case "sold":
          return {
            display: "Sold",
            "class": "bg-red-100 text-red-800",
            showAvailabilityBadges: false
          };
        case "ongoing":
          return {
            display: "Ongoing",
            "class": "bg-purple-100 text-purple-800",
            showAvailabilityBadges: false
          };
        default:
          return {
            display: status,
            "class": "bg-gray-100 text-gray-800",
            showAvailabilityBadges: true
          };
      }
    }
  }, {
    key: "renderPagination",
    value: function renderPagination() {
      if (this.pagination.totalPages <= 1) return "";
      var _this$pagination = this.pagination,
        page = _this$pagination.page,
        totalPages = _this$pagination.totalPages,
        limit = _this$pagination.limit,
        total = _this$pagination.total;
      var startItem = (page - 1) * limit + 1;
      var endItem = Math.min(page * limit, total);
      var startPage = Math.max(1, page - 2),
        endPage = Math.min(totalPages, page + 2);
      if (page <= 3) endPage = Math.min(5, totalPages);
      if (page >= totalPages - 2) startPage = Math.max(1, totalPages - 4);
      var pageNumbers = Array.from({
        length: endPage - startPage + 1
      }, function (_, i) {
        return startPage + i;
      });
      return "\n      <div class=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-8 px-4\">\n        <div class=\"text-sm text-gray-700 font-poppins\">\n          Menampilkan <span class=\"font-medium\">".concat(startItem, "</span> sampai <span class=\"font-medium\">").concat(endItem, "</span> dari <span class=\"font-medium\">").concat(total, "</span> hasil\n        </div>\n        <div class=\"flex items-center gap-2\" id=\"pagination-controls\">\n          <button data-page=\"").concat(page - 1, "\" class=\"pagination-btn ").concat(page === 1 ? 'pagination-btn-disabled' : 'pagination-btn-enabled', "\" ").concat(page === 1 ? 'disabled' : '', ">\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\"></path></svg>\n            <span class=\"hidden sm:inline\">Previous</span>\n          </button>\n          <div class=\"flex items-center gap-1\">\n            ").concat(startPage > 1 ? "<button data-page=\"1\" class=\"pagination-number\">1</button>".concat(startPage > 2 ? '<span class="px-2 text-gray-500">...</span>' : '') : '', "\n            ").concat(pageNumbers.map(function (p) {
        return "<button data-page=\"".concat(p, "\" class=\"pagination-number ").concat(p === page ? 'pagination-number-active' : '', "\">").concat(p, "</button>");
      }).join(''), "\n            ").concat(endPage < totalPages ? "".concat(endPage < totalPages - 1 ? '<span class="px-2 text-gray-500">...</span>' : '', "<button data-page=\"").concat(totalPages, "\" class=\"pagination-number\">").concat(totalPages, "</button>") : '', "\n          </div>\n          <button data-page=\"").concat(page + 1, "\" class=\"pagination-btn ").concat(page === totalPages ? 'pagination-btn-disabled' : 'pagination-btn-enabled', "\" ").concat(page === totalPages ? 'disabled' : '', ">\n            <span class=\"hidden sm:inline\">Next</span>\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>\n          </button>\n        </div>\n      </div>");
    }
  }, {
    key: "renderUserRecommendationsSection",
    value: function renderUserRecommendationsSection() {
      var _this3 = this;
      if (!this.getUserIdFromToken()) return "";
      if (this.isLoadingUserRecommendations) return "<div>Loading recommendations...</div>";
      if (this.userRecommendationsError) return "<div>Error: ".concat(this.userRecommendationsError, "</div>");
      if (!this.userRecommendations || this.userRecommendations.length === 0) return "<div>No recommendations available.</div>";
      var backendBaseUrl = "https://api.pinjemin.site";
      var formatRupiah = function formatRupiah(money) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0
        }).format(money);
      };
      return "\n      <div class=\"mx-auto max-w-2xl px-4 py-4 sm:px-6 sm:py-8 lg:max-w-7xl lg:px-8 bg-gradient-to-r from-indigo-800 to-purple-900 rounded-xl shadow-lg mb-8 border border-indigo-600\">\n        <h3 class=\"text-2xl font-bold mb-6 text-white flex items-center\"><i class=\"fa-solid fa-sparkles mr-3\"></i>Rekomendasi untuk Anda</h3>\n        <div class=\"relative\">\n          <button class=\"scroll-left absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-black/20 hover:bg-white/30 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all duration-300\"><i class=\"fa-solid fa-angle-left text-lg\"></i></button>\n          <div class=\"flex overflow-x-auto space-x-6 pb-4 custom-scrollbar recommendations-wrapper\">\n            ".concat(this.userRecommendations.map(function (rec) {
        return _this3.renderRecommendationCard(rec, backendBaseUrl, formatRupiah);
      }).join(''), "\n          </div>\n          <button class=\"scroll-right absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-black/20 hover:bg-white/30 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all duration-300\"><i class=\"fa-solid fa-angle-right text-lg\"></i></button>\n        </div>\n      </div>");
    }
  }, {
    key: "renderSearchRecommendationsSection",
    value: function renderSearchRecommendationsSection() {
      var _this4 = this;
      if (!this.currentSearchKeyword) return "";
      if (this.isLoadingSearchRecommendations) return "<div>Loading search suggestions...</div>";
      if (this.searchRecommendationsError) return "<div>Error: ".concat(this.searchRecommendationsError, "</div>");
      if (!this.searchRecommendations || this.searchRecommendations.length === 0) return "<div>No suggestions found.</div>";
      var backendBaseUrl = "https://api.pinjemin.site";
      var formatRupiah = function formatRupiah(money) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0
        }).format(money);
      };
      return "\n      <div class=\"mx-auto max-w-2xl px-4 py-4 sm:px-6 sm:py-8 lg:max-w-7xl lg:px-8 bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl shadow-lg mb-8 text-white border border-gray-700\">\n        <h3 class=\"text-lg font-semibold mb-4 text-white flex items-center\"><i class=\"fa-solid fa-wand-magic-sparkles mr-2\"></i>Saran Terkait \"".concat(this.currentSearchKeyword, "\"</h3>\n        <div class=\"relative\">\n          <button class=\"scroll-left absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-full shadow\"><i class=\"fa-solid fa-angle-left\"></i></button>\n          <div class=\"flex overflow-x-auto space-x-6 pb-4 custom-scrollbar recommendations-wrapper\">\n            ").concat(this.searchRecommendations.map(function (rec) {
        return _this4.renderRecommendationCard(rec, backendBaseUrl, formatRupiah);
      }).join(''), "\n          </div>\n          <button class=\"scroll-right absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-full shadow\"><i class=\"fa-solid fa-angle-right\"></i></button>\n        </div>\n      </div>");
    }
  }, {
    key: "renderRecommendationCard",
    value: function renderRecommendationCard(rec, backendBaseUrl, formatRupiah) {
      var statusInfo = this.getStatusInfo(rec);
      return "\n      <div class=\"recommendation-card bg-white rounded-xl shadow-lg p-4 flex-shrink-0 w-64 relative overflow-hidden border-2 border-gray-200\">\n        <a href=\"/#/items/".concat(rec.id || rec.product_id, "\" class=\"block\">\n          <div class=\"relative mb-3\">\n            ").concat(rec.thumbnail ? "<img src=\"".concat(backendBaseUrl).concat(rec.thumbnail, "\" alt=\"").concat(rec.name, "\" class=\"recommendation-img w-full h-32 object-cover rounded-lg\">") : "<div class=\"w-full h-32 bg-gray-200 rounded-lg\"></div>", "\n            <div class=\"absolute top-2 left-2\"><span class=\"px-2 py-1 rounded-md text-xs font-medium ").concat(statusInfo["class"], "\">").concat(statusInfo.display, "</span></div>\n          </div>\n          <h5 class=\"text-sm font-bold text-gray-900 leading-tight line-clamp-2 mb-2\">").concat(rec.name || rec.product_name, "</h5>\n          ").concat(statusInfo.showAvailabilityBadges ? "<div>".concat(rec.is_available_for_sell ? "<p class=\"text-sm font-semibold\">Jual: ".concat(formatRupiah(rec.price_sell), "</p>") : '').concat(rec.is_available_for_rent ? "<p class=\"text-sm font-semibold\">Sewa: ".concat(formatRupiah(rec.price_rent), "/hari</p>") : '', "</div>") : '', "\n        </a>\n      </div>");
    }
  }, {
    key: "renderContent",
    value: function renderContent() {
      if (this.isLoading) {
        return "\n        <div class=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-6\">\n          ".concat(Array(8).fill(0).map(function () {
          return "\n            <div class=\"w-full bg-white rounded-xl shadow-lg border-2 border-gray-200 overflow-hidden\">\n              <div class=\"shimmer h-64 w-full\"></div>\n              <div class=\"p-5\">\n                <div class=\"shimmer h-6 w-3/4 mb-2 rounded\"></div>\n                <div class=\"shimmer h-4 w-1/2 rounded\"></div>\n              </div>\n            </div>";
        }).join(""), "\n        </div>");
      }
      if (this.error) {
        return "<div class=\"text-center py-12\"><div class=\"bg-red-50 border border-red-200 rounded-xl p-6 max-w-md mx-auto text-red-600 font-semibold\">Error: ".concat(this.error, "</div></div>");
      }
      if (!this.items || this.items.length === 0) {
        return "<div class=\"text-center py-16\"><div class=\"bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-8 max-w-md mx-auto\"><p class=\"text-gray-600 font-medium text-lg\">No items found.</p></div></div>";
      }
      return "<div class=\"grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8\">".concat(this.generateItemList(this.items), "</div>");
    }
  }, {
    key: "generateItemList",
    value: function generateItemList(items) {
      var _this5 = this;
      var backendBaseUrl = "https://api.pinjemin.site";
      var formatRupiah = function formatRupiah(money) {
        return money != null ? new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0
        }).format(money) : "-";
      };
      return items.map(function (item) {
        var statusInfo = _this5.getStatusInfo(item);
        return "\n        <div class=\"product-recommendation-card\">\n          <a href=\"/#/items/".concat(item.id, "\" class=\"block text-gray-800\" data-item-id=\"").concat(item.id, "\">\n            <div class=\"relative overflow-hidden\">\n              ").concat(item.thumbnail ? "<img src=\"".concat(backendBaseUrl).concat(item.thumbnail, "\" alt=\"").concat(item.name || 'Product image', "\" class=\"product-recommendation-img w-full h-48 object-cover\">") : '<div class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-400"><i class="fa-solid fa-image text-3xl"></i></div>', "\n              <div class=\"absolute top-3 left-3\"><span class=\"product-status-badge ").concat(statusInfo["class"], " text-xs\">").concat(statusInfo.display, "</span></div>\n            </div>\n            <div class=\"p-4\">\n              <h5 class=\"text-lg font-bold text-gray-900 line-clamp-2 mb-2 h-14\">").concat(item.name || "Unnamed Product", "</h5>\n              ").concat(statusInfo.showAvailabilityBadges ? "\n                <div class=\"flex items-center gap-2 flex-wrap mb-3\">\n                  ".concat(item.is_available_for_rent ? "<span class=\"product-availability-tag rent\">Sewa</span>" : "", "\n                  ").concat(item.is_available_for_sell ? "<span class=\"product-availability-tag sell\">Jual</span>" : "", "\n                </div>\n                <div class=\"space-y-1 border-t border-gray-200 pt-3\">\n                  ").concat(item.is_available_for_sell ? "<p class=\"text-sm font-semibold flex items-center\"><i class=\"fa-solid fa-tag text-green-600 mr-2\"></i>Jual: ".concat(formatRupiah(item.price_sell), "</p>") : "", "\n                  ").concat(item.is_available_for_rent ? "<p class=\"text-sm font-semibold flex items-center\"><i class=\"fa-solid fa-calendar-days text-blue-600 mr-2\"></i>Sewa: ".concat(formatRupiah(item.price_rent)).concat(item.price_rent > 0 ? " /hari" : "", "</p>") : "", "\n                </div>") : "", "\n            </div>\n          </a>\n        </div>");
      }).join("");
    }
  }]);
}(/*#__PURE__*/all_product_wrapNativeSuper(HTMLElement));
customElements.define("all-product", AllProduct);
;// ./user/src/script/utils/utils.js
function utils_typeof(o) { "@babel/helpers - typeof"; return utils_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, utils_typeof(o); }
function utils_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function utils_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, utils_toPropertyKey(o.key), o); } }
function utils_createClass(e, r, t) { return r && utils_defineProperties(e.prototype, r), t && utils_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function utils_toPropertyKey(t) { var i = utils_toPrimitive(t, "string"); return "symbol" == utils_typeof(i) ? i : i + ""; }
function utils_toPrimitive(t, r) { if ("object" != utils_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != utils_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var utils_Utils = /*#__PURE__*/function () {
  function Utils() {
    utils_classCallCheck(this, Utils);
  }
  return utils_createClass(Utils, null, [{
    key: "emptyElement",
    value: function emptyElement(element) {
      element.innerHTML = '';
    }
  }, {
    key: "showElement",
    value: function showElement(element) {
      element.style.display = 'block';
      element.hidden = false;
    }
  }, {
    key: "hideElement",
    value: function hideElement(element) {
      element.style.display = 'none';
      element.hidden = true;
    }
  }, {
    key: "isValidInteger",
    value: function isValidInteger(newValue) {
      return Number.isNaN(newValue) || Number.isFinite(newValue);
    }

    // Fungsi autentikasi
  }, {
    key: "isAuthenticated",
    value: function isAuthenticated() {
      // Cek apakah token ada di localStorage
      var token = localStorage.getItem('token');
      return token !== null && token !== undefined; // Kembalikan true jika token ada
    }

    // Metode untuk mengalihkan ke halaman login
  }, {
    key: "redirectToLogin",
    value: function redirectToLogin() {
      window.location.hash = '#/login';
    }

    // static login() { // Metode ini tidak lagi diperlukan jika status login ditentukan oleh token
    //     localStorage.setItem('isLoggedIn', 'true');
    // }

    // static logout() { // Metode ini tidak lagi diperlukan jika status login ditentukan oleh token
    //     localStorage.removeItem('isLoggedIn');
    // }
  }, {
    key: "getUserInfo",
    value: function getUserInfo() {
      var user = localStorage.getItem('user');
      return user ? JSON.parse(user) : null;
    }
    // --- Fungsi slugify BARU ---
  }, {
    key: "slugify",
    value: function slugify(text) {
      if (!text) return "";
      return text.toString().normalize("NFD") // Pisahkan diakritik dari huruf
      .replace(/[\u0300-\u036f]/g, "") // Hapus diakritik
      .toLowerCase() // Ubah ke huruf kecil
      .trim() // Hapus spasi di awal/akhir
      .replace(/\s+/g, "-") // Ganti spasi dengan tanda hubung
      .replace(/[^\w-]+/g, "") // Hapus semua karakter non-kata (kecuali tanda hubung)
      .replace(/--+/g, "-"); // Ganti tanda hubung ganda dengan satu tanda hubung
    }
  }]);
}();
/* harmony default export */ const utils = (utils_Utils);
// EXTERNAL MODULE: ./node_modules/sweetalert2/dist/sweetalert2.all.js
var sweetalert2_all = __webpack_require__(465);
var sweetalert2_all_default = /*#__PURE__*/__webpack_require__.n(sweetalert2_all);
;// ./user/src/script/components/product/detail-product.js
function detail_product_typeof(o) { "@babel/helpers - typeof"; return detail_product_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, detail_product_typeof(o); }
function detail_product_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function detail_product_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? detail_product_ownKeys(Object(t), !0).forEach(function (r) { detail_product_defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : detail_product_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function detail_product_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ detail_product_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == detail_product_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(detail_product_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function detail_product_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function detail_product_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { detail_product_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { detail_product_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function detail_product_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function detail_product_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, detail_product_toPropertyKey(o.key), o); } }
function detail_product_createClass(e, r, t) { return r && detail_product_defineProperties(e.prototype, r), t && detail_product_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function detail_product_callSuper(t, o, e) { return o = detail_product_getPrototypeOf(o), detail_product_possibleConstructorReturn(t, detail_product_isNativeReflectConstruct() ? Reflect.construct(o, e || [], detail_product_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function detail_product_possibleConstructorReturn(t, e) { if (e && ("object" == detail_product_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return detail_product_assertThisInitialized(t); }
function detail_product_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function detail_product_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && detail_product_setPrototypeOf(t, e); }
function detail_product_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return detail_product_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !detail_product_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return detail_product_construct(t, arguments, detail_product_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), detail_product_setPrototypeOf(Wrapper, t); }, detail_product_wrapNativeSuper(t); }
function detail_product_construct(t, e, r) { if (detail_product_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && detail_product_setPrototypeOf(p, r.prototype), p; }
function detail_product_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (detail_product_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function detail_product_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function detail_product_setPrototypeOf(t, e) { return detail_product_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, detail_product_setPrototypeOf(t, e); }
function detail_product_getPrototypeOf(t) { return detail_product_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, detail_product_getPrototypeOf(t); }
function detail_product_defineProperty(e, r, t) { return (r = detail_product_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function detail_product_toPropertyKey(t) { var i = detail_product_toPrimitive(t, "string"); return "symbol" == detail_product_typeof(i) ? i : i + ""; }
function detail_product_toPrimitive(t, r) { if ("object" != detail_product_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != detail_product_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }




var DetailProduct = /*#__PURE__*/function (_HTMLElement) {
  function DetailProduct() {
    var _this;
    detail_product_classCallCheck(this, DetailProduct);
    _this = detail_product_callSuper(this, DetailProduct);
    detail_product_defineProperty(_this, "formatRupiah", function (money) {
      if (money === null || money === undefined) return "-";
      var numericMoney = typeof money === "string" ? Number.parseFloat(money) : money;
      if (isNaN(numericMoney)) return "-";
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(numericMoney);
    });
    _this._itemId = null;
    _this._item = null;
    _this._reviews = [];
    _this.isLoading = true;
    _this.error = null;
    _this._isCurrentUserReviewed = false;
    _this._shouldShowReviewForm = window.location.hash.endsWith("#review");
    _this._editingReviewId = null;
    _this._showRentForm = false;
    _this._userReviewId = null;
    _this.itemBasedRecommendations = [];
    _this.isLoadingItemBasedRecommendations = false;
    _this.itemBasedRecommendationsError = null;
    _this._currentPhotoIndex = 0;
    _this._itemRecScrollPosition = 0;
    _this._hasCompletedTransaction = false;
    _this.handleReviewSubmit = _this.handleReviewSubmit.bind(_this);
    _this.handleBuy = _this.handleBuy.bind(_this);
    _this.handleRent = _this.handleRent.bind(_this);
    _this._handleHashChange = _this.handleHashChange.bind(_this);
    _this.handleRentFormSubmit = _this.handleRentFormSubmit.bind(_this);
    _this.cancelRentForm = _this.cancelRentForm.bind(_this);
    _this.fetchItemBasedRecommendationsForCurrentItem = _this.fetchItemBasedRecommendationsForCurrentItem.bind(_this);
    return _this;
  }
  detail_product_inherits(DetailProduct, _HTMLElement);
  return detail_product_createClass(DetailProduct, [{
    key: "itemId",
    set: function set(id) {
      if (this._itemId !== id) {
        this._itemId = id;
        this._shouldShowReviewForm = window.location.hash.endsWith("#review");
        this._editingReviewId = null;
        this._showRentForm = false;
        this._currentPhotoIndex = 0;
        this._itemRecScrollPosition = 0;
        this.renderContent();
        if (this._itemId) {
          this.fetchItemAndReviews(this._itemId);
        } else {
          this.error = "ID Item tidak valid.";
          this.isLoading = false;
          this.renderContent();
        }
      }
    }
  }, {
    key: "connectedCallback",
    value: function () {
      var _connectedCallback = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee() {
        return detail_product_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              this._shouldShowReviewForm = window.location.hash.endsWith("#review");
              this._editingReviewId = null;
              if (this._itemId) {
                this.renderContent();
                this.fetchItemAndReviews(this._itemId);
              }
              window.addEventListener("hashchange", this._handleHashChange);
            case 4:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function connectedCallback() {
        return _connectedCallback.apply(this, arguments);
      }
      return connectedCallback;
    }()
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      this.removeEventListeners();
      window.removeEventListener("hashchange", this._handleHashChange);
      this._editingReviewId = null;
    }
  }, {
    key: "attributeChangedCallback",
    value: function attributeChangedCallback(name, oldValue, newValue) {
      if (name === "item-id") {
        var newItemId = newValue && typeof newValue === "string" && newValue !== "undefined" ? newValue : null;
        this.itemId = newItemId;
      }
    }
  }, {
    key: "handleHashChange",
    value: function handleHashChange() {
      var oldShouldShow = this._shouldShowReviewForm;
      this._shouldShowReviewForm = window.location.hash.endsWith("#review");
      if (oldShouldShow !== this._shouldShowReviewForm && !this.isLoading && !this.error && this._item) {
        this.renderContent();
      }
    }

    // Helper method to get standardized status display
  }, {
    key: "getStatusInfo",
    value: function getStatusInfo(item) {
      var status = item.status || "available";
      switch (status) {
        case "available":
          return {
            display: "Available",
            "class": "status-available",
            canTransact: true
          };
        case "pending":
          return {
            display: "Pending",
            "class": "status-pending",
            canTransact: false
          };
        case "rented":
          return {
            display: "Rented",
            "class": "status-rented",
            canTransact: false
          };
        case "sold":
          return {
            display: "Sold",
            "class": "status-sold",
            canTransact: false
          };
        case "ongoing":
          return {
            display: "Ongoing",
            "class": "status-ongoing",
            canTransact: false
          };
        default:
          return {
            display: status,
            "class": "status-default",
            canTransact: false
          };
      }
    }
  }, {
    key: "fetchItemAndReviews",
    value: function () {
      var _fetchItemAndReviews = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee2(itemId) {
        var itemResponse, currentUser, response, reviewsResponse, _currentUser, userReview;
        return detail_product_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              if (itemId) {
                _context2.next = 5;
                break;
              }
              this.error = "ID Item tidak valid.";
              this.isLoading = false;
              this.renderContent();
              return _context2.abrupt("return");
            case 5:
              this.isLoading = true;
              this.error = null;
              this._item = null;
              this._reviews = [];
              this._isCurrentUserReviewed = false;
              this._editingReviewId = null;
              this._showRentForm = false;
              this._userReviewId = null;
              this._currentPhotoIndex = 0;
              this._itemRecScrollPosition = 0;
              this._hasCompletedTransaction = false;
              this.itemBasedRecommendations = [];
              this.isLoadingItemBasedRecommendations = false;
              this.itemBasedRecommendationsError = null;
              this.renderContent();
              _context2.prev = 20;
              _context2.next = 23;
              return apiGet("/items/".concat(itemId));
            case 23:
              itemResponse = _context2.sent;
              if (!(itemResponse.status === "success" && itemResponse.data)) {
                _context2.next = 45;
                break;
              }
              this._item = itemResponse.data;
              currentUser = utils.getUserInfo();
              if (!currentUser) {
                _context2.next = 38;
                break;
              }
              _context2.prev = 28;
              _context2.next = 31;
              return fetch("https://api.pinjemin.site/api/transactions/user/".concat(currentUser.id, "/item/").concat(itemId, "/completed"), {
                headers: {
                  'Authorization': "Bearer ".concat(utils.getToken())
                }
              });
            case 31:
              response = _context2.sent;
              this._hasCompletedTransaction = response.ok && response.status === 200;
              _context2.next = 38;
              break;
            case 35:
              _context2.prev = 35;
              _context2.t0 = _context2["catch"](28);
              this._hasCompletedTransaction = false;
            case 38:
              this.fetchItemBasedRecommendationsForCurrentItem(this._item.id);
              _context2.next = 41;
              return apiGet("/reviews/item/".concat(itemId));
            case 41:
              reviewsResponse = _context2.sent;
              if (reviewsResponse.status === "success" && reviewsResponse.data) {
                this._reviews = Array.isArray(reviewsResponse.data) ? reviewsResponse.data : [];
                _currentUser = utils.getUserInfo();
                if (_currentUser) {
                  userReview = this._reviews.find(function (review) {
                    return review.user_id === _currentUser.id;
                  });
                  if (userReview) {
                    this._isCurrentUserReviewed = true;
                    this._userReviewId = userReview.id;
                  } else {
                    this._isCurrentUserReviewed = false;
                    this._userReviewId = null;
                  }
                } else {
                  this._isCurrentUserReviewed = false;
                  this._userReviewId = null;
                }
              } else {
                this._reviews = [];
                this._isCurrentUserReviewed = false;
                this._userReviewId = null;
              }
              _context2.next = 50;
              break;
            case 45:
              this._item = null;
              this._reviews = [];
              this.error = itemResponse.message || "Gagal memuat detail item.";
              this._isCurrentUserReviewed = false;
              this._userReviewId = null;
            case 50:
              _context2.next = 59;
              break;
            case 52:
              _context2.prev = 52;
              _context2.t1 = _context2["catch"](20);
              this._item = null;
              this._reviews = [];
              this.error = _context2.t1.message || "Terjadi kesalahan saat memuat data.";
              this._isCurrentUserReviewed = false;
              this._userReviewId = null;
            case 59:
              _context2.prev = 59;
              this.isLoading = false;
              this._editingReviewId = null;
              this._showRentForm = false;
              this.renderContent();
              if (this._item) {
                this.fetchItemBasedRecommendationsForCurrentItem(this._item.id);
              }
              return _context2.finish(59);
            case 66:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[20, 52, 59, 66], [28, 35]]);
      }));
      function fetchItemAndReviews(_x) {
        return _fetchItemAndReviews.apply(this, arguments);
      }
      return fetchItemAndReviews;
    }()
  }, {
    key: "getStyles",
    value: function getStyles() {
      return "\n      <style>\n        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n        \n        .detail-product-container {\n          font-family: 'Poppins', sans-serif;\n          color: #334155;\n        }\n        \n        .detail-product-container h1, \n        .detail-product-container h2, \n        .detail-product-container h3, \n        .detail-product-container h4, \n        .detail-product-container h5, \n        .detail-product-container h6 {\n          font-family: 'Poppins', sans-serif;\n        }\n        \n        .detail-product-container .hide-scrollbar {\n          scrollbar-width: none;\n          -ms-overflow-style: none;\n        }\n        \n        .detail-product-container .hide-scrollbar::-webkit-scrollbar {\n          display: none;\n        }\n        \n        .detail-product-container .nav-button {\n          background: rgba(79, 70, 229, 0.85);\n          color: white;\n          border: none;\n          width: 44px;\n          height: 44px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          transition: all 0.3s ease;\n          backdrop-filter: blur(4px);\n          box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);\n        }\n        \n        .detail-product-container .nav-button:hover {\n          background: rgba(67, 56, 202, 0.95);\n          transform: translateY(-2px);\n          box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);\n        }\n        \n        .detail-product-container .nav-button:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n          transform: none;\n          box-shadow: none;\n        }\n        \n        .detail-product-container .nav-button:not(:disabled):active {\n          transform: scale(0.95);\n        }\n        \n        .detail-product-container .thumbnail-item {\n          transition: all 0.3s ease;\n          border: 2px solid transparent;\n          border-radius: 12px;\n          overflow: hidden;\n          cursor: pointer;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n        }\n        \n        .detail-product-container .thumbnail-item:hover {\n          transform: translateY(-3px);\n          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n        }\n        \n        .detail-product-container .thumbnail-item.active {\n          border-color: #6366f1;\n          box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);\n        }\n        \n        .detail-product-container .recommendation-card {\n          background: #ffffff;\n          border: 1px solid #e2e8f0;\n          border-radius: 16px;\n          overflow: hidden;\n          transition: all 0.3s ease;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n        }\n        \n        .detail-product-container .recommendation-card:hover {\n          transform: translateY(-8px);\n          box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);\n          border-color: #6366f1;\n        }\n        \n        .detail-product-container .recommendation-card:active {\n          transform: translateY(-4px);\n        }\n        \n        .detail-product-container .recommendation-img {\n          transition: all 0.5s ease;\n        }\n        \n        .detail-product-container .recommendation-card:hover .recommendation-img {\n          transform: scale(1.08);\n        }\n        \n        .detail-product-container .slider-nav-button {\n          background: rgba(79, 70, 229, 0.85);\n          color: white;\n          border: none;\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          transition: all 0.3s ease;\n          flex-shrink: 0;\n          box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);\n        }\n        \n        .detail-product-container .slider-nav-button:hover {\n          background: rgba(67, 56, 202, 0.95);\n          transform: translateY(-2px);\n          box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);\n        }\n        \n        .detail-product-container .slider-nav-button:disabled {\n          opacity: 0.4;\n          cursor: not-allowed;\n          transform: none;\n          box-shadow: none;\n        }\n        \n        .detail-product-container .slider-nav-button:not(:disabled):active {\n          transform: scale(0.9);\n        }\n        \n        .detail-product-container .status-badge {\n          display: inline-block;\n          padding: 6px 16px;\n          border-radius: 9999px;\n          font-size: 14px;\n          font-weight: 600;\n          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n        }\n        \n        .detail-product-container .status-available {\n          background: linear-gradient(135deg, #10b981, #059669);\n          color: white;\n        }\n        \n        .detail-product-container .status-pending {\n          background: linear-gradient(135deg, #f59e0b, #d97706);\n          color: white;\n        }\n        \n        .detail-product-container .status-rented {\n          background: linear-gradient(135deg, #3b82f6, #2563eb);\n          color: white;\n        }\n        \n        .detail-product-container .status-sold {\n          background: linear-gradient(135deg, #ef4444, #dc2626);\n          color: white;\n        }\n        \n        .detail-product-container .status-ongoing {\n          background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n          color: white;\n        }\n        \n        .detail-product-container .status-default {\n          background: linear-gradient(135deg, #6b7280, #4b5563);\n          color: white;\n        }\n        \n        .detail-product-container .info-card {\n          background: #f8fafc;\n          color: #334155;\n          padding: 20px;\n          border-radius: 16px;\n          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);\n          border: 1px solid #e2e8f0;\n          transition: all 0.3s ease;\n        }\n        \n        .detail-product-container .info-card:hover {\n          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);\n          transform: translateY(-2px);\n        }\n        \n        .detail-product-container .price-info-card {\n          background: linear-gradient(135deg, #4f46e5, #6366f1);\n          color: white;\n          border: none;\n        }\n        \n        .detail-product-container .price-info-card:hover {\n          background: linear-gradient(135deg, #4338ca, #4f46e5);\n        }\n        \n        .detail-product-container .action-button {\n          padding: 12px 28px;\n          border-radius: 12px;\n          font-weight: 600;\n          border: none;\n          cursor: pointer;\n          transition: all 0.3s ease;\n          font-family: 'Poppins', sans-serif;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n        }\n        \n        .detail-product-container .action-button:hover {\n          transform: translateY(-3px);\n          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);\n        }\n        \n        .detail-product-container .action-button:active {\n          transform: translateY(-1px);\n        }\n        \n        .detail-product-container .btn-buy {\n          background: linear-gradient(135deg, #10b981, #059669);\n          color: white;\n        }\n        \n        .detail-product-container .btn-buy:hover {\n          background: linear-gradient(135deg, #059669, #047857);\n        }\n        \n        .detail-product-container .btn-rent {\n          background: linear-gradient(135deg, #3b82f6, #2563eb);\n          color: white;\n        }\n        \n        .detail-product-container .btn-rent:hover {\n          background: linear-gradient(135deg, #2563eb, #1d4ed8);\n        }\n        \n        .detail-product-container .btn-cancel {\n          background: #f1f5f9;\n          color: #64748b;\n        }\n        \n        .detail-product-container .btn-cancel:hover {\n          background: #e2e8f0;\n          color: #475569;\n        }\n        \n        .detail-product-container .availability-tag {\n          background: #3b82f6;\n          color: white;\n          padding: 4px 10px;\n          border-radius: 8px;\n          font-size: 12px;\n          font-weight: 600;\n          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n          transition: all 0.3s ease;\n        }\n        \n        .detail-product-container .availability-tag.rent {\n          background: linear-gradient(135deg, #3b82f6, #2563eb);\n        }\n        \n        .detail-product-container .availability-tag.sell {\n          background: linear-gradient(135deg, #10b981, #059669);\n        }\n        \n        .detail-product-container .availability-tag:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);\n        }\n        \n        .detail-product-container .section-title {\n          position: relative;\n          font-weight: 700;\n          color: #1e293b;\n          padding-bottom: 12px;\n          margin-bottom: 24px;\n        }\n        \n        .detail-product-container .section-title::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          width: 60px;\n          height: 4px;\n          background: linear-gradient(135deg, #4f46e5, #6366f1);\n          border-radius: 2px;\n        }\n        \n        .detail-product-container .product-main-image {\n          border-radius: 16px;\n          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);\n          transition: all 0.3s ease;\n        }\n        \n        .detail-product-container .product-main-image:hover {\n          box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);\n        }\n        \n        .detail-product-container .review-card {\n          border-radius: 12px;\n          background: #f8fafc;\n          border: 1px solid #e2e8f0;\n          transition: all 0.3s ease;\n        }\n        \n        .detail-product-container .review-card:hover {\n          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);\n          transform: translateY(-2px);\n        }\n        \n        .detail-product-container .review-form {\n          border-radius: 12px;\n          background: #f0f9ff;\n          border: 1px solid #bae6fd;\n        }\n        \n        .detail-product-container .edit-review-form {\n          border-radius: 12px;\n          background: #eff6ff;\n          border: 1px solid #bfdbfe;\n        }\n        \n        .detail-product-container .shimmer {\n          background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);\n          background-size: 200% 100%;\n          animation: shimmer 2s infinite;\n        }\n        \n        @keyframes shimmer {\n          0% { background-position: -200% 0; }\n          100% { background-position: 200% 0; }\n        }\n        \n        .detail-product-container .pulse {\n          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n        \n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.7; }\n        }\n      </style>\n    ";
    }
  }, {
    key: "renderContent",
    value: function renderContent() {
      this.innerHTML = "";
      var styles = this.getStyles();
      var itemDetailsHtml = this.renderItemDetails();
      var itemBasedRecommendationsHtml = this.renderItemBasedRecommendations();
      var rentFormHtml = this.renderRentForm();
      var reviewsSectionHtml = this.renderReviewsSection();
      this.innerHTML = "\n        ".concat(styles, "\n        <div class=\"detail-product-container\">\n            <div class=\"container mx-auto px-4 py-8\">\n                ").concat(itemDetailsHtml, "\n                ").concat(rentFormHtml, "\n                ").concat(itemBasedRecommendationsHtml, "\n                ").concat(reviewsSectionHtml, "\n            </div>\n        </div>\n        ");
      this.setupEventListeners();
    }
  }, {
    key: "renderItemDetails",
    value: function renderItemDetails() {
      var _this2 = this;
      if (this.isLoading && !this._item) {
        return "\n        <div class=\"bg-white shadow-xl rounded-2xl p-8 mb-8\">\n          <div class=\"shimmer h-8 w-3/4 rounded-lg mb-8\"></div>\n          <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <div class=\"shimmer h-96 w-full rounded-2xl\"></div>\n            <div class=\"space-y-6\">\n              <div class=\"shimmer h-32 w-full rounded-xl\"></div>\n              <div class=\"shimmer h-40 w-full rounded-xl\"></div>\n              <div class=\"shimmer h-40 w-full rounded-xl\"></div>\n            </div>\n          </div>\n        </div>\n      ";
      }
      if (this.error && !this._item) {
        return "\n        <div class=\"bg-red-50 border-2 border-red-200 rounded-2xl p-8 mb-8 text-center\">\n          <svg class=\"w-16 h-16 text-red-500 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"></path>\n          </svg>\n          <h3 class=\"text-xl font-bold text-red-700 mb-2\">Error</h3>\n          <p class=\"text-red-600\">".concat(this.error, "</p>\n        </div>\n      ");
      }
      if (!this._item) {
        return "\n        <div class=\"bg-gray-50 border-2 border-gray-200 rounded-2xl p-8 mb-8 text-center\">\n          <svg class=\"w-16 h-16 text-gray-400 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <h3 class=\"text-xl font-bold text-gray-700 mb-2\">Detail Tidak Tersedia</h3>\n          <p class=\"text-gray-600\">Detail item tidak dapat ditemukan.</p>\n        </div>\n      ";
      }
      var item = this._item;
      var formatRupiah = function formatRupiah(money) {
        if (money === null || money === undefined) return "-";
        var numericMoney = typeof money === "string" ? Number.parseFloat(money) : money;
        if (isNaN(numericMoney)) return "-";
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0
        }).format(numericMoney);
      };
      var statusInfo = this.getStatusInfo(item);
      var currentUser = utils.getUserInfo();
      var isOwner = currentUser && this._item && this._item.user_id === currentUser.id;
      var showBuyRentButtons = statusInfo.canTransact && !isOwner && !this._showRentForm;
      return " \n        <div class=\"bg-white shadow-xl rounded-2xl p-8 mb-8\">\n            <h2 class=\"text-3xl font-bold mb-8 text-indigo-900\">".concat(item.name, "</h2>\n            <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                <!-- Photo Gallery -->\n                <div>\n                    ").concat(item.photos && item.photos.length > 0 ? "\n                        <!-- Main Photo Display -->\n                        <div class=\"mb-8\">\n                            <div class=\"relative bg-gray-50 rounded-2xl overflow-hidden product-main-image\" style=\"height: 450px;\">\n                                <img src=\"https://api.pinjemin.site".concat(item.photos[this._currentPhotoIndex], "\" \n                                     alt=\"").concat(item.name, "\" \n                                     class=\"w-full h-full object-contain\">\n                                ").concat(item.photos.length > 1 ? "\n                                    <button class=\"absolute left-4 top-1/2 transform -translate-y-1/2 nav-button\" \n                                            id=\"prev-photo\">\n                                        <i class=\"fa-solid fa-angle-left text-lg\"></i>\n                                    </button>\n                                    <button class=\"absolute right-4 top-1/2 transform -translate-y-1/2 nav-button\" \n                                            id=\"next-photo\">\n                                        <i class=\"fa-solid fa-angle-right text-lg\"></i>\n                                    </button>\n                                " : "", "\n                            </div>\n                        </div>\n                        \n                        <!-- Thumbnail Slider -->\n                        ").concat(item.photos.length > 1 ? "\n                            <div class=\"relative\">\n                                <div class=\"flex items-center gap-4\">\n                                    <div class=\"flex-1 overflow-hidden\">\n                                        <div class=\"flex gap-4 transition-transform duration-300 hide-scrollbar\" \n                                             id=\"thumbnail-container\" style=\"overflow-x: auto;\">\n                                            ".concat(item.photos.map(function (photo, index) {
        return "\n                                                <div class=\"flex-shrink-0 cursor-pointer thumbnail-item ".concat(index === _this2._currentPhotoIndex ? "active" : "", "\" \n                                                     data-index=\"").concat(index, "\">\n                                                    <img src=\"https://api.pinjemin.site").concat(photo, "\" \n                                                         alt=\"").concat(item.name, " ").concat(index + 1, "\" \n                                                         class=\"w-24 h-24 object-cover\">\n                                                </div>\n                                            ");
      }).join(""), "\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ") : "", "\n                    ") : '<div class="w-full h-96 bg-gray-100 rounded-2xl mb-6 flex items-center justify-center text-gray-500"><span class="text-lg font-medium">Tidak Ada Foto</span></div>', "\n                </div>\n\n                <!-- Product Information -->\n                <div class=\"space-y-6\">\n                    <!-- Description -->\n                    <div class=\"bg-gray-50 p-6 rounded-xl\">\n                        <h3 class=\"text-xl font-semibold mb-4 text-indigo-900\">Deskripsi</h3>\n                        <p class=\"text-gray-700 leading-relaxed\">").concat(item.description || "Tidak ada deskripsi tersedia.", "</p>\n                    </div>\n\n                    <!-- Product Details -->\n                    <div class=\"info-card\">\n                        <h3 class=\"text-xl font-semibold mb-4 text-indigo-900\">Detail Item</h3>\n                        <div class=\"space-y-3\">\n                            <p class=\"flex items-center\">\n                                <span class=\"w-32 font-medium text-gray-700\">Kategori:</span> \n                                <span class=\"bg-indigo-100 text-indigo-800 px-3 py-1 rounded-lg text-sm font-medium\">").concat(item.category_name || "-", "</span>\n                            </p>\n                            <p class=\"flex items-center\">\n                                <span class=\"w-32 font-medium text-gray-700\">Status Item:</span> \n                                <span class=\"status-badge ").concat(statusInfo["class"], "\">").concat(statusInfo.display, "</span>\n                            </p>\n                        </div>\n                    </div>\n\n                    <!-- Pricing Information -->\n                    ").concat(statusInfo.canTransact ? "\n                    <div class=\"info-card price-info-card\">\n                        <h3 class=\"text-xl font-semibold mb-4\">Informasi Harga</h3>\n                        <div class=\"space-y-3\">\n                            ".concat(item.is_available_for_sell ? "\n                                <p class=\"flex items-center\">\n                                    <span class=\"w-32 font-medium text-white/90\">Harga Jual:</span> \n                                    <span class=\"text-xl font-bold\">".concat(formatRupiah(item.price_sell), "</span>\n                                </p>") : "", "\n                            ").concat(item.is_available_for_rent ? "\n                                <p class=\"flex items-center\">\n                                    <span class=\"w-32 font-medium text-white/90\">Harga Sewa:</span> \n                                    <span class=\"text-xl font-bold\">".concat(formatRupiah(item.price_rent), "/hari</span>\n                                </p>\n                                <p class=\"flex items-center\">\n                                    <span class=\"w-32 font-medium text-white/90\">Deposit Sewa:</span> \n                                    <span class=\"text-lg font-bold\">").concat(formatRupiah(item.deposit_amount), "</span>\n                                </p>\n                            ") : "", "\n                        </div>\n                    </div>\n                    ") : "", "\n\n                    <!-- Location & Seller -->\n                    <div class=\"info-card\">\n                        <h3 class=\"text-xl font-semibold mb-4 text-indigo-900\">Lokasi & Penjual</h3>\n                        <div class=\"space-y-3\">\n                            <p class=\"flex items-center\">\n                                <i class=\"fa-solid fa-location-dot text-indigo-600 mr-2\"></i>\n                                <span class=\"font-medium text-gray-700 mr-2\">Lokasi:</span> \n                                <span>").concat(item.city_name || "-", ", ").concat(item.province_name || "-", "</span>\n                            </p>\n                            <p class=\"flex items-center\">\n                                <i class=\"fa-solid fa-user text-indigo-600 mr-2\"></i>\n                                <span class=\"font-medium text-gray-700 mr-2\">Penjual:</span> \n                                <span>").concat(item.owner_name || "Tidak Diketahui", "</span>\n                            </p>\n                            <p class=\"flex items-center\">\n                                <i class=\"fa-solid fa-envelope text-indigo-600 mr-2\"></i>\n                                <span class=\"font-medium text-gray-700 mr-2\">Email:</span> \n                                <span>").concat(item.owner_email || "-", "</span>\n                            </p>\n                        </div>\n                    </div>\n\n                    <!-- Action Buttons -->\n                    ").concat(showBuyRentButtons ? "\n                        <div class=\"flex gap-4 mt-8\">\n                            ".concat(item.is_available_for_sell ? "<button id=\"buy-button\" class=\"action-button btn-buy flex items-center\"><i class=\"fa-solid fa-shopping-cart mr-2\"></i> Beli Sekarang</button>" : "", "\n                            ").concat(item.is_available_for_rent ? "<button id=\"rent-button\" class=\"action-button btn-rent flex items-center\"><i class=\"fa-solid fa-calendar-days mr-2\"></i> Sewa</button>" : "", "\n                        </div>\n                    ") : isOwner && statusInfo.canTransact ? "<div class=\"bg-indigo-100 text-indigo-800 px-4 py-3 rounded-xl mt-6 flex items-center\"><i class=\"fa-solid fa-circle-info mr-2\"></i> Anda adalah pemilik item ini.</div>" : !statusInfo.canTransact ? "<div class=\"bg-amber-100 text-amber-800 px-4 py-3 rounded-xl mt-6 flex items-center\"><i class=\"fa-solid fa-circle-exclamation mr-2\"></i> Item ini saat ini tidak tersedia untuk transaksi.</div>" : "", "\n                </div>\n            </div>\n        </div>\n        ");
    }
  }, {
    key: "renderReviewsSection",
    value: function renderReviewsSection() {
      var _this3 = this;
      var reviewsHtml = "";
      if (this.isLoading && !this._item) {
        reviewsHtml = "\n        <div class=\"space-y-4\">\n          ".concat(Array(3).fill().map(function () {
          return "\n            <div class=\"shimmer h-32 w-full rounded-xl\"></div>\n          ";
        }).join(""), "\n        </div>\n      ");
      } else if (this.error && !this._item) {
        reviewsHtml = "";
      } else if (this._reviews.length === 0) {
        reviewsHtml = "\n        <div class=\"bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl p-8 text-center\">\n          <svg class=\"w-12 h-12 text-gray-400 mx-auto mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"></path>\n          </svg>\n          <p class=\"text-gray-600\">Belum ada review untuk item ini.</p>\n          ".concat(utils.isAuthenticated() && !this._isCurrentUserReviewed ? this._hasCompletedTransaction ? "\n                <button class=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\" \n                        onclick=\"window.location.hash = window.location.hash + '#review'\">\n                  Tulis Review Pertama\n                </button>\n                " : "\n                <p class=\"mt-4 text-amber-600\">\n                  <i class=\"fa-solid fa-circle-info mr-1\"></i>\n                  Selesaikan transaksi untuk dapat memberikan review\n                </p>\n                " : "", "\n        </div>\n      ");
      } else {
        reviewsHtml = "\n        <div class=\"space-y-6\">\n          ".concat(this._reviews.map(function (review) {
          return _this3.renderReview(review);
        }).join(""), "\n        </div>\n      ");
      }
      var currentUser = utils.getUserInfo();
      var showAddReviewForm = currentUser && !!this._item && !this._isCurrentUserReviewed && this._shouldShowReviewForm && this._editingReviewId === null && this._hasCompletedTransaction;
      return "\n      <div class=\"bg-white shadow-xl rounded-2xl p-8 mt-8\">\n        <h3 class=\"section-title text-2xl\">Review Pengguna (".concat(this._reviews.length, ")</h3>\n\n        ").concat(showAddReviewForm ? this.renderReviewForm() : "", "\n\n        <div id=\"reviews-list\" class=\"mt-6\">\n          ").concat(reviewsHtml, "\n        </div>\n        \n        ").concat(!showAddReviewForm && currentUser && !this._isCurrentUserReviewed && !this._editingReviewId ? this._hasCompletedTransaction ? "\n              <div class=\"mt-8 text-center\">\n                <button class=\"action-button bg-indigo-600 text-white hover:bg-indigo-700\" \n                        onclick=\"window.location.hash = window.location.hash + '#review'\">\n                  <i class=\"fa-solid fa-pen-to-square mr-2\"></i> Tulis Review Anda\n                </button>\n              </div>\n              " : "\n              <div class=\"mt-8 text-center\">\n                <div class=\"bg-amber-100 text-amber-800 px-4 py-3 rounded-xl inline-flex items-center\">\n                  <i class=\"fa-solid fa-circle-info mr-2\"></i>\n                  Anda harus menyelesaikan transaksi dengan item ini untuk dapat memberikan review\n                </div>\n              </div>\n              " : "", "\n      </div>\n    ");
    }
  }, {
    key: "renderReviewForm",
    value: function renderReviewForm() {
      if (!this._item || !utils.isAuthenticated() || this._isCurrentUserReviewed || this._editingReviewId !== null || !this._hasCompletedTransaction) {
        return "";
      }
      return "\n      <div id=\"review-form-section\" class=\"mb-8 p-6 review-form\">\n        <h4 class=\"text-xl font-semibold mb-4 text-indigo-900 flex items-center\">\n          <i class=\"fa-solid fa-pen-to-square mr-2 text-indigo-600\"></i>\n          Tulis Review Anda\n        </h4>\n        <form id=\"add-review-form\">\n          <div class=\"mb-4\">\n            <label for=\"review-comment\" class=\"block text-sm font-medium text-gray-700 mb-2\">Komentar</label>\n            <textarea id=\"review-comment\" name=\"comment\" rows=\"4\" \n                      class=\"w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50\" \n                      placeholder=\"Bagikan pendapat Anda tentang produk ini...\" required></textarea>\n          </div>\n          <div class=\"flex justify-end\">\n            <button type=\"submit\" class=\"action-button bg-indigo-600 text-white hover:bg-indigo-700\">\n              <i class=\"fa-solid fa-paper-plane mr-2\"></i> Kirim Review\n            </button>\n          </div>\n        </form>\n      </div>\n    ";
    }
  }, {
    key: "renderEditReviewForm",
    value: function renderEditReviewForm(review) {
      if (!review || !utils.isAuthenticated()) {
        return "";
      }
      if (this._editingReviewId !== review.id) {
        return "";
      }
      return "\n      <div class=\"mt-4 mb-6 p-6 edit-review-form\">\n        <h4 class=\"text-xl font-semibold mb-4 text-indigo-900 flex items-center\">\n          <i class=\"fa-solid fa-pen-to-square mr-2 text-indigo-600\"></i>\n          Edit Review Anda\n        </h4>\n        <form class=\"edit-review-form\" data-review-id=\"".concat(review.id, "\">\n          <div class=\"mb-4\">\n            <label for=\"edit-review-comment-").concat(review.id, "\" class=\"block text-sm font-medium text-gray-700 mb-2\">Komentar</label>\n            <textarea id=\"edit-review-comment-").concat(review.id, "\" name=\"comment\" rows=\"4\" \n                      class=\"w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50\" \n                      required>").concat(review.comment || "", "</textarea>\n          </div>\n          <div class=\"flex justify-end gap-3\">\n            <button type=\"button\" class=\"cancel-edit-button action-button btn-cancel\">\n              <i class=\"fa-solid fa-xmark mr-2\"></i> Batal\n            </button>\n            <button type=\"submit\" class=\"save-edit-button action-button bg-indigo-600 text-white hover:bg-indigo-700\">\n              <i class=\"fa-solid fa-check mr-2\"></i> Simpan Perubahan\n            </button>\n          </div>\n        </form>\n      </div>\n    ");
    }
  }, {
    key: "renderReview",
    value: function renderReview(review) {
      if (!review) return "";
      var currentUser = utils.getUserInfo();
      var isCurrentUserReview = currentUser && currentUser.id === review.user_id;
      var reviewDate = review.created_at ? new Date(review.created_at) : null;
      var formattedDate = reviewDate ? new Intl.DateTimeFormat("id-ID", {
        year: "numeric",
        month: "long",
        day: "numeric"
      }).format(reviewDate) : "-";
      if (isCurrentUserReview && this._editingReviewId === review.id) {
        return this.renderEditReviewForm(review);
      }
      return "\n      <div class=\"review-card p-6\" data-review-id=\"".concat(review.id, "\">\n        <div class=\"flex items-center mb-3\">\n          <div class=\"w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-lg mr-3\">\n            ").concat((review.user_name || "?")[0].toUpperCase(), "\n          </div>\n          <div>\n            <p class=\"font-semibold text-gray-900\">").concat(review.user_name || "Pengguna Tidak Diketahui", "</p>\n            <p class=\"text-gray-500 text-sm\">").concat(formattedDate, "</p>\n          </div>\n        </div>\n        \n        <p class=\"text-gray-700 mt-3 mb-4\" id=\"review-comment-").concat(review.id, "\">").concat(review.comment || "-", "</p>\n        \n        ").concat(isCurrentUserReview && this._editingReviewId === null ? "\n            <div class=\"flex justify-end gap-2\">\n              <button class=\"edit-review-button flex items-center text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-3 py-2 rounded-lg text-sm font-medium transition-colors\" data-review-id=\"".concat(review.id, "\">\n                <i class=\"fa-solid fa-pen-to-square mr-1\"></i> Edit\n              </button>\n              <button class=\"delete-review-button flex items-center text-red-600 bg-red-50 hover:bg-red-100 px-3 py-2 rounded-lg text-sm font-medium transition-colors\" data-review-id=\"").concat(review.id, "\">\n                <i class=\"fa-solid fa-trash-can mr-1\"></i> Hapus\n              </button>\n            </div>\n            ") : "", "\n      </div>\n    ");
    }
  }, {
    key: "renderRentForm",
    value: function renderRentForm() {
      if (!this._showRentForm || !this._item || !utils.isAuthenticated()) {
        return "";
      }
      var today = new Date().toISOString().split("T")[0];
      var item = this._item;
      var formatRupiah = this.formatRupiah;
      return "\n      <div id=\"rent-form-section\" class=\"bg-white shadow-xl rounded-2xl p-8 mt-8 mb-8\">\n        <h3 class=\"section-title text-2xl\">Formulir Penyewaan</h3>\n        \n        <div class=\"bg-indigo-50 border border-indigo-200 rounded-xl p-4 mb-6\">\n          <div class=\"flex flex-wrap gap-4 items-center\">\n            <div class=\"flex-shrink-0\">\n              <img src=\"".concat(item.thumbnail ? "https://api.pinjemin.site".concat(item.thumbnail) : "https://via.placeholder.com/80", "\" \n                   alt=\"").concat(item.name, "\" class=\"w-20 h-20 object-cover rounded-lg\">\n            </div>\n            <div class=\"flex-grow\">\n              <h4 class=\"font-semibold text-lg text-indigo-900\">").concat(item.name, "</h4>\n              <div class=\"flex flex-wrap gap-4 mt-2\">\n                <p class=\"text-indigo-700 font-medium\">Harga Sewa: ").concat(formatRupiah(item.price_rent), "/hari</p>\n                <p class=\"text-indigo-700 font-medium\">Deposit: ").concat(formatRupiah(item.deposit_amount), "</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <form id=\"rent-item-form\" class=\"space-y-6\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <label for=\"rent-start-date\" class=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal Mulai Sewa</label>\n              <input type=\"date\" id=\"rent-start-date\" name=\"rent_start_date\"\n                  class=\"w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50\"\n                  required min=\"").concat(today, "\">\n            </div>\n            <div>\n              <label for=\"rent-end-date\" class=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal Selesai Sewa</label>\n              <input type=\"date\" id=\"rent-end-date\" name=\"rent_end_date\"\n                  class=\"w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50\"\n                  required min=\"").concat(today, "\">\n            </div>\n          </div>\n          \n          <div class=\"flex flex-wrap gap-4 mt-8\">\n            <button type=\"submit\" class=\"action-button btn-rent flex items-center\">\n              <i class=\"fa-solid fa-check mr-2\"></i> Ajukan Penyewaan\n            </button>\n            <button type=\"button\" id=\"cancel-rent-button\" class=\"action-button btn-cancel flex items-center\">\n              <i class=\"fa-solid fa-xmark mr-2\"></i> Batal\n            </button>\n          </div>\n        </form>\n      </div>\n    ");
    }
  }, {
    key: "renderItemBasedRecommendations",
    value: function renderItemBasedRecommendations() {
      var _this4 = this;
      if (this.isLoading || this.error || !this._item) {
        return "";
      }
      if (this.isLoadingItemBasedRecommendations) {
        return "\n        <div class=\"bg-white shadow-xl rounded-2xl p-8 mt-8 mb-8\">\n          <h3 class=\"section-title text-2xl\">Produk Serupa Lainnya</h3>\n          <div class=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\n            ".concat(Array(8).fill().map(function () {
          return "\n              <div class=\"shimmer h-64 w-full rounded-xl\"></div>\n            ";
        }).join(""), "\n          </div>\n        </div>\n      ");
      }
      if (this.itemBasedRecommendationsError) {
        return "\n        <div class=\"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-xl mt-8 mb-8\">\n          <div class=\"flex items-center\">\n            <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"></path>\n            </svg>\n            <span class=\"font-medium\">Error:</span>\n            <span class=\"ml-1\">".concat(this.itemBasedRecommendationsError, "</span>\n          </div>\n        </div>\n      ");
      }
      if (!this.itemBasedRecommendations || this.itemBasedRecommendations.length === 0) {
        return "\n        <div class=\"bg-white shadow-xl rounded-2xl p-8 mt-8 mb-8\">\n          <h3 class=\"section-title text-2xl\">Produk Serupa Lainnya</h3>\n          <div class=\"bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl p-6 text-center\">\n            <svg class=\"w-12 h-12 text-gray-400 mx-auto mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"></path>\n            </svg>\n            <p class=\"text-gray-600\">Tidak ada rekomendasi serupa yang tersedia saat ini.</p>\n          </div>\n        </div>\n      ";
      }
      var backendBaseUrl = "https://api.pinjemin.site";
      var formatRupiah = this.formatRupiah;

      // Ensure we have exactly 8 recommendations or as many as possible
      var recommendationsToShow = this.itemBasedRecommendations.slice(0, 8);

      // If we have less than 8, duplicate some to fill the space
      while (recommendationsToShow.length < 8 && this.itemBasedRecommendations.length > 0) {
        var itemsToAdd = Math.min(this.itemBasedRecommendations.length, 8 - recommendationsToShow.length);
        for (var i = 0; i < itemsToAdd; i++) {
          recommendationsToShow.push(detail_product_objectSpread({}, this.itemBasedRecommendations[i % this.itemBasedRecommendations.length]));
        }
      }
      var recommendationsListHtml = recommendationsToShow.map(function (rec) {
        var statusInfo = _this4.getStatusInfo(rec);
        return "\n          <div class=\"recommendation-card\">\n            <a href=\"/#/items/".concat(rec.id || rec.product_id, "\" class=\"block text-gray-800\" data-item-id=\"").concat(rec.id || rec.product_id, "\">\n              <div class=\"relative overflow-hidden\">\n                ").concat(rec.thumbnail ? "<img src=\"".concat(backendBaseUrl).concat(rec.thumbnail, "\" alt=\"").concat(rec.name || "Product image", "\" \n                        class=\"recommendation-img w-full h-48 object-cover\">") : '<div class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-400"><i class="fa-solid fa-image text-3xl"></i></div>', "\n                <div class=\"absolute top-3 left-3\">\n                  <span class=\"status-badge ").concat(statusInfo["class"], " text-xs\">").concat(statusInfo.display, "</span>\n                </div>\n              </div>\n              \n              <div class=\"p-4\">\n                <h5 class=\"text-lg font-bold text-gray-900 line-clamp-2 mb-2 h-14\">").concat(rec.name || rec.product_name || "Unnamed Product", "</h5>\n                \n                ").concat(statusInfo.canTransact ? "\n                    <div class=\"flex items-center gap-2 flex-wrap mb-3\">\n                      ".concat(rec.is_available_for_rent ? "<span class=\"availability-tag rent\">Sewa</span>" : "", "\n                      ").concat(rec.is_available_for_sell ? "<span class=\"availability-tag sell\">Jual</span>" : "", "\n                    </div>\n                    <div class=\"space-y-1 border-t border-gray-200 pt-3\">\n                      ").concat(rec.is_available_for_sell ? "<p class=\"text-sm font-semibold flex items-center\">\n                          <i class=\"fa-solid fa-tag text-green-600 mr-2\"></i>\n                          Jual: ".concat(formatRupiah(rec.price_sell), "\n                        </p>") : "", "\n                      ").concat(rec.is_available_for_rent ? "<p class=\"text-sm font-semibold flex items-center\">\n                          <i class=\"fa-solid fa-calendar-days text-blue-600 mr-2\"></i>\n                          Sewa: ".concat(formatRupiah(rec.price_rent)).concat(rec.price_rent > 0 ? " /hari" : "", "\n                        </p>") : "", "\n                    </div>\n                    ") : "", "\n              </div>\n            </a>\n          </div>\n        ");
      }).join("");
      return "\n      <div class=\"bg-white shadow-xl rounded-2xl p-8 mt-8 mb-8\">\n        <h3 class=\"section-title text-2xl\">Produk Serupa Lainnya</h3>\n        \n        <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n          ".concat(recommendationsListHtml, "\n        </div>\n      </div>\n    ");
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      var _this5 = this;
      this.removeEventListeners();
      this.setupPhotoNavigation();
      this.setupRecommendationSliders();
      var addReviewForm = this.querySelector("#add-review-form");
      if (addReviewForm) {
        this._addReviewFormSubmitHandler = this.handleReviewSubmit;
        addReviewForm.addEventListener("submit", this._addReviewFormSubmitHandler);
        if (window.location.hash.endsWith("#review") && this._shouldShowReviewForm) {
          var reviewFormSection = this.querySelector("#review-form-section");
          if (reviewFormSection) {
            requestAnimationFrame(function () {
              reviewFormSection.scrollIntoView({
                behavior: "smooth",
                block: "start"
              });
            });
          }
        }
      }
      var reviewsList = this.querySelector("#reviews-list");
      if (reviewsList) {
        this._reviewActionsDelegate = function (event) {
          var _target$closest;
          var target = event.target;
          var reviewId = target.dataset.reviewId || ((_target$closest = target.closest("[data-review-id]")) === null || _target$closest === void 0 ? void 0 : _target$closest.dataset.reviewId);
          var isButton = target.tagName === "BUTTON";
          if (isButton && target.closest(".edit-review-form")) {
            var form = target.closest(".edit-review-form");
            var formReviewId = form ? Number.parseInt(form.dataset.reviewId, 10) : null;
            if (!formReviewId) return;
            if (target.classList.contains("save-edit-button")) {
              _this5.handleEditSubmit(event, formReviewId);
              return;
            } else if (target.classList.contains("cancel-edit-button")) {
              _this5.cancelEditReview(event);
              return;
            }
          }
          if (isButton && reviewId) {
            if (target.classList.contains("edit-review-button")) {
              _this5.handleEditReview(Number.parseInt(reviewId, 10));
            } else if (target.classList.contains("delete-review-button")) {
              _this5.handleDeleteReview(Number.parseInt(reviewId, 10));
            }
          }
        };
        reviewsList.addEventListener("click", this._reviewActionsDelegate);
      }
      var buyButton = this.querySelector("#buy-button");
      if (buyButton) {
        this._buyButtonClickHandler = this.handleBuy;
        buyButton.addEventListener("click", this._buyButtonClickHandler);
      }
      var rentButton = this.querySelector("#rent-button");
      if (rentButton) {
        this._rentButtonClickHandler = this.handleRent;
        rentButton.addEventListener("click", this._rentButtonClickHandler);
      }
      var rentItemForm = this.querySelector("#rent-item-form");
      if (rentItemForm) {
        this._rentFormSubmitHandler = this.handleRentFormSubmit;
        rentItemForm.addEventListener("submit", this._rentFormSubmitHandler);
        var cancelRentButton = rentItemForm.querySelector("#cancel-rent-button");
        if (cancelRentButton) {
          this._cancelRentButtonClickHandler = this.cancelRentForm;
          cancelRentButton.addEventListener("click", this._cancelRentButtonClickHandler);
        }
        requestAnimationFrame(function () {
          rentItemForm.scrollIntoView({
            behavior: "smooth",
            block: "start"
          });
        });
      }
    }
  }, {
    key: "setupPhotoNavigation",
    value: function setupPhotoNavigation() {
      var _this6 = this;
      if (!this._item || !this._item.photos || this._item.photos.length <= 1) return;
      var prevButton = this.querySelector("#prev-photo");
      var nextButton = this.querySelector("#next-photo");
      var thumbPrevButton = this.querySelector("#thumb-prev");
      var thumbNextButton = this.querySelector("#thumb-next");
      if (prevButton && nextButton) {
        this._prevPhotoHandler = function () {
          _this6._currentPhotoIndex = _this6._currentPhotoIndex > 0 ? _this6._currentPhotoIndex - 1 : _this6._item.photos.length - 1;
          _this6.updatePhotoDisplay();
        };
        this._nextPhotoHandler = function () {
          _this6._currentPhotoIndex = _this6._currentPhotoIndex < _this6._item.photos.length - 1 ? _this6._currentPhotoIndex + 1 : 0;
          _this6.updatePhotoDisplay();
        };
        prevButton.addEventListener("click", this._prevPhotoHandler);
        nextButton.addEventListener("click", this._nextPhotoHandler);
      }
      if (thumbPrevButton && thumbNextButton) {
        this._thumbPrevHandler = function () {
          return _this6.scrollThumbnails(-1);
        };
        this._thumbNextHandler = function () {
          return _this6.scrollThumbnails(1);
        };
        thumbPrevButton.addEventListener("click", this._thumbPrevHandler);
        thumbNextButton.addEventListener("click", this._thumbNextHandler);
      }
      var thumbnails = this.querySelectorAll(".thumbnail-item");
      thumbnails.forEach(function (thumb, index) {
        var handler = function handler() {
          _this6._currentPhotoIndex = index;
          _this6.updatePhotoDisplay();
        };
        thumb.addEventListener("click", handler);
        thumb._clickHandler = handler;
      });
    }
  }, {
    key: "setupRecommendationSliders",
    value: function setupRecommendationSliders() {
      var _this7 = this;
      var itemRecPrev = this.querySelector("#item-rec-prev");
      var itemRecNext = this.querySelector("#item-rec-next");
      if (itemRecPrev && itemRecNext) {
        this._itemRecPrevHandler = function () {
          return _this7.scrollRecommendations("item", -1);
        };
        this._itemRecNextHandler = function () {
          return _this7.scrollRecommendations("item", 1);
        };
        itemRecPrev.addEventListener("click", this._itemRecPrevHandler);
        itemRecNext.addEventListener("click", this._itemRecNextHandler);
      }

      // Add click handler for recommendation items
      var recommendationsContainer = this.querySelector("#item-recommendations-container");
      if (recommendationsContainer) {
        this._recommendationClickHandler = function (event) {
          var link = event.target.closest("a[data-item-id]");
          if (link) {
            var itemId = link.dataset.itemId;
            if (itemId) {
              // Trigger ML refresh before navigation
              _this7.triggerMLRefresh(itemId);
            }
          }
        };
        recommendationsContainer.addEventListener("click", this._recommendationClickHandler);
      }
    }
  }, {
    key: "updatePhotoDisplay",
    value: function updatePhotoDisplay() {
      var _this8 = this;
      var mainImg = this.querySelector(".bg-gray-50 img");
      var thumbnails = this.querySelectorAll(".thumbnail-item");
      if (mainImg && this._item && this._item.photos) {
        mainImg.src = "https://api.pinjemin.site".concat(this._item.photos[this._currentPhotoIndex]);
      }
      thumbnails.forEach(function (thumb, index) {
        if (index === _this8._currentPhotoIndex) {
          thumb.classList.add("active");
        } else {
          thumb.classList.remove("active");
        }
      });
    }
  }, {
    key: "scrollThumbnails",
    value: function scrollThumbnails(direction) {
      var container = this.querySelector("#thumbnail-container");
      if (!container) return;
      var scrollAmount = 100;
      container.scrollLeft += direction * scrollAmount;
    }
  }, {
    key: "scrollRecommendations",
    value: function scrollRecommendations(type, direction) {
      if (type === "item") {
        var container = this.querySelector("#item-recommendations-container");
        if (container) {
          var cardWidth = 280; // Approximate width of a card + gap
          var scrollAmount = cardWidth * direction;
          container.scrollBy({
            left: scrollAmount,
            behavior: "smooth"
          });
          this._itemRecScrollPosition = container.scrollLeft + scrollAmount;
        }
      }
    }
  }, {
    key: "removeEventListeners",
    value: function removeEventListeners() {
      var addReviewForm = this.querySelector("#add-review-form");
      if (addReviewForm && this._addReviewFormSubmitHandler) {
        addReviewForm.removeEventListener("submit", this._addReviewFormSubmitHandler);
        this._addReviewFormSubmitHandler = null;
      }
      var reviewsList = this.querySelector("#reviews-list");
      if (reviewsList && this._reviewActionsDelegate) {
        reviewsList.removeEventListener("click", this._reviewActionsDelegate);
        this._reviewActionsDelegate = null;
      }
      var buyButton = this.querySelector("#buy-button");
      if (buyButton && this._buyButtonClickHandler) {
        buyButton.removeEventListener("click", this._buyButtonClickHandler);
        this._buyButtonClickHandler = null;
      }
      var rentButton = this.querySelector("#rent-button");
      if (rentButton && this._rentButtonClickHandler) {
        rentButton.removeEventListener("click", this._rentButtonClickHandler);
        this._rentButtonClickHandler = null;
      }
      var rentItemForm = this.querySelector("#rent-item-form");
      if (rentItemForm && this._rentFormSubmitHandler) {
        rentItemForm.removeEventListener("submit", this._rentFormSubmitHandler);
        this._rentFormSubmitHandler = null;
      }
      var cancelRentButton = this.querySelector("#cancel-rent-button");
      if (cancelRentButton && this._cancelRentButtonClickHandler) {
        cancelRentButton.removeEventListener("click", this._cancelRentButtonClickHandler);
        this._cancelRentButtonClickHandler = null;
      }
      var prevButton = this.querySelector("#prev-photo");
      var nextButton = this.querySelector("#next-photo");
      if (prevButton && this._prevPhotoHandler) {
        prevButton.removeEventListener("click", this._prevPhotoHandler);
        this._prevPhotoHandler = null;
      }
      if (nextButton && this._nextPhotoHandler) {
        nextButton.removeEventListener("click", this._nextPhotoHandler);
        this._nextPhotoHandler = null;
      }
      var thumbPrevButton = this.querySelector("#thumb-prev");
      var thumbNextButton = this.querySelector("#thumb-next");
      if (thumbPrevButton && this._thumbPrevHandler) {
        thumbPrevButton.removeEventListener("click", this._thumbPrevHandler);
        this._thumbPrevHandler = null;
      }
      if (thumbNextButton && this._thumbNextHandler) {
        thumbNextButton.removeEventListener("click", this._thumbNextHandler);
        this._thumbNextHandler = null;
      }
      var thumbnails = this.querySelectorAll(".thumbnail-item");
      thumbnails.forEach(function (thumb) {
        if (thumb._clickHandler) {
          thumb.removeEventListener("click", thumb._clickHandler);
          thumb._clickHandler = null;
        }
      });
      var userRecPrev = this.querySelector("#user-rec-prev");
      var userRecNext = this.querySelector("#user-rec-next");
      if (userRecPrev && this._userRecPrevHandler) {
        userRecPrev.removeEventListener("click", this._userRecPrevHandler);
        this._userRecPrevHandler = null;
      }
      if (userRecNext && this._userRecNextHandler) {
        userRecNext.removeEventListener("click", this._userRecNextHandler);
        this._userRecNextHandler = null;
      }
      var itemRecPrev = this.querySelector("#item-rec-prev");
      var itemRecNext = this.querySelector("#item-rec-next");
      if (itemRecPrev && this._itemRecPrevHandler) {
        itemRecPrev.removeEventListener("click", this._itemRecPrevHandler);
        this._itemRecPrevHandler = null;
      }
      if (itemRecNext && this._itemRecNextHandler) {
        itemRecNext.removeEventListener("click", this._itemRecNextHandler);
        this._itemRecNextHandler = null;
      }
      var recommendationsContainer = this.querySelector("#item-recommendations-container");
      if (recommendationsContainer && this._recommendationClickHandler) {
        recommendationsContainer.removeEventListener("click", this._recommendationClickHandler);
        this._recommendationClickHandler = null;
      }
    }
  }, {
    key: "handleReviewSubmit",
    value: function () {
      var _handleReviewSubmit = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee3(event) {
        var currentUser, form, commentTextarea, comment, submitButton, response, errorMessage;
        return detail_product_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              event.preventDefault();
              currentUser = utils.getUserInfo();
              if (!(!currentUser || !this._item || !this._item.id)) {
                _context3.next = 5;
                break;
              }
              alert("Anda harus login dan item harus valid untuk mengirim review.");
              return _context3.abrupt("return");
            case 5:
              form = event.target;
              commentTextarea = form.querySelector("#review-comment");
              comment = commentTextarea ? commentTextarea.value.trim() : "";
              if (comment) {
                _context3.next = 11;
                break;
              }
              alert("Komentar review tidak boleh kosong.");
              return _context3.abrupt("return");
            case 11:
              submitButton = form.querySelector('button[type="submit"]');
              if (submitButton) submitButton.disabled = true;
              _context3.prev = 13;
              _context3.next = 16;
              return authenticatedRequest("/reviews/item/".concat(this._item.id), "POST", {
                comment: comment
              });
            case 16:
              response = _context3.sent;
              if (!(response.status === "success")) {
                _context3.next = 25;
                break;
              }
              alert("Review berhasil dikirim!");
              if (commentTextarea) commentTextarea.value = "";
              this._shouldShowReviewForm = false;
              _context3.next = 23;
              return this.fetchItemAndReviews(this._item.id);
            case 23:
              _context3.next = 28;
              break;
            case 25:
              errorMessage = response.message || "Gagal mengirim review baru.";
              if (response.errors && Array.isArray(response.errors)) {
                errorMessage += "\nValidasi error:";
                response.errors.forEach(function (err) {
                  if (err.param && err.msg) {
                    errorMessage += "\n- ".concat(err.param, ": ").concat(err.msg);
                  } else if (typeof err === "string") {
                    errorMessage += "\n- ".concat(err);
                  }
                });
              }
              alert(errorMessage);
            case 28:
              _context3.next = 33;
              break;
            case 30:
              _context3.prev = 30;
              _context3.t0 = _context3["catch"](13);
              alert("Terjadi kesalahan saat mengirim review baru.");
            case 33:
              _context3.prev = 33;
              if (submitButton && this._shouldShowReviewForm) submitButton.disabled = false;
              return _context3.finish(33);
            case 36:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[13, 30, 33, 36]]);
      }));
      function handleReviewSubmit(_x2) {
        return _handleReviewSubmit.apply(this, arguments);
      }
      return handleReviewSubmit;
    }()
  }, {
    key: "handleEditReview",
    value: function handleEditReview(reviewId) {
      var _this9 = this;
      if (this._editingReviewId === Number.parseInt(reviewId, 10)) {
        return;
      }
      if (this._editingReviewId !== null) {
        this.cancelEditReview();
      }
      var reviewToEdit = this._reviews.find(function (review) {
        return review.id === Number.parseInt(reviewId, 10);
      });
      if (!reviewToEdit) {
        alert("Review tidak ditemukan.");
        return;
      }
      this._editingReviewId = reviewToEdit.id;
      this.renderContent();
      requestAnimationFrame(function () {
        var editForm = _this9.querySelector(".edit-review-form[data-review-id=\"".concat(reviewId, "\"]"));
        if (editForm) {
          editForm.scrollIntoView({
            behavior: "smooth",
            block: "center"
          });
        }
      });
    }
  }, {
    key: "cancelEditReview",
    value: function cancelEditReview() {
      if (this._editingReviewId !== null) {
        this._editingReviewId = null;
        this.renderContent();
      }
    }
  }, {
    key: "handleEditSubmit",
    value: function () {
      var _handleEditSubmit = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee4(event, reviewId) {
        var currentUser, form, commentTextarea, comment, _saveButton, _cancelButton, saveButton, cancelButton, response, errorMessage;
        return detail_product_regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              event.preventDefault();
              currentUser = utils.getUserInfo();
              if (!(!currentUser || !this._item || !this._item.id || !reviewId)) {
                _context4.next = 5;
                break;
              }
              alert("Informasi tidak lengkap untuk memperbarui review.");
              return _context4.abrupt("return");
            case 5:
              form = event.target.closest(".edit-review-form");
              if (form) {
                _context4.next = 9;
                break;
              }
              alert("Form edit tidak ditemukan.");
              return _context4.abrupt("return");
            case 9:
              commentTextarea = form.querySelector("#edit-review-comment-".concat(reviewId));
              comment = commentTextarea ? commentTextarea.value.trim() : "";
              if (comment) {
                _context4.next = 18;
                break;
              }
              alert("Komentar review tidak boleh kosong.");
              _saveButton = form.querySelector(".save-edit-button");
              if (_saveButton) _saveButton.disabled = false;
              _cancelButton = form.querySelector(".cancel-edit-button");
              if (_cancelButton) _cancelButton.disabled = false;
              return _context4.abrupt("return");
            case 18:
              saveButton = form.querySelector(".save-edit-button");
              if (saveButton) saveButton.disabled = true;
              cancelButton = form.querySelector(".cancel-edit-button");
              if (cancelButton) cancelButton.disabled = true;
              _context4.prev = 22;
              _context4.next = 25;
              return authenticatedRequest("/reviews/".concat(reviewId), "PATCH", {
                comment: comment
              });
            case 25:
              response = _context4.sent;
              if (!(response.status === "success")) {
                _context4.next = 33;
                break;
              }
              alert("Review berhasil diperbarui!");
              this._editingReviewId = null;
              _context4.next = 31;
              return this.fetchItemAndReviews(this._item.id);
            case 31:
              _context4.next = 36;
              break;
            case 33:
              errorMessage = response.message || "Gagal memperbarui review.";
              if (response.errors && Array.isArray(response.errors)) {
                errorMessage += "\nValidasi error:";
                response.errors.forEach(function (err) {
                  if (err.param && err.msg) {
                    errorMessage += "\n- ".concat(err.param, ": ").concat(err.msg);
                  } else if (typeof err === "string") {
                    errorMessage += "\n- ".concat(err);
                  }
                });
              }
              alert(errorMessage);
            case 36:
              _context4.next = 41;
              break;
            case 38:
              _context4.prev = 38;
              _context4.t0 = _context4["catch"](22);
              alert("Terjadi kesalahan saat memperbarui review.");
            case 41:
              _context4.prev = 41;
              if (this._editingReviewId === reviewId) {
                if (saveButton) saveButton.disabled = false;
                if (cancelButton) cancelButton.disabled = false;
              }
              return _context4.finish(41);
            case 44:
            case "end":
              return _context4.stop();
          }
        }, _callee4, this, [[22, 38, 41, 44]]);
      }));
      function handleEditSubmit(_x3, _x4) {
        return _handleEditSubmit.apply(this, arguments);
      }
      return handleEditSubmit;
    }()
  }, {
    key: "handleDeleteReview",
    value: function () {
      var _handleDeleteReview = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee5(reviewId) {
        var confirmDelete, response;
        return detail_product_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              confirmDelete = confirm("Apakah Anda yakin ingin menghapus review ini?");
              if (confirmDelete) {
                _context5.next = 3;
                break;
              }
              return _context5.abrupt("return");
            case 3:
              _context5.prev = 3;
              _context5.next = 6;
              return authenticatedRequest("/reviews/".concat(reviewId), "DELETE");
            case 6:
              response = _context5.sent;
              if (!(response.status === "success")) {
                _context5.next = 13;
                break;
              }
              alert("Review berhasil dihapus!");
              _context5.next = 11;
              return this.fetchItemAndReviews(this._item.id);
            case 11:
              _context5.next = 14;
              break;
            case 13:
              alert("Gagal menghapus review: " + (response.message || "Terjadi kesalahan."));
            case 14:
              _context5.next = 19;
              break;
            case 16:
              _context5.prev = 16;
              _context5.t0 = _context5["catch"](3);
              alert("Terjadi kesalahan saat menghapus review.");
            case 19:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this, [[3, 16]]);
      }));
      function handleDeleteReview(_x5) {
        return _handleDeleteReview.apply(this, arguments);
      }
      return handleDeleteReview;
    }()
  }, {
    key: "handleBuy",
    value: function () {
      var _handleBuy = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee6() {
        var currentUser, result, response;
        return detail_product_regeneratorRuntime().wrap(function _callee6$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              currentUser = utils.getUserInfo();
              if (!(!currentUser || !this._item || !this._item.id)) {
                _context6.next = 4;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Login Diperlukan',
                text: 'Anda harus login untuk melakukan pembelian.',
                confirmButtonColor: '#4f46e5'
              });
              return _context6.abrupt("return");
            case 4:
              _context6.next = 6;
              return sweetalert2_all_default().fire({
                title: 'Konfirmasi Pembelian',
                html: "Apakah Anda yakin ingin membeli<br><strong>\"".concat(this._item.name, "\"</strong><br>dengan harga <strong>").concat(this.formatRupiah(this._item.price_sell), "</strong>?"),
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#10b981',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Beli Sekarang!',
                cancelButtonText: 'Batal'
              });
            case 6:
              result = _context6.sent;
              if (result.isConfirmed) {
                _context6.next = 9;
                break;
              }
              return _context6.abrupt("return");
            case 9:
              _context6.prev = 9;
              _context6.next = 12;
              return authenticatedRequest("/transactions", "POST", {
                item_id: this._item.id,
                type: "buy"
              });
            case 12:
              response = _context6.sent;
              if (!(response.status === "success" && response.data)) {
                _context6.next = 19;
                break;
              }
              _context6.next = 16;
              return sweetalert2_all_default().fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Transaksi pembelian berhasil dibuat!',
                confirmButtonColor: '#4f46e5'
              });
            case 16:
              window.location.hash = "#/transactions/".concat(response.data.id);
              _context6.next = 20;
              break;
            case 19:
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal!',
                text: "Gagal membuat transaksi pembelian: " + (response.message || "Terjadi kesalahan."),
                confirmButtonColor: '#4f46e5'
              });
            case 20:
              _context6.next = 25;
              break;
            case 22:
              _context6.prev = 22;
              _context6.t0 = _context6["catch"](9);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Error!',
                text: 'Terjadi kesalahan saat membuat transaksi pembelian.',
                confirmButtonColor: '#4f46e5'
              });
            case 25:
            case "end":
              return _context6.stop();
          }
        }, _callee6, this, [[9, 22]]);
      }));
      function handleBuy() {
        return _handleBuy.apply(this, arguments);
      }
      return handleBuy;
    }()
  }, {
    key: "handleRent",
    value: function () {
      var _handleRent = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee7() {
        var statusInfo;
        return detail_product_regeneratorRuntime().wrap(function _callee7$(_context7) {
          while (1) switch (_context7.prev = _context7.next) {
            case 0:
              if (!(!this._item || !utils.isAuthenticated())) {
                _context7.next = 3;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Login Diperlukan',
                text: 'Item tidak tersedia atau Anda harus login.',
                confirmButtonColor: '#4f46e5'
              });
              return _context7.abrupt("return");
            case 3:
              statusInfo = this.getStatusInfo(this._item);
              if (statusInfo.canTransact) {
                _context7.next = 7;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Tidak Tersedia',
                text: 'Item ini tidak tersedia untuk disewa.',
                confirmButtonColor: '#4f46e5'
              });
              return _context7.abrupt("return");
            case 7:
              this._showRentForm = true;
              this.renderContent();
            case 9:
            case "end":
              return _context7.stop();
          }
        }, _callee7, this);
      }));
      function handleRent() {
        return _handleRent.apply(this, arguments);
      }
      return handleRent;
    }()
  }, {
    key: "handleRentFormSubmit",
    value: function () {
      var _handleRentFormSubmit = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee8(event) {
        var form, startDateInput, endDateInput, startDate, endDate, start, end, today, currentUser, diffTime, diffDays, totalRentCost, totalCost, result, submitButton, cancelButton, response;
        return detail_product_regeneratorRuntime().wrap(function _callee8$(_context8) {
          while (1) switch (_context8.prev = _context8.next) {
            case 0:
              event.preventDefault();
              form = event.target;
              startDateInput = form.querySelector("#rent-start-date");
              endDateInput = form.querySelector("#rent-end-date");
              startDate = startDateInput ? startDateInput.value : null;
              endDate = endDateInput ? endDateInput.value : null;
              if (!(!startDate || !endDate)) {
                _context8.next = 9;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Data Tidak Lengkap',
                text: 'Tanggal mulai dan selesai sewa harus diisi.',
                confirmButtonColor: '#4f46e5'
              });
              return _context8.abrupt("return");
            case 9:
              start = new Date(startDate);
              end = new Date(endDate);
              today = new Date();
              today.setHours(0, 0, 0, 0);
              if (!(isNaN(start.getTime()) || isNaN(end.getTime()))) {
                _context8.next = 16;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Format Salah',
                text: 'Format tanggal tidak valid.',
                confirmButtonColor: '#4f46e5'
              });
              return _context8.abrupt("return");
            case 16:
              if (!(start < today || end < today)) {
                _context8.next = 19;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Tanggal Tidak Valid',
                text: 'Tanggal sewa tidak boleh di masa lalu.',
                confirmButtonColor: '#4f46e5'
              });
              return _context8.abrupt("return");
            case 19:
              if (!(start >= end)) {
                _context8.next = 22;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Tanggal Tidak Valid',
                text: 'Tanggal selesai sewa harus setelah tanggal mulai sewa.',
                confirmButtonColor: '#4f46e5'
              });
              return _context8.abrupt("return");
            case 22:
              currentUser = utils.getUserInfo();
              if (!(!currentUser || !this._item || !this._item.id)) {
                _context8.next = 26;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Login Diperlukan',
                text: 'Anda harus login dan item harus valid untuk mengajukan penyewaan.',
                confirmButtonColor: '#4f46e5'
              });
              return _context8.abrupt("return");
            case 26:
              // Calculate rental duration and total cost
              diffTime = Math.abs(end - start);
              diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
              totalRentCost = diffDays * this._item.price_rent;
              totalCost = totalRentCost + this._item.deposit_amount;
              _context8.next = 32;
              return sweetalert2_all_default().fire({
                title: 'Konfirmasi Penyewaan',
                html: "\n      <div class=\"text-left\">\n        <p><strong>Item:</strong> ".concat(this._item.name, "</p>\n        <p><strong>Durasi:</strong> ").concat(diffDays, " hari</p>\n        <p><strong>Biaya Sewa:</strong> ").concat(this.formatRupiah(totalRentCost), "</p>\n        <p><strong>Deposit:</strong> ").concat(this.formatRupiah(this._item.deposit_amount), "</p>\n        <hr class=\"my-2\">\n        <p><strong>Total Bayar:</strong> ").concat(this.formatRupiah(totalCost), "</p>\n      </div>\n    "),
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Ajukan Sewa!',
                cancelButtonText: 'Batal'
              });
            case 32:
              result = _context8.sent;
              if (result.isConfirmed) {
                _context8.next = 35;
                break;
              }
              return _context8.abrupt("return");
            case 35:
              submitButton = form.querySelector('button[type="submit"]');
              if (submitButton) submitButton.disabled = true;
              cancelButton = form.querySelector("#cancel-rent-button");
              if (cancelButton) cancelButton.disabled = true;
              _context8.prev = 39;
              _context8.next = 42;
              return authenticatedRequest("/transactions", "POST", {
                item_id: this._item.id,
                type: "rent",
                rent_start_date: startDate,
                rent_end_date: endDate
              });
            case 42:
              response = _context8.sent;
              if (!(response.status === "success" && response.data)) {
                _context8.next = 50;
                break;
              }
              _context8.next = 46;
              return sweetalert2_all_default().fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Transaksi penyewaan berhasil dibuat!',
                confirmButtonColor: '#4f46e5'
              });
            case 46:
              this._showRentForm = false;
              window.location.hash = "#/transactions/".concat(response.data.id);
              _context8.next = 51;
              break;
            case 50:
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal!',
                text: "Gagal membuat transaksi penyewaan: " + (response.message || "Terjadi kesalahan."),
                confirmButtonColor: '#4f46e5'
              });
            case 51:
              _context8.next = 56;
              break;
            case 53:
              _context8.prev = 53;
              _context8.t0 = _context8["catch"](39);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Error!',
                text: 'Terjadi kesalahan saat membuat transaksi penyewaan.',
                confirmButtonColor: '#4f46e5'
              });
            case 56:
              _context8.prev = 56;
              this._showRentForm = false;
              this.renderContent();
              return _context8.finish(56);
            case 60:
            case "end":
              return _context8.stop();
          }
        }, _callee8, this, [[39, 53, 56, 60]]);
      }));
      function handleRentFormSubmit(_x6) {
        return _handleRentFormSubmit.apply(this, arguments);
      }
      return handleRentFormSubmit;
    }()
  }, {
    key: "cancelRentForm",
    value: function cancelRentForm() {
      this._showRentForm = false;
      this.renderContent();
    }
  }, {
    key: "fetchItemBasedRecommendationsForCurrentItem",
    value: function () {
      var _fetchItemBasedRecommendationsForCurrentItem = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee10(basedOnItemId) {
        var _this10 = this;
        var topN, mlResult, recommendationPromises, results;
        return detail_product_regeneratorRuntime().wrap(function _callee10$(_context10) {
          while (1) switch (_context10.prev = _context10.next) {
            case 0:
              if (basedOnItemId) {
                _context10.next = 6;
                break;
              }
              this.itemBasedRecommendations = [];
              this.isLoadingItemBasedRecommendations = false;
              this.itemBasedRecommendationsError = null;
              this.renderContent();
              return _context10.abrupt("return");
            case 6:
              this.isLoadingItemBasedRecommendations = true;
              this.itemBasedRecommendationsError = null;
              this.renderContent();
              topN = 8; // Changed from 5 to 8
              _context10.prev = 10;
              _context10.next = 13;
              return fetchItemRecommendations(basedOnItemId, topN);
            case 13:
              mlResult = _context10.sent;
              if (!(mlResult && Array.isArray(mlResult.recommendations) && mlResult.recommendations.length > 0)) {
                _context10.next = 24;
                break;
              }
              recommendationPromises = mlResult.recommendations.map(/*#__PURE__*/function () {
                var _ref = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee9(rec) {
                  var itemDetailResponse;
                  return detail_product_regeneratorRuntime().wrap(function _callee9$(_context9) {
                    while (1) switch (_context9.prev = _context9.next) {
                      case 0:
                        _context9.prev = 0;
                        _context9.next = 3;
                        return apiGet("/items/".concat(rec.product_id));
                      case 3:
                        itemDetailResponse = _context9.sent;
                        if (!(itemDetailResponse.status === "success" && itemDetailResponse.data)) {
                          _context9.next = 8;
                          break;
                        }
                        return _context9.abrupt("return", detail_product_objectSpread(detail_product_objectSpread({}, rec), itemDetailResponse.data));
                      case 8:
                        return _context9.abrupt("return", null);
                      case 9:
                        _context9.next = 14;
                        break;
                      case 11:
                        _context9.prev = 11;
                        _context9.t0 = _context9["catch"](0);
                        return _context9.abrupt("return", null);
                      case 14:
                      case "end":
                        return _context9.stop();
                    }
                  }, _callee9, null, [[0, 11]]);
                }));
                return function (_x8) {
                  return _ref.apply(this, arguments);
                };
              }());
              _context10.next = 18;
              return Promise.all(recommendationPromises);
            case 18:
              results = _context10.sent;
              this.itemBasedRecommendations = results.filter(function (item) {
                return item !== null && item.id !== _this10._item.id;
              });
              this.isLoadingItemBasedRecommendations = false;
              if (mlResult.recommendations.length > 0 && this.itemBasedRecommendations.length === 0) {
                if (mlResult.recommendations.length > 0) {
                  this.itemBasedRecommendationsError = "Tidak ada rekomendasi serupa yang ditemukan atau detail gagal dimuat.";
                } else {
                  this.itemBasedRecommendationsError = "Tidak ada rekomendasi serupa yang ditemukan dari ML API.";
                }
              } else {
                this.itemBasedRecommendationsError = null;
              }
              _context10.next = 27;
              break;
            case 24:
              this.itemBasedRecommendations = [];
              this.isLoadingItemBasedRecommendations = false;
              this.itemBasedRecommendationsError = mlResult.message || "Tidak ada rekomendasi serupa yang ditemukan dari ML API.";
            case 27:
              _context10.next = 34;
              break;
            case 29:
              _context10.prev = 29;
              _context10.t0 = _context10["catch"](10);
              this.itemBasedRecommendations = [];
              this.isLoadingItemBasedRecommendations = false;
              this.itemBasedRecommendationsError = _context10.t0.message || "Terjadi kesalahan saat memuat rekomendasi serupa.";
            case 34:
              _context10.prev = 34;
              this.renderContent();
              return _context10.finish(34);
            case 37:
            case "end":
              return _context10.stop();
          }
        }, _callee10, this, [[10, 29, 34, 37]]);
      }));
      function fetchItemBasedRecommendationsForCurrentItem(_x7) {
        return _fetchItemBasedRecommendationsForCurrentItem.apply(this, arguments);
      }
      return fetchItemBasedRecommendationsForCurrentItem;
    }()
  }, {
    key: "triggerMLRefresh",
    value: function () {
      var _triggerMLRefresh = detail_product_asyncToGenerator(/*#__PURE__*/detail_product_regeneratorRuntime().mark(function _callee11(itemId) {
        return detail_product_regeneratorRuntime().wrap(function _callee11$(_context11) {
          while (1) switch (_context11.prev = _context11.next) {
            case 0:
              _context11.prev = 0;
              _context11.next = 3;
              return fetch("https://exml.pinjemin.site/api/refresh_data", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({})
              });
            case 3:
              _context11.next = 8;
              break;
            case 5:
              _context11.prev = 5;
              _context11.t0 = _context11["catch"](0);
              console.warn("Failed to trigger ML backend data refresh:", _context11.t0);
            case 8:
            case "end":
              return _context11.stop();
          }
        }, _callee11, null, [[0, 5]]);
      }));
      function triggerMLRefresh(_x9) {
        return _triggerMLRefresh.apply(this, arguments);
      }
      return triggerMLRefresh;
    }()
  }], [{
    key: "observedAttributes",
    get: function get() {
      return ["item-id"];
    }
  }]);
}(/*#__PURE__*/detail_product_wrapNativeSuper(HTMLElement));
customElements.define("detail-product", DetailProduct);
// EXTERNAL MODULE: ./user/src/script/components/search-bar.js
var search_bar = __webpack_require__(109);
// EXTERNAL MODULE: ./user/src/script/components/auth/login/login-page.js
var login_page = __webpack_require__(407);
// EXTERNAL MODULE: ./user/src/script/components/auth/register/register-page.js
var register_page = __webpack_require__(115);
;// ./user/src/script/components/user/profile-page.js
function profile_page_typeof(o) { "@babel/helpers - typeof"; return profile_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, profile_page_typeof(o); }
function profile_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ profile_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == profile_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(profile_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function profile_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function profile_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { profile_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { profile_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function profile_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function profile_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, profile_page_toPropertyKey(o.key), o); } }
function profile_page_createClass(e, r, t) { return r && profile_page_defineProperties(e.prototype, r), t && profile_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function profile_page_toPropertyKey(t) { var i = profile_page_toPrimitive(t, "string"); return "symbol" == profile_page_typeof(i) ? i : i + ""; }
function profile_page_toPrimitive(t, r) { if ("object" != profile_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != profile_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function profile_page_callSuper(t, o, e) { return o = profile_page_getPrototypeOf(o), profile_page_possibleConstructorReturn(t, profile_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], profile_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function profile_page_possibleConstructorReturn(t, e) { if (e && ("object" == profile_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return profile_page_assertThisInitialized(t); }
function profile_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function profile_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && profile_page_setPrototypeOf(t, e); }
function profile_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return profile_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !profile_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return profile_page_construct(t, arguments, profile_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), profile_page_setPrototypeOf(Wrapper, t); }, profile_page_wrapNativeSuper(t); }
function profile_page_construct(t, e, r) { if (profile_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && profile_page_setPrototypeOf(p, r.prototype), p; }
function profile_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (profile_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function profile_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function profile_page_setPrototypeOf(t, e) { return profile_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, profile_page_setPrototypeOf(t, e); }
function profile_page_getPrototypeOf(t) { return profile_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, profile_page_getPrototypeOf(t); }

var ProfilePage = /*#__PURE__*/function (_HTMLElement) {
  function ProfilePage() {
    var _this;
    profile_page_classCallCheck(this, ProfilePage);
    _this = profile_page_callSuper(this, ProfilePage);
    // Bind methods
    _this.fetchUserProfile = _this.fetchUserProfile.bind(_this);
    _this.handleUpdateProfile = _this.handleUpdateProfile.bind(_this);
    _this.handleUpdatePassword = _this.handleUpdatePassword.bind(_this);

    // State internal komponen
    _this.user = null;
    return _this;
  }
  profile_page_inherits(ProfilePage, _HTMLElement);
  return profile_page_createClass(ProfilePage, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
      this.setupEventListeners();
      this.fetchUserProfile();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      this.removeEventListeners();
    }
  }, {
    key: "render",
    value: function render() {
      this.innerHTML = "\n            <div class=\"container mx-auto px-4 py-8 font-opensan\">\n                <h2 class=\"text-3xl font-montserrat font-bold mb-8 text-gray-800\">Profil Pengguna</h2>\n\n                <!-- Main Card Container -->\n                <div class=\"bg-white p-8 rounded-2xl shadow-xl mb-8 border border-gray-100\">\n                    <!-- Informasi Akun Container (Gradient) -->\n                    <div class=\"bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 text-white p-6 rounded-xl shadow-lg mb-8\">\n                        <h3 class=\"text-2xl font-montserrat font-bold mb-4 flex items-center\">\n                            <svg class=\"w-6 h-6 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                            </svg>\n                            Informasi Akun\n                        </h3>\n                        <div id=\"profile-info\" class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div class=\"bg-white/10 backdrop-blur-sm rounded-lg p-4\">\n                                <p class=\"text-sm opacity-80 mb-1\">Nama</p>\n                                <p class=\"font-semibold text-lg\" id=\"user-name\">Loading...</p>\n                            </div>\n                            <div class=\"bg-white/10 backdrop-blur-sm rounded-lg p-4\">\n                                <p class=\"text-sm opacity-80 mb-1\">Email</p>\n                                <p class=\"font-semibold text-lg\" id=\"user-email\">Loading...</p>\n                            </div>\n                            <div class=\"bg-white/10 backdrop-blur-sm rounded-lg p-4\">\n                                <p class=\"text-sm opacity-80 mb-1\">Provinsi</p>\n                                <p class=\"font-semibold text-lg\" id=\"user-province\">Loading...</p>\n                            </div>\n                            <div class=\"bg-white/10 backdrop-blur-sm rounded-lg p-4\">\n                                <p class=\"text-sm opacity-80 mb-1\">Kota</p>\n                                <p class=\"font-semibold text-lg\" id=\"user-city\">Loading...</p>\n                            </div>\n                            <div class=\"bg-white/10 backdrop-blur-sm rounded-lg p-4 md:col-span-2\">\n                                <p class=\"text-sm opacity-80 mb-1\">Hobby</p>\n                                <p class=\"font-semibold text-lg\" id=\"user-hobby\">Loading...</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Perbarui Profil Section -->\n                    <div>\n                        <h3 class=\"text-2xl font-montserrat font-bold mb-6 text-gray-800 flex items-center\">\n                            <svg class=\"w-6 h-6 mr-3 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n                            </svg>\n                            Perbarui Profil\n                        </h3>\n                        <form id=\"update-profile-form\" class=\"space-y-6\">\n                            <div>\n                                <label for=\"update-name\" class=\"block mb-2 text-sm font-semibold text-gray-700\">Nama Lengkap</label>\n                                <input type=\"text\" id=\"update-name\" name=\"name\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full p-3 transition-all duration-200\" placeholder=\"Masukkan nama lengkap\" />\n                            </div>\n\n                            <div>\n                          <label for=\"update-hobby\" class=\"block text-sm font-medium text-gray-700 mb-1\">Hobby</label>\n                          <select \n                              id=\"update-hobby\" \n                              name=\"hobby\" \n                              required \n                              class=\"w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white\"\n                          >\n                              <option value=\"\">Select Hobby</option>\n                              <option value=\"MASAK\">Masak</option>\n                              <option value=\"MEMBACA\">Membaca</option>\n                              <option value=\"FOTOGRAFI\">Fotografi</option>\n                          </select>\n                        </div>\n                            \n                            <!-- Tooltip Container -->\n                            <div class=\"tooltip-container relative\">\n                                <div>\n                                    <label for=\"update-province\" class=\"block mb-2 text-sm font-semibold text-gray-700\">Provinsi</label>\n                                    <div class=\"relative\">\n                                        <input type=\"text\" id=\"update-province\" name=\"province_name\" readonly class=\"bg-gray-100 border border-gray-300 text-gray-500 text-sm rounded-xl block w-full p-3 cursor-not-allowed opacity-60\" placeholder=\"Provinsi tidak dapat diubah\" />\n                                        <div class=\"absolute inset-0 cursor-help\" title=\"Anda tidak dapat mengedit provinsi sesuai dengan kebijakan kami demi keamanan\"></div>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"mt-4\">\n                                    <label for=\"update-city\" class=\"block mb-2 text-sm font-semibold text-gray-700\">Kota/Kabupaten</label>\n                                    <div class=\"relative\">\n                                        <input type=\"text\" id=\"update-city\" name=\"city_name\" readonly class=\"bg-gray-100 border border-gray-300 text-gray-500 text-sm rounded-xl block w-full p-3 cursor-not-allowed opacity-60\" placeholder=\"Kota tidak dapat diubah\" />\n                                        <div class=\"absolute inset-0 cursor-help\" title=\"Anda tidak dapat mengedit kota sesuai dengan kebijakan kami demi keamanan\"></div>\n                                    </div>\n                                </div>\n                                \n                                <!-- Tooltip -->\n                                <div class=\"tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 invisible transition-all duration-200 whitespace-nowrap z-10\">\n                                    Anda tidak dapat mengedit provinsi atau kota sesuai dengan kebijakan kami demi keamanan\n                                    <div class=\"tooltip-arrow absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800\"></div>\n                                </div>\n                            </div>\n\n                            <button type=\"submit\" class=\"w-full flex justify-center py-3 px-6 border border-transparent shadow-lg text-sm font-bold rounded-xl text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform hover:scale-105\">\n                                <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"></path>\n                                </svg>\n                                Perbarui Profil\n                            </button>\n                        </form>\n                    </div>\n                </div>\n\n                <!-- Password Card Container -->\n                <div class=\"bg-white p-8 rounded-2xl shadow-xl border border-gray-100\">\n                    <div>\n                        <h3 class=\"text-2xl font-montserrat font-bold mb-6 text-gray-800 flex items-center\">\n                            <svg class=\"w-6 h-6 mr-3 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n                            </svg>\n                            Ubah Kata Sandi\n                        </h3>\n                        <form id=\"update-password-form\" class=\"space-y-6\">\n                            <div>\n                                <label for=\"current-password\" class=\"block mb-2 text-sm font-semibold text-gray-700\">Kata Sandi Saat Ini</label>\n                                <input type=\"password\" id=\"current-password\" name=\"currentPassword\" required class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 block w-full p-3 transition-all duration-200\" placeholder=\"Masukkan kata sandi saat ini\">\n                            </div>\n                            <div>\n                                <label for=\"new-password\" class=\"block mb-2 text-sm font-semibold text-gray-700\">Kata Sandi Baru</label>\n                                <input type=\"password\" id=\"new-password\" name=\"newPassword\" required class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 block w-full p-3 transition-all duration-200\" placeholder=\"Masukkan kata sandi baru\">\n                            </div>\n                            <button type=\"submit\" class=\"w-full flex justify-center py-3 px-6 border border-transparent shadow-lg text-sm font-bold rounded-xl text-white bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 transform hover:scale-105\">\n                                <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n                                </svg>\n                                Ubah Kata Sandi\n                            </button>\n                        </form>\n                    </div>\n                </div>\n\n                <!-- Success Modal -->\n                <div id=\"success-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden\">\n                    <div class=\"bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl\">\n                        <div class=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                            <svg class=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                            </svg>\n                        </div>\n                        <h3 class=\"text-xl font-bold text-gray-800 mb-2\">Password Berhasil Diubah!</h3>\n                        <p class=\"text-gray-600 mb-6\">Password Anda telah berhasil diganti. Silakan login ulang untuk keamanan.</p>\n                        <button id=\"login-redirect-btn\" class=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold py-3 px-6 rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-200\">\n                            Login Ulang\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <style>\n                .tooltip-container:hover .tooltip {\n                    opacity: 1;\n                    visibility: visible;\n                }\n                \n                .tooltip-arrow {\n                    filter: drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.1));\n                }\n                \n                /* Custom scrollbar */\n                ::-webkit-scrollbar {\n                    width: 8px;\n                }\n                \n                ::-webkit-scrollbar-track {\n                    background: #f1f1f1;\n                    border-radius: 4px;\n                }\n                \n                ::-webkit-scrollbar-thumb {\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    border-radius: 4px;\n                }\n                \n                ::-webkit-scrollbar-thumb:hover {\n                    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);\n                }\n\n                /* Modal animation */\n                #success-modal.show {\n                    animation: fadeIn 0.3s ease-out;\n                }\n\n                @keyframes fadeIn {\n                    from {\n                        opacity: 0;\n                        transform: scale(0.9);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: scale(1);\n                    }\n                }\n            </style>\n        ";
    }
  }, {
    key: "fetchUserProfile",
    value: function () {
      var _fetchUserProfile = profile_page_asyncToGenerator(/*#__PURE__*/profile_page_regeneratorRuntime().mark(function _callee() {
        var result;
        return profile_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.prev = 0;
              _context.next = 3;
              return apiGet('/auth/me');
            case 3:
              result = _context.sent;
              if (result.status === 'success') {
                this.user = result.data.user;
                this.updateUIWithUserProfile();
              } else {
                console.error('Failed to fetch user profile:', result.message);
              }
              _context.next = 10;
              break;
            case 7:
              _context.prev = 7;
              _context.t0 = _context["catch"](0);
              console.error('Error fetching user profile:', _context.t0);
            case 10:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[0, 7]]);
      }));
      function fetchUserProfile() {
        return _fetchUserProfile.apply(this, arguments);
      }
      return fetchUserProfile;
    }()
  }, {
    key: "handleUpdateProfile",
    value: function () {
      var _handleUpdateProfile = profile_page_asyncToGenerator(/*#__PURE__*/profile_page_regeneratorRuntime().mark(function _callee2(event) {
        var form, formData, profileData, result, profileUpdatedEvent;
        return profile_page_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              event.preventDefault();
              form = event.target;
              formData = new FormData(form);
              profileData = Object.fromEntries(formData.entries()); // Remove province and city from update data since they're readonly
              delete profileData.province_name;
              delete profileData.city_name;
              _context2.prev = 6;
              _context2.next = 9;
              return apiPatch('/users/update-profile', profileData);
            case 9:
              result = _context2.sent;
              if (result.status === 'success') {
                alert('Profile berhasil diperbarui!');
                this.user = result.data.user;
                localStorage.setItem('user', JSON.stringify(this.user));
                this.updateUIWithUserProfile();
                profileUpdatedEvent = new CustomEvent('userProfileUpdated', {
                  detail: {
                    user: this.user
                  }
                });
                window.dispatchEvent(profileUpdatedEvent);
              } else {
                console.error('Failed to update profile:', result.message, result.errors);
                alert('Gagal memperbarui profil: ' + result.message + (result.errors ? '\n' + result.errors.map(function (e) {
                  return e.msg;
                }).join('\n') : ''));
              }
              _context2.next = 17;
              break;
            case 13:
              _context2.prev = 13;
              _context2.t0 = _context2["catch"](6);
              console.error('Error updating profile:', _context2.t0);
              alert('Terjadi kesalahan saat memperbarui profil.');
            case 17:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[6, 13]]);
      }));
      function handleUpdateProfile(_x) {
        return _handleUpdateProfile.apply(this, arguments);
      }
      return handleUpdateProfile;
    }()
  }, {
    key: "handleUpdatePassword",
    value: function () {
      var _handleUpdatePassword = profile_page_asyncToGenerator(/*#__PURE__*/profile_page_regeneratorRuntime().mark(function _callee3(event) {
        var form, formData, passwordData, result;
        return profile_page_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              event.preventDefault();
              form = event.target;
              formData = new FormData(form);
              passwordData = Object.fromEntries(formData.entries());
              _context3.prev = 4;
              _context3.next = 7;
              return apiPatch('/users/update-password', passwordData);
            case 7:
              result = _context3.sent;
              if (result.status === 'success') {
                // Show success modal
                this.showSuccessModal();
                form.reset(); // Clear the form
              } else {
                console.error('Failed to update password:', result.message);
                alert('Gagal mengubah kata sandi: ' + result.message);
              }
              _context3.next = 15;
              break;
            case 11:
              _context3.prev = 11;
              _context3.t0 = _context3["catch"](4);
              console.error('Error updating password:', _context3.t0);
              alert('Terjadi kesalahan saat mengubah kata sandi.');
            case 15:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[4, 11]]);
      }));
      function handleUpdatePassword(_x2) {
        return _handleUpdatePassword.apply(this, arguments);
      }
      return handleUpdatePassword;
    }()
  }, {
    key: "showSuccessModal",
    value: function showSuccessModal() {
      var modal = this.querySelector('#success-modal');
      var loginBtn = this.querySelector('#login-redirect-btn');
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('show');

        // Setup login redirect button
        if (loginBtn) {
          loginBtn.addEventListener('click', function () {
            // Clear auth data and redirect to login
            clearAuthData();
            window.location.href = '/#/login';
          });
        }
      }
    }
  }, {
    key: "updateUIWithUserProfile",
    value: function updateUIWithUserProfile() {
      if (this.user) {
        var userNameSpan = this.querySelector('#user-name');
        var userEmailSpan = this.querySelector('#user-email');
        var userProvinceSpan = this.querySelector('#user-province');
        var userCitySpan = this.querySelector('#user-city');
        var userHobbySpan = this.querySelector('#user-hobby');
        var updateNameInput = this.querySelector('#update-name');
        var updateHobbyInput = this.querySelector('#update-hobby');
        var updateProvinceInput = this.querySelector('#update-province');
        var updateCityInput = this.querySelector('#update-city');
        if (userNameSpan) userNameSpan.textContent = this.user.name;
        if (userEmailSpan) userEmailSpan.textContent = this.user.email;
        if (userProvinceSpan) userProvinceSpan.textContent = this.user.province_name || '-';
        if (userCitySpan) userCitySpan.textContent = this.user.city_name || '-';
        if (userHobbySpan) userHobbySpan.textContent = this.user.hobby || '-';
        if (updateNameInput) updateNameInput.value = this.user.name || '';
        if (updateHobbyInput) updateHobbyInput.value = this.user.hobby || '';
        if (updateProvinceInput) updateProvinceInput.value = this.user.province_name || '';
        if (updateCityInput) updateCityInput.value = this.user.city_name || '';
      } else {
        var profileInfoDiv = this.querySelector('#profile-info');
        if (profileInfoDiv) profileInfoDiv.innerHTML = '<p>Loading profile...</p>';
      }
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      var updateProfileForm = this.querySelector('#update-profile-form');
      if (updateProfileForm) {
        updateProfileForm.addEventListener('submit', this.handleUpdateProfile);
      }
      var updatePasswordForm = this.querySelector('#update-password-form');
      if (updatePasswordForm) {
        updatePasswordForm.addEventListener('submit', this.handleUpdatePassword);
      }
    }
  }, {
    key: "removeEventListeners",
    value: function removeEventListeners() {
      var updateProfileForm = this.querySelector('#update-profile-form');
      if (updateProfileForm) {
        updateProfileForm.removeEventListener('submit', this.handleUpdateProfile);
      }
      var updatePasswordForm = this.querySelector('#update-password-form');
      if (updatePasswordForm) {
        updatePasswordForm.removeEventListener('submit', this.handleUpdatePassword);
      }
    }
  }]);
}(/*#__PURE__*/profile_page_wrapNativeSuper(HTMLElement));
customElements.define('profile-page', ProfilePage);
;// ./user/src/script/components/SmallMap.js
function SmallMap_typeof(o) { "@babel/helpers - typeof"; return SmallMap_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, SmallMap_typeof(o); }
function SmallMap_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ SmallMap_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == SmallMap_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(SmallMap_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function SmallMap_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function SmallMap_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { SmallMap_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { SmallMap_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function SmallMap_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function SmallMap_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? SmallMap_ownKeys(Object(t), !0).forEach(function (r) { SmallMap_defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : SmallMap_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function SmallMap_defineProperty(e, r, t) { return (r = SmallMap_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function SmallMap_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function SmallMap_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, SmallMap_toPropertyKey(o.key), o); } }
function SmallMap_createClass(e, r, t) { return r && SmallMap_defineProperties(e.prototype, r), t && SmallMap_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function SmallMap_toPropertyKey(t) { var i = SmallMap_toPrimitive(t, "string"); return "symbol" == SmallMap_typeof(i) ? i : i + ""; }
function SmallMap_toPrimitive(t, r) { if ("object" != SmallMap_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != SmallMap_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
// Small map component for add/edit item forms


var SmallMap = /*#__PURE__*/function () {
  function SmallMap(containerId) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    SmallMap_classCallCheck(this, SmallMap);
    this.containerId = containerId;
    this.options = SmallMap_objectSpread({
      height: '300px',
      defaultZoom: 10
    }, options);
    this.map = null;
    this.marker = null;
    this.onLocationSelect = options.onLocationSelect || function () {};
    this.isInitialized = false;
    this.initializationPromise = null;
  }
  return SmallMap_createClass(SmallMap, [{
    key: "waitForContainer",
    value: function () {
      var _waitForContainer = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee() {
        var maxAttempts,
          attempts,
          container,
          _args = arguments;
        return SmallMap_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              maxAttempts = _args.length > 0 && _args[0] !== undefined ? _args[0] : 50;
              attempts = 0;
            case 2:
              if (!(attempts < maxAttempts)) {
                _context.next = 11;
                break;
              }
              container = document.getElementById(this.containerId);
              if (!(container && container.offsetParent !== null)) {
                _context.next = 6;
                break;
              }
              return _context.abrupt("return", container);
            case 6:
              _context.next = 8;
              return new Promise(function (resolve) {
                return setTimeout(resolve, 100);
              });
            case 8:
              attempts++;
              _context.next = 2;
              break;
            case 11:
              throw new Error("Container ".concat(this.containerId, " not found after ").concat(maxAttempts, " attempts"));
            case 12:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function waitForContainer() {
        return _waitForContainer.apply(this, arguments);
      }
      return waitForContainer;
    }()
  }, {
    key: "initializeMap",
    value: function () {
      var _initializeMap = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee2() {
        var provinceName,
          cityName,
          _args2 = arguments;
        return SmallMap_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              provinceName = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : null;
              cityName = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : null;
              if (!this.initializationPromise) {
                _context2.next = 4;
                break;
              }
              return _context2.abrupt("return", this.initializationPromise);
            case 4:
              this.initializationPromise = this._doInitializeMap(provinceName, cityName);
              return _context2.abrupt("return", this.initializationPromise);
            case 6:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this);
      }));
      function initializeMap() {
        return _initializeMap.apply(this, arguments);
      }
      return initializeMap;
    }()
  }, {
    key: "_doInitializeMap",
    value: function () {
      var _doInitializeMap2 = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee3() {
        var _this = this;
        var provinceName,
          cityName,
          container,
          center,
          zoom,
          coords,
          _args3 = arguments;
        return SmallMap_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              provinceName = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : null;
              cityName = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : null;
              _context3.prev = 2;
              if (!(typeof (leaflet_src_default()) === 'undefined')) {
                _context3.next = 5;
                break;
              }
              throw new Error('Leaflet is not loaded. Please include Leaflet CSS and JS files.');
            case 5:
              _context3.next = 7;
              return this.waitForContainer();
            case 7:
              container = _context3.sent;
              _context3.next = 10;
              return this.destroy();
            case 10:
              // Set container height
              container.style.height = this.options.height;
              container.style.width = '100%';

              // Clear any existing Leaflet data
              container._leaflet_id = null;

              // Default center (Indonesia)
              center = [-2.5489, 118.0149];
              zoom = 5; // Try to geocode the provided location
              if (!provinceName) {
                _context3.next = 26;
                break;
              }
              _context3.prev = 16;
              _context3.next = 19;
              return GeocodingUtils.geocodeLocation(provinceName, cityName);
            case 19:
              coords = _context3.sent;
              if (coords) {
                center = [coords.lat, coords.lng];
                zoom = cityName ? this.options.defaultZoom : 8;
              }
              _context3.next = 26;
              break;
            case 23:
              _context3.prev = 23;
              _context3.t0 = _context3["catch"](16);
              console.error('Error geocoding location:', _context3.t0);
            case 26:
              _context3.next = 28;
              return new Promise(function (resolve) {
                return setTimeout(resolve, 100);
              });
            case 28:
              this.map = leaflet_src_default().map(this.containerId, {
                attributionControl: false,
                zoomControl: true
              }).setView(center, zoom);

              // Add OpenStreetMap tiles
              leaflet_src_default().tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
              }).addTo(this.map);

              // Add click handler for location selection
              this.map.on('click', function (e) {
                _this.setMarker(e.latlng.lat, e.latlng.lng);
              });
              this.isInitialized = true;
              console.log("SmallMap initialized successfully for ".concat(this.containerId));

              // Force a resize after initialization
              setTimeout(function () {
                if (_this.map) {
                  _this.map.invalidateSize();
                }
              }, 200);
              return _context3.abrupt("return", true);
            case 37:
              _context3.prev = 37;
              _context3.t1 = _context3["catch"](2);
              console.error('Error initializing SmallMap:', _context3.t1);
              this.isInitialized = false;
              this.map = null;
              throw _context3.t1;
            case 43:
              _context3.prev = 43;
              this.initializationPromise = null;
              return _context3.finish(43);
            case 46:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[2, 37, 43, 46], [16, 23]]);
      }));
      function _doInitializeMap() {
        return _doInitializeMap2.apply(this, arguments);
      }
      return _doInitializeMap;
    }()
  }, {
    key: "setMarker",
    value: function setMarker(lat, lng) {
      if (!this.isMapReady()) {
        console.error('Cannot set marker: map is not ready');
        return;
      }

      // Remove existing marker
      if (this.marker) {
        this.map.removeLayer(this.marker);
      }

      // Add new marker
      this.marker = leaflet_src_default().marker([lat, lng]).addTo(this.map);

      // Trigger callback
      this.onLocationSelect(lat, lng);
    }
  }, {
    key: "getCurrentLocation",
    value: function () {
      var _getCurrentLocation = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee4() {
        var position, address;
        return SmallMap_regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              if (this.isMapReady()) {
                _context4.next = 2;
                break;
              }
              throw new Error('Map is not ready. Please wait for initialization to complete.');
            case 2:
              _context4.prev = 2;
              _context4.next = 5;
              return GeocodingUtils.getCurrentLocation();
            case 5:
              position = _context4.sent;
              this.map.setView([position.lat, position.lng], this.options.defaultZoom);
              this.setMarker(position.lat, position.lng);

              // Try to get address info
              _context4.next = 10;
              return GeocodingUtils.reverseGeocode(position.lat, position.lng);
            case 10:
              address = _context4.sent;
              return _context4.abrupt("return", SmallMap_objectSpread(SmallMap_objectSpread({}, position), {}, {
                address: address
              }));
            case 14:
              _context4.prev = 14;
              _context4.t0 = _context4["catch"](2);
              console.error('Error getting current location:', _context4.t0);
              throw _context4.t0;
            case 18:
            case "end":
              return _context4.stop();
          }
        }, _callee4, this, [[2, 14]]);
      }));
      function getCurrentLocation() {
        return _getCurrentLocation.apply(this, arguments);
      }
      return getCurrentLocation;
    }()
  }, {
    key: "updateLocation",
    value: function () {
      var _updateLocation = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee5(provinceName, cityName) {
        var coords, zoom;
        return SmallMap_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              if (this.isMapReady()) {
                _context5.next = 3;
                break;
              }
              console.error('Cannot update location: map is not ready');
              return _context5.abrupt("return");
            case 3:
              if (provinceName) {
                _context5.next = 5;
                break;
              }
              return _context5.abrupt("return");
            case 5:
              _context5.prev = 5;
              _context5.next = 8;
              return GeocodingUtils.geocodeLocation(provinceName, cityName);
            case 8:
              coords = _context5.sent;
              if (coords) {
                zoom = cityName ? this.options.defaultZoom : 8;
                this.map.setView([coords.lat, coords.lng], zoom);
                this.setMarker(coords.lat, coords.lng);
              }
              _context5.next = 15;
              break;
            case 12:
              _context5.prev = 12;
              _context5.t0 = _context5["catch"](5);
              console.error('Error updating map location:', _context5.t0);
            case 15:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this, [[5, 12]]);
      }));
      function updateLocation(_x, _x2) {
        return _updateLocation.apply(this, arguments);
      }
      return updateLocation;
    }()
  }, {
    key: "destroy",
    value: function () {
      var _destroy = SmallMap_asyncToGenerator(/*#__PURE__*/SmallMap_regeneratorRuntime().mark(function _callee6() {
        var container;
        return SmallMap_regeneratorRuntime().wrap(function _callee6$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              if (this.map) {
                try {
                  // Remove marker first
                  if (this.marker) {
                    this.map.removeLayer(this.marker);
                    this.marker = null;
                  }

                  // Remove map
                  this.map.remove();
                  console.log("SmallMap destroyed for ".concat(this.containerId));
                } catch (error) {
                  console.error('Error destroying SmallMap:', error);
                }
              }

              // Clear container
              container = document.getElementById(this.containerId);
              if (container) {
                container.innerHTML = '';
                container._leaflet_id = null;
                delete container._leaflet_id;
              }
              this.map = null;
              this.marker = null;
              this.isInitialized = false;
              this.initializationPromise = null;
            case 7:
            case "end":
              return _context6.stop();
          }
        }, _callee6, this);
      }));
      function destroy() {
        return _destroy.apply(this, arguments);
      }
      return destroy;
    }()
  }, {
    key: "isMapReady",
    value: function isMapReady() {
      return this.isInitialized && this.map !== null && !this.initializationPromise;
    }
  }]);
}();
;// ./user/src/script/components/item/my-items-page.js
function my_items_page_typeof(o) { "@babel/helpers - typeof"; return my_items_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, my_items_page_typeof(o); }
function my_items_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ my_items_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == my_items_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(my_items_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = my_items_page_unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function my_items_page_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return my_items_page_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? my_items_page_arrayLikeToArray(r, a) : void 0; } }
function my_items_page_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function my_items_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function my_items_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { my_items_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { my_items_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function my_items_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function my_items_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, my_items_page_toPropertyKey(o.key), o); } }
function my_items_page_createClass(e, r, t) { return r && my_items_page_defineProperties(e.prototype, r), t && my_items_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function my_items_page_callSuper(t, o, e) { return o = my_items_page_getPrototypeOf(o), my_items_page_possibleConstructorReturn(t, my_items_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], my_items_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function my_items_page_possibleConstructorReturn(t, e) { if (e && ("object" == my_items_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return my_items_page_assertThisInitialized(t); }
function my_items_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function my_items_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && my_items_page_setPrototypeOf(t, e); }
function my_items_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return my_items_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !my_items_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return my_items_page_construct(t, arguments, my_items_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), my_items_page_setPrototypeOf(Wrapper, t); }, my_items_page_wrapNativeSuper(t); }
function my_items_page_construct(t, e, r) { if (my_items_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && my_items_page_setPrototypeOf(p, r.prototype), p; }
function my_items_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (my_items_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function my_items_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function my_items_page_setPrototypeOf(t, e) { return my_items_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, my_items_page_setPrototypeOf(t, e); }
function my_items_page_getPrototypeOf(t) { return my_items_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, my_items_page_getPrototypeOf(t); }
function my_items_page_defineProperty(e, r, t) { return (r = my_items_page_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function my_items_page_toPropertyKey(t) { var i = my_items_page_toPrimitive(t, "string"); return "symbol" == my_items_page_typeof(i) ? i : i + ""; }
function my_items_page_toPrimitive(t, r) { if ("object" != my_items_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != my_items_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }




var WILAYAH_BASE_URL = "https://kanglerian.my.id/api-wilayah-indonesia/api";
var MyItemsPage = /*#__PURE__*/function (_HTMLElement) {
  function MyItemsPage() {
    var _this;
    my_items_page_classCallCheck(this, MyItemsPage);
    _this = my_items_page_callSuper(this, MyItemsPage);
    my_items_page_defineProperty(_this, "handleAddItem", /*#__PURE__*/function () {
      var _ref = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee(event) {
        var form, formData, availableSell, availableRent, categoryInput, priceSellInput, priceRentInput, availableRentCheckbox, depositInput, availableSellCheckbox, _iterator, _step, pair, result, errorMessage;
        return my_items_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              event.preventDefault();
              form = event.target;
              formData = new FormData(form); // --- Validasi Form (Tidak ada perubahan) ---
              availableSell = form.querySelector("#item-available-sell").checked;
              availableRent = form.querySelector("#item-available-rent").checked;
              if (!(!availableSell && !availableRent)) {
                _context.next = 8;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Validasi Error',
                text: 'Item harus tersedia untuk dijual atau disewa (minimal salah satu).',
                confirmButtonColor: '#3b82f6'
              });
              return _context.abrupt("return");
            case 8:
              if (!(availableSell && !form.querySelector("#item-price-sell").value)) {
                _context.next = 11;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Harga Jual Kosong',
                text: 'Harga jual harus diisi jika item tersedia untuk dijual.',
                confirmButtonColor: '#3b82f6'
              }).then(function () {
                form.querySelector("#item-price-sell").focus();
              });
              return _context.abrupt("return");
            case 11:
              if (!(availableRent && !form.querySelector("#item-price-rent").value)) {
                _context.next = 14;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Harga Sewa Kosong',
                text: 'Harga sewa harus diisi jika item tersedia untuk disewa.',
                confirmButtonColor: '#3b82f6'
              }).then(function () {
                form.querySelector("#item-price-rent").focus();
              });
              return _context.abrupt("return");
            case 14:
              // --- Persiapan FormData (Tidak ada perubahan) ---
              categoryInput = _this.querySelector("#item-category");
              if (!categoryInput || !categoryInput.value) {
                formData["delete"]("category_id");
              }
              priceSellInput = form.querySelector("#item-price-sell");
              if (!priceSellInput || !priceSellInput.value || priceSellInput.disabled) {
                formData["delete"]("price_sell");
              }
              priceRentInput = form.querySelector("#item-price-rent");
              if (!priceRentInput || !priceRentInput.value || priceRentInput.disabled) {
                formData["delete"]("price_rent");
              }
              availableRentCheckbox = form.querySelector("#item-available-rent");
              depositInput = form.querySelector("#item-deposit");
              if (!availableRentCheckbox || !availableRentCheckbox.checked || !depositInput || !depositInput.value) {
                formData["delete"]("deposit_amount");
              }
              availableSellCheckbox = form.querySelector("#item-available-sell");
              formData.set("is_available_for_sell", availableSellCheckbox && availableSellCheckbox.checked ? "true" : "false");
              formData.set("is_available_for_rent", availableRentCheckbox && availableRentCheckbox.checked ? "true" : "false");
              formData.set("status", "available");
              _iterator = _createForOfIteratorHelper(formData.entries());
              try {
                for (_iterator.s(); !(_step = _iterator.n()).done;) {
                  pair = _step.value;
                  console.log(pair[0] + ": " + pair[1]);
                }
              } catch (err) {
                _iterator.e(err);
              } finally {
                _iterator.f();
              }
              _context.prev = 29;
              _context.next = 32;
              return apiFormDataRequest("POST", "/items", formData);
            case 32:
              result = _context.sent;
              if (!(result.status === "success")) {
                _context.next = 40;
                break;
              }
              fetch("https://exml.pinjemin.site/api/refresh_data", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({})
              }).then(function () {})["catch"](function (refreshError) {
                console.warn("Failed to trigger ML backend data refresh:", refreshError);
              });
              _context.next = 37;
              return sweetalert2_all_default().fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Item berhasil ditambahkan. Anda akan dialihkan ke halaman utama.',
                confirmButtonColor: '#10b981',
                confirmButtonText: 'OK'
              });
            case 37:
              window.location.href = "/#/home";
              _context.next = 44;
              break;
            case 40:
              console.error("Failed to add item (API error):", result.message, result.errors);
              errorMessage = "Gagal menambahkan item: " + result.message;
              if (result.errors && Array.isArray(result.errors)) {
                errorMessage += "\nValidasi error:";
                result.errors.forEach(function (err) {
                  errorMessage += "\n- ".concat(err.param, ": ").concat(err.msg);
                });
              }
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal Menambahkan Item',
                text: errorMessage,
                confirmButtonColor: '#ef4444'
              });
            case 44:
              _context.next = 50;
              break;
            case 46:
              _context.prev = 46;
              _context.t0 = _context["catch"](29);
              console.error("Error adding item:", _context.t0);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Terjadi Kesalahan',
                text: 'Terjadi kesalahan saat menambahkan item. Silakan coba lagi.',
                confirmButtonColor: '#ef4444'
              });
            case 50:
            case "end":
              return _context.stop();
          }
        }, _callee, null, [[29, 46]]);
      }));
      return function (_x) {
        return _ref.apply(this, arguments);
      };
    }());
    my_items_page_defineProperty(_this, "handleUpdateItem", /*#__PURE__*/function () {
      var _ref2 = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee2(event) {
        var form, formData, availableSellCheckbox, availableRentCheckbox, statusSelect, validation, depositInput, priceSellInput, priceRentInput, _iterator2, _step2, pair, result, errorMessage;
        return my_items_page_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              event.preventDefault();
              form = event.target;
              formData = new FormData(form); // --- Validasi Form (Tidak ada perubahan) ---
              if (_this.editingItemId) {
                _context2.next = 7;
                break;
              }
              console.error("No item ID set for editing.");
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Error',
                text: 'Terjadi kesalahan: ID item yang diedit tidak ditemukan.',
                confirmButtonColor: '#ef4444'
              });
              return _context2.abrupt("return");
            case 7:
              if (_this.canEditOrDelete(_this.editingItemData)) {
                _context2.next = 10;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Tidak Dapat Diedit',
                text: 'Item ini tidak dapat diedit karena sudah sold atau rented.',
                confirmButtonColor: '#f59e0b'
              });
              return _context2.abrupt("return");
            case 10:
              availableSellCheckbox = form.querySelector("#edit-item-available-sell");
              availableRentCheckbox = form.querySelector("#edit-item-available-rent");
              statusSelect = form.querySelector("#edit-item-status");
              validation = _this.validateAvailability({
                status: statusSelect.value
              }, availableSellCheckbox.checked, availableRentCheckbox.checked);
              if (validation.valid) {
                _context2.next = 17;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Validasi Error',
                text: validation.message,
                confirmButtonColor: '#f59e0b'
              });
              return _context2.abrupt("return");
            case 17:
              if (!(!availableSellCheckbox.checked && !availableRentCheckbox.checked)) {
                _context2.next = 20;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Validasi Error',
                text: 'Item harus tersedia untuk dijual atau disewa (minimal salah satu).',
                confirmButtonColor: '#f59e0b'
              });
              return _context2.abrupt("return");
            case 20:
              if (!(availableSellCheckbox.checked && !form.querySelector("#edit-item-price-sell").value)) {
                _context2.next = 23;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Harga Jual Kosong',
                text: 'Harga jual harus diisi jika item tersedia untuk dijual.',
                confirmButtonColor: '#f59e0b'
              }).then(function () {
                form.querySelector("#edit-item-price-sell").focus();
              });
              return _context2.abrupt("return");
            case 23:
              if (!(availableRentCheckbox.checked && !form.querySelector("#edit-item-price-rent").value)) {
                _context2.next = 26;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Harga Sewa Kosong',
                text: 'Harga sewa harus diisi jika item tersedia untuk disewa.',
                confirmButtonColor: '#f59e0b'
              }).then(function () {
                form.querySelector("#edit-item-price-rent").focus();
              });
              return _context2.abrupt("return");
            case 26:
              // --- Persiapan FormData (Tidak ada perubahan) ---
              formData["delete"]("is_available_for_sell");
              formData["delete"]("is_available_for_rent");
              formData.append("is_available_for_sell", availableSellCheckbox.checked ? "true" : "false");
              formData.append("is_available_for_rent", availableRentCheckbox.checked ? "true" : "false");
              depositInput = form.querySelector("#edit-item-deposit");
              if (!availableRentCheckbox.checked || !depositInput.value) {
                formData["delete"]("deposit_amount");
              }
              priceSellInput = _this.querySelector("#edit-item-price-sell");
              priceRentInput = _this.querySelector("#edit-item-price-rent");
              if (!priceSellInput.value || priceSellInput.disabled) formData["delete"]("price_sell");
              if (!priceRentInput.value || priceRentInput.disabled) formData["delete"]("price_rent");
              formData.append("id", _this.editingItemId);
              _iterator2 = _createForOfIteratorHelper(formData.entries());
              try {
                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                  pair = _step2.value;
                  console.log(pair[0] + ": " + pair[1]);
                }
              } catch (err) {
                _iterator2.e(err);
              } finally {
                _iterator2.f();
              }
              _context2.prev = 39;
              _context2.next = 42;
              return apiFormDataRequest("PATCH", "/items/".concat(_this.editingItemId), formData);
            case 42:
              result = _context2.sent;
              if (!(result.status === "success")) {
                _context2.next = 50;
                break;
              }
              fetch("https://exml.pinjemin.site/api/refresh_data", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({})
              }).then(function () {})["catch"](function (refreshError) {
                console.warn("Failed to trigger ML backend data refresh:", refreshError);
              });
              _context2.next = 47;
              return sweetalert2_all_default().fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Item berhasil diupdate. Anda akan dialihkan ke halaman utama.',
                confirmButtonColor: '#10b981',
                confirmButtonText: 'OK'
              });
            case 47:
              window.location.href = "/#/home";
              _context2.next = 54;
              break;
            case 50:
              console.error("Failed to update item (API error):", result.message, result.errors);
              errorMessage = "Gagal mengupdate item: " + result.message;
              if (result.errors && Array.isArray(result.errors)) {
                errorMessage += "\nValidasi error:";
                result.errors.forEach(function (err) {
                  errorMessage += "\n- ".concat(err.param, ": ").concat(err.msg);
                });
              }
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal Mengupdate Item',
                text: errorMessage,
                confirmButtonColor: '#ef4444'
              });
            case 54:
              _context2.next = 60;
              break;
            case 56:
              _context2.prev = 56;
              _context2.t0 = _context2["catch"](39);
              console.error("Error updating item:", _context2.t0);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Terjadi Kesalahan',
                text: 'Terjadi kesalahan saat mengupdate item. Silakan coba lagi.',
                confirmButtonColor: '#ef4444'
              });
            case 60:
            case "end":
              return _context2.stop();
          }
        }, _callee2, null, [[39, 56]]);
      }));
      return function (_x2) {
        return _ref2.apply(this, arguments);
      };
    }());
    _this.fetchUserItems = _this.fetchUserItems.bind(_this);
    _this.renderUserItems = _this.renderUserItems.bind(_this);
    _this.handleItemActions = _this.handleItemActions.bind(_this);
    _this.handleEditItem = _this.handleEditItem.bind(_this);
    _this.handleDeleteItem = _this.handleDeleteItem.bind(_this);
    _this.handleUpdateItem = _this.handleUpdateItem.bind(_this);
    _this.handlePaginationClick = _this.handlePaginationClick.bind(_this);
    _this.editingItemId = null;
    _this.editingItemData = null;
    _this.user = null;

    // Pagination state
    _this.pagination = {
      total: 0,
      page: 1,
      limit: 10,
      totalPages: 1
    };
    _this.items = [];
    _this.isLoading = false;
    _this.error = null;

    // Map instances
    _this.addItemMap = null;
    _this.editItemMap = null;
    _this.selectedLocation = null;
    _this.editSelectedLocation = null;
    return _this;
  }
  my_items_page_inherits(MyItemsPage, _HTMLElement);
  return my_items_page_createClass(MyItemsPage, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.loadUserData();
      this.render();
      this.fetchUserItems();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      this.removeEventListeners();

      // Cleanup maps
      if (this.addItemMap) {
        this.addItemMap.destroy();
        this.addItemMap = null;
      }
      if (this.editItemMap) {
        this.editItemMap.destroy();
        this.editItemMap = null;
      }
    }
  }, {
    key: "loadUserData",
    value: function loadUserData() {
      var userData = localStorage.getItem("user");
      if (userData) {
        this.user = JSON.parse(userData);
      }
    }
  }, {
    key: "handlePaginationClick",
    value: function handlePaginationClick(event) {
      // Only handle clicks on pagination buttons
      var target = event.target.closest("[data-page]");
      if (!target) return;

      // Prevent default behavior
      event.preventDefault();
      event.stopPropagation();
      var page = Number.parseInt(target.dataset.page);
      if (page && page !== this.pagination.page && page >= 1 && page <= this.pagination.totalPages) {
        this.pagination.page = page;
        this.fetchUserItems();
      }
    }

    // Helper function untuk mendapatkan status yang konsisten
  }, {
    key: "getItemStatus",
    value: function getItemStatus(item) {
      // Normalisasi status dari berbagai kemungkinan format
      if (!item.status) {
        return "available"; // default status
      }
      var status = item.status.toLowerCase().trim();

      // Mapping status yang mungkin berbeda ke format standar
      switch (status) {
        case "available":
        case "tersedia":
        case "aktif":
          return "available";
        case "pending":
        case "menunggu":
        case "proses":
          return "pending";
        case "sold":
        case "terjual":
        case "dijual":
          return "sold";
        case "rented":
        case "disewa":
        case "tersewa":
          return "rented";
        case "completed":
        case "selesai":
          return "completed";
        default:
          return "available";
      }
    }

    // Helper function untuk mendapatkan display status dan styling
  }, {
    key: "getStatusDisplay",
    value: function getStatusDisplay(status) {
      var normalizedStatus = this.getItemStatus({
        status: status
      });
      switch (normalizedStatus) {
        case "available":
          return {
            display: "Available",
            "class": "text-green-600 bg-green-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
        case "pending":
          return {
            display: "Pending",
            "class": "text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
        case "sold":
          return {
            display: "Sold",
            "class": "text-red-600 bg-red-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
        case "rented":
          return {
            display: "Rented",
            "class": "text-yellow-600 bg-yellow-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
        case "completed":
          return {
            display: "Completed",
            "class": "text-purple-600 bg-purple-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
        default:
          return {
            display: "Unknown",
            "class": "text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full text-xs font-semibold font-poppins"
          };
      }
    }

    // Helper function untuk mengecek apakah item bisa diedit/dihapus
  }, {
    key: "canEditOrDelete",
    value: function canEditOrDelete(item) {
      var status = this.getItemStatus(item);
      // Item bisa diedit/dihapus jika statusnya available, pending, atau completed
      return status === "available" || status === "pending" || status === "completed";
    }

    // Helper function untuk mengecek apakah item bisa dijual
  }, {
    key: "canBeSold",
    value: function canBeSold(item) {
      var status = this.getItemStatus(item);
      // Item bisa dijual jika tidak sedang rented
      return status !== "rented";
    }

    // Helper function untuk validasi availability berdasarkan status
  }, {
    key: "validateAvailability",
    value: function validateAvailability(item, isAvailableForSell, isAvailableForRent) {
      var status = this.getItemStatus(item);

      // Jika item sedang rented, tidak bisa dijual
      if (status === "rented" && isAvailableForSell) {
        return {
          valid: false,
          message: "Item yang sedang disewa tidak dapat dijual sampai statusnya menjadi completed."
        };
      }

      // Jika item sudah sold, tidak bisa disewa
      if (status === "sold" && isAvailableForRent) {
        return {
          valid: false,
          message: "Item yang sudah terjual tidak dapat disewa."
        };
      }
      return {
        valid: true
      };
    }
  }, {
    key: "renderPagination",
    value: function renderPagination() {
      if (this.pagination.totalPages <= 1) {
        return "";
      }
      var currentPage = this.pagination.page;
      var totalPages = this.pagination.totalPages;
      var startItem = (currentPage - 1) * this.pagination.limit + 1;
      var endItem = Math.min(currentPage * this.pagination.limit, this.pagination.total);

      // Calculate page numbers to show
      var startPage = Math.max(1, currentPage - 2);
      var endPage = Math.min(totalPages, currentPage + 2);

      // Adjust if we're near the beginning or end
      if (currentPage <= 3) {
        endPage = Math.min(5, totalPages);
      }
      if (currentPage >= totalPages - 2) {
        startPage = Math.max(1, totalPages - 4);
      }
      var pageNumbers = [];
      for (var i = startPage; i <= endPage; i++) {
        pageNumbers.push(i);
      }
      return "\n      <div class=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-8 px-4\">\n        <!-- Results info -->\n        <div class=\"text-sm text-gray-700 font-poppins\">\n          Menampilkan <span class=\"font-medium\">".concat(startItem, "</span> sampai <span class=\"font-medium\">").concat(endItem, "</span> dari <span class=\"font-medium\">").concat(this.pagination.total, "</span> item\n        </div>\n        \n        <!-- Pagination controls -->\n        <div class=\"flex items-center gap-2\">\n          <!-- Previous button -->\n          <button \n            data-page=\"").concat(currentPage - 1, "\" \n            class=\"pagination-btn ").concat(currentPage === 1 ? "pagination-btn-disabled" : "pagination-btn-enabled", "\"\n            ").concat(currentPage === 1 ? "disabled" : "", "\n          >\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\"></path>\n            </svg>\n            <span class=\"hidden sm:inline\">Previous</span>\n          </button>\n\n          <!-- Page numbers -->\n          <div class=\"flex items-center gap-1\">\n            ").concat(startPage > 1 ? "\n              <button data-page=\"1\" class=\"pagination-number\">1</button>\n              ".concat(startPage > 2 ? '<span class="px-2 text-gray-500">...</span>' : "", "\n            ") : "", "\n            \n            ").concat(pageNumbers.map(function (page) {
        return "\n              <button \n                data-page=\"".concat(page, "\" \n                class=\"pagination-number ").concat(page === currentPage ? "pagination-number-active" : "", "\"\n              >\n                ").concat(page, "\n              </button>\n            ");
      }).join(""), "\n            \n            ").concat(endPage < totalPages ? "\n              ".concat(endPage < totalPages - 1 ? '<span class="px-2 text-gray-500">...</span>' : "", "\n              <button data-page=\"").concat(totalPages, "\" class=\"pagination-number\">").concat(totalPages, "</button>\n            ") : "", "\n          </div>\n\n          <!-- Next button -->\n          <button \n            data-page=\"").concat(currentPage + 1, "\" \n            class=\"pagination-btn ").concat(currentPage === totalPages ? "pagination-btn-disabled" : "pagination-btn-enabled", "\"\n            ").concat(currentPage === totalPages ? "disabled" : "", "\n          >\n            <span class=\"hidden sm:inline\">Next</span>\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n    ");
    }
  }, {
    key: "render",
    value: function render() {
      var _this$user,
        _this$user2,
        _this$user3,
        _this$user4,
        _this$user5,
        _this$user6,
        _this$user7,
        _this$user8,
        _this$user9,
        _this$user10,
        _this$user11,
        _this$user12,
        _this2 = this;
      this.innerHTML = "\n            <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n                /* Pagination styles */\n                .pagination-btn {\n                    display: flex;\n                    align-items: center;\n                    gap: 0.5rem;\n                    padding: 0.5rem 0.75rem;\n                    border-radius: 0.5rem;\n                    font-size: 0.875rem;\n                    font-weight: 500;\n                    transition: all 0.2s;\n                }\n\n                .pagination-btn-enabled {\n                    background-color: white;\n                    border: 1px solid #d1d5db;\n                    color: #374151;\n                }\n\n                .pagination-btn-enabled:hover {\n                    background-color: #f9fafb;\n                    border-color: #9ca3af;\n                }\n\n                .pagination-btn-disabled {\n                    background-color: #f9fafb;\n                    border: 1px solid #e5e7eb;\n                    color: #9ca3af;\n                    cursor: not-allowed;\n                }\n\n                .pagination-number {\n                    min-width: 2.5rem;\n                    height: 2.5rem;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    border-radius: 0.5rem;\n                    font-size: 0.875rem;\n                    font-weight: 500;\n                    transition: all 0.2s;\n                    background-color: white;\n                    border: 1px solid #d1d5db;\n                    color: #374151;\n                }\n\n                .pagination-number:hover {\n                    background-color: #f3f4f6;\n                    border-color: #9ca3af;\n                }\n\n                .pagination-number-active {\n                    background-color: #3b82f6;\n                    border-color: #3b82f6;\n                    color: white;\n                }\n\n                .pagination-number-active:hover {\n                    background-color: #2563eb;\n                    border-color: #2563eb;\n                }\n\n                /* Leaflet styles */\n                #map { height: 180px; }\n            </style>\n            <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n            <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n            <div class=\"container mx-auto px-4 py-8 font-poppins\">\n                <h2 class=\"text-2xl font-bold mb-4\">Item Saya (Toko Saya)</h2>\n\n                <div id=\"add-item-section\" class=\"mt-8 p-6 bg-white rounded-lg shadow-md\">\n                    <h3 class=\"text-xl font-semibold mb-4\">Tambah Item Baru</h3>\n                    <form id=\"add-item-form\" class=\"space-y-4\">\n                        <div>\n                            <label for=\"item-name\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Nama Item <span class=\"text-red-500\">*</span></label>\n                            <input type=\"text\" id=\"item-name\" name=\"name\" required class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                        </div>\n                        \n                        <div>\n                            <label for=\"item-category\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Kategori</label>\n                            <select id=\"item-category\" name=\"category_id\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                                <option value=\"\">Pilih Kategori</option>\n                                <option value=\"1\">Masak</option>\n                                <option value=\"2\">Fotografi</option>\n                                <option value=\"3\">Membaca</option>\n                            </select>\n                        </div>\n                        \n                        <div>\n                            <label for=\"item-description\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Deskripsi</label>\n                            <textarea id=\"item-description\" name=\"description\" rows=\"3\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\"></textarea>\n                        </div>\n\n                        <div class=\"flex items-center space-x-4 mb-4\">\n                            <div class=\"flex items-center\">\n                                <input id=\"item-available-sell\" name=\"is_available_for_sell\" type=\"checkbox\" value=\"true\" class=\"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded\">\n                                <label for=\"item-available-sell\" class=\"ml-2 block text-sm text-gray-900 font-poppins\">Tersedia untuk Dijual</label>\n                            </div>\n                            <div class=\"flex items-center\">\n                                <input id=\"item-available-rent\" name=\"is_available_for_rent\" type=\"checkbox\" value=\"true\" class=\"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded\">\n                                <label for=\"item-available-rent\" class=\"ml-2 block text-sm text-gray-900 font-poppins\">Tersedia untuk Disewa</label>\n                            </div>\n                        </div>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                                <label for=\"item-price-sell\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Harga Jual</label>\n                                <input type=\"number\" id=\"item-price-sell\" name=\"price_sell\" step=\"0.01\" disabled class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 disabled:opacity-50\">\n                            </div>\n                            <div>\n                                <label for=\"item-price-rent\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Harga Sewa</label>\n                                <input type=\"number\" id=\"item-price-rent\" name=\"price_rent\" step=\"0.01\" disabled class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 disabled:opacity-50\">\n                            </div>\n                        </div>\n\n                        <div id=\"deposit-field\" class=\"hidden\">\n                            <label for=\"item-deposit\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Jumlah Deposit</label>\n                            <input type=\"number\" id=\"item-deposit\" name=\"deposit_amount\" step=\"0.01\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                        </div>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                                <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Provinsi</label>\n                                <input type=\"text\" value=\"".concat(((_this$user = this.user) === null || _this$user === void 0 ? void 0 : _this$user.province_name) || "Tidak diset", "\" disabled class=\"bg-gray-100 border border-gray-300 text-gray-700 text-sm rounded-lg block w-full p-2.5 disabled:opacity-75\">\n                                <input type=\"hidden\" name=\"province_id\" value=\"").concat(((_this$user2 = this.user) === null || _this$user2 === void 0 ? void 0 : _this$user2.province_id) || "", "\">\n                                <input type=\"hidden\" name=\"province_name\" value=\"").concat(((_this$user3 = this.user) === null || _this$user3 === void 0 ? void 0 : _this$user3.province_name) || "", "\">\n                            </div>\n                            <div>\n                                <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Kota/Kabupaten</label>\n                                <input type=\"text\" value=\"").concat(((_this$user4 = this.user) === null || _this$user4 === void 0 ? void 0 : _this$user4.city_name) || "Tidak diset", "\" disabled class=\"bg-gray-100 border border-gray-300 text-gray-700 text-sm rounded-lg block w-full p-2.5 disabled:opacity-75\">\n                                <input type=\"hidden\" name=\"city_id\" value=\"").concat(((_this$user5 = this.user) === null || _this$user5 === void 0 ? void 0 : _this$user5.city_id) || "", "\">\n                                <input type=\"hidden\" name=\"city_name\" value=\"").concat(((_this$user6 = this.user) === null || _this$user6 === void 0 ? void 0 : _this$user6.city_name) || "", "\">\n                            </div>\n                        </div>\n\n                        <div>\n                            <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Lokasi pada Peta</label>\n                            <div class=\"space-y-2\">\n                                <button type=\"button\" id=\"get-current-location-add\" class=\"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center gap-2\">\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                                    </svg>\n                                    Gunakan Lokasi Saat Ini\n                                </button>\n                                <div id=\"add-item-map\" class=\"border border-gray-300 rounded-lg\"></div>\n                                <p class=\"text-xs text-gray-500\">Klik pada peta untuk memilih lokasi yang lebih spesifik</p>\n                            </div>\n                            <input type=\"hidden\" name=\"latitude\" id=\"add-latitude\">\n                            <input type=\"hidden\" name=\"longitude\" id=\"add-longitude\">\n                        </div>\n\n                        <div>\n                            <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\" for=\"item-photos\">Foto Item (Multiple)</label>\n                            <input class=\"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none\" id=\"item-photos\" name=\"photos\" multiple accept=\"image/*\" type=\"file\">\n                        </div>\n\n                        <!-- Hidden field untuk status default -->\n                        <input type=\"hidden\" name=\"status\" value=\"available\">\n\n                        <div>\n                            <button type=\"submit\" class=\"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\">\n                                Tambah Item\n                            </button>\n                        </div>\n                    </form>\n                </div>\n\n                <div id=\"edit-item-section\" class=\"mt-8 p-6 bg-white rounded-lg shadow-md hidden\"> \n                    <h3 class=\"text-xl font-semibold mb-4\">Edit Item <span id=\"editing-item-name\" class=\"font-normal italic text-gray-600\"></span></h3>\n                    <form id=\"edit-item-form\" class=\"space-y-4\">\n                        <div>\n                            <label for=\"edit-item-name\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Nama Item <span class=\"text-red-500\">*</span></label>\n                            <input type=\"text\" id=\"edit-item-name\" name=\"name\" required class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                        </div>\n                        \n                        <div>\n                            <label for=\"edit-item-category\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Kategori</label>\n                            <select id=\"edit-item-category\" name=\"category_id\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                                <option value=\"\">Pilih Kategori</option>\n                                <option value=\"1\">Masak</option>\n                                <option value=\"2\">Fotografi</option>\n                                <option value=\"3\">Membaca</option>\n                            </select>\n                        </div>\n                        \n                        <div>\n                            <label for=\"edit-item-description\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Deskripsi</label>\n                            <textarea id=\"edit-item-description\" name=\"description\" rows=\"3\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\"></textarea>\n                        </div>\n\n                        <!-- Status selector untuk edit -->\n                        <div>\n                            <label for=\"edit-item-status\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Status Item</label>\n                            <select id=\"edit-item-status\" name=\"status\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                                <option value=\"available\">Available</option>\n                                <option value=\"pending\">Pending</option>\n                                <option value=\"sold\">Sold</option>\n                                <option value=\"rented\">Rented</option>\n                                <option value=\"completed\">Completed</option>\n                            </select>\n                        </div>\n\n                        <div class=\"flex items-center space-x-4 mb-4\">\n                            <div class=\"flex items-center\">\n                                <input id=\"edit-item-available-sell\" name=\"is_available_for_sell\" type=\"checkbox\" value=\"true\" class=\"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded\">\n                                <label for=\"edit-item-available-sell\" class=\"ml-2 block text-sm text-gray-900 font-poppins\">Tersedia untuk Dijual</label>\n                            </div>\n                            <div class=\"flex items-center\">\n                                <input id=\"edit-item-available-rent\" name=\"is_available_for_rent\" type=\"checkbox\" value=\"true\" class=\"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded\">\n                                <label for=\"edit-item-available-rent\" class=\"ml-2 block text-sm text-gray-900 font-poppins\">Tersedia untuk Disewa</label>\n                            </div>\n                        </div>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                                <label for=\"edit-item-price-sell\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Harga Jual</label>\n                                <input type=\"number\" id=\"edit-item-price-sell\" name=\"price_sell\" step=\"0.01\" disabled class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 disabled:opacity-50\">\n                            </div>\n                            <div>\n                                <label for=\"edit-item-price-rent\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Harga Sewa</label>\n                                <input type=\"number\" id=\"edit-item-price-rent\" name=\"price_rent\" step=\"0.01\" disabled class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 disabled:opacity-50\">\n                            </div>\n                        </div>\n\n                        <div id=\"edit-deposit-field\" class=\"hidden\"> \n                            <label for=\"edit-item-deposit\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Jumlah Deposit</label>\n                            <input type=\"number\" id=\"edit-item-deposit\" name=\"deposit_amount\" step=\"0.01\" class=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5\">\n                        </div>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                                <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Provinsi</label>\n                                <input type=\"text\" value=\"").concat(((_this$user7 = this.user) === null || _this$user7 === void 0 ? void 0 : _this$user7.province_name) || "Tidak diset", "\" disabled class=\"bg-gray-100 border border-gray-300 text-gray-700 text-sm rounded-lg block w-full p-2.5 disabled:opacity-75\">\n                                <input type=\"hidden\" name=\"province_id\" value=\"").concat(((_this$user8 = this.user) === null || _this$user8 === void 0 ? void 0 : _this$user8.province_id) || "", "\">\n                                <input type=\"hidden\" name=\"province_name\" value=\"").concat(((_this$user9 = this.user) === null || _this$user9 === void 0 ? void 0 : _this$user9.province_name) || "", "\">\n                            </div>\n                            <div>\n                                <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Kota/Kabupaten</label>\n                                <input type=\"text\" value=\"").concat(((_this$user10 = this.user) === null || _this$user10 === void 0 ? void 0 : _this$user10.city_name) || "Tidak diset", "\" disabled class=\"bg-gray-100 border border-gray-300 text-gray-700 text-sm rounded-lg block w-full p-2.5 disabled:opacity-75\">\n                                <input type=\"hidden\" name=\"city_id\" value=\"").concat(((_this$user11 = this.user) === null || _this$user11 === void 0 ? void 0 : _this$user11.city_id) || "", "\">\n                                <input type=\"hidden\" name=\"city_name\" value=\"").concat(((_this$user12 = this.user) === null || _this$user12 === void 0 ? void 0 : _this$user12.city_name) || "", "\">\n                            </div>\n                        </div>\n\n                        <div>\n                            <label class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Lokasi pada Peta</label>\n                            <div class=\"space-y-2\">\n                                <button type=\"button\" id=\"get-current-location-edit\" class=\"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center gap-2\">\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                                    </svg>\n                                    Gunakan Lokasi Saat Ini\n                                </button>\n                                <div id=\"edit-item-map\" class=\"border border-gray-300 rounded-lg\"></div>\n                                <p class=\"text-xs text-gray-500\">Klik pada peta untuk memilih lokasi yang lebih spesifik</p>\n                            </div>\n                            <input type=\"hidden\" name=\"latitude\" id=\"edit-latitude\">\n                            <input type=\"hidden\" name=\"longitude\" id=\"edit-longitude\">\n                        </div>\n\n                        <div>\n                            <label for=\"edit-item-photos\" class=\"block mb-2 text-sm font-medium text-gray-900 font-poppins font-bold\">Foto Item Baru (Multiple)</label>\n                            <input type=\"file\" id=\"edit-item-photos\" name=\"photos\" multiple accept=\"image/*\" class=\"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none\">\n                        </div>\n\n                        <div class=\"flex space-x-4\">\n                            <button type=\"submit\" class=\"flex-1 justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\">\n                                Simpan Perubahan\n                            </button>\n                            <button type=\"button\" id=\"cancel-edit-button\" class=\"flex-1 justify-center rounded-md bg-gray-300 px-3 py-1.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-400\">\n                                Batal\n                            </button>\n                        </div>\n                    </form>\n                </div>\n\n                <hr class=\"my-8\">\n\n                <div class=\"mt-8\">\n                    <h3 class=\"text-xl font-semibold mb-4\">Daftar Item Anda</h3>\n                    <div id=\"user-items-list\">\n                        ").concat(this.renderItemsList(), "\n                    </div>\n                    ").concat(this.renderPagination(), "\n                </div>\n            </div>\n        ");

      // Setup event listeners setelah render
      this.setupEventListeners();

      // Initialize edit map with item location or user's city
      setTimeout(/*#__PURE__*/my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee3() {
        var _this2$user;
        var _this2$editingItemDat, _this2$editingItemDat2;
        return my_items_page_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (!(_this2.editItemMap && (_this2$user = _this2.user) !== null && _this2$user !== void 0 && _this2$user.province_name)) {
                _context3.next = 10;
                break;
              }
              _context3.prev = 1;
              _context3.next = 4;
              return _this2.editItemMap.initializeMap(_this2.user.province_name, _this2.user.city_name);
            case 4:
              // If item has coordinates, set marker
              if ((_this2$editingItemDat = _this2.editingItemData) !== null && _this2$editingItemDat !== void 0 && _this2$editingItemDat.latitude && (_this2$editingItemDat2 = _this2.editingItemData) !== null && _this2$editingItemDat2 !== void 0 && _this2$editingItemDat2.longitude) {
                _this2.editItemMap.setMarker(_this2.editingItemData.latitude, _this2.editingItemData.longitude);
              }
              _context3.next = 10;
              break;
            case 7:
              _context3.prev = 7;
              _context3.t0 = _context3["catch"](1);
              console.error('Error initializing edit map:', _context3.t0);
            case 10:
            case "end":
              return _context3.stop();
          }
        }, _callee3, null, [[1, 7]]);
      })), 100);
    }
  }, {
    key: "renderItemsList",
    value: function renderItemsList() {
      var _this3 = this;
      if (this.isLoading) {
        return "\n        <div class=\"flex justify-center items-center py-12\">\n          <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n          <span class=\"ml-3 text-gray-600\">Loading items...</span>\n        </div>\n      ";
      }
      if (this.error) {
        return "\n        <div class=\"text-center py-12\">\n          <div class=\"bg-red-50 border border-red-200 rounded-xl p-6 max-w-md mx-auto\">\n            <svg class=\"w-12 h-12 text-red-500 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"></path>\n            </svg>\n            <p class=\"text-red-600 font-semibold\">Error: ".concat(this.error, "</p>\n          </div>\n        </div>\n      ");
      }
      if (!this.items || this.items.length === 0) {
        return "\n        <div class=\"text-center py-16\">\n          <div class=\"bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-8 max-w-md mx-auto\">\n            <svg class=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m13-8l-4 4m0 0l-4-4m4 4V3\"></path>\n            </svg>\n            <h3 class=\"mt-2 text-sm font-medium text-gray-900\">Belum ada item</h3>\n            <p class=\"mt-1 text-sm text-gray-500\">Mulai dengan menambahkan item pertama Anda.</p>\n          </div>\n        </div>\n      ";
      }
      return this.items.map(function (item) {
        return _this3.renderSingleItem(item);
      }).join("");
    }
  }, {
    key: "renderSingleItem",
    value: function renderSingleItem(item) {
      var statusInfo = this.getStatusDisplay(item.status);
      var canEdit = this.canEditOrDelete(item);
      var canSell = this.canBeSold(item);
      var getCategoryName = function getCategoryName(categoryId) {
        switch (categoryId) {
          case 1:
            return "Masak";
          case 2:
            return "Fotografi";
          case 3:
            return "Membaca";
          default:
            return "Tidak dikategorikan";
        }
      };

      // Tambahkan informasi tambahan untuk status
      var statusNote = "";
      var status = this.getItemStatus(item);
      if (status === "rented") {
        statusNote = '<span class="text-xs text-orange-600 bg-orange-100 px-2 py-0.5 rounded-full ml-2">🚫 Tidak dapat dijual saat disewa</span>';
      } else if (status === "completed") {
        statusNote = '<span class="text-xs text-green-600 bg-green-100 px-2 py-0.5 rounded-full ml-2">✅ Dapat dijual/disewa lagi</span>';
      }
      return "\n      <div class=\"mb-6 p-6 bg-white rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300 ".concat(!canEdit ? "opacity-75 border-gray-400" : "", "\">\n        <div class=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\n          <div class=\"flex items-start gap-4 flex-1\">\n            ").concat(item.thumbnail ? "<img src=\"https://api.pinjemin.site".concat(item.thumbnail, "\" alt=\"Thumbnail ").concat(item.name, "\" class=\"w-20 h-20 object-cover rounded-lg border-2 border-gray-200 flex-shrink-0\">") : "<div class=\"w-20 h-20 bg-gray-200 rounded-lg border-2 border-gray-300 flex items-center justify-center flex-shrink-0\">\n                    <span class=\"text-gray-500 text-xs\">No Image</span>\n                  </div>", "\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"flex items-center gap-2 mb-2 flex-wrap\">\n                <h4 class=\"text-lg font-poppins font-bold text-gray-800 truncate\">").concat(item.name, "</h4>\n                <span class=\"").concat(statusInfo["class"], "\">").concat(statusInfo.display, "</span>\n                ").concat(statusNote, "\n                ").concat(!canEdit ? '<span class="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">🔒 Tidak dapat diedit</span>' : "", "\n              </div>\n              <p class=\"text-sm text-gray-600 font-poppins mb-1 line-clamp-2\">").concat(item.description || "Tidak ada deskripsi", "</p>\n              <div class=\"flex flex-wrap gap-4 text-sm text-gray-500 font-poppins\">\n                <span><strong>Kategori:</strong> ").concat(getCategoryName(item.category_id), "</span>\n                <span><strong>Lokasi:</strong> ").concat(item.city_name || "-", ", ").concat(item.province_name || "-", "</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"flex flex-col lg:flex-row lg:items-center gap-4\">\n            <div class=\"flex flex-col sm:flex-row gap-2 text-sm font-poppins\">\n              ").concat(item.price_sell ? "<div class=\"bg-green-50 border border-green-200 rounded-lg px-3 py-2\">\n                      <span class=\"text-green-700 font-semibold\">Jual: Rp ".concat(Number.parseFloat(item.price_sell).toLocaleString("id-ID"), "</span>\n                    </div>") : "", "\n              ").concat(item.price_rent ? "<div class=\"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2\">\n                      <span class=\"text-blue-700 font-semibold\">Sewa: Rp ".concat(Number.parseFloat(item.price_rent).toLocaleString("id-ID"), "/hari</span>\n                    </div>") : "", "\n              ").concat(item.is_available_for_rent && item.deposit_amount ? "<div class=\"bg-yellow-50 border border-yellow-200 rounded-lg px-3 py-2\">\n                      <span class=\"text-yellow-700 font-semibold\">Deposit: Rp ".concat(Number.parseFloat(item.deposit_amount).toLocaleString("id-ID"), "</span>\n                    </div>") : "", "\n            </div>\n            \n            <div class=\"flex gap-2\">\n              <button class=\"edit-item-button ").concat(canEdit ? "bg-yellow-500 hover:bg-yellow-600" : "bg-gray-400 cursor-not-allowed", " text-white text-sm px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center gap-1\" \n                      data-item-id=\"").concat(item.id, "\" \n                      ").concat(!canEdit ? 'disabled title="Item tidak dapat diedit karena sudah sold/rented"' : "", ">\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n                </svg>\n                Edit\n              </button>\n              <button class=\"delete-item-button ").concat(canEdit ? "bg-red-500 hover:bg-red-600" : "bg-gray-400 cursor-not-allowed", " text-white text-sm px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center gap-1\" \n                      data-item-id=\"").concat(item.id, "\"\n                      ").concat(!canEdit ? 'disabled title="Item tidak dapat dihapus karena sudah sold/rented"' : "", ">\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n                </svg>\n                Hapus\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ");
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      var addItemForm = this.querySelector("#add-item-form");
      if (addItemForm) {
        addItemForm.addEventListener("submit", this.handleAddItem);
      }

      // Setup checkbox listeners untuk form tambah item
      this.setupAvailabilityListeners("add");
      var itemListDiv = this.querySelector("#user-items-list");
      if (itemListDiv) {
        itemListDiv.addEventListener("click", this.handleItemActions);
      }
      var editItemForm = this.querySelector("#edit-item-form");
      if (editItemForm) {
        editItemForm.addEventListener("submit", this.handleUpdateItem);
      }

      // Setup checkbox listeners untuk form edit item
      this.setupAvailabilityListeners("edit");
      var cancelEditButton = this.querySelector("#cancel-edit-button");
      if (cancelEditButton) {
        cancelEditButton.addEventListener("click", this.hideEditForm.bind(this));
      }
      this.addEventListener("click", this.handlePaginationClick);

      // Initialize maps and setup location buttons
      this.initializeMaps();
      this.setupLocationButtons();
    }
  }, {
    key: "initializeMaps",
    value: function () {
      var _initializeMaps = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee5() {
        var _this4 = this;
        return my_items_page_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              // Wait a bit for DOM to be ready
              setTimeout(/*#__PURE__*/my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee4() {
                var _this4$user;
                return my_items_page_regeneratorRuntime().wrap(function _callee4$(_context4) {
                  while (1) switch (_context4.prev = _context4.next) {
                    case 0:
                      _context4.prev = 0;
                      // Initialize add item map
                      _this4.addItemMap = new SmallMap('add-item-map', {
                        height: '300px',
                        defaultZoom: 12,
                        onLocationSelect: function onLocationSelect(lat, lng) {
                          _this4.selectedLocation = {
                            lat: lat,
                            lng: lng
                          };
                          document.getElementById('add-latitude').value = lat;
                          document.getElementById('add-longitude').value = lng;
                        }
                      });

                      // Initialize edit item map
                      _this4.editItemMap = new SmallMap('edit-item-map', {
                        height: '300px',
                        defaultZoom: 12,
                        onLocationSelect: function onLocationSelect(lat, lng) {
                          _this4.editSelectedLocation = {
                            lat: lat,
                            lng: lng
                          };
                          document.getElementById('edit-latitude').value = lat;
                          document.getElementById('edit-longitude').value = lng;
                        }
                      });

                      // Initialize add map with user's city
                      if (!((_this4$user = _this4.user) !== null && _this4$user !== void 0 && _this4$user.province_name)) {
                        _context4.next = 6;
                        break;
                      }
                      _context4.next = 6;
                      return _this4.addItemMap.initializeMap(_this4.user.province_name, _this4.user.city_name);
                    case 6:
                      _context4.next = 11;
                      break;
                    case 8:
                      _context4.prev = 8;
                      _context4.t0 = _context4["catch"](0);
                      console.error('Error initializing maps:', _context4.t0);
                    case 11:
                    case "end":
                      return _context4.stop();
                  }
                }, _callee4, null, [[0, 8]]);
              })), 500);
            case 1:
            case "end":
              return _context5.stop();
          }
        }, _callee5);
      }));
      function initializeMaps() {
        return _initializeMaps.apply(this, arguments);
      }
      return initializeMaps;
    }()
  }, {
    key: "setupLocationButtons",
    value: function setupLocationButtons() {
      var _this5 = this;
      // Add item current location button
      var addLocationBtn = this.querySelector('#get-current-location-add');
      if (addLocationBtn) {
        addLocationBtn.addEventListener('click', /*#__PURE__*/my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee6() {
          return my_items_page_regeneratorRuntime().wrap(function _callee6$(_context6) {
            while (1) switch (_context6.prev = _context6.next) {
              case 0:
                _context6.prev = 0;
                addLocationBtn.disabled = true;
                addLocationBtn.innerHTML = "\n                    <svg class=\"w-4 h-4 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path>\n                    </svg>\n                    Mengambil Lokasi...\n                ";
                if (!(_this5.addItemMap && _this5.addItemMap.isMapReady())) {
                  _context6.next = 8;
                  break;
                }
                _context6.next = 6;
                return _this5.addItemMap.getCurrentLocation();
              case 6:
                _context6.next = 9;
                break;
              case 8:
                throw new Error('Map belum siap');
              case 9:
                _context6.next = 15;
                break;
              case 11:
                _context6.prev = 11;
                _context6.t0 = _context6["catch"](0);
                console.error('Error getting current location:', _context6.t0);
                sweetalert2_all_default().fire({
                  icon: 'error',
                  title: 'Gagal Mengambil Lokasi',
                  text: 'Tidak dapat mengambil lokasi saat ini. Pastikan GPS aktif dan izin lokasi diberikan.',
                  confirmButtonColor: '#ef4444'
                });
              case 15:
                _context6.prev = 15;
                addLocationBtn.disabled = false;
                addLocationBtn.innerHTML = "\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                    </svg>\n                    Gunakan Lokasi Saat Ini\n                ";
                return _context6.finish(15);
              case 19:
              case "end":
                return _context6.stop();
            }
          }, _callee6, null, [[0, 11, 15, 19]]);
        })));
      }

      // Edit item current location button
      var editLocationBtn = this.querySelector('#get-current-location-edit');
      if (editLocationBtn) {
        editLocationBtn.addEventListener('click', /*#__PURE__*/my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee7() {
          return my_items_page_regeneratorRuntime().wrap(function _callee7$(_context7) {
            while (1) switch (_context7.prev = _context7.next) {
              case 0:
                _context7.prev = 0;
                editLocationBtn.disabled = true;
                editLocationBtn.innerHTML = "\n                    <svg class=\"w-4 h-4 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path>\n                    </svg>\n                    Mengambil Lokasi...\n                ";
                if (!(_this5.editItemMap && _this5.editItemMap.isMapReady())) {
                  _context7.next = 8;
                  break;
                }
                _context7.next = 6;
                return _this5.editItemMap.getCurrentLocation();
              case 6:
                _context7.next = 9;
                break;
              case 8:
                throw new Error('Map belum siap');
              case 9:
                _context7.next = 15;
                break;
              case 11:
                _context7.prev = 11;
                _context7.t0 = _context7["catch"](0);
                console.error('Error getting current location:', _context7.t0);
                sweetalert2_all_default().fire({
                  icon: 'error',
                  title: 'Gagal Mengambil Lokasi',
                  text: 'Tidak dapat mengambil lokasi saat ini. Pastikan GPS aktif dan izin lokasi diberikan.',
                  confirmButtonColor: '#ef4444'
                });
              case 15:
                _context7.prev = 15;
                editLocationBtn.disabled = false;
                editLocationBtn.innerHTML = "\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                    </svg>\n                    Gunakan Lokasi Saat Ini\n                ";
                return _context7.finish(15);
              case 19:
              case "end":
                return _context7.stop();
            }
          }, _callee7, null, [[0, 11, 15, 19]]);
        })));
      }
    }

    // Helper method untuk setup availability listeners
  }, {
    key: "setupAvailabilityListeners",
    value: function setupAvailabilityListeners(formType) {
      var prefix = formType === "add" ? "item" : "edit-item";
      var availableSellCheckbox = this.querySelector("#".concat(prefix, "-available-sell"));
      var availableRentCheckbox = this.querySelector("#".concat(prefix, "-available-rent"));
      var priceSellInput = this.querySelector("#".concat(prefix, "-price-sell"));
      var priceRentInput = this.querySelector("#".concat(prefix, "-price-rent"));
      var depositFieldDiv = this.querySelector("#".concat(formType === "add" ? "deposit" : "edit-deposit", "-field"));
      var depositInput = this.querySelector("#".concat(prefix, "-deposit"));
      if (availableSellCheckbox && priceSellInput) {
        availableSellCheckbox.addEventListener("change", function (event) {
          priceSellInput.disabled = !event.target.checked;
          if (!event.target.checked) {
            priceSellInput.value = "";
          } else {
            setTimeout(function () {
              return priceSellInput.focus();
            }, 100);
          }
        });
      }
      if (availableRentCheckbox && priceRentInput && depositFieldDiv && depositInput) {
        availableRentCheckbox.addEventListener("change", function (event) {
          priceRentInput.disabled = !event.target.checked;
          if (event.target.checked) {
            depositFieldDiv.classList.remove("hidden");
            setTimeout(function () {
              return priceRentInput.focus();
            }, 100);
          } else {
            depositFieldDiv.classList.add("hidden");
            priceRentInput.value = "";
            depositInput.value = "";
          }
        });
      }
    }
  }, {
    key: "removeEventListeners",
    value: function removeEventListeners() {
      var addItemForm = this.querySelector("#add-item-form");
      if (addItemForm) {
        addItemForm.removeEventListener("submit", this.handleAddItem);
      }
      var itemListDiv = this.querySelector("#user-items-list");
      if (itemListDiv) {
        itemListDiv.removeEventListener("click", this.handleItemActions);
      }
      var editItemForm = this.querySelector("#edit-item-form");
      if (editItemForm) {
        editItemForm.removeEventListener("submit", this.handleUpdateItem);
      }
      var cancelEditButton = this.querySelector("#cancel-edit-button");
      if (cancelEditButton) {
        cancelEditButton.removeEventListener("click", this.hideEditForm.bind(this));
      }
      this.removeEventListener("click", this.handlePaginationClick);
    }
  }, {
    key: "showAddForm",
    value: function showAddForm() {
      this.querySelector("#add-item-section").classList.remove("hidden");
      this.querySelector("#edit-item-section").classList.add("hidden");
      var addItemForm = this.querySelector("#add-item-form");
      if (addItemForm) addItemForm.reset();

      // Reset form state
      var priceSellInput = this.querySelector("#item-price-sell");
      var priceRentInput = this.querySelector("#item-price-rent");
      var depositField = this.querySelector("#deposit-field");
      if (priceSellInput) priceSellInput.disabled = true;
      if (priceRentInput) priceRentInput.disabled = true;
      if (depositField) depositField.classList.add("hidden");
      this.editingItemId = null;
    }
  }, {
    key: "showEditForm",
    value: function showEditForm() {
      var _this6 = this;
      this.querySelector("#add-item-section").classList.add("hidden");
      var editSection = this.querySelector("#edit-item-section");
      editSection.classList.remove("hidden");

      // Tunggu DOM berubah dan terlihat
      setTimeout(/*#__PURE__*/my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee8() {
        var mapContainer, _this6$user, _document$getElementB, _this6$editingItemDat, _this6$editingItemDat2;
        return my_items_page_regeneratorRuntime().wrap(function _callee8$(_context8) {
          while (1) switch (_context8.prev = _context8.next) {
            case 0:
              mapContainer = document.getElementById('edit-item-map');
              if (!(mapContainer && mapContainer.offsetParent !== null)) {
                _context8.next = 13;
                break;
              }
              if (!(_this6.editItemMap && (_this6$user = _this6.user) !== null && _this6$user !== void 0 && _this6$user.province_name)) {
                _context8.next = 13;
                break;
              }
              _context8.prev = 3;
              _context8.next = 6;
              return _this6.editItemMap.initializeMap(_this6.user.province_name, _this6.user.city_name);
            case 6:
              console.log("Apakah #edit-item-map visible?", ((_document$getElementB = document.getElementById("edit-item-map")) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.offsetParent) !== null);
              if ((_this6$editingItemDat = _this6.editingItemData) !== null && _this6$editingItemDat !== void 0 && _this6$editingItemDat.latitude && (_this6$editingItemDat2 = _this6.editingItemData) !== null && _this6$editingItemDat2 !== void 0 && _this6$editingItemDat2.longitude) {
                _this6.editItemMap.setMarker(_this6.editingItemData.latitude, _this6.editingItemData.longitude);
              }
              _context8.next = 13;
              break;
            case 10:
              _context8.prev = 10;
              _context8.t0 = _context8["catch"](3);
              console.error('Error initializing edit map:', _context8.t0);
            case 13:
            case "end":
              return _context8.stop();
          }
        }, _callee8, null, [[3, 10]]);
      })), 1000); // beri delay cukup agar DOM benar-benar updated
    }
  }, {
    key: "hideEditForm",
    value: function hideEditForm() {
      this.showAddForm();
    }
  }, {
    key: "fetchUserItems",
    value: function () {
      var _fetchUserItems = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee9() {
        var user, userId, queryParams, queryString, result;
        return my_items_page_regeneratorRuntime().wrap(function _callee9$(_context9) {
          while (1) switch (_context9.prev = _context9.next) {
            case 0:
              this.isLoading = true;
              this.error = null;
              this.render();
              _context9.prev = 3;
              user = localStorage.getItem("user");
              if (user) {
                _context9.next = 11;
                break;
              }
              console.error("User not found in localStorage. Cannot fetch items.");
              this.items = [];
              this.isLoading = false;
              this.render();
              return _context9.abrupt("return");
            case 11:
              userId = JSON.parse(user).id; // Add pagination parameters
              queryParams = {
                user_id: userId,
                limit: this.pagination.limit,
                page: this.pagination.page
              };
              queryString = Object.keys(queryParams).map(function (key) {
                return "".concat(encodeURIComponent(key), "=").concat(encodeURIComponent(queryParams[key]));
              }).join("&");
              _context9.next = 16;
              return apiGet("/items?".concat(queryString));
            case 16:
              result = _context9.sent;
              if (result.status === "success") {
                this.items = Array.isArray(result.data) ? result.data : [];

                // Update pagination info from API response
                if (result.pagination) {
                  this.pagination = {
                    total: result.pagination.total || 0,
                    page: result.pagination.page || 1,
                    limit: result.pagination.limit || 10,
                    totalPages: result.pagination.totalPages || 1
                  };
                }
                this.isLoading = false;
                this.error = null;
              } else {
                console.error("Failed to fetch user items:", result.message);
                this.items = [];
                this.error = result.message || "Gagal memuat item.";
                this.isLoading = false;
              }
              _context9.next = 26;
              break;
            case 20:
              _context9.prev = 20;
              _context9.t0 = _context9["catch"](3);
              console.error("Error fetching user items:", _context9.t0);
              this.items = [];
              this.error = _context9.t0.message || "Terjadi kesalahan saat memuat item.";
              this.isLoading = false;
            case 26:
              _context9.prev = 26;
              this.render();
              return _context9.finish(26);
            case 29:
            case "end":
              return _context9.stop();
          }
        }, _callee9, this, [[3, 20, 26, 29]]);
      }));
      function fetchUserItems() {
        return _fetchUserItems.apply(this, arguments);
      }
      return fetchUserItems;
    }()
  }, {
    key: "renderUserItems",
    value: function renderUserItems(items) {
      // This method is now replaced by renderItemsList() which is called in render()
      // Keeping for backward compatibility but it's no longer used
      console.warn("renderUserItems is deprecated, use renderItemsList instead");
    }
  }, {
    key: "handleItemActions",
    value: function handleItemActions(event) {
      var target = event.target.closest("button");
      if (!target) return;

      // Cek apakah button disabled
      if (target.disabled) {
        return;
      }
      if (target.classList.contains("edit-item-button")) {
        var itemId = target.dataset.itemId;
        if (itemId) {
          this.handleEditItem(itemId);
        }
      }
      if (target.classList.contains("delete-item-button")) {
        var _itemId = target.dataset.itemId;
        if (_itemId) {
          this.handleDeleteItem(_itemId);
        }
      }
    }
  }, {
    key: "handleEditItem",
    value: function () {
      var _handleEditItem = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee10(itemId) {
        var apiResult, confirmation;
        return my_items_page_regeneratorRuntime().wrap(function _callee10$(_context10) {
          while (1) switch (_context10.prev = _context10.next) {
            case 0:
              this.editingItemId = itemId;
              _context10.prev = 1;
              _context10.next = 4;
              return apiGet("/items/".concat(itemId));
            case 4:
              apiResult = _context10.sent;
              if (!(apiResult.status === "success")) {
                _context10.next = 18;
                break;
              }
              this.editingItemData = apiResult.data;

              // Cek apakah item bisa diedit
              if (this.canEditOrDelete(this.editingItemData)) {
                _context10.next = 12;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'warning',
                title: 'Tidak Dapat Diedit',
                text: 'Item ini tidak dapat diedit karena sudah sold atau rented.',
                confirmButtonColor: '#f59e0b'
              });
              this.editingItemId = null;
              this.editingItemData = null;
              return _context10.abrupt("return");
            case 12:
              _context10.next = 14;
              return sweetalert2_all_default().fire({
                title: 'Edit Item',
                text: "Apakah Anda yakin ingin mengedit item \"".concat(this.editingItemData.name, "\"?"),
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Edit',
                cancelButtonText: 'Batal'
              });
            case 14:
              confirmation = _context10.sent;
              if (confirmation.isConfirmed) {
                this.showEditForm();
                this.populateEditForm(this.editingItemData);
              } else {
                this.editingItemId = null;
                this.editingItemData = null;
              }
              _context10.next = 22;
              break;
            case 18:
              console.error("Failed to fetch item details for editing:", apiResult.message);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal Mengambil Data',
                text: "Gagal mengambil detail item untuk diedit: " + apiResult.message,
                confirmButtonColor: '#ef4444'
              });
              this.editingItemId = null;
              this.editingItemData = null;
            case 22:
              _context10.next = 30;
              break;
            case 24:
              _context10.prev = 24;
              _context10.t0 = _context10["catch"](1);
              console.error("Error fetching item details for editing:", _context10.t0);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Terjadi Kesalahan',
                text: 'Terjadi kesalahan saat mengambil detail item.',
                confirmButtonColor: '#ef4444'
              });
              this.editingItemId = null;
              this.editingItemData = null;
            case 30:
            case "end":
              return _context10.stop();
          }
        }, _callee10, this, [[1, 24]]);
      }));
      function handleEditItem(_x3) {
        return _handleEditItem.apply(this, arguments);
      }
      return handleEditItem;
    }()
  }, {
    key: "populateEditForm",
    value: function () {
      var _populateEditForm = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee11(item) {
        var form, editingItemNameSpan, statusSelect, normalizedStatus, availableSellCheckbox, availableRentCheckbox, priceSellInput, priceRentInput, depositFieldDiv, depositInput, editLatInput, editLngInput;
        return my_items_page_regeneratorRuntime().wrap(function _callee11$(_context11) {
          while (1) switch (_context11.prev = _context11.next) {
            case 0:
              form = this.querySelector("#edit-item-form");
              if (!(!form || !item)) {
                _context11.next = 3;
                break;
              }
              return _context11.abrupt("return");
            case 3:
              form.querySelector("#edit-item-name").value = item.name || "";
              editingItemNameSpan = this.querySelector("#editing-item-name");
              if (editingItemNameSpan) {
                editingItemNameSpan.textContent = item.name || "";
              }
              form.querySelector("#edit-item-category").value = item.category_id || "";
              form.querySelector("#edit-item-description").value = item.description || "";
              form.querySelector("#edit-item-price-sell").value = item.price_sell || "";
              form.querySelector("#edit-item-price-rent").value = item.price_rent || "";

              // Set status
              statusSelect = form.querySelector("#edit-item-status");
              if (statusSelect) {
                normalizedStatus = this.getItemStatus(item);
                statusSelect.value = normalizedStatus;
              }
              availableSellCheckbox = form.querySelector("#edit-item-available-sell");
              availableRentCheckbox = form.querySelector("#edit-item-available-rent");
              priceSellInput = this.querySelector("#edit-item-price-sell");
              priceRentInput = this.querySelector("#edit-item-price-rent");
              availableSellCheckbox.checked = item.is_available_for_sell === 1 || item.is_available_for_sell === true;
              availableRentCheckbox.checked = item.is_available_for_rent === 1 || item.is_available_for_rent === true;
              priceSellInput.disabled = !availableSellCheckbox.checked;
              priceRentInput.disabled = !availableRentCheckbox.checked;
              depositFieldDiv = this.querySelector("#edit-deposit-field");
              depositInput = form.querySelector("#edit-item-deposit");
              if (item.is_available_for_rent === 1 || item.is_available_for_rent === true) {
                if (depositFieldDiv) depositFieldDiv.classList.remove("hidden");
                if (depositInput) depositInput.value = item.deposit_amount || "";
              } else {
                if (depositFieldDiv) depositFieldDiv.classList.add("hidden");
                if (depositInput) depositInput.value = "";
              }

              // Set coordinates if available
              if (item.latitude && item.longitude) {
                editLatInput = form.querySelector("#edit-latitude");
                editLngInput = form.querySelector("#edit-longitude");
                if (editLatInput) editLatInput.value = item.latitude;
                if (editLngInput) editLngInput.value = item.longitude;
                this.editSelectedLocation = {
                  lat: item.latitude,
                  lng: item.longitude
                };
              }

              // Setup status change listener untuk validasi availability
              if (statusSelect) {
                statusSelect.addEventListener("change", function (event) {
                  var newStatus = event.target.value;

                  // Jika status berubah ke rented, disable checkbox jual
                  if (newStatus === "rented") {
                    availableSellCheckbox.disabled = true;
                    availableSellCheckbox.checked = false;
                    priceSellInput.disabled = true;
                    priceSellInput.value = "";
                  } else {
                    availableSellCheckbox.disabled = false;
                  }
                });
              }
            case 25:
            case "end":
              return _context11.stop();
          }
        }, _callee11, this);
      }));
      function populateEditForm(_x4) {
        return _populateEditForm.apply(this, arguments);
      }
      return populateEditForm;
    }()
  }, {
    key: "handleDeleteItem",
    value: function () {
      var _handleDeleteItem = my_items_page_asyncToGenerator(/*#__PURE__*/my_items_page_regeneratorRuntime().mark(function _callee12(itemId) {
        var result, deleteResult;
        return my_items_page_regeneratorRuntime().wrap(function _callee12$(_context12) {
          while (1) switch (_context12.prev = _context12.next) {
            case 0:
              _context12.prev = 0;
              _context12.next = 3;
              return sweetalert2_all_default().fire({
                title: 'Hapus Item',
                text: "Apakah Anda yakin ingin menghapus item ini?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Hapus',
                cancelButtonText: 'Batal'
              });
            case 3:
              result = _context12.sent;
              if (!result.isConfirmed) {
                _context12.next = 25;
                break;
              }
              _context12.next = 7;
              return apiDelete("/items/".concat(itemId));
            case 7:
              deleteResult = _context12.sent;
              if (!(deleteResult.status === "success")) {
                _context12.next = 23;
                break;
              }
              sweetalert2_all_default().fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Item berhasil dihapus!',
                confirmButtonColor: '#10b981'
              });
              _context12.prev = 10;
              _context12.next = 13;
              return fetch("https://exml.pinjemin.site/api/refresh_data", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({})
              });
            case 13:
              _context12.next = 15;
              return new Promise(function (resolve) {
                return setTimeout(resolve, 2000);
              });
            case 15:
              _context12.next = 20;
              break;
            case 17:
              _context12.prev = 17;
              _context12.t0 = _context12["catch"](10);
              console.warn("Failed to trigger ML backend data refresh:", _context12.t0);
            case 20:
              this.fetchUserItems();
              _context12.next = 25;
              break;
            case 23:
              console.error("Failed to delete item:", deleteResult.message);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Gagal Menghapus Item',
                text: "Gagal menghapus item: " + deleteResult.message,
                confirmButtonColor: '#ef4444'
              });
            case 25:
              _context12.next = 31;
              break;
            case 27:
              _context12.prev = 27;
              _context12.t1 = _context12["catch"](0);
              console.error("Error deleting item:", _context12.t1);
              sweetalert2_all_default().fire({
                icon: 'error',
                title: 'Terjadi Kesalahan',
                text: 'Terjadi kesalahan saat menghapus item. Silakan coba lagi.',
                confirmButtonColor: '#ef4444'
              });
            case 31:
            case "end":
              return _context12.stop();
          }
        }, _callee12, this, [[0, 27], [10, 17]]);
      }));
      function handleDeleteItem(_x5) {
        return _handleDeleteItem.apply(this, arguments);
      }
      return handleDeleteItem;
    }()
  }]);
}(/*#__PURE__*/my_items_page_wrapNativeSuper(HTMLElement));
customElements.define("my-items-page", MyItemsPage);
;// ./user/src/script/components/transaction/my-transactions-page.js
function my_transactions_page_typeof(o) { "@babel/helpers - typeof"; return my_transactions_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, my_transactions_page_typeof(o); }
function my_transactions_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ my_transactions_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == my_transactions_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(my_transactions_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function my_transactions_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function my_transactions_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { my_transactions_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { my_transactions_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function my_transactions_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function my_transactions_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, my_transactions_page_toPropertyKey(o.key), o); } }
function my_transactions_page_createClass(e, r, t) { return r && my_transactions_page_defineProperties(e.prototype, r), t && my_transactions_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function my_transactions_page_toPropertyKey(t) { var i = my_transactions_page_toPrimitive(t, "string"); return "symbol" == my_transactions_page_typeof(i) ? i : i + ""; }
function my_transactions_page_toPrimitive(t, r) { if ("object" != my_transactions_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != my_transactions_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function my_transactions_page_callSuper(t, o, e) { return o = my_transactions_page_getPrototypeOf(o), my_transactions_page_possibleConstructorReturn(t, my_transactions_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], my_transactions_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function my_transactions_page_possibleConstructorReturn(t, e) { if (e && ("object" == my_transactions_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return my_transactions_page_assertThisInitialized(t); }
function my_transactions_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function my_transactions_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && my_transactions_page_setPrototypeOf(t, e); }
function my_transactions_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return my_transactions_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !my_transactions_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return my_transactions_page_construct(t, arguments, my_transactions_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), my_transactions_page_setPrototypeOf(Wrapper, t); }, my_transactions_page_wrapNativeSuper(t); }
function my_transactions_page_construct(t, e, r) { if (my_transactions_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && my_transactions_page_setPrototypeOf(p, r.prototype), p; }
function my_transactions_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (my_transactions_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function my_transactions_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function my_transactions_page_setPrototypeOf(t, e) { return my_transactions_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, my_transactions_page_setPrototypeOf(t, e); }
function my_transactions_page_getPrototypeOf(t) { return my_transactions_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, my_transactions_page_getPrototypeOf(t); }

 // Assuming Utils has isAuthenticated and redirectToLogin
var MyTransactionsPage = /*#__PURE__*/function (_HTMLElement) {
  function MyTransactionsPage() {
    var _this;
    my_transactions_page_classCallCheck(this, MyTransactionsPage);
    _this = my_transactions_page_callSuper(this, MyTransactionsPage);
    // State to hold transaction data
    _this.transactions = [];
    _this.transactionType = null; // 'buy' or 'rent', determined from URL
    return _this;
  }
  my_transactions_page_inherits(MyTransactionsPage, _HTMLElement);
  return my_transactions_page_createClass(MyTransactionsPage, [{
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }
  }, {
    key: "connectedCallback",
    value: function connectedCallback() {
      // Check login status - crucial for authenticated pages
      if (!utils.isAuthenticated()) {
        alert('Anda harus login untuk melihat halaman ini.');
        utils.redirectToLogin(); // Redirect if not logged in
        return; // Stop further execution
      }
      this._emptyContent(); // Clear initial content
      this.transactionType = this.getTransactionTypeFromUrl();
      this.renderLayout(); // Render basic layout first
      this.fetchTransactions(this.transactionType); // Fetch transactions based on type
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {}
  }, {
    key: "getTransactionTypeFromUrl",
    value: function getTransactionTypeFromUrl() {
      var hash = window.location.hash;
      if (hash.includes('/my-rentals')) {
        return 'rent';
      } else if (hash.includes('/my-transactions')) {
        return 'buy';
      }
      return null;
    }
  }, {
    key: "renderLayout",
    value: function renderLayout() {
      var pageTitle = this.transactionType === 'rent' ? 'Pinjaman Saya' : 'Transaksi Pembelian Saya';
      this.innerHTML = "\n            <div class=\"container mx-auto px-4 py-8\">\n                <h1 class=\"text-2xl font-bold mb-6\">".concat(pageTitle, "</h1>\n\n                <!-- Transaction List Area -->\n                <div id=\"transactions-list\">\n                    <p>Memuat transaksi...</p>\n                </div>\n\n                <!-- TODO: Add Pagination here if needed -->\n            </div>\n        ");
    }
  }, {
    key: "renderTransactions",
    value: function renderTransactions() {
      var transactionsListElement = this.querySelector('#transactions-list');
      if (!transactionsListElement) {
        console.error('Transactions list element not found!');
        return;
      }
      transactionsListElement.innerHTML = ''; // Bersihkan daftar sebelumnya

      if (this.transactions.length === 0) {
        // Added font-poppins and text-gray-700 for consistency
        transactionsListElement.innerHTML = "<p class=\"text-gray-700 font-poppins\">Anda belum memiliki ".concat(this.transactionType === 'rent' ? 'pinjaman' : 'transaksi pembelian', " apapun.</p>");
        return;
      }

      // Added space-y-4 for spacing between transaction cards
      transactionsListElement.innerHTML = "\n        <style>\n            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');\n            \n            * {\n                font-family: 'Poppins', sans-serif;\n            }\n        </style>\n             <div class=\"space-y-4\">\n                ".concat(this.transactions.map(function (transaction) {
        return "\n                    <!-- Card Container for each transaction item -->\n                    <!-- Added modern card styling: bg-white, p-6, rounded-lg, shadow-md, text-gray-800 for default text -->\n                    <div class=\"p-6 bg-white rounded-lg shadow-md text-gray-800\">\n                        <!-- Flex container for content and actions -->\n                        <div class=\"flex flex-col md:flex-row justify-between items-start md:items-center flex-wrap\">\n                            <!-- Transaction Details Area -->\n                            <div class=\"flex-1 min-w-0 mr-0 md:mr-4 mb-4 md:mb-0\">\n                                <h3 class=\"text-lg font-poppins font-bold mb-2\">".concat(transaction.item_name || 'Nama Item Tidak Diketahui', "</h3>\n                                <!-- Transaction Details: Font Open Sans -->\n                                <p class=\"text-sm text-gray-700 font-poppins\">Tipe: <span class=\"capitalize\">").concat(transaction.type, "</span></p>\n                                <p class=\"text-sm text-gray-700 font-poppins\">Status: <span class=\"capitalize\">").concat(transaction.status, "</span></p>\n                                <p class=\"text-sm font-semibold text-gray-800 font-poppins\">Total Harga: Rp ").concat(transaction.total_price ? parseFloat(transaction.total_price).toLocaleString('id-ID') : 'N/A', "</p>\n                                ").concat(transaction.type === 'rent' ? "\n                                    <p class=\"text-sm text-gray-700 font-poppins\">Tanggal Sewa: ".concat(transaction.rent_start_date ? new Date(transaction.rent_start_date).toLocaleDateString('id-ID') : '-', " - ").concat(transaction.rent_end_date ? new Date(transaction.rent_end_date).toLocaleDateString('id-ID') : '-', "</p>\n                                    <p class=\"text-sm text-gray-700 font-poppins\">Deposit Dibayar: Rp ").concat(transaction.deposit_paid ? parseFloat(transaction.deposit_paid).toLocaleString('id-ID') : '0', "</p>\n                                ") : '', "\n                                <p class=\"text-sm text-gray-700 font-poppins\">Tanggal Transaksi: ").concat(transaction.created_at ? new Date(transaction.created_at).toLocaleDateString('id-ID') : '-', "</p>\n                                <!-- Add more details as needed -->\n                            </div>\n                            <!-- Action Buttons Area -->\n                            <div class=\"flex flex-wrap gap-2\">\n                                <!-- Detail Button: Styled like primary button -->\n                               <a href=\"/#/transactions/").concat(transaction.id, "\" class=\"bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded-md font-semibold inline-block text-center font-poppins\">Detail</a>\n\n                               ").concat(transaction.status === 'completed' ? "\n                                    <!-- Review Button: Styled like secondary/success button -->\n                                     <a href=\"/#/items/".concat(transaction.item_id, "#review\" class=\"bg-green-600 hover:bg-green-700 text-white text-sm px-4 py-2 rounded-md font-semibold inline-block text-center font-poppins\">\n                                         Beri Review\n                                     </a>\n                                 ") : '', "\n                            </div>\n                        </div>\n                    </div>\n                ");
      }).join(''), "\n             </div>\n        ");
    }

    // Method to fetch transactions from the backend API
  }, {
    key: "fetchTransactions",
    value: function () {
      var _fetchTransactions = my_transactions_page_asyncToGenerator(/*#__PURE__*/my_transactions_page_regeneratorRuntime().mark(function _callee(type) {
        var queryParams, response, transactionsListElement, _transactionsListElement, errorMessage;
        return my_transactions_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.prev = 0;
              // Construct query parameters if type is specified
              queryParams = type ? "?type=".concat(type) : ''; // Use authenticatedRequest as this endpoint requires authentication
              _context.next = 4;
              return authenticatedRequest("/transactions".concat(queryParams));
            case 4:
              response = _context.sent;
              if (response.status === 'success' && response.data) {
                console.log('Fetched transactions:', response.data);
                // Assuming response.data is the array of transactions
                this.transactions = Array.isArray(response.data) ? response.data : []; // Ensure it's an array
                this.renderTransactions(); // Render the list once data is fetched
              } else {
                console.error('Error fetching transactions:', response.message || 'Unknown error', response);
                // Display error message to the user
                transactionsListElement = this.querySelector('#transactions-list');
                if (transactionsListElement) {
                  transactionsListElement.innerHTML = "<p class=\"text-red-500\">Gagal memuat daftar transaksi: ".concat(response.message || 'Terjadi kesalahan', "</p>");
                }
              }
              _context.next = 13;
              break;
            case 8:
              _context.prev = 8;
              _context.t0 = _context["catch"](0);
              console.error('Error during API request:', _context.t0);
              // Display error message to the user
              _transactionsListElement = this.querySelector('#transactions-list');
              if (_transactionsListElement) {
                // Check if error has a message property
                errorMessage = _context.t0.message || 'Terjadi kesalahan tidak diketahui';
                _transactionsListElement.innerHTML = "<p class=\"text-red-500\">Terjadi kesalahan saat memuat transaksi: ".concat(errorMessage, "</p>");
              }
            case 13:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[0, 8]]);
      }));
      function fetchTransactions(_x) {
        return _fetchTransactions.apply(this, arguments);
      }
      return fetchTransactions;
    }()
  }]);
}(/*#__PURE__*/my_transactions_page_wrapNativeSuper(HTMLElement));
customElements.define('my-transactions-page', MyTransactionsPage);
;// ./node_modules/engine.io-parser/build/esm/commons.js
const PACKET_TYPES = Object.create(null); // no Map = no polyfill
PACKET_TYPES["open"] = "0";
PACKET_TYPES["close"] = "1";
PACKET_TYPES["ping"] = "2";
PACKET_TYPES["pong"] = "3";
PACKET_TYPES["message"] = "4";
PACKET_TYPES["upgrade"] = "5";
PACKET_TYPES["noop"] = "6";
const PACKET_TYPES_REVERSE = Object.create(null);
Object.keys(PACKET_TYPES).forEach((key) => {
    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;
});
const ERROR_PACKET = { type: "error", data: "parser error" };


;// ./node_modules/engine.io-parser/build/esm/encodePacket.browser.js

const withNativeBlob = typeof Blob === "function" ||
    (typeof Blob !== "undefined" &&
        Object.prototype.toString.call(Blob) === "[object BlobConstructor]");
const withNativeArrayBuffer = typeof ArrayBuffer === "function";
// ArrayBuffer.isView method is not defined in IE10
const isView = (obj) => {
    return typeof ArrayBuffer.isView === "function"
        ? ArrayBuffer.isView(obj)
        : obj && obj.buffer instanceof ArrayBuffer;
};
const encodePacket = ({ type, data }, supportsBinary, callback) => {
    if (withNativeBlob && data instanceof Blob) {
        if (supportsBinary) {
            return callback(data);
        }
        else {
            return encodeBlobAsBase64(data, callback);
        }
    }
    else if (withNativeArrayBuffer &&
        (data instanceof ArrayBuffer || isView(data))) {
        if (supportsBinary) {
            return callback(data);
        }
        else {
            return encodeBlobAsBase64(new Blob([data]), callback);
        }
    }
    // plain string
    return callback(PACKET_TYPES[type] + (data || ""));
};
const encodeBlobAsBase64 = (data, callback) => {
    const fileReader = new FileReader();
    fileReader.onload = function () {
        const content = fileReader.result.split(",")[1];
        callback("b" + (content || ""));
    };
    return fileReader.readAsDataURL(data);
};
function toArray(data) {
    if (data instanceof Uint8Array) {
        return data;
    }
    else if (data instanceof ArrayBuffer) {
        return new Uint8Array(data);
    }
    else {
        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);
    }
}
let TEXT_ENCODER;
function encodePacketToBinary(packet, callback) {
    if (withNativeBlob && packet.data instanceof Blob) {
        return packet.data.arrayBuffer().then(toArray).then(callback);
    }
    else if (withNativeArrayBuffer &&
        (packet.data instanceof ArrayBuffer || isView(packet.data))) {
        return callback(toArray(packet.data));
    }
    encodePacket(packet, false, (encoded) => {
        if (!TEXT_ENCODER) {
            TEXT_ENCODER = new TextEncoder();
        }
        callback(TEXT_ENCODER.encode(encoded));
    });
}


;// ./node_modules/engine.io-parser/build/esm/contrib/base64-arraybuffer.js
// imported from https://github.com/socketio/base64-arraybuffer
const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
// Use a lookup table to find the index.
const lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);
for (let i = 0; i < chars.length; i++) {
    lookup[chars.charCodeAt(i)] = i;
}
const encode = (arraybuffer) => {
    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';
    for (i = 0; i < len; i += 3) {
        base64 += chars[bytes[i] >> 2];
        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];
        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];
        base64 += chars[bytes[i + 2] & 63];
    }
    if (len % 3 === 2) {
        base64 = base64.substring(0, base64.length - 1) + '=';
    }
    else if (len % 3 === 1) {
        base64 = base64.substring(0, base64.length - 2) + '==';
    }
    return base64;
};
const decode = (base64) => {
    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;
    if (base64[base64.length - 1] === '=') {
        bufferLength--;
        if (base64[base64.length - 2] === '=') {
            bufferLength--;
        }
    }
    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);
    for (i = 0; i < len; i += 4) {
        encoded1 = lookup[base64.charCodeAt(i)];
        encoded2 = lookup[base64.charCodeAt(i + 1)];
        encoded3 = lookup[base64.charCodeAt(i + 2)];
        encoded4 = lookup[base64.charCodeAt(i + 3)];
        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);
        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);
        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);
    }
    return arraybuffer;
};

;// ./node_modules/engine.io-parser/build/esm/decodePacket.browser.js


const decodePacket_browser_withNativeArrayBuffer = typeof ArrayBuffer === "function";
const decodePacket = (encodedPacket, binaryType) => {
    if (typeof encodedPacket !== "string") {
        return {
            type: "message",
            data: mapBinary(encodedPacket, binaryType),
        };
    }
    const type = encodedPacket.charAt(0);
    if (type === "b") {
        return {
            type: "message",
            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),
        };
    }
    const packetType = PACKET_TYPES_REVERSE[type];
    if (!packetType) {
        return ERROR_PACKET;
    }
    return encodedPacket.length > 1
        ? {
            type: PACKET_TYPES_REVERSE[type],
            data: encodedPacket.substring(1),
        }
        : {
            type: PACKET_TYPES_REVERSE[type],
        };
};
const decodeBase64Packet = (data, binaryType) => {
    if (decodePacket_browser_withNativeArrayBuffer) {
        const decoded = decode(data);
        return mapBinary(decoded, binaryType);
    }
    else {
        return { base64: true, data }; // fallback for old browsers
    }
};
const mapBinary = (data, binaryType) => {
    switch (binaryType) {
        case "blob":
            if (data instanceof Blob) {
                // from WebSocket + binaryType "blob"
                return data;
            }
            else {
                // from HTTP long-polling or WebTransport
                return new Blob([data]);
            }
        case "arraybuffer":
        default:
            if (data instanceof ArrayBuffer) {
                // from HTTP long-polling (base64) or WebSocket + binaryType "arraybuffer"
                return data;
            }
            else {
                // from WebTransport (Uint8Array)
                return data.buffer;
            }
    }
};

;// ./node_modules/engine.io-parser/build/esm/index.js



const SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text
const encodePayload = (packets, callback) => {
    // some packets may be added to the array while encoding, so the initial length must be saved
    const length = packets.length;
    const encodedPackets = new Array(length);
    let count = 0;
    packets.forEach((packet, i) => {
        // force base64 encoding for binary packets
        encodePacket(packet, false, (encodedPacket) => {
            encodedPackets[i] = encodedPacket;
            if (++count === length) {
                callback(encodedPackets.join(SEPARATOR));
            }
        });
    });
};
const decodePayload = (encodedPayload, binaryType) => {
    const encodedPackets = encodedPayload.split(SEPARATOR);
    const packets = [];
    for (let i = 0; i < encodedPackets.length; i++) {
        const decodedPacket = decodePacket(encodedPackets[i], binaryType);
        packets.push(decodedPacket);
        if (decodedPacket.type === "error") {
            break;
        }
    }
    return packets;
};
function createPacketEncoderStream() {
    return new TransformStream({
        transform(packet, controller) {
            encodePacketToBinary(packet, (encodedPacket) => {
                const payloadLength = encodedPacket.length;
                let header;
                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length
                if (payloadLength < 126) {
                    header = new Uint8Array(1);
                    new DataView(header.buffer).setUint8(0, payloadLength);
                }
                else if (payloadLength < 65536) {
                    header = new Uint8Array(3);
                    const view = new DataView(header.buffer);
                    view.setUint8(0, 126);
                    view.setUint16(1, payloadLength);
                }
                else {
                    header = new Uint8Array(9);
                    const view = new DataView(header.buffer);
                    view.setUint8(0, 127);
                    view.setBigUint64(1, BigInt(payloadLength));
                }
                // first bit indicates whether the payload is plain text (0) or binary (1)
                if (packet.data && typeof packet.data !== "string") {
                    header[0] |= 0x80;
                }
                controller.enqueue(header);
                controller.enqueue(encodedPacket);
            });
        },
    });
}
let TEXT_DECODER;
function totalLength(chunks) {
    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);
}
function concatChunks(chunks, size) {
    if (chunks[0].length === size) {
        return chunks.shift();
    }
    const buffer = new Uint8Array(size);
    let j = 0;
    for (let i = 0; i < size; i++) {
        buffer[i] = chunks[0][j++];
        if (j === chunks[0].length) {
            chunks.shift();
            j = 0;
        }
    }
    if (chunks.length && j < chunks[0].length) {
        chunks[0] = chunks[0].slice(j);
    }
    return buffer;
}
function createPacketDecoderStream(maxPayload, binaryType) {
    if (!TEXT_DECODER) {
        TEXT_DECODER = new TextDecoder();
    }
    const chunks = [];
    let state = 0 /* State.READ_HEADER */;
    let expectedLength = -1;
    let isBinary = false;
    return new TransformStream({
        transform(chunk, controller) {
            chunks.push(chunk);
            while (true) {
                if (state === 0 /* State.READ_HEADER */) {
                    if (totalLength(chunks) < 1) {
                        break;
                    }
                    const header = concatChunks(chunks, 1);
                    isBinary = (header[0] & 0x80) === 0x80;
                    expectedLength = header[0] & 0x7f;
                    if (expectedLength < 126) {
                        state = 3 /* State.READ_PAYLOAD */;
                    }
                    else if (expectedLength === 126) {
                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;
                    }
                    else {
                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;
                    }
                }
                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {
                    if (totalLength(chunks) < 2) {
                        break;
                    }
                    const headerArray = concatChunks(chunks, 2);
                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);
                    state = 3 /* State.READ_PAYLOAD */;
                }
                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {
                    if (totalLength(chunks) < 8) {
                        break;
                    }
                    const headerArray = concatChunks(chunks, 8);
                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);
                    const n = view.getUint32(0);
                    if (n > Math.pow(2, 53 - 32) - 1) {
                        // the maximum safe integer in JavaScript is 2^53 - 1
                        controller.enqueue(ERROR_PACKET);
                        break;
                    }
                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);
                    state = 3 /* State.READ_PAYLOAD */;
                }
                else {
                    if (totalLength(chunks) < expectedLength) {
                        break;
                    }
                    const data = concatChunks(chunks, expectedLength);
                    controller.enqueue(decodePacket(isBinary ? data : TEXT_DECODER.decode(data), binaryType));
                    state = 0 /* State.READ_HEADER */;
                }
                if (expectedLength === 0 || expectedLength > maxPayload) {
                    controller.enqueue(ERROR_PACKET);
                    break;
                }
            }
        },
    });
}
const protocol = 4;


;// ./node_modules/@socket.io/component-emitter/lib/esm/index.js
/**
 * Initialize a new `Emitter`.
 *
 * @api public
 */

function Emitter(obj) {
  if (obj) return mixin(obj);
}

/**
 * Mixin the emitter properties.
 *
 * @param {Object} obj
 * @return {Object}
 * @api private
 */

function mixin(obj) {
  for (var key in Emitter.prototype) {
    obj[key] = Emitter.prototype[key];
  }
  return obj;
}

/**
 * Listen on the given `event` with `fn`.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.on =
Emitter.prototype.addEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};
  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])
    .push(fn);
  return this;
};

/**
 * Adds an `event` listener that will be invoked a single
 * time then automatically removed.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.once = function(event, fn){
  function on() {
    this.off(event, on);
    fn.apply(this, arguments);
  }

  on.fn = fn;
  this.on(event, on);
  return this;
};

/**
 * Remove the given callback for `event` or all
 * registered callbacks.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.off =
Emitter.prototype.removeListener =
Emitter.prototype.removeAllListeners =
Emitter.prototype.removeEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};

  // all
  if (0 == arguments.length) {
    this._callbacks = {};
    return this;
  }

  // specific event
  var callbacks = this._callbacks['$' + event];
  if (!callbacks) return this;

  // remove all handlers
  if (1 == arguments.length) {
    delete this._callbacks['$' + event];
    return this;
  }

  // remove specific handler
  var cb;
  for (var i = 0; i < callbacks.length; i++) {
    cb = callbacks[i];
    if (cb === fn || cb.fn === fn) {
      callbacks.splice(i, 1);
      break;
    }
  }

  // Remove event specific arrays for event types that no
  // one is subscribed for to avoid memory leak.
  if (callbacks.length === 0) {
    delete this._callbacks['$' + event];
  }

  return this;
};

/**
 * Emit `event` with the given args.
 *
 * @param {String} event
 * @param {Mixed} ...
 * @return {Emitter}
 */

Emitter.prototype.emit = function(event){
  this._callbacks = this._callbacks || {};

  var args = new Array(arguments.length - 1)
    , callbacks = this._callbacks['$' + event];

  for (var i = 1; i < arguments.length; i++) {
    args[i - 1] = arguments[i];
  }

  if (callbacks) {
    callbacks = callbacks.slice(0);
    for (var i = 0, len = callbacks.length; i < len; ++i) {
      callbacks[i].apply(this, args);
    }
  }

  return this;
};

// alias used for reserved events (protected method)
Emitter.prototype.emitReserved = Emitter.prototype.emit;

/**
 * Return array of callbacks for `event`.
 *
 * @param {String} event
 * @return {Array}
 * @api public
 */

Emitter.prototype.listeners = function(event){
  this._callbacks = this._callbacks || {};
  return this._callbacks['$' + event] || [];
};

/**
 * Check if this emitter has `event` handlers.
 *
 * @param {String} event
 * @return {Boolean}
 * @api public
 */

Emitter.prototype.hasListeners = function(event){
  return !! this.listeners(event).length;
};

;// ./node_modules/engine.io-client/build/esm/globals.js
const nextTick = (() => {
    const isPromiseAvailable = typeof Promise === "function" && typeof Promise.resolve === "function";
    if (isPromiseAvailable) {
        return (cb) => Promise.resolve().then(cb);
    }
    else {
        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);
    }
})();
const globalThisShim = (() => {
    if (typeof self !== "undefined") {
        return self;
    }
    else if (typeof window !== "undefined") {
        return window;
    }
    else {
        return Function("return this")();
    }
})();
const defaultBinaryType = "arraybuffer";
function createCookieJar() { }

;// ./node_modules/engine.io-client/build/esm/util.js

function pick(obj, ...attr) {
    return attr.reduce((acc, k) => {
        if (obj.hasOwnProperty(k)) {
            acc[k] = obj[k];
        }
        return acc;
    }, {});
}
// Keep a reference to the real timeout functions so they can be used when overridden
const NATIVE_SET_TIMEOUT = globalThisShim.setTimeout;
const NATIVE_CLEAR_TIMEOUT = globalThisShim.clearTimeout;
function installTimerFunctions(obj, opts) {
    if (opts.useNativeTimers) {
        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThisShim);
        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThisShim);
    }
    else {
        obj.setTimeoutFn = globalThisShim.setTimeout.bind(globalThisShim);
        obj.clearTimeoutFn = globalThisShim.clearTimeout.bind(globalThisShim);
    }
}
// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)
const BASE64_OVERHEAD = 1.33;
// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9
function byteLength(obj) {
    if (typeof obj === "string") {
        return utf8Length(obj);
    }
    // arraybuffer or blob
    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);
}
function utf8Length(str) {
    let c = 0, length = 0;
    for (let i = 0, l = str.length; i < l; i++) {
        c = str.charCodeAt(i);
        if (c < 0x80) {
            length += 1;
        }
        else if (c < 0x800) {
            length += 2;
        }
        else if (c < 0xd800 || c >= 0xe000) {
            length += 3;
        }
        else {
            i++;
            length += 4;
        }
    }
    return length;
}
/**
 * Generates a random 8-characters string.
 */
function randomString() {
    return (Date.now().toString(36).substring(3) +
        Math.random().toString(36).substring(2, 5));
}

;// ./node_modules/engine.io-client/build/esm/contrib/parseqs.js
// imported from https://github.com/galkn/querystring
/**
 * Compiles a querystring
 * Returns string representation of the object
 *
 * @param {Object}
 * @api private
 */
function parseqs_encode(obj) {
    let str = '';
    for (let i in obj) {
        if (obj.hasOwnProperty(i)) {
            if (str.length)
                str += '&';
            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);
        }
    }
    return str;
}
/**
 * Parses a simple querystring into an object
 *
 * @param {String} qs
 * @api private
 */
function parseqs_decode(qs) {
    let qry = {};
    let pairs = qs.split('&');
    for (let i = 0, l = pairs.length; i < l; i++) {
        let pair = pairs[i].split('=');
        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
    }
    return qry;
}

;// ./node_modules/engine.io-client/build/esm/transport.js




class TransportError extends Error {
    constructor(reason, description, context) {
        super(reason);
        this.description = description;
        this.context = context;
        this.type = "TransportError";
    }
}
class Transport extends Emitter {
    /**
     * Transport abstract constructor.
     *
     * @param {Object} opts - options
     * @protected
     */
    constructor(opts) {
        super();
        this.writable = false;
        installTimerFunctions(this, opts);
        this.opts = opts;
        this.query = opts.query;
        this.socket = opts.socket;
        this.supportsBinary = !opts.forceBase64;
    }
    /**
     * Emits an error.
     *
     * @param {String} reason
     * @param description
     * @param context - the error context
     * @return {Transport} for chaining
     * @protected
     */
    onError(reason, description, context) {
        super.emitReserved("error", new TransportError(reason, description, context));
        return this;
    }
    /**
     * Opens the transport.
     */
    open() {
        this.readyState = "opening";
        this.doOpen();
        return this;
    }
    /**
     * Closes the transport.
     */
    close() {
        if (this.readyState === "opening" || this.readyState === "open") {
            this.doClose();
            this.onClose();
        }
        return this;
    }
    /**
     * Sends multiple packets.
     *
     * @param {Array} packets
     */
    send(packets) {
        if (this.readyState === "open") {
            this.write(packets);
        }
        else {
            // this might happen if the transport was silently closed in the beforeunload event handler
        }
    }
    /**
     * Called upon open
     *
     * @protected
     */
    onOpen() {
        this.readyState = "open";
        this.writable = true;
        super.emitReserved("open");
    }
    /**
     * Called with data.
     *
     * @param {String} data
     * @protected
     */
    onData(data) {
        const packet = decodePacket(data, this.socket.binaryType);
        this.onPacket(packet);
    }
    /**
     * Called with a decoded packet.
     *
     * @protected
     */
    onPacket(packet) {
        super.emitReserved("packet", packet);
    }
    /**
     * Called upon close.
     *
     * @protected
     */
    onClose(details) {
        this.readyState = "closed";
        super.emitReserved("close", details);
    }
    /**
     * Pauses the transport, in order not to lose packets during an upgrade.
     *
     * @param onPause
     */
    pause(onPause) { }
    createUri(schema, query = {}) {
        return (schema +
            "://" +
            this._hostname() +
            this._port() +
            this.opts.path +
            this._query(query));
    }
    _hostname() {
        const hostname = this.opts.hostname;
        return hostname.indexOf(":") === -1 ? hostname : "[" + hostname + "]";
    }
    _port() {
        if (this.opts.port &&
            ((this.opts.secure && Number(this.opts.port !== 443)) ||
                (!this.opts.secure && Number(this.opts.port) !== 80))) {
            return ":" + this.opts.port;
        }
        else {
            return "";
        }
    }
    _query(query) {
        const encodedQuery = parseqs_encode(query);
        return encodedQuery.length ? "?" + encodedQuery : "";
    }
}

;// ./node_modules/engine.io-client/build/esm/transports/polling.js



class polling_Polling extends Transport {
    constructor() {
        super(...arguments);
        this._polling = false;
    }
    get name() {
        return "polling";
    }
    /**
     * Opens the socket (triggers polling). We write a PING message to determine
     * when the transport is open.
     *
     * @protected
     */
    doOpen() {
        this._poll();
    }
    /**
     * Pauses polling.
     *
     * @param {Function} onPause - callback upon buffers are flushed and transport is paused
     * @package
     */
    pause(onPause) {
        this.readyState = "pausing";
        const pause = () => {
            this.readyState = "paused";
            onPause();
        };
        if (this._polling || !this.writable) {
            let total = 0;
            if (this._polling) {
                total++;
                this.once("pollComplete", function () {
                    --total || pause();
                });
            }
            if (!this.writable) {
                total++;
                this.once("drain", function () {
                    --total || pause();
                });
            }
        }
        else {
            pause();
        }
    }
    /**
     * Starts polling cycle.
     *
     * @private
     */
    _poll() {
        this._polling = true;
        this.doPoll();
        this.emitReserved("poll");
    }
    /**
     * Overloads onData to detect payloads.
     *
     * @protected
     */
    onData(data) {
        const callback = (packet) => {
            // if its the first message we consider the transport open
            if ("opening" === this.readyState && packet.type === "open") {
                this.onOpen();
            }
            // if its a close packet, we close the ongoing requests
            if ("close" === packet.type) {
                this.onClose({ description: "transport closed by the server" });
                return false;
            }
            // otherwise bypass onData and handle the message
            this.onPacket(packet);
        };
        // decode payload
        decodePayload(data, this.socket.binaryType).forEach(callback);
        // if an event did not trigger closing
        if ("closed" !== this.readyState) {
            // if we got data we're not polling
            this._polling = false;
            this.emitReserved("pollComplete");
            if ("open" === this.readyState) {
                this._poll();
            }
            else {
            }
        }
    }
    /**
     * For polling, send a close packet.
     *
     * @protected
     */
    doClose() {
        const close = () => {
            this.write([{ type: "close" }]);
        };
        if ("open" === this.readyState) {
            close();
        }
        else {
            // in case we're trying to close while
            // handshaking is in progress (GH-164)
            this.once("open", close);
        }
    }
    /**
     * Writes a packets payload.
     *
     * @param {Array} packets - data packets
     * @protected
     */
    write(packets) {
        this.writable = false;
        encodePayload(packets, (data) => {
            this.doWrite(data, () => {
                this.writable = true;
                this.emitReserved("drain");
            });
        });
    }
    /**
     * Generates uri for connection.
     *
     * @private
     */
    uri() {
        const schema = this.opts.secure ? "https" : "http";
        const query = this.query || {};
        // cache busting is forced
        if (false !== this.opts.timestampRequests) {
            query[this.opts.timestampParam] = randomString();
        }
        if (!this.supportsBinary && !query.sid) {
            query.b64 = 1;
        }
        return this.createUri(schema, query);
    }
}

;// ./node_modules/engine.io-client/build/esm/contrib/has-cors.js
// imported from https://github.com/component/has-cors
let value = false;
try {
    value = typeof XMLHttpRequest !== 'undefined' &&
        'withCredentials' in new XMLHttpRequest();
}
catch (err) {
    // if XMLHttp support is disabled in IE then it will throw
    // when trying to create
}
const hasCORS = value;

;// ./node_modules/engine.io-client/build/esm/transports/polling-xhr.js





function empty() { }
class BaseXHR extends polling_Polling {
    /**
     * XHR Polling constructor.
     *
     * @param {Object} opts
     * @package
     */
    constructor(opts) {
        super(opts);
        if (typeof location !== "undefined") {
            const isSSL = "https:" === location.protocol;
            let port = location.port;
            // some user agents have empty `location.port`
            if (!port) {
                port = isSSL ? "443" : "80";
            }
            this.xd =
                (typeof location !== "undefined" &&
                    opts.hostname !== location.hostname) ||
                    port !== opts.port;
        }
    }
    /**
     * Sends data.
     *
     * @param {String} data to send.
     * @param {Function} called upon flush.
     * @private
     */
    doWrite(data, fn) {
        const req = this.request({
            method: "POST",
            data: data,
        });
        req.on("success", fn);
        req.on("error", (xhrStatus, context) => {
            this.onError("xhr post error", xhrStatus, context);
        });
    }
    /**
     * Starts a poll cycle.
     *
     * @private
     */
    doPoll() {
        const req = this.request();
        req.on("data", this.onData.bind(this));
        req.on("error", (xhrStatus, context) => {
            this.onError("xhr poll error", xhrStatus, context);
        });
        this.pollXhr = req;
    }
}
class Request extends Emitter {
    /**
     * Request constructor
     *
     * @param {Object} options
     * @package
     */
    constructor(createRequest, uri, opts) {
        super();
        this.createRequest = createRequest;
        installTimerFunctions(this, opts);
        this._opts = opts;
        this._method = opts.method || "GET";
        this._uri = uri;
        this._data = undefined !== opts.data ? opts.data : null;
        this._create();
    }
    /**
     * Creates the XHR object and sends the request.
     *
     * @private
     */
    _create() {
        var _a;
        const opts = pick(this._opts, "agent", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "autoUnref");
        opts.xdomain = !!this._opts.xd;
        const xhr = (this._xhr = this.createRequest(opts));
        try {
            xhr.open(this._method, this._uri, true);
            try {
                if (this._opts.extraHeaders) {
                    // @ts-ignore
                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);
                    for (let i in this._opts.extraHeaders) {
                        if (this._opts.extraHeaders.hasOwnProperty(i)) {
                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);
                        }
                    }
                }
            }
            catch (e) { }
            if ("POST" === this._method) {
                try {
                    xhr.setRequestHeader("Content-type", "text/plain;charset=UTF-8");
                }
                catch (e) { }
            }
            try {
                xhr.setRequestHeader("Accept", "*/*");
            }
            catch (e) { }
            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);
            // ie6 check
            if ("withCredentials" in xhr) {
                xhr.withCredentials = this._opts.withCredentials;
            }
            if (this._opts.requestTimeout) {
                xhr.timeout = this._opts.requestTimeout;
            }
            xhr.onreadystatechange = () => {
                var _a;
                if (xhr.readyState === 3) {
                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(
                    // @ts-ignore
                    xhr.getResponseHeader("set-cookie"));
                }
                if (4 !== xhr.readyState)
                    return;
                if (200 === xhr.status || 1223 === xhr.status) {
                    this._onLoad();
                }
                else {
                    // make sure the `error` event handler that's user-set
                    // does not throw in the same tick and gets caught here
                    this.setTimeoutFn(() => {
                        this._onError(typeof xhr.status === "number" ? xhr.status : 0);
                    }, 0);
                }
            };
            xhr.send(this._data);
        }
        catch (e) {
            // Need to defer since .create() is called directly from the constructor
            // and thus the 'error' event can only be only bound *after* this exception
            // occurs.  Therefore, also, we cannot throw here at all.
            this.setTimeoutFn(() => {
                this._onError(e);
            }, 0);
            return;
        }
        if (typeof document !== "undefined") {
            this._index = Request.requestsCount++;
            Request.requests[this._index] = this;
        }
    }
    /**
     * Called upon error.
     *
     * @private
     */
    _onError(err) {
        this.emitReserved("error", err, this._xhr);
        this._cleanup(true);
    }
    /**
     * Cleans up house.
     *
     * @private
     */
    _cleanup(fromError) {
        if ("undefined" === typeof this._xhr || null === this._xhr) {
            return;
        }
        this._xhr.onreadystatechange = empty;
        if (fromError) {
            try {
                this._xhr.abort();
            }
            catch (e) { }
        }
        if (typeof document !== "undefined") {
            delete Request.requests[this._index];
        }
        this._xhr = null;
    }
    /**
     * Called upon load.
     *
     * @private
     */
    _onLoad() {
        const data = this._xhr.responseText;
        if (data !== null) {
            this.emitReserved("data", data);
            this.emitReserved("success");
            this._cleanup();
        }
    }
    /**
     * Aborts the request.
     *
     * @package
     */
    abort() {
        this._cleanup();
    }
}
Request.requestsCount = 0;
Request.requests = {};
/**
 * Aborts pending requests when unloading the window. This is needed to prevent
 * memory leaks (e.g. when using IE) and to ensure that no spurious error is
 * emitted.
 */
if (typeof document !== "undefined") {
    // @ts-ignore
    if (typeof attachEvent === "function") {
        // @ts-ignore
        attachEvent("onunload", unloadHandler);
    }
    else if (typeof addEventListener === "function") {
        const terminationEvent = "onpagehide" in globalThisShim ? "pagehide" : "unload";
        addEventListener(terminationEvent, unloadHandler, false);
    }
}
function unloadHandler() {
    for (let i in Request.requests) {
        if (Request.requests.hasOwnProperty(i)) {
            Request.requests[i].abort();
        }
    }
}
const hasXHR2 = (function () {
    const xhr = newRequest({
        xdomain: false,
    });
    return xhr && xhr.responseType !== null;
})();
/**
 * HTTP long-polling based on the built-in `XMLHttpRequest` object.
 *
 * Usage: browser
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
 */
class XHR extends BaseXHR {
    constructor(opts) {
        super(opts);
        const forceBase64 = opts && opts.forceBase64;
        this.supportsBinary = hasXHR2 && !forceBase64;
    }
    request(opts = {}) {
        Object.assign(opts, { xd: this.xd }, this.opts);
        return new Request(newRequest, this.uri(), opts);
    }
}
function newRequest(opts) {
    const xdomain = opts.xdomain;
    // XMLHttpRequest can be disabled on IE
    try {
        if ("undefined" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {
            return new XMLHttpRequest();
        }
    }
    catch (e) { }
    if (!xdomain) {
        try {
            return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP");
        }
        catch (e) { }
    }
}

;// ./node_modules/engine.io-client/build/esm/transports/websocket.js




// detect ReactNative environment
const isReactNative = typeof navigator !== "undefined" &&
    typeof navigator.product === "string" &&
    navigator.product.toLowerCase() === "reactnative";
class BaseWS extends Transport {
    get name() {
        return "websocket";
    }
    doOpen() {
        const uri = this.uri();
        const protocols = this.opts.protocols;
        // React Native only supports the 'headers' option, and will print a warning if anything else is passed
        const opts = isReactNative
            ? {}
            : pick(this.opts, "agent", "perMessageDeflate", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "localAddress", "protocolVersion", "origin", "maxPayload", "family", "checkServerIdentity");
        if (this.opts.extraHeaders) {
            opts.headers = this.opts.extraHeaders;
        }
        try {
            this.ws = this.createSocket(uri, protocols, opts);
        }
        catch (err) {
            return this.emitReserved("error", err);
        }
        this.ws.binaryType = this.socket.binaryType;
        this.addEventListeners();
    }
    /**
     * Adds event listeners to the socket
     *
     * @private
     */
    addEventListeners() {
        this.ws.onopen = () => {
            if (this.opts.autoUnref) {
                this.ws._socket.unref();
            }
            this.onOpen();
        };
        this.ws.onclose = (closeEvent) => this.onClose({
            description: "websocket connection closed",
            context: closeEvent,
        });
        this.ws.onmessage = (ev) => this.onData(ev.data);
        this.ws.onerror = (e) => this.onError("websocket error", e);
    }
    write(packets) {
        this.writable = false;
        // encodePacket efficient as it uses WS framing
        // no need for encodePayload
        for (let i = 0; i < packets.length; i++) {
            const packet = packets[i];
            const lastPacket = i === packets.length - 1;
            encodePacket(packet, this.supportsBinary, (data) => {
                // Sometimes the websocket has already been closed but the browser didn't
                // have a chance of informing us about it yet, in that case send will
                // throw an error
                try {
                    this.doWrite(packet, data);
                }
                catch (e) {
                }
                if (lastPacket) {
                    // fake drain
                    // defer to next tick to allow Socket to clear writeBuffer
                    nextTick(() => {
                        this.writable = true;
                        this.emitReserved("drain");
                    }, this.setTimeoutFn);
                }
            });
        }
    }
    doClose() {
        if (typeof this.ws !== "undefined") {
            this.ws.onerror = () => { };
            this.ws.close();
            this.ws = null;
        }
    }
    /**
     * Generates uri for connection.
     *
     * @private
     */
    uri() {
        const schema = this.opts.secure ? "wss" : "ws";
        const query = this.query || {};
        // append timestamp to URI
        if (this.opts.timestampRequests) {
            query[this.opts.timestampParam] = randomString();
        }
        // communicate binary support capabilities
        if (!this.supportsBinary) {
            query.b64 = 1;
        }
        return this.createUri(schema, query);
    }
}
const WebSocketCtor = globalThisShim.WebSocket || globalThisShim.MozWebSocket;
/**
 * WebSocket transport based on the built-in `WebSocket` object.
 *
 * Usage: browser, Node.js (since v21), Deno, Bun
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket
 * @see https://caniuse.com/mdn-api_websocket
 * @see https://nodejs.org/api/globals.html#websocket
 */
class WS extends BaseWS {
    createSocket(uri, protocols, opts) {
        return !isReactNative
            ? protocols
                ? new WebSocketCtor(uri, protocols)
                : new WebSocketCtor(uri)
            : new WebSocketCtor(uri, protocols, opts);
    }
    doWrite(_packet, data) {
        this.ws.send(data);
    }
}

;// ./node_modules/engine.io-client/build/esm/transports/webtransport.js



/**
 * WebTransport transport based on the built-in `WebTransport` object.
 *
 * Usage: browser, Node.js (with the `@fails-components/webtransport` package)
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport
 * @see https://caniuse.com/webtransport
 */
class WT extends Transport {
    get name() {
        return "webtransport";
    }
    doOpen() {
        try {
            // @ts-ignore
            this._transport = new WebTransport(this.createUri("https"), this.opts.transportOptions[this.name]);
        }
        catch (err) {
            return this.emitReserved("error", err);
        }
        this._transport.closed
            .then(() => {
            this.onClose();
        })
            .catch((err) => {
            this.onError("webtransport error", err);
        });
        // note: we could have used async/await, but that would require some additional polyfills
        this._transport.ready.then(() => {
            this._transport.createBidirectionalStream().then((stream) => {
                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);
                const reader = stream.readable.pipeThrough(decoderStream).getReader();
                const encoderStream = createPacketEncoderStream();
                encoderStream.readable.pipeTo(stream.writable);
                this._writer = encoderStream.writable.getWriter();
                const read = () => {
                    reader
                        .read()
                        .then(({ done, value }) => {
                        if (done) {
                            return;
                        }
                        this.onPacket(value);
                        read();
                    })
                        .catch((err) => {
                    });
                };
                read();
                const packet = { type: "open" };
                if (this.query.sid) {
                    packet.data = `{"sid":"${this.query.sid}"}`;
                }
                this._writer.write(packet).then(() => this.onOpen());
            });
        });
    }
    write(packets) {
        this.writable = false;
        for (let i = 0; i < packets.length; i++) {
            const packet = packets[i];
            const lastPacket = i === packets.length - 1;
            this._writer.write(packet).then(() => {
                if (lastPacket) {
                    nextTick(() => {
                        this.writable = true;
                        this.emitReserved("drain");
                    }, this.setTimeoutFn);
                }
            });
        }
    }
    doClose() {
        var _a;
        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();
    }
}

;// ./node_modules/engine.io-client/build/esm/transports/index.js



const transports = {
    websocket: WS,
    webtransport: WT,
    polling: XHR,
};

;// ./node_modules/engine.io-client/build/esm/contrib/parseuri.js
// imported from https://github.com/galkn/parseuri
/**
 * Parses a URI
 *
 * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.
 *
 * See:
 * - https://developer.mozilla.org/en-US/docs/Web/API/URL
 * - https://caniuse.com/url
 * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B
 *
 * History of the parse() method:
 * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c
 * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3
 * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242
 *
 * @author Steven Levithan <stevenlevithan.com> (MIT license)
 * @api private
 */
const re = /^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;
const parts = [
    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'
];
function parse(str) {
    if (str.length > 8000) {
        throw "URI too long";
    }
    const src = str, b = str.indexOf('['), e = str.indexOf(']');
    if (b != -1 && e != -1) {
        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);
    }
    let m = re.exec(str || ''), uri = {}, i = 14;
    while (i--) {
        uri[parts[i]] = m[i] || '';
    }
    if (b != -1 && e != -1) {
        uri.source = src;
        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');
        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');
        uri.ipv6uri = true;
    }
    uri.pathNames = pathNames(uri, uri['path']);
    uri.queryKey = queryKey(uri, uri['query']);
    return uri;
}
function pathNames(obj, path) {
    const regx = /\/{2,9}/g, names = path.replace(regx, "/").split("/");
    if (path.slice(0, 1) == '/' || path.length === 0) {
        names.splice(0, 1);
    }
    if (path.slice(-1) == '/') {
        names.splice(names.length - 1, 1);
    }
    return names;
}
function queryKey(uri, query) {
    const data = {};
    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {
        if ($1) {
            data[$1] = $2;
        }
    });
    return data;
}

;// ./node_modules/engine.io-client/build/esm/socket.js







const withEventListeners = typeof addEventListener === "function" &&
    typeof removeEventListener === "function";
const OFFLINE_EVENT_LISTENERS = [];
if (withEventListeners) {
    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the
    // script, so we create one single event listener here which will forward the event to the socket instances
    addEventListener("offline", () => {
        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());
    }, false);
}
/**
 * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established
 * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.
 *
 * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that
 * successfully establishes the connection.
 *
 * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.
 *
 * @example
 * import { SocketWithoutUpgrade, WebSocket } from "engine.io-client";
 *
 * const socket = new SocketWithoutUpgrade({
 *   transports: [WebSocket]
 * });
 *
 * socket.on("open", () => {
 *   socket.send("hello");
 * });
 *
 * @see SocketWithUpgrade
 * @see Socket
 */
class SocketWithoutUpgrade extends Emitter {
    /**
     * Socket constructor.
     *
     * @param {String|Object} uri - uri or options
     * @param {Object} opts - options
     */
    constructor(uri, opts) {
        super();
        this.binaryType = defaultBinaryType;
        this.writeBuffer = [];
        this._prevBufferLen = 0;
        this._pingInterval = -1;
        this._pingTimeout = -1;
        this._maxPayload = -1;
        /**
         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the
         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.
         */
        this._pingTimeoutTime = Infinity;
        if (uri && "object" === typeof uri) {
            opts = uri;
            uri = null;
        }
        if (uri) {
            const parsedUri = parse(uri);
            opts.hostname = parsedUri.host;
            opts.secure =
                parsedUri.protocol === "https" || parsedUri.protocol === "wss";
            opts.port = parsedUri.port;
            if (parsedUri.query)
                opts.query = parsedUri.query;
        }
        else if (opts.host) {
            opts.hostname = parse(opts.host).host;
        }
        installTimerFunctions(this, opts);
        this.secure =
            null != opts.secure
                ? opts.secure
                : typeof location !== "undefined" && "https:" === location.protocol;
        if (opts.hostname && !opts.port) {
            // if no port is specified manually, use the protocol default
            opts.port = this.secure ? "443" : "80";
        }
        this.hostname =
            opts.hostname ||
                (typeof location !== "undefined" ? location.hostname : "localhost");
        this.port =
            opts.port ||
                (typeof location !== "undefined" && location.port
                    ? location.port
                    : this.secure
                        ? "443"
                        : "80");
        this.transports = [];
        this._transportsByName = {};
        opts.transports.forEach((t) => {
            const transportName = t.prototype.name;
            this.transports.push(transportName);
            this._transportsByName[transportName] = t;
        });
        this.opts = Object.assign({
            path: "/engine.io",
            agent: false,
            withCredentials: false,
            upgrade: true,
            timestampParam: "t",
            rememberUpgrade: false,
            addTrailingSlash: true,
            rejectUnauthorized: true,
            perMessageDeflate: {
                threshold: 1024,
            },
            transportOptions: {},
            closeOnBeforeunload: false,
        }, opts);
        this.opts.path =
            this.opts.path.replace(/\/$/, "") +
                (this.opts.addTrailingSlash ? "/" : "");
        if (typeof this.opts.query === "string") {
            this.opts.query = parseqs_decode(this.opts.query);
        }
        if (withEventListeners) {
            if (this.opts.closeOnBeforeunload) {
                // Firefox closes the connection when the "beforeunload" event is emitted but not Chrome. This event listener
                // ensures every browser behaves the same (no "disconnect" event at the Socket.IO level when the page is
                // closed/reloaded)
                this._beforeunloadEventListener = () => {
                    if (this.transport) {
                        // silently close the transport
                        this.transport.removeAllListeners();
                        this.transport.close();
                    }
                };
                addEventListener("beforeunload", this._beforeunloadEventListener, false);
            }
            if (this.hostname !== "localhost") {
                this._offlineEventListener = () => {
                    this._onClose("transport close", {
                        description: "network connection lost",
                    });
                };
                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);
            }
        }
        if (this.opts.withCredentials) {
            this._cookieJar = createCookieJar();
        }
        this._open();
    }
    /**
     * Creates transport of the given type.
     *
     * @param {String} name - transport name
     * @return {Transport}
     * @private
     */
    createTransport(name) {
        const query = Object.assign({}, this.opts.query);
        // append engine.io protocol identifier
        query.EIO = protocol;
        // transport name
        query.transport = name;
        // session id if we already have one
        if (this.id)
            query.sid = this.id;
        const opts = Object.assign({}, this.opts, {
            query,
            socket: this,
            hostname: this.hostname,
            secure: this.secure,
            port: this.port,
        }, this.opts.transportOptions[name]);
        return new this._transportsByName[name](opts);
    }
    /**
     * Initializes transport to use and starts probe.
     *
     * @private
     */
    _open() {
        if (this.transports.length === 0) {
            // Emit error on next tick so it can be listened to
            this.setTimeoutFn(() => {
                this.emitReserved("error", "No transports available");
            }, 0);
            return;
        }
        const transportName = this.opts.rememberUpgrade &&
            SocketWithoutUpgrade.priorWebsocketSuccess &&
            this.transports.indexOf("websocket") !== -1
            ? "websocket"
            : this.transports[0];
        this.readyState = "opening";
        const transport = this.createTransport(transportName);
        transport.open();
        this.setTransport(transport);
    }
    /**
     * Sets the current transport. Disables the existing one (if any).
     *
     * @private
     */
    setTransport(transport) {
        if (this.transport) {
            this.transport.removeAllListeners();
        }
        // set up transport
        this.transport = transport;
        // set up transport listeners
        transport
            .on("drain", this._onDrain.bind(this))
            .on("packet", this._onPacket.bind(this))
            .on("error", this._onError.bind(this))
            .on("close", (reason) => this._onClose("transport close", reason));
    }
    /**
     * Called when connection is deemed open.
     *
     * @private
     */
    onOpen() {
        this.readyState = "open";
        SocketWithoutUpgrade.priorWebsocketSuccess =
            "websocket" === this.transport.name;
        this.emitReserved("open");
        this.flush();
    }
    /**
     * Handles a packet.
     *
     * @private
     */
    _onPacket(packet) {
        if ("opening" === this.readyState ||
            "open" === this.readyState ||
            "closing" === this.readyState) {
            this.emitReserved("packet", packet);
            // Socket is live - any packet counts
            this.emitReserved("heartbeat");
            switch (packet.type) {
                case "open":
                    this.onHandshake(JSON.parse(packet.data));
                    break;
                case "ping":
                    this._sendPacket("pong");
                    this.emitReserved("ping");
                    this.emitReserved("pong");
                    this._resetPingTimeout();
                    break;
                case "error":
                    const err = new Error("server error");
                    // @ts-ignore
                    err.code = packet.data;
                    this._onError(err);
                    break;
                case "message":
                    this.emitReserved("data", packet.data);
                    this.emitReserved("message", packet.data);
                    break;
            }
        }
        else {
        }
    }
    /**
     * Called upon handshake completion.
     *
     * @param {Object} data - handshake obj
     * @private
     */
    onHandshake(data) {
        this.emitReserved("handshake", data);
        this.id = data.sid;
        this.transport.query.sid = data.sid;
        this._pingInterval = data.pingInterval;
        this._pingTimeout = data.pingTimeout;
        this._maxPayload = data.maxPayload;
        this.onOpen();
        // In case open handler closes socket
        if ("closed" === this.readyState)
            return;
        this._resetPingTimeout();
    }
    /**
     * Sets and resets ping timeout timer based on server pings.
     *
     * @private
     */
    _resetPingTimeout() {
        this.clearTimeoutFn(this._pingTimeoutTimer);
        const delay = this._pingInterval + this._pingTimeout;
        this._pingTimeoutTime = Date.now() + delay;
        this._pingTimeoutTimer = this.setTimeoutFn(() => {
            this._onClose("ping timeout");
        }, delay);
        if (this.opts.autoUnref) {
            this._pingTimeoutTimer.unref();
        }
    }
    /**
     * Called on `drain` event
     *
     * @private
     */
    _onDrain() {
        this.writeBuffer.splice(0, this._prevBufferLen);
        // setting prevBufferLen = 0 is very important
        // for example, when upgrading, upgrade packet is sent over,
        // and a nonzero prevBufferLen could cause problems on `drain`
        this._prevBufferLen = 0;
        if (0 === this.writeBuffer.length) {
            this.emitReserved("drain");
        }
        else {
            this.flush();
        }
    }
    /**
     * Flush write buffers.
     *
     * @private
     */
    flush() {
        if ("closed" !== this.readyState &&
            this.transport.writable &&
            !this.upgrading &&
            this.writeBuffer.length) {
            const packets = this._getWritablePackets();
            this.transport.send(packets);
            // keep track of current length of writeBuffer
            // splice writeBuffer and callbackBuffer on `drain`
            this._prevBufferLen = packets.length;
            this.emitReserved("flush");
        }
    }
    /**
     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP
     * long-polling)
     *
     * @private
     */
    _getWritablePackets() {
        const shouldCheckPayloadSize = this._maxPayload &&
            this.transport.name === "polling" &&
            this.writeBuffer.length > 1;
        if (!shouldCheckPayloadSize) {
            return this.writeBuffer;
        }
        let payloadSize = 1; // first packet type
        for (let i = 0; i < this.writeBuffer.length; i++) {
            const data = this.writeBuffer[i].data;
            if (data) {
                payloadSize += byteLength(data);
            }
            if (i > 0 && payloadSize > this._maxPayload) {
                return this.writeBuffer.slice(0, i);
            }
            payloadSize += 2; // separator + packet type
        }
        return this.writeBuffer;
    }
    /**
     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.
     *
     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the
     * `write()` method then the message would not be buffered by the Socket.IO client.
     *
     * @return {boolean}
     * @private
     */
    /* private */ _hasPingExpired() {
        if (!this._pingTimeoutTime)
            return true;
        const hasExpired = Date.now() > this._pingTimeoutTime;
        if (hasExpired) {
            this._pingTimeoutTime = 0;
            nextTick(() => {
                this._onClose("ping timeout");
            }, this.setTimeoutFn);
        }
        return hasExpired;
    }
    /**
     * Sends a message.
     *
     * @param {String} msg - message.
     * @param {Object} options.
     * @param {Function} fn - callback function.
     * @return {Socket} for chaining.
     */
    write(msg, options, fn) {
        this._sendPacket("message", msg, options, fn);
        return this;
    }
    /**
     * Sends a message. Alias of {@link Socket#write}.
     *
     * @param {String} msg - message.
     * @param {Object} options.
     * @param {Function} fn - callback function.
     * @return {Socket} for chaining.
     */
    send(msg, options, fn) {
        this._sendPacket("message", msg, options, fn);
        return this;
    }
    /**
     * Sends a packet.
     *
     * @param {String} type: packet type.
     * @param {String} data.
     * @param {Object} options.
     * @param {Function} fn - callback function.
     * @private
     */
    _sendPacket(type, data, options, fn) {
        if ("function" === typeof data) {
            fn = data;
            data = undefined;
        }
        if ("function" === typeof options) {
            fn = options;
            options = null;
        }
        if ("closing" === this.readyState || "closed" === this.readyState) {
            return;
        }
        options = options || {};
        options.compress = false !== options.compress;
        const packet = {
            type: type,
            data: data,
            options: options,
        };
        this.emitReserved("packetCreate", packet);
        this.writeBuffer.push(packet);
        if (fn)
            this.once("flush", fn);
        this.flush();
    }
    /**
     * Closes the connection.
     */
    close() {
        const close = () => {
            this._onClose("forced close");
            this.transport.close();
        };
        const cleanupAndClose = () => {
            this.off("upgrade", cleanupAndClose);
            this.off("upgradeError", cleanupAndClose);
            close();
        };
        const waitForUpgrade = () => {
            // wait for upgrade to finish since we can't send packets while pausing a transport
            this.once("upgrade", cleanupAndClose);
            this.once("upgradeError", cleanupAndClose);
        };
        if ("opening" === this.readyState || "open" === this.readyState) {
            this.readyState = "closing";
            if (this.writeBuffer.length) {
                this.once("drain", () => {
                    if (this.upgrading) {
                        waitForUpgrade();
                    }
                    else {
                        close();
                    }
                });
            }
            else if (this.upgrading) {
                waitForUpgrade();
            }
            else {
                close();
            }
        }
        return this;
    }
    /**
     * Called upon transport error
     *
     * @private
     */
    _onError(err) {
        SocketWithoutUpgrade.priorWebsocketSuccess = false;
        if (this.opts.tryAllTransports &&
            this.transports.length > 1 &&
            this.readyState === "opening") {
            this.transports.shift();
            return this._open();
        }
        this.emitReserved("error", err);
        this._onClose("transport error", err);
    }
    /**
     * Called upon transport close.
     *
     * @private
     */
    _onClose(reason, description) {
        if ("opening" === this.readyState ||
            "open" === this.readyState ||
            "closing" === this.readyState) {
            // clear timers
            this.clearTimeoutFn(this._pingTimeoutTimer);
            // stop event from firing again for transport
            this.transport.removeAllListeners("close");
            // ensure transport won't stay open
            this.transport.close();
            // ignore further transport communication
            this.transport.removeAllListeners();
            if (withEventListeners) {
                if (this._beforeunloadEventListener) {
                    removeEventListener("beforeunload", this._beforeunloadEventListener, false);
                }
                if (this._offlineEventListener) {
                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);
                    if (i !== -1) {
                        OFFLINE_EVENT_LISTENERS.splice(i, 1);
                    }
                }
            }
            // set ready state
            this.readyState = "closed";
            // clear session id
            this.id = null;
            // emit close event
            this.emitReserved("close", reason, description);
            // clean buffers after, so users can still
            // grab the buffers on `close` event
            this.writeBuffer = [];
            this._prevBufferLen = 0;
        }
    }
}
SocketWithoutUpgrade.protocol = protocol;
/**
 * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established
 * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.
 *
 * This class comes with an upgrade mechanism, which means that once the connection is established with the first
 * low-level transport, it will try to upgrade to a better transport.
 *
 * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.
 *
 * @example
 * import { SocketWithUpgrade, WebSocket } from "engine.io-client";
 *
 * const socket = new SocketWithUpgrade({
 *   transports: [WebSocket]
 * });
 *
 * socket.on("open", () => {
 *   socket.send("hello");
 * });
 *
 * @see SocketWithoutUpgrade
 * @see Socket
 */
class SocketWithUpgrade extends SocketWithoutUpgrade {
    constructor() {
        super(...arguments);
        this._upgrades = [];
    }
    onOpen() {
        super.onOpen();
        if ("open" === this.readyState && this.opts.upgrade) {
            for (let i = 0; i < this._upgrades.length; i++) {
                this._probe(this._upgrades[i]);
            }
        }
    }
    /**
     * Probes a transport.
     *
     * @param {String} name - transport name
     * @private
     */
    _probe(name) {
        let transport = this.createTransport(name);
        let failed = false;
        SocketWithoutUpgrade.priorWebsocketSuccess = false;
        const onTransportOpen = () => {
            if (failed)
                return;
            transport.send([{ type: "ping", data: "probe" }]);
            transport.once("packet", (msg) => {
                if (failed)
                    return;
                if ("pong" === msg.type && "probe" === msg.data) {
                    this.upgrading = true;
                    this.emitReserved("upgrading", transport);
                    if (!transport)
                        return;
                    SocketWithoutUpgrade.priorWebsocketSuccess =
                        "websocket" === transport.name;
                    this.transport.pause(() => {
                        if (failed)
                            return;
                        if ("closed" === this.readyState)
                            return;
                        cleanup();
                        this.setTransport(transport);
                        transport.send([{ type: "upgrade" }]);
                        this.emitReserved("upgrade", transport);
                        transport = null;
                        this.upgrading = false;
                        this.flush();
                    });
                }
                else {
                    const err = new Error("probe error");
                    // @ts-ignore
                    err.transport = transport.name;
                    this.emitReserved("upgradeError", err);
                }
            });
        };
        function freezeTransport() {
            if (failed)
                return;
            // Any callback called by transport should be ignored since now
            failed = true;
            cleanup();
            transport.close();
            transport = null;
        }
        // Handle any error that happens while probing
        const onerror = (err) => {
            const error = new Error("probe error: " + err);
            // @ts-ignore
            error.transport = transport.name;
            freezeTransport();
            this.emitReserved("upgradeError", error);
        };
        function onTransportClose() {
            onerror("transport closed");
        }
        // When the socket is closed while we're probing
        function onclose() {
            onerror("socket closed");
        }
        // When the socket is upgraded while we're probing
        function onupgrade(to) {
            if (transport && to.name !== transport.name) {
                freezeTransport();
            }
        }
        // Remove all listeners on the transport and on self
        const cleanup = () => {
            transport.removeListener("open", onTransportOpen);
            transport.removeListener("error", onerror);
            transport.removeListener("close", onTransportClose);
            this.off("close", onclose);
            this.off("upgrading", onupgrade);
        };
        transport.once("open", onTransportOpen);
        transport.once("error", onerror);
        transport.once("close", onTransportClose);
        this.once("close", onclose);
        this.once("upgrading", onupgrade);
        if (this._upgrades.indexOf("webtransport") !== -1 &&
            name !== "webtransport") {
            // favor WebTransport
            this.setTimeoutFn(() => {
                if (!failed) {
                    transport.open();
                }
            }, 200);
        }
        else {
            transport.open();
        }
    }
    onHandshake(data) {
        this._upgrades = this._filterUpgrades(data.upgrades);
        super.onHandshake(data);
    }
    /**
     * Filters upgrades, returning only those matching client transports.
     *
     * @param {Array} upgrades - server upgrades
     * @private
     */
    _filterUpgrades(upgrades) {
        const filteredUpgrades = [];
        for (let i = 0; i < upgrades.length; i++) {
            if (~this.transports.indexOf(upgrades[i]))
                filteredUpgrades.push(upgrades[i]);
        }
        return filteredUpgrades;
    }
}
/**
 * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established
 * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.
 *
 * This class comes with an upgrade mechanism, which means that once the connection is established with the first
 * low-level transport, it will try to upgrade to a better transport.
 *
 * @example
 * import { Socket } from "engine.io-client";
 *
 * const socket = new Socket();
 *
 * socket.on("open", () => {
 *   socket.send("hello");
 * });
 *
 * @see SocketWithoutUpgrade
 * @see SocketWithUpgrade
 */
class Socket extends SocketWithUpgrade {
    constructor(uri, opts = {}) {
        const o = typeof uri === "object" ? uri : opts;
        if (!o.transports ||
            (o.transports && typeof o.transports[0] === "string")) {
            o.transports = (o.transports || ["polling", "websocket", "webtransport"])
                .map((transportName) => transports[transportName])
                .filter((t) => !!t);
        }
        super(uri, o);
    }
}

;// ./node_modules/engine.io-client/build/esm/transports/polling-fetch.js

/**
 * HTTP long-polling based on the built-in `fetch()` method.
 *
 * Usage: browser, Node.js (since v18), Deno, Bun
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch
 * @see https://caniuse.com/fetch
 * @see https://nodejs.org/api/globals.html#fetch
 */
class Fetch extends (/* unused pure expression or super */ null && (Polling)) {
    doPoll() {
        this._fetch()
            .then((res) => {
            if (!res.ok) {
                return this.onError("fetch read error", res.status, res);
            }
            res.text().then((data) => this.onData(data));
        })
            .catch((err) => {
            this.onError("fetch read error", err);
        });
    }
    doWrite(data, callback) {
        this._fetch(data)
            .then((res) => {
            if (!res.ok) {
                return this.onError("fetch write error", res.status, res);
            }
            callback();
        })
            .catch((err) => {
            this.onError("fetch write error", err);
        });
    }
    _fetch(data) {
        var _a;
        const isPost = data !== undefined;
        const headers = new Headers(this.opts.extraHeaders);
        if (isPost) {
            headers.set("content-type", "text/plain;charset=UTF-8");
        }
        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);
        return fetch(this.uri(), {
            method: isPost ? "POST" : "GET",
            body: isPost ? data : null,
            headers,
            credentials: this.opts.withCredentials ? "include" : "omit",
        }).then((res) => {
            var _a;
            // @ts-ignore getSetCookie() was added in Node.js v19.7.0
            (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());
            return res;
        });
    }
}

;// ./node_modules/engine.io-client/build/esm/index.js



const esm_protocol = Socket.protocol;












;// ./node_modules/socket.io-client/build/esm/url.js

/**
 * URL parser.
 *
 * @param uri - url
 * @param path - the request path of the connection
 * @param loc - An object meant to mimic window.location.
 *        Defaults to window.location.
 * @public
 */
function url(uri, path = "", loc) {
    let obj = uri;
    // default to window.location
    loc = loc || (typeof location !== "undefined" && location);
    if (null == uri)
        uri = loc.protocol + "//" + loc.host;
    // relative path support
    if (typeof uri === "string") {
        if ("/" === uri.charAt(0)) {
            if ("/" === uri.charAt(1)) {
                uri = loc.protocol + uri;
            }
            else {
                uri = loc.host + uri;
            }
        }
        if (!/^(https?|wss?):\/\//.test(uri)) {
            if ("undefined" !== typeof loc) {
                uri = loc.protocol + "//" + uri;
            }
            else {
                uri = "https://" + uri;
            }
        }
        // parse
        obj = parse(uri);
    }
    // make sure we treat `localhost:80` and `localhost` equally
    if (!obj.port) {
        if (/^(http|ws)$/.test(obj.protocol)) {
            obj.port = "80";
        }
        else if (/^(http|ws)s$/.test(obj.protocol)) {
            obj.port = "443";
        }
    }
    obj.path = obj.path || "/";
    const ipv6 = obj.host.indexOf(":") !== -1;
    const host = ipv6 ? "[" + obj.host + "]" : obj.host;
    // define unique id
    obj.id = obj.protocol + "://" + host + ":" + obj.port + path;
    // define href
    obj.href =
        obj.protocol +
            "://" +
            host +
            (loc && loc.port === obj.port ? "" : ":" + obj.port);
    return obj;
}

;// ./node_modules/socket.io-parser/build/esm/is-binary.js
const is_binary_withNativeArrayBuffer = typeof ArrayBuffer === "function";
const is_binary_isView = (obj) => {
    return typeof ArrayBuffer.isView === "function"
        ? ArrayBuffer.isView(obj)
        : obj.buffer instanceof ArrayBuffer;
};
const is_binary_toString = Object.prototype.toString;
const is_binary_withNativeBlob = typeof Blob === "function" ||
    (typeof Blob !== "undefined" &&
        is_binary_toString.call(Blob) === "[object BlobConstructor]");
const withNativeFile = typeof File === "function" ||
    (typeof File !== "undefined" &&
        is_binary_toString.call(File) === "[object FileConstructor]");
/**
 * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.
 *
 * @private
 */
function isBinary(obj) {
    return ((is_binary_withNativeArrayBuffer && (obj instanceof ArrayBuffer || is_binary_isView(obj))) ||
        (is_binary_withNativeBlob && obj instanceof Blob) ||
        (withNativeFile && obj instanceof File));
}
function hasBinary(obj, toJSON) {
    if (!obj || typeof obj !== "object") {
        return false;
    }
    if (Array.isArray(obj)) {
        for (let i = 0, l = obj.length; i < l; i++) {
            if (hasBinary(obj[i])) {
                return true;
            }
        }
        return false;
    }
    if (isBinary(obj)) {
        return true;
    }
    if (obj.toJSON &&
        typeof obj.toJSON === "function" &&
        arguments.length === 1) {
        return hasBinary(obj.toJSON(), true);
    }
    for (const key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {
            return true;
        }
    }
    return false;
}

;// ./node_modules/socket.io-parser/build/esm/binary.js

/**
 * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.
 *
 * @param {Object} packet - socket.io event packet
 * @return {Object} with deconstructed packet and list of buffers
 * @public
 */
function deconstructPacket(packet) {
    const buffers = [];
    const packetData = packet.data;
    const pack = packet;
    pack.data = _deconstructPacket(packetData, buffers);
    pack.attachments = buffers.length; // number of binary 'attachments'
    return { packet: pack, buffers: buffers };
}
function _deconstructPacket(data, buffers) {
    if (!data)
        return data;
    if (isBinary(data)) {
        const placeholder = { _placeholder: true, num: buffers.length };
        buffers.push(data);
        return placeholder;
    }
    else if (Array.isArray(data)) {
        const newData = new Array(data.length);
        for (let i = 0; i < data.length; i++) {
            newData[i] = _deconstructPacket(data[i], buffers);
        }
        return newData;
    }
    else if (typeof data === "object" && !(data instanceof Date)) {
        const newData = {};
        for (const key in data) {
            if (Object.prototype.hasOwnProperty.call(data, key)) {
                newData[key] = _deconstructPacket(data[key], buffers);
            }
        }
        return newData;
    }
    return data;
}
/**
 * Reconstructs a binary packet from its placeholder packet and buffers
 *
 * @param {Object} packet - event packet with placeholders
 * @param {Array} buffers - binary buffers to put in placeholder positions
 * @return {Object} reconstructed packet
 * @public
 */
function reconstructPacket(packet, buffers) {
    packet.data = _reconstructPacket(packet.data, buffers);
    delete packet.attachments; // no longer useful
    return packet;
}
function _reconstructPacket(data, buffers) {
    if (!data)
        return data;
    if (data && data._placeholder === true) {
        const isIndexValid = typeof data.num === "number" &&
            data.num >= 0 &&
            data.num < buffers.length;
        if (isIndexValid) {
            return buffers[data.num]; // appropriate buffer (should be natural order anyway)
        }
        else {
            throw new Error("illegal attachments");
        }
    }
    else if (Array.isArray(data)) {
        for (let i = 0; i < data.length; i++) {
            data[i] = _reconstructPacket(data[i], buffers);
        }
    }
    else if (typeof data === "object") {
        for (const key in data) {
            if (Object.prototype.hasOwnProperty.call(data, key)) {
                data[key] = _reconstructPacket(data[key], buffers);
            }
        }
    }
    return data;
}

;// ./node_modules/socket.io-parser/build/esm/index.js



/**
 * These strings must not be used as event names, as they have a special meaning.
 */
const RESERVED_EVENTS = [
    "connect",
    "connect_error",
    "disconnect",
    "disconnecting",
    "newListener",
    "removeListener", // used by the Node.js EventEmitter
];
/**
 * Protocol version.
 *
 * @public
 */
const build_esm_protocol = 5;
var PacketType;
(function (PacketType) {
    PacketType[PacketType["CONNECT"] = 0] = "CONNECT";
    PacketType[PacketType["DISCONNECT"] = 1] = "DISCONNECT";
    PacketType[PacketType["EVENT"] = 2] = "EVENT";
    PacketType[PacketType["ACK"] = 3] = "ACK";
    PacketType[PacketType["CONNECT_ERROR"] = 4] = "CONNECT_ERROR";
    PacketType[PacketType["BINARY_EVENT"] = 5] = "BINARY_EVENT";
    PacketType[PacketType["BINARY_ACK"] = 6] = "BINARY_ACK";
})(PacketType || (PacketType = {}));
/**
 * A socket.io Encoder instance
 */
class Encoder {
    /**
     * Encoder constructor
     *
     * @param {function} replacer - custom replacer to pass down to JSON.parse
     */
    constructor(replacer) {
        this.replacer = replacer;
    }
    /**
     * Encode a packet as a single string if non-binary, or as a
     * buffer sequence, depending on packet type.
     *
     * @param {Object} obj - packet object
     */
    encode(obj) {
        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {
            if (hasBinary(obj)) {
                return this.encodeAsBinary({
                    type: obj.type === PacketType.EVENT
                        ? PacketType.BINARY_EVENT
                        : PacketType.BINARY_ACK,
                    nsp: obj.nsp,
                    data: obj.data,
                    id: obj.id,
                });
            }
        }
        return [this.encodeAsString(obj)];
    }
    /**
     * Encode packet as string.
     */
    encodeAsString(obj) {
        // first is type
        let str = "" + obj.type;
        // attachments if we have them
        if (obj.type === PacketType.BINARY_EVENT ||
            obj.type === PacketType.BINARY_ACK) {
            str += obj.attachments + "-";
        }
        // if we have a namespace other than `/`
        // we append it followed by a comma `,`
        if (obj.nsp && "/" !== obj.nsp) {
            str += obj.nsp + ",";
        }
        // immediately followed by the id
        if (null != obj.id) {
            str += obj.id;
        }
        // json data
        if (null != obj.data) {
            str += JSON.stringify(obj.data, this.replacer);
        }
        return str;
    }
    /**
     * Encode packet as 'buffer sequence' by removing blobs, and
     * deconstructing packet into object with placeholders and
     * a list of buffers.
     */
    encodeAsBinary(obj) {
        const deconstruction = deconstructPacket(obj);
        const pack = this.encodeAsString(deconstruction.packet);
        const buffers = deconstruction.buffers;
        buffers.unshift(pack); // add packet info to beginning of data list
        return buffers; // write all the buffers
    }
}
// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript
function isObject(value) {
    return Object.prototype.toString.call(value) === "[object Object]";
}
/**
 * A socket.io Decoder instance
 *
 * @return {Object} decoder
 */
class Decoder extends Emitter {
    /**
     * Decoder constructor
     *
     * @param {function} reviver - custom reviver to pass down to JSON.stringify
     */
    constructor(reviver) {
        super();
        this.reviver = reviver;
    }
    /**
     * Decodes an encoded packet string into packet JSON.
     *
     * @param {String} obj - encoded packet
     */
    add(obj) {
        let packet;
        if (typeof obj === "string") {
            if (this.reconstructor) {
                throw new Error("got plaintext data when reconstructing a packet");
            }
            packet = this.decodeString(obj);
            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;
            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {
                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;
                // binary packet's json
                this.reconstructor = new BinaryReconstructor(packet);
                // no attachments, labeled binary but no binary data to follow
                if (packet.attachments === 0) {
                    super.emitReserved("decoded", packet);
                }
            }
            else {
                // non-binary full packet
                super.emitReserved("decoded", packet);
            }
        }
        else if (isBinary(obj) || obj.base64) {
            // raw binary data
            if (!this.reconstructor) {
                throw new Error("got binary data when not reconstructing a packet");
            }
            else {
                packet = this.reconstructor.takeBinaryData(obj);
                if (packet) {
                    // received final buffer
                    this.reconstructor = null;
                    super.emitReserved("decoded", packet);
                }
            }
        }
        else {
            throw new Error("Unknown type: " + obj);
        }
    }
    /**
     * Decode a packet String (JSON data)
     *
     * @param {String} str
     * @return {Object} packet
     */
    decodeString(str) {
        let i = 0;
        // look up type
        const p = {
            type: Number(str.charAt(0)),
        };
        if (PacketType[p.type] === undefined) {
            throw new Error("unknown packet type " + p.type);
        }
        // look up attachments if type binary
        if (p.type === PacketType.BINARY_EVENT ||
            p.type === PacketType.BINARY_ACK) {
            const start = i + 1;
            while (str.charAt(++i) !== "-" && i != str.length) { }
            const buf = str.substring(start, i);
            if (buf != Number(buf) || str.charAt(i) !== "-") {
                throw new Error("Illegal attachments");
            }
            p.attachments = Number(buf);
        }
        // look up namespace (if any)
        if ("/" === str.charAt(i + 1)) {
            const start = i + 1;
            while (++i) {
                const c = str.charAt(i);
                if ("," === c)
                    break;
                if (i === str.length)
                    break;
            }
            p.nsp = str.substring(start, i);
        }
        else {
            p.nsp = "/";
        }
        // look up id
        const next = str.charAt(i + 1);
        if ("" !== next && Number(next) == next) {
            const start = i + 1;
            while (++i) {
                const c = str.charAt(i);
                if (null == c || Number(c) != c) {
                    --i;
                    break;
                }
                if (i === str.length)
                    break;
            }
            p.id = Number(str.substring(start, i + 1));
        }
        // look up json data
        if (str.charAt(++i)) {
            const payload = this.tryParse(str.substr(i));
            if (Decoder.isPayloadValid(p.type, payload)) {
                p.data = payload;
            }
            else {
                throw new Error("invalid payload");
            }
        }
        return p;
    }
    tryParse(str) {
        try {
            return JSON.parse(str, this.reviver);
        }
        catch (e) {
            return false;
        }
    }
    static isPayloadValid(type, payload) {
        switch (type) {
            case PacketType.CONNECT:
                return isObject(payload);
            case PacketType.DISCONNECT:
                return payload === undefined;
            case PacketType.CONNECT_ERROR:
                return typeof payload === "string" || isObject(payload);
            case PacketType.EVENT:
            case PacketType.BINARY_EVENT:
                return (Array.isArray(payload) &&
                    (typeof payload[0] === "number" ||
                        (typeof payload[0] === "string" &&
                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));
            case PacketType.ACK:
            case PacketType.BINARY_ACK:
                return Array.isArray(payload);
        }
    }
    /**
     * Deallocates a parser's resources
     */
    destroy() {
        if (this.reconstructor) {
            this.reconstructor.finishedReconstruction();
            this.reconstructor = null;
        }
    }
}
/**
 * A manager of a binary event's 'buffer sequence'. Should
 * be constructed whenever a packet of type BINARY_EVENT is
 * decoded.
 *
 * @param {Object} packet
 * @return {BinaryReconstructor} initialized reconstructor
 */
class BinaryReconstructor {
    constructor(packet) {
        this.packet = packet;
        this.buffers = [];
        this.reconPack = packet;
    }
    /**
     * Method to be called when binary data received from connection
     * after a BINARY_EVENT packet.
     *
     * @param {Buffer | ArrayBuffer} binData - the raw binary data received
     * @return {null | Object} returns null if more binary data is expected or
     *   a reconstructed packet object if all buffers have been received.
     */
    takeBinaryData(binData) {
        this.buffers.push(binData);
        if (this.buffers.length === this.reconPack.attachments) {
            // done with buffer list
            const packet = reconstructPacket(this.reconPack, this.buffers);
            this.finishedReconstruction();
            return packet;
        }
        return null;
    }
    /**
     * Cleans up binary packet reconstruction variables.
     */
    finishedReconstruction() {
        this.reconPack = null;
        this.buffers = [];
    }
}

;// ./node_modules/socket.io-client/build/esm/on.js
function on(obj, ev, fn) {
    obj.on(ev, fn);
    return function subDestroy() {
        obj.off(ev, fn);
    };
}

;// ./node_modules/socket.io-client/build/esm/socket.js



/**
 * Internal events.
 * These events can't be emitted by the user.
 */
const socket_RESERVED_EVENTS = Object.freeze({
    connect: 1,
    connect_error: 1,
    disconnect: 1,
    disconnecting: 1,
    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener
    newListener: 1,
    removeListener: 1,
});
/**
 * A Socket is the fundamental class for interacting with the server.
 *
 * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.
 *
 * @example
 * const socket = io();
 *
 * socket.on("connect", () => {
 *   console.log("connected");
 * });
 *
 * // send an event to the server
 * socket.emit("foo", "bar");
 *
 * socket.on("foobar", () => {
 *   // an event was received from the server
 * });
 *
 * // upon disconnection
 * socket.on("disconnect", (reason) => {
 *   console.log(`disconnected due to ${reason}`);
 * });
 */
class socket_Socket extends Emitter {
    /**
     * `Socket` constructor.
     */
    constructor(io, nsp, opts) {
        super();
        /**
         * Whether the socket is currently connected to the server.
         *
         * @example
         * const socket = io();
         *
         * socket.on("connect", () => {
         *   console.log(socket.connected); // true
         * });
         *
         * socket.on("disconnect", () => {
         *   console.log(socket.connected); // false
         * });
         */
        this.connected = false;
        /**
         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will
         * be transmitted by the server.
         */
        this.recovered = false;
        /**
         * Buffer for packets received before the CONNECT packet
         */
        this.receiveBuffer = [];
        /**
         * Buffer for packets that will be sent once the socket is connected
         */
        this.sendBuffer = [];
        /**
         * The queue of packets to be sent with retry in case of failure.
         *
         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.
         * @private
         */
        this._queue = [];
        /**
         * A sequence to generate the ID of the {@link QueuedPacket}.
         * @private
         */
        this._queueSeq = 0;
        this.ids = 0;
        /**
         * A map containing acknowledgement handlers.
         *
         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:
         *
         * - `socket.emit("test", (err, value) => { ... })` with `ackTimeout` option
         * - `socket.timeout(5000).emit("test", (err, value) => { ... })`
         * - `const value = await socket.emitWithAck("test")`
         *
         * From those that don't:
         *
         * - `socket.emit("test", (value) => { ... });`
         *
         * In the first case, the handlers will be called with an error when:
         *
         * - the timeout is reached
         * - the socket gets disconnected
         *
         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive
         * an acknowledgement from the server.
         *
         * @private
         */
        this.acks = {};
        this.flags = {};
        this.io = io;
        this.nsp = nsp;
        if (opts && opts.auth) {
            this.auth = opts.auth;
        }
        this._opts = Object.assign({}, opts);
        if (this.io._autoConnect)
            this.open();
    }
    /**
     * Whether the socket is currently disconnected
     *
     * @example
     * const socket = io();
     *
     * socket.on("connect", () => {
     *   console.log(socket.disconnected); // false
     * });
     *
     * socket.on("disconnect", () => {
     *   console.log(socket.disconnected); // true
     * });
     */
    get disconnected() {
        return !this.connected;
    }
    /**
     * Subscribe to open, close and packet events
     *
     * @private
     */
    subEvents() {
        if (this.subs)
            return;
        const io = this.io;
        this.subs = [
            on(io, "open", this.onopen.bind(this)),
            on(io, "packet", this.onpacket.bind(this)),
            on(io, "error", this.onerror.bind(this)),
            on(io, "close", this.onclose.bind(this)),
        ];
    }
    /**
     * Whether the Socket will try to reconnect when its Manager connects or reconnects.
     *
     * @example
     * const socket = io();
     *
     * console.log(socket.active); // true
     *
     * socket.on("disconnect", (reason) => {
     *   if (reason === "io server disconnect") {
     *     // the disconnection was initiated by the server, you need to manually reconnect
     *     console.log(socket.active); // false
     *   }
     *   // else the socket will automatically try to reconnect
     *   console.log(socket.active); // true
     * });
     */
    get active() {
        return !!this.subs;
    }
    /**
     * "Opens" the socket.
     *
     * @example
     * const socket = io({
     *   autoConnect: false
     * });
     *
     * socket.connect();
     */
    connect() {
        if (this.connected)
            return this;
        this.subEvents();
        if (!this.io["_reconnecting"])
            this.io.open(); // ensure open
        if ("open" === this.io._readyState)
            this.onopen();
        return this;
    }
    /**
     * Alias for {@link connect()}.
     */
    open() {
        return this.connect();
    }
    /**
     * Sends a `message` event.
     *
     * This method mimics the WebSocket.send() method.
     *
     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send
     *
     * @example
     * socket.send("hello");
     *
     * // this is equivalent to
     * socket.emit("message", "hello");
     *
     * @return self
     */
    send(...args) {
        args.unshift("message");
        this.emit.apply(this, args);
        return this;
    }
    /**
     * Override `emit`.
     * If the event is in `events`, it's emitted normally.
     *
     * @example
     * socket.emit("hello", "world");
     *
     * // all serializable datastructures are supported (no need to call JSON.stringify)
     * socket.emit("hello", 1, "2", { 3: ["4"], 5: Uint8Array.from([6]) });
     *
     * // with an acknowledgement from the server
     * socket.emit("hello", "world", (val) => {
     *   // ...
     * });
     *
     * @return self
     */
    emit(ev, ...args) {
        var _a, _b, _c;
        if (socket_RESERVED_EVENTS.hasOwnProperty(ev)) {
            throw new Error('"' + ev.toString() + '" is a reserved event name');
        }
        args.unshift(ev);
        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {
            this._addToQueue(args);
            return this;
        }
        const packet = {
            type: PacketType.EVENT,
            data: args,
        };
        packet.options = {};
        packet.options.compress = this.flags.compress !== false;
        // event ack callback
        if ("function" === typeof args[args.length - 1]) {
            const id = this.ids++;
            const ack = args.pop();
            this._registerAckCallback(id, ack);
            packet.id = id;
        }
        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;
        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());
        const discardPacket = this.flags.volatile && !isTransportWritable;
        if (discardPacket) {
        }
        else if (isConnected) {
            this.notifyOutgoingListeners(packet);
            this.packet(packet);
        }
        else {
            this.sendBuffer.push(packet);
        }
        this.flags = {};
        return this;
    }
    /**
     * @private
     */
    _registerAckCallback(id, ack) {
        var _a;
        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;
        if (timeout === undefined) {
            this.acks[id] = ack;
            return;
        }
        // @ts-ignore
        const timer = this.io.setTimeoutFn(() => {
            delete this.acks[id];
            for (let i = 0; i < this.sendBuffer.length; i++) {
                if (this.sendBuffer[i].id === id) {
                    this.sendBuffer.splice(i, 1);
                }
            }
            ack.call(this, new Error("operation has timed out"));
        }, timeout);
        const fn = (...args) => {
            // @ts-ignore
            this.io.clearTimeoutFn(timer);
            ack.apply(this, args);
        };
        fn.withError = true;
        this.acks[id] = fn;
    }
    /**
     * Emits an event and waits for an acknowledgement
     *
     * @example
     * // without timeout
     * const response = await socket.emitWithAck("hello", "world");
     *
     * // with a specific timeout
     * try {
     *   const response = await socket.timeout(1000).emitWithAck("hello", "world");
     * } catch (err) {
     *   // the server did not acknowledge the event in the given delay
     * }
     *
     * @return a Promise that will be fulfilled when the server acknowledges the event
     */
    emitWithAck(ev, ...args) {
        return new Promise((resolve, reject) => {
            const fn = (arg1, arg2) => {
                return arg1 ? reject(arg1) : resolve(arg2);
            };
            fn.withError = true;
            args.push(fn);
            this.emit(ev, ...args);
        });
    }
    /**
     * Add the packet to the queue.
     * @param args
     * @private
     */
    _addToQueue(args) {
        let ack;
        if (typeof args[args.length - 1] === "function") {
            ack = args.pop();
        }
        const packet = {
            id: this._queueSeq++,
            tryCount: 0,
            pending: false,
            args,
            flags: Object.assign({ fromQueue: true }, this.flags),
        };
        args.push((err, ...responseArgs) => {
            if (packet !== this._queue[0]) {
                // the packet has already been acknowledged
                return;
            }
            const hasError = err !== null;
            if (hasError) {
                if (packet.tryCount > this._opts.retries) {
                    this._queue.shift();
                    if (ack) {
                        ack(err);
                    }
                }
            }
            else {
                this._queue.shift();
                if (ack) {
                    ack(null, ...responseArgs);
                }
            }
            packet.pending = false;
            return this._drainQueue();
        });
        this._queue.push(packet);
        this._drainQueue();
    }
    /**
     * Send the first packet of the queue, and wait for an acknowledgement from the server.
     * @param force - whether to resend a packet that has not been acknowledged yet
     *
     * @private
     */
    _drainQueue(force = false) {
        if (!this.connected || this._queue.length === 0) {
            return;
        }
        const packet = this._queue[0];
        if (packet.pending && !force) {
            return;
        }
        packet.pending = true;
        packet.tryCount++;
        this.flags = packet.flags;
        this.emit.apply(this, packet.args);
    }
    /**
     * Sends a packet.
     *
     * @param packet
     * @private
     */
    packet(packet) {
        packet.nsp = this.nsp;
        this.io._packet(packet);
    }
    /**
     * Called upon engine `open`.
     *
     * @private
     */
    onopen() {
        if (typeof this.auth == "function") {
            this.auth((data) => {
                this._sendConnectPacket(data);
            });
        }
        else {
            this._sendConnectPacket(this.auth);
        }
    }
    /**
     * Sends a CONNECT packet to initiate the Socket.IO session.
     *
     * @param data
     * @private
     */
    _sendConnectPacket(data) {
        this.packet({
            type: PacketType.CONNECT,
            data: this._pid
                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)
                : data,
        });
    }
    /**
     * Called upon engine or manager `error`.
     *
     * @param err
     * @private
     */
    onerror(err) {
        if (!this.connected) {
            this.emitReserved("connect_error", err);
        }
    }
    /**
     * Called upon engine `close`.
     *
     * @param reason
     * @param description
     * @private
     */
    onclose(reason, description) {
        this.connected = false;
        delete this.id;
        this.emitReserved("disconnect", reason, description);
        this._clearAcks();
    }
    /**
     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from
     * the server.
     *
     * @private
     */
    _clearAcks() {
        Object.keys(this.acks).forEach((id) => {
            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);
            if (!isBuffered) {
                // note: handlers that do not accept an error as first argument are ignored here
                const ack = this.acks[id];
                delete this.acks[id];
                if (ack.withError) {
                    ack.call(this, new Error("socket has been disconnected"));
                }
            }
        });
    }
    /**
     * Called with socket packet.
     *
     * @param packet
     * @private
     */
    onpacket(packet) {
        const sameNamespace = packet.nsp === this.nsp;
        if (!sameNamespace)
            return;
        switch (packet.type) {
            case PacketType.CONNECT:
                if (packet.data && packet.data.sid) {
                    this.onconnect(packet.data.sid, packet.data.pid);
                }
                else {
                    this.emitReserved("connect_error", new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));
                }
                break;
            case PacketType.EVENT:
            case PacketType.BINARY_EVENT:
                this.onevent(packet);
                break;
            case PacketType.ACK:
            case PacketType.BINARY_ACK:
                this.onack(packet);
                break;
            case PacketType.DISCONNECT:
                this.ondisconnect();
                break;
            case PacketType.CONNECT_ERROR:
                this.destroy();
                const err = new Error(packet.data.message);
                // @ts-ignore
                err.data = packet.data.data;
                this.emitReserved("connect_error", err);
                break;
        }
    }
    /**
     * Called upon a server event.
     *
     * @param packet
     * @private
     */
    onevent(packet) {
        const args = packet.data || [];
        if (null != packet.id) {
            args.push(this.ack(packet.id));
        }
        if (this.connected) {
            this.emitEvent(args);
        }
        else {
            this.receiveBuffer.push(Object.freeze(args));
        }
    }
    emitEvent(args) {
        if (this._anyListeners && this._anyListeners.length) {
            const listeners = this._anyListeners.slice();
            for (const listener of listeners) {
                listener.apply(this, args);
            }
        }
        super.emit.apply(this, args);
        if (this._pid && args.length && typeof args[args.length - 1] === "string") {
            this._lastOffset = args[args.length - 1];
        }
    }
    /**
     * Produces an ack callback to emit with an event.
     *
     * @private
     */
    ack(id) {
        const self = this;
        let sent = false;
        return function (...args) {
            // prevent double callbacks
            if (sent)
                return;
            sent = true;
            self.packet({
                type: PacketType.ACK,
                id: id,
                data: args,
            });
        };
    }
    /**
     * Called upon a server acknowledgement.
     *
     * @param packet
     * @private
     */
    onack(packet) {
        const ack = this.acks[packet.id];
        if (typeof ack !== "function") {
            return;
        }
        delete this.acks[packet.id];
        // @ts-ignore FIXME ack is incorrectly inferred as 'never'
        if (ack.withError) {
            packet.data.unshift(null);
        }
        // @ts-ignore
        ack.apply(this, packet.data);
    }
    /**
     * Called upon server connect.
     *
     * @private
     */
    onconnect(id, pid) {
        this.id = id;
        this.recovered = pid && this._pid === pid;
        this._pid = pid; // defined only if connection state recovery is enabled
        this.connected = true;
        this.emitBuffered();
        this.emitReserved("connect");
        this._drainQueue(true);
    }
    /**
     * Emit buffered events (received and emitted).
     *
     * @private
     */
    emitBuffered() {
        this.receiveBuffer.forEach((args) => this.emitEvent(args));
        this.receiveBuffer = [];
        this.sendBuffer.forEach((packet) => {
            this.notifyOutgoingListeners(packet);
            this.packet(packet);
        });
        this.sendBuffer = [];
    }
    /**
     * Called upon server disconnect.
     *
     * @private
     */
    ondisconnect() {
        this.destroy();
        this.onclose("io server disconnect");
    }
    /**
     * Called upon forced client/server side disconnections,
     * this method ensures the manager stops tracking us and
     * that reconnections don't get triggered for this.
     *
     * @private
     */
    destroy() {
        if (this.subs) {
            // clean subscriptions to avoid reconnections
            this.subs.forEach((subDestroy) => subDestroy());
            this.subs = undefined;
        }
        this.io["_destroy"](this);
    }
    /**
     * Disconnects the socket manually. In that case, the socket will not try to reconnect.
     *
     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.
     *
     * @example
     * const socket = io();
     *
     * socket.on("disconnect", (reason) => {
     *   // console.log(reason); prints "io client disconnect"
     * });
     *
     * socket.disconnect();
     *
     * @return self
     */
    disconnect() {
        if (this.connected) {
            this.packet({ type: PacketType.DISCONNECT });
        }
        // remove socket from pool
        this.destroy();
        if (this.connected) {
            // fire events
            this.onclose("io client disconnect");
        }
        return this;
    }
    /**
     * Alias for {@link disconnect()}.
     *
     * @return self
     */
    close() {
        return this.disconnect();
    }
    /**
     * Sets the compress flag.
     *
     * @example
     * socket.compress(false).emit("hello");
     *
     * @param compress - if `true`, compresses the sending data
     * @return self
     */
    compress(compress) {
        this.flags.compress = compress;
        return this;
    }
    /**
     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not
     * ready to send messages.
     *
     * @example
     * socket.volatile.emit("hello"); // the server may or may not receive it
     *
     * @returns self
     */
    get volatile() {
        this.flags.volatile = true;
        return this;
    }
    /**
     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the
     * given number of milliseconds have elapsed without an acknowledgement from the server:
     *
     * @example
     * socket.timeout(5000).emit("my-event", (err) => {
     *   if (err) {
     *     // the server did not acknowledge the event in the given delay
     *   }
     * });
     *
     * @returns self
     */
    timeout(timeout) {
        this.flags.timeout = timeout;
        return this;
    }
    /**
     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
     * callback.
     *
     * @example
     * socket.onAny((event, ...args) => {
     *   console.log(`got ${event}`);
     * });
     *
     * @param listener
     */
    onAny(listener) {
        this._anyListeners = this._anyListeners || [];
        this._anyListeners.push(listener);
        return this;
    }
    /**
     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
     * callback. The listener is added to the beginning of the listeners array.
     *
     * @example
     * socket.prependAny((event, ...args) => {
     *   console.log(`got event ${event}`);
     * });
     *
     * @param listener
     */
    prependAny(listener) {
        this._anyListeners = this._anyListeners || [];
        this._anyListeners.unshift(listener);
        return this;
    }
    /**
     * Removes the listener that will be fired when any event is emitted.
     *
     * @example
     * const catchAllListener = (event, ...args) => {
     *   console.log(`got event ${event}`);
     * }
     *
     * socket.onAny(catchAllListener);
     *
     * // remove a specific listener
     * socket.offAny(catchAllListener);
     *
     * // or remove all listeners
     * socket.offAny();
     *
     * @param listener
     */
    offAny(listener) {
        if (!this._anyListeners) {
            return this;
        }
        if (listener) {
            const listeners = this._anyListeners;
            for (let i = 0; i < listeners.length; i++) {
                if (listener === listeners[i]) {
                    listeners.splice(i, 1);
                    return this;
                }
            }
        }
        else {
            this._anyListeners = [];
        }
        return this;
    }
    /**
     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,
     * e.g. to remove listeners.
     */
    listenersAny() {
        return this._anyListeners || [];
    }
    /**
     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
     * callback.
     *
     * Note: acknowledgements sent to the server are not included.
     *
     * @example
     * socket.onAnyOutgoing((event, ...args) => {
     *   console.log(`sent event ${event}`);
     * });
     *
     * @param listener
     */
    onAnyOutgoing(listener) {
        this._anyOutgoingListeners = this._anyOutgoingListeners || [];
        this._anyOutgoingListeners.push(listener);
        return this;
    }
    /**
     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
     * callback. The listener is added to the beginning of the listeners array.
     *
     * Note: acknowledgements sent to the server are not included.
     *
     * @example
     * socket.prependAnyOutgoing((event, ...args) => {
     *   console.log(`sent event ${event}`);
     * });
     *
     * @param listener
     */
    prependAnyOutgoing(listener) {
        this._anyOutgoingListeners = this._anyOutgoingListeners || [];
        this._anyOutgoingListeners.unshift(listener);
        return this;
    }
    /**
     * Removes the listener that will be fired when any event is emitted.
     *
     * @example
     * const catchAllListener = (event, ...args) => {
     *   console.log(`sent event ${event}`);
     * }
     *
     * socket.onAnyOutgoing(catchAllListener);
     *
     * // remove a specific listener
     * socket.offAnyOutgoing(catchAllListener);
     *
     * // or remove all listeners
     * socket.offAnyOutgoing();
     *
     * @param [listener] - the catch-all listener (optional)
     */
    offAnyOutgoing(listener) {
        if (!this._anyOutgoingListeners) {
            return this;
        }
        if (listener) {
            const listeners = this._anyOutgoingListeners;
            for (let i = 0; i < listeners.length; i++) {
                if (listener === listeners[i]) {
                    listeners.splice(i, 1);
                    return this;
                }
            }
        }
        else {
            this._anyOutgoingListeners = [];
        }
        return this;
    }
    /**
     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,
     * e.g. to remove listeners.
     */
    listenersAnyOutgoing() {
        return this._anyOutgoingListeners || [];
    }
    /**
     * Notify the listeners for each packet sent
     *
     * @param packet
     *
     * @private
     */
    notifyOutgoingListeners(packet) {
        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {
            const listeners = this._anyOutgoingListeners.slice();
            for (const listener of listeners) {
                listener.apply(this, packet.data);
            }
        }
    }
}

;// ./node_modules/socket.io-client/build/esm/contrib/backo2.js
/**
 * Initialize backoff timer with `opts`.
 *
 * - `min` initial timeout in milliseconds [100]
 * - `max` max timeout [10000]
 * - `jitter` [0]
 * - `factor` [2]
 *
 * @param {Object} opts
 * @api public
 */
function Backoff(opts) {
    opts = opts || {};
    this.ms = opts.min || 100;
    this.max = opts.max || 10000;
    this.factor = opts.factor || 2;
    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;
    this.attempts = 0;
}
/**
 * Return the backoff duration.
 *
 * @return {Number}
 * @api public
 */
Backoff.prototype.duration = function () {
    var ms = this.ms * Math.pow(this.factor, this.attempts++);
    if (this.jitter) {
        var rand = Math.random();
        var deviation = Math.floor(rand * this.jitter * ms);
        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;
    }
    return Math.min(ms, this.max) | 0;
};
/**
 * Reset the number of attempts.
 *
 * @api public
 */
Backoff.prototype.reset = function () {
    this.attempts = 0;
};
/**
 * Set the minimum duration
 *
 * @api public
 */
Backoff.prototype.setMin = function (min) {
    this.ms = min;
};
/**
 * Set the maximum duration
 *
 * @api public
 */
Backoff.prototype.setMax = function (max) {
    this.max = max;
};
/**
 * Set the jitter
 *
 * @api public
 */
Backoff.prototype.setJitter = function (jitter) {
    this.jitter = jitter;
};

;// ./node_modules/socket.io-client/build/esm/manager.js






class Manager extends Emitter {
    constructor(uri, opts) {
        var _a;
        super();
        this.nsps = {};
        this.subs = [];
        if (uri && "object" === typeof uri) {
            opts = uri;
            uri = undefined;
        }
        opts = opts || {};
        opts.path = opts.path || "/socket.io";
        this.opts = opts;
        installTimerFunctions(this, opts);
        this.reconnection(opts.reconnection !== false);
        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);
        this.reconnectionDelay(opts.reconnectionDelay || 1000);
        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);
        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);
        this.backoff = new Backoff({
            min: this.reconnectionDelay(),
            max: this.reconnectionDelayMax(),
            jitter: this.randomizationFactor(),
        });
        this.timeout(null == opts.timeout ? 20000 : opts.timeout);
        this._readyState = "closed";
        this.uri = uri;
        const _parser = opts.parser || socket_io_parser_build_esm_namespaceObject;
        this.encoder = new _parser.Encoder();
        this.decoder = new _parser.Decoder();
        this._autoConnect = opts.autoConnect !== false;
        if (this._autoConnect)
            this.open();
    }
    reconnection(v) {
        if (!arguments.length)
            return this._reconnection;
        this._reconnection = !!v;
        if (!v) {
            this.skipReconnect = true;
        }
        return this;
    }
    reconnectionAttempts(v) {
        if (v === undefined)
            return this._reconnectionAttempts;
        this._reconnectionAttempts = v;
        return this;
    }
    reconnectionDelay(v) {
        var _a;
        if (v === undefined)
            return this._reconnectionDelay;
        this._reconnectionDelay = v;
        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);
        return this;
    }
    randomizationFactor(v) {
        var _a;
        if (v === undefined)
            return this._randomizationFactor;
        this._randomizationFactor = v;
        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);
        return this;
    }
    reconnectionDelayMax(v) {
        var _a;
        if (v === undefined)
            return this._reconnectionDelayMax;
        this._reconnectionDelayMax = v;
        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);
        return this;
    }
    timeout(v) {
        if (!arguments.length)
            return this._timeout;
        this._timeout = v;
        return this;
    }
    /**
     * Starts trying to reconnect if reconnection is enabled and we have not
     * started reconnecting yet
     *
     * @private
     */
    maybeReconnectOnOpen() {
        // Only try to reconnect if it's the first time we're connecting
        if (!this._reconnecting &&
            this._reconnection &&
            this.backoff.attempts === 0) {
            // keeps reconnection from firing twice for the same reconnection loop
            this.reconnect();
        }
    }
    /**
     * Sets the current transport `socket`.
     *
     * @param {Function} fn - optional, callback
     * @return self
     * @public
     */
    open(fn) {
        if (~this._readyState.indexOf("open"))
            return this;
        this.engine = new Socket(this.uri, this.opts);
        const socket = this.engine;
        const self = this;
        this._readyState = "opening";
        this.skipReconnect = false;
        // emit `open`
        const openSubDestroy = on(socket, "open", function () {
            self.onopen();
            fn && fn();
        });
        const onError = (err) => {
            this.cleanup();
            this._readyState = "closed";
            this.emitReserved("error", err);
            if (fn) {
                fn(err);
            }
            else {
                // Only do this if there is no fn to handle the error
                this.maybeReconnectOnOpen();
            }
        };
        // emit `error`
        const errorSub = on(socket, "error", onError);
        if (false !== this._timeout) {
            const timeout = this._timeout;
            // set timer
            const timer = this.setTimeoutFn(() => {
                openSubDestroy();
                onError(new Error("timeout"));
                socket.close();
            }, timeout);
            if (this.opts.autoUnref) {
                timer.unref();
            }
            this.subs.push(() => {
                this.clearTimeoutFn(timer);
            });
        }
        this.subs.push(openSubDestroy);
        this.subs.push(errorSub);
        return this;
    }
    /**
     * Alias for open()
     *
     * @return self
     * @public
     */
    connect(fn) {
        return this.open(fn);
    }
    /**
     * Called upon transport open.
     *
     * @private
     */
    onopen() {
        // clear old subs
        this.cleanup();
        // mark as open
        this._readyState = "open";
        this.emitReserved("open");
        // add new subs
        const socket = this.engine;
        this.subs.push(on(socket, "ping", this.onping.bind(this)), on(socket, "data", this.ondata.bind(this)), on(socket, "error", this.onerror.bind(this)), on(socket, "close", this.onclose.bind(this)), 
        // @ts-ignore
        on(this.decoder, "decoded", this.ondecoded.bind(this)));
    }
    /**
     * Called upon a ping.
     *
     * @private
     */
    onping() {
        this.emitReserved("ping");
    }
    /**
     * Called with data.
     *
     * @private
     */
    ondata(data) {
        try {
            this.decoder.add(data);
        }
        catch (e) {
            this.onclose("parse error", e);
        }
    }
    /**
     * Called when parser fully decodes a packet.
     *
     * @private
     */
    ondecoded(packet) {
        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a "parse error"
        nextTick(() => {
            this.emitReserved("packet", packet);
        }, this.setTimeoutFn);
    }
    /**
     * Called upon socket error.
     *
     * @private
     */
    onerror(err) {
        this.emitReserved("error", err);
    }
    /**
     * Creates a new socket for the given `nsp`.
     *
     * @return {Socket}
     * @public
     */
    socket(nsp, opts) {
        let socket = this.nsps[nsp];
        if (!socket) {
            socket = new socket_Socket(this, nsp, opts);
            this.nsps[nsp] = socket;
        }
        else if (this._autoConnect && !socket.active) {
            socket.connect();
        }
        return socket;
    }
    /**
     * Called upon a socket close.
     *
     * @param socket
     * @private
     */
    _destroy(socket) {
        const nsps = Object.keys(this.nsps);
        for (const nsp of nsps) {
            const socket = this.nsps[nsp];
            if (socket.active) {
                return;
            }
        }
        this._close();
    }
    /**
     * Writes a packet.
     *
     * @param packet
     * @private
     */
    _packet(packet) {
        const encodedPackets = this.encoder.encode(packet);
        for (let i = 0; i < encodedPackets.length; i++) {
            this.engine.write(encodedPackets[i], packet.options);
        }
    }
    /**
     * Clean up transport subscriptions and packet buffer.
     *
     * @private
     */
    cleanup() {
        this.subs.forEach((subDestroy) => subDestroy());
        this.subs.length = 0;
        this.decoder.destroy();
    }
    /**
     * Close the current socket.
     *
     * @private
     */
    _close() {
        this.skipReconnect = true;
        this._reconnecting = false;
        this.onclose("forced close");
    }
    /**
     * Alias for close()
     *
     * @private
     */
    disconnect() {
        return this._close();
    }
    /**
     * Called when:
     *
     * - the low-level engine is closed
     * - the parser encountered a badly formatted packet
     * - all sockets are disconnected
     *
     * @private
     */
    onclose(reason, description) {
        var _a;
        this.cleanup();
        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();
        this.backoff.reset();
        this._readyState = "closed";
        this.emitReserved("close", reason, description);
        if (this._reconnection && !this.skipReconnect) {
            this.reconnect();
        }
    }
    /**
     * Attempt a reconnection.
     *
     * @private
     */
    reconnect() {
        if (this._reconnecting || this.skipReconnect)
            return this;
        const self = this;
        if (this.backoff.attempts >= this._reconnectionAttempts) {
            this.backoff.reset();
            this.emitReserved("reconnect_failed");
            this._reconnecting = false;
        }
        else {
            const delay = this.backoff.duration();
            this._reconnecting = true;
            const timer = this.setTimeoutFn(() => {
                if (self.skipReconnect)
                    return;
                this.emitReserved("reconnect_attempt", self.backoff.attempts);
                // check again for the case socket closed in above events
                if (self.skipReconnect)
                    return;
                self.open((err) => {
                    if (err) {
                        self._reconnecting = false;
                        self.reconnect();
                        this.emitReserved("reconnect_error", err);
                    }
                    else {
                        self.onreconnect();
                    }
                });
            }, delay);
            if (this.opts.autoUnref) {
                timer.unref();
            }
            this.subs.push(() => {
                this.clearTimeoutFn(timer);
            });
        }
    }
    /**
     * Called upon successful reconnect.
     *
     * @private
     */
    onreconnect() {
        const attempt = this.backoff.attempts;
        this._reconnecting = false;
        this.backoff.reset();
        this.emitReserved("reconnect", attempt);
    }
}

;// ./node_modules/socket.io-client/build/esm/index.js



/**
 * Managers cache.
 */
const cache = {};
function esm_lookup(uri, opts) {
    if (typeof uri === "object") {
        opts = uri;
        uri = undefined;
    }
    opts = opts || {};
    const parsed = url(uri, opts.path || "/socket.io");
    const source = parsed.source;
    const id = parsed.id;
    const path = parsed.path;
    const sameNamespace = cache[id] && path in cache[id]["nsps"];
    const newConnection = opts.forceNew ||
        opts["force new connection"] ||
        false === opts.multiplex ||
        sameNamespace;
    let io;
    if (newConnection) {
        io = new Manager(source, opts);
    }
    else {
        if (!cache[id]) {
            cache[id] = new Manager(source, opts);
        }
        io = cache[id];
    }
    if (parsed.query && !opts.query) {
        opts.query = parsed.queryKey;
    }
    return io.socket(parsed.path, opts);
}
// so that "lookup" can be used both as a function (e.g. `io(...)`) and as a
// namespace (e.g. `io.connect(...)`), for backward compatibility
Object.assign(esm_lookup, {
    Manager: Manager,
    Socket: socket_Socket,
    io: esm_lookup,
    connect: esm_lookup,
});
/**
 * Protocol version.
 *
 * @public
 */

/**
 * Expose constructors for standalone build.
 *
 * @public
 */



;// ./user/src/script/components/transaction/detail-transaction-page.js
function detail_transaction_page_typeof(o) { "@babel/helpers - typeof"; return detail_transaction_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, detail_transaction_page_typeof(o); }
function detail_transaction_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ detail_transaction_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == detail_transaction_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(detail_transaction_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function detail_transaction_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function detail_transaction_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { detail_transaction_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { detail_transaction_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function detail_transaction_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function detail_transaction_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, detail_transaction_page_toPropertyKey(o.key), o); } }
function detail_transaction_page_createClass(e, r, t) { return r && detail_transaction_page_defineProperties(e.prototype, r), t && detail_transaction_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function detail_transaction_page_callSuper(t, o, e) { return o = detail_transaction_page_getPrototypeOf(o), detail_transaction_page_possibleConstructorReturn(t, detail_transaction_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], detail_transaction_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function detail_transaction_page_possibleConstructorReturn(t, e) { if (e && ("object" == detail_transaction_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return detail_transaction_page_assertThisInitialized(t); }
function detail_transaction_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function detail_transaction_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && detail_transaction_page_setPrototypeOf(t, e); }
function detail_transaction_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return detail_transaction_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !detail_transaction_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return detail_transaction_page_construct(t, arguments, detail_transaction_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), detail_transaction_page_setPrototypeOf(Wrapper, t); }, detail_transaction_page_wrapNativeSuper(t); }
function detail_transaction_page_construct(t, e, r) { if (detail_transaction_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && detail_transaction_page_setPrototypeOf(p, r.prototype), p; }
function detail_transaction_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (detail_transaction_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function detail_transaction_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function detail_transaction_page_setPrototypeOf(t, e) { return detail_transaction_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, detail_transaction_page_setPrototypeOf(t, e); }
function detail_transaction_page_getPrototypeOf(t) { return detail_transaction_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, detail_transaction_page_getPrototypeOf(t); }
function detail_transaction_page_defineProperty(e, r, t) { return (r = detail_transaction_page_toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function detail_transaction_page_toPropertyKey(t) { var i = detail_transaction_page_toPrimitive(t, "string"); return "symbol" == detail_transaction_page_typeof(i) ? i : i + ""; }
function detail_transaction_page_toPrimitive(t, r) { if ("object" != detail_transaction_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != detail_transaction_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }




var DetailTransactionPage = /*#__PURE__*/function (_HTMLElement) {
  function DetailTransactionPage() {
    var _this;
    detail_transaction_page_classCallCheck(this, DetailTransactionPage);
    _this = detail_transaction_page_callSuper(this, DetailTransactionPage);
    detail_transaction_page_defineProperty(_this, "formatRupiah", function (money) {
      if (money === null || money === undefined) return "-";
      var numericMoney = typeof money === "string" ? Number.parseFloat(money) : money;
      if (isNaN(numericMoney)) return "-";
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(numericMoney);
    });
    _this.transactionId = null;
    _this.transactionDetails = null;
    _this.isLoading = true;
    _this.error = null;

    // State for messages
    _this._messages = [];
    _this._messagesLoading = false;
    _this._messagesError = null;

    // Socket.io related properties
    _this._socket = null;
    _this._isSocketConnected = false;

    // Bind methods
    _this.fetchTransactionDetails = _this.fetchTransactionDetails.bind(_this);
    _this.handleStatusUpdate = _this.handleStatusUpdate.bind(_this);
    // Bind methods for messages
    _this.fetchMessages = _this.fetchMessages.bind(_this);
    _this._handleSendMessageSocket = _this._handleSendMessageSocket.bind(_this);
    // Bind Socket.io methods
    _this._connectSocket = _this._connectSocket.bind(_this);
    _this._disconnectSocket = _this._disconnectSocket.bind(_this);
    _this._handleNewMessage = _this._handleNewMessage.bind(_this);
    _this._handleSocketError = _this._handleSocketError.bind(_this);
    return _this;
  }
  detail_transaction_page_inherits(DetailTransactionPage, _HTMLElement);
  return detail_transaction_page_createClass(DetailTransactionPage, [{
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }

    // Observe the 'transaction-id' attribute passed from the router
  }, {
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
      if (utils.isAuthenticated()) {
        this._ensureNotificationPermission();
      }
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      this.removeEventListeners();
      this._disconnectSocket();
      this.transactionId = null;
      this.transactionDetails = null;
      this.isLoading = true;
      this.error = null;
      this._messages = [];
      this._messagesLoading = false;
      this._messagesError = null;
      this._isSocketConnected = false;
    }
  }, {
    key: "attributeChangedCallback",
    value: function attributeChangedCallback(name, oldValue, newValue) {
      var newTransactionId = newValue && typeof newValue === "string" && newValue !== "undefined" && newValue !== "null" && newValue.trim() !== "" ? newValue.trim() : null;
      if (newTransactionId !== this.transactionId) {
        this._disconnectSocket();
        this.transactionId = newTransactionId;
        this.transactionDetails = null;
        this.isLoading = true;
        this.error = null;
        this._messages = [];
        this._messagesLoading = false;
        this._messagesError = null;
        if (this.transactionId) {
          if (!utils.isAuthenticated()) {
            sweetalert2_all_default().fire({
              icon: "warning",
              title: "Login Diperlukan",
              text: "Anda harus login untuk melihat detail transaksi.",
              confirmButtonColor: "#4f46e5"
            });
            utils.redirectToLogin();
            this.error = "Anda harus login untuk melihat detail ini.";
            this.isLoading = false;
            this.render();
            return;
          }
          this.render(); // Show loading
          this.fetchTransactionDetails(this.transactionId);
        } else {
          console.warn("Invalid transaction ID");
          this.error = "ID Transaksi tidak valid.";
          this.isLoading = false;
          this.render();
        }
      }
    }
  }, {
    key: "fetchTransactionDetails",
    value: function () {
      var _fetchTransactionDetails = detail_transaction_page_asyncToGenerator(/*#__PURE__*/detail_transaction_page_regeneratorRuntime().mark(function _callee(transactionId) {
        var response;
        return detail_transaction_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (transactionId) {
                _context.next = 6;
                break;
              }
              console.error("fetchTransactionDetails called without a valid transactionId.");
              this.error = "ID Transaksi tidak ditemukan.";
              this.isLoading = false;
              this.render();
              return _context.abrupt("return");
            case 6:
              this.isLoading = true;
              this.error = null;
              this.transactionDetails = null;
              _context.prev = 9;
              _context.next = 12;
              return authenticatedRequest("/transactions/".concat(transactionId), "GET");
            case 12:
              response = _context.sent;
              if (response.status === "success" && response.data) {
                this.transactionDetails = response.data;
                this.error = null;
                this.fetchMessages(transactionId);
                this._connectSocket(transactionId);
              } else {
                console.error("Error fetching transaction details:", response.message || "Unknown error", response);
                this.transactionDetails = null;
                this.error = response.message || "Gagal memuat detail transaksi.";
                this.isLoading = false;
                this._disconnectSocket();
                this.render();
              }
              _context.next = 24;
              break;
            case 16:
              _context.prev = 16;
              _context.t0 = _context["catch"](9);
              console.error("Error during API request for transaction details:", _context.t0);
              this.transactionDetails = null;
              this.error = "Terjadi kesalahan saat memuat detail transaksi.";
              this.isLoading = false;
              this._disconnectSocket();
              this.render();
            case 24:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[9, 16]]);
      }));
      function fetchTransactionDetails(_x) {
        return _fetchTransactionDetails.apply(this, arguments);
      }
      return fetchTransactionDetails;
    }()
  }, {
    key: "fetchMessages",
    value: function () {
      var _fetchMessages = detail_transaction_page_asyncToGenerator(/*#__PURE__*/detail_transaction_page_regeneratorRuntime().mark(function _callee2(transactionId) {
        var response;
        return detail_transaction_page_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              if (transactionId) {
                _context2.next = 6;
                break;
              }
              console.error("fetchMessages called without a valid transactionId.");
              this._messagesError = "ID Transaksi tidak ditemukan untuk memuat pesan.";
              this._messagesLoading = false;
              this.render();
              return _context2.abrupt("return");
            case 6:
              this._messagesLoading = true;
              this._messagesError = null;
              this._messages = [];
              _context2.prev = 9;
              _context2.next = 12;
              return authenticatedRequest("/messages/transaction/".concat(transactionId), "GET");
            case 12:
              response = _context2.sent;
              if (response.status === "success" && response.data) {
                this._messages = Array.isArray(response.data) ? response.data : [];
                this._messagesError = null;
                this._messages.sort(function (a, b) {
                  return new Date(a.created_at) - new Date(b.created_at);
                });
              } else {
                console.error("Error fetching messages:", response.message || "Unknown error", response);
                this._messages = [];
                this._messagesError = response.message || "Gagal memuat pesan.";
              }
              _context2.next = 21;
              break;
            case 16:
              _context2.prev = 16;
              _context2.t0 = _context2["catch"](9);
              console.error("Error during API request for messages:", _context2.t0);
              this._messages = [];
              this._messagesError = "Terjadi kesalahan saat memuat pesan.";
            case 21:
              _context2.prev = 21;
              this._messagesLoading = false;
              if (this.transactionDetails) {
                this.isLoading = false;
              }
              console.log("fetchMessages finally block reached. Current state after fetch:", {
                transactionDetails: !!this.transactionDetails,
                isLoading: this.isLoading,
                error: this.error,
                messagesCount: this._messages.length,
                messagesLoading: this._messagesLoading,
                messagesError: this._messagesError,
                isSocketConnected: this._isSocketConnected
              });
              this.render();
              return _context2.finish(21);
            case 27:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[9, 16, 21, 27]]);
      }));
      function fetchMessages(_x2) {
        return _fetchMessages.apply(this, arguments);
      }
      return fetchMessages;
    }()
  }, {
    key: "_connectSocket",
    value: function _connectSocket(transactionId) {
      var _this2 = this;
      if (this._isSocketConnected || !transactionId) {
        if (!transactionId) {
          console.warn("Cannot connect Socket.io: No valid transaction ID.");
        } else if (this._isSocketConnected) {}
        return;
      }
      var token = localStorage.getItem("token");
      if (!token) {
        console.warn("No JWT token found. Cannot connect Socket.io for authenticated user.");
        this._messagesError = "Anda harus login untuk menggunakan chat.";
        this.render();
        return;
      }
      this._socket = esm_lookup("https://api.pinjemin.site", {
        query: {
          transactionId: transactionId
        },
        auth: {
          token: token
        }
      });
      this._socket.on("connect", function () {
        _this2._isSocketConnected = true;
        console.log("Socket.io connected:", _this2._socket.id);
        if (_this2._socket && _this2.transactionId) {
          console.log("Emitting 'joinTransaction' for ID: ".concat(_this2.transactionId));
          _this2._socket.emit("joinTransaction", Number.parseInt(_this2.transactionId, 10));
        } else {
          console.warn("Cannot emit joinTransaction: missing transactionId or socket");
        }
      });
      this._socket.on("disconnect", function (reason) {
        _this2._isSocketConnected = false;
        console.log("Socket.io disconnected:", reason);
      });
      this._socket.on("connect_error", function (error) {
        console.error("Socket.io connect_error:", error);
        _this2._isSocketConnected = false;
      });
      this._socket.on("error", function (error) {
        console.error("Socket.io error:", error);
        _this2._isSocketConnected = false;
      });
      this._socket.on("newMessage", function (newMessage) {
        if (!newMessage || !_this2.transactionId) {
          console.warn("Invalid message or missing transaction ID");
          return;
        }
        if (newMessage.transaction_id && Number.parseInt(newMessage.transaction_id, 10) === Number.parseInt(_this2.transactionId, 10)) {
          if (!_this2._messages.find(function (msg) {
            return msg.id === newMessage.id;
          })) {
            _this2._messages.push(newMessage);
            _this2._messages.sort(function (a, b) {
              return new Date(a.created_at) - new Date(b.created_at);
            });
            _this2.render();
            requestAnimationFrame(function () {
              var messagesListElement = _this2.querySelector("#messages-list");
              if (messagesListElement) {
                messagesListElement.scrollTop = messagesListElement.scrollHeight;
              }
            });
          }
        } else {
          console.warn("Message not for this transaction:", {
            expected: _this2.transactionId,
            received: newMessage.transaction_id
          });
        }
      });
      this._socket.on("messageError", function (errorData) {
        console.error("Server reported message error:", errorData.error);
        sweetalert2_all_default().fire({
          icon: "error",
          title: "Gagal Mengirim Pesan",
          text: "Gagal mengirim pesan: " + (errorData.error || "Terjadi kesalahan server."),
          confirmButtonColor: "#4f46e5"
        });
      });
    }
  }, {
    key: "_disconnectSocket",
    value: function _disconnectSocket() {
      if (this._socket) {
        this._socket.off("connect");
        this._socket.off("disconnect");
        this._socket.off("connect_error", this._handleSocketError);
        this._socket.off("error", this._handleSocketError);
        this._socket.off("newMessage", this._handleNewMessage);
        this._socket.off("messageError");
        this._socket.disconnect();
        this._socket = null;
        this._isSocketConnected = false;
      }
    }
  }, {
    key: "_handleSocketError",
    value: function _handleSocketError(error) {
      console.error("Socket.io error handler:", error);
      this._isSocketConnected = false;
    }
  }, {
    key: "_handleNewMessage",
    value: function _handleNewMessage(newMessage) {
      var _this3 = this;
      if (newMessage && newMessage.transaction_id && this.transactionId && Number.parseInt(newMessage.transaction_id, 10) === Number.parseInt(this.transactionId, 10)) {
        if (!this._messages.find(function (msg) {
          return msg.id === newMessage.id;
        })) {
          this._messages.push(newMessage);
          this._messages.sort(function (a, b) {
            return new Date(a.created_at) - new Date(b.created_at);
          });
          this.render();
          requestAnimationFrame(function () {
            var messagesListElement = _this3.querySelector("#messages-list");
            if (messagesListElement) {
              messagesListElement.scrollTop = messagesListElement.scrollHeight;
            } else {
              console.warn("Messages list element not found for scrolling after new message.");
            }
          });
        } else {}
      } else {
        console.warn("Received new message not for this transaction or invalid format, ignoring:", newMessage);
        console.log("Expected transaction ID:", this.transactionId, "Received transaction ID:", newMessage ? newMessage.transaction_id : "N/A");
      }
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      var _this4 = this;
      this.removeEventListeners();
      var transactionActionsDiv = this.querySelector("#transaction-actions");
      if (transactionActionsDiv) {
        this.handleStatusUpdateDelegate = function (event) {
          var target = event.target;
          if (target.classList.contains("status-update-button")) {
            var newStatus = target.dataset.status;
            if (newStatus && _this4.transactionDetails && _this4.transactionDetails.id) {
              _this4.handleStatusUpdate(_this4.transactionDetails.id, newStatus);
            }
          }
        };
        transactionActionsDiv.addEventListener("click", this.handleStatusUpdateDelegate);
      }
      var sendMessageForm = this.querySelector("#send-message-form");
      if (sendMessageForm) {
        this._sendMessageSubmitHandler = this._handleSendMessageSocket;
        sendMessageForm.addEventListener("submit", this._sendMessageSubmitHandler);
      }
    }
  }, {
    key: "removeEventListeners",
    value: function removeEventListeners() {
      var transactionActionsDiv = this.querySelector("#transaction-actions");
      if (transactionActionsDiv && this.handleStatusUpdateDelegate) {
        transactionActionsDiv.removeEventListener("click", this.handleStatusUpdateDelegate);
        this.handleStatusUpdateDelegate = null;
      }
      var sendMessageForm = this.querySelector("#send-message-form");
      if (sendMessageForm && this._sendMessageSubmitHandler) {
        sendMessageForm.removeEventListener("submit", this._sendMessageSubmitHandler);
        this._sendMessageSubmitHandler = null;
      }
    }
  }, {
    key: "_handleSendMessageSocket",
    value: function _handleSendMessageSocket(event) {
      event.preventDefault();
      if (!this._socket || !this._isSocketConnected) {
        console.warn("Socket not connected");
        sweetalert2_all_default().fire({
          icon: "error",
          title: "Koneksi Terputus",
          text: "Koneksi chat tidak aktif. Silakan refresh halaman.",
          confirmButtonColor: "#4f46e5"
        });
        return;
      }
      if (!this.transactionDetails || !this.transactionDetails.id) {
        console.warn("Transaction details missing");
        sweetalert2_all_default().fire({
          icon: "error",
          title: "Data Tidak Lengkap",
          text: "Informasi transaksi tidak lengkap.",
          confirmButtonColor: "#4f46e5"
        });
        return;
      }
      var form = event.target;
      var messageInput = form.querySelector("#message-input");
      var content = messageInput ? messageInput.value.trim() : "";
      if (!content) {
        sweetalert2_all_default().fire({
          icon: "warning",
          title: "Pesan Kosong",
          text: "Pesan tidak boleh kosong.",
          confirmButtonColor: "#4f46e5"
        });
        return;
      }
      var sendButton = form.querySelector('button[type="submit"]');
      if (sendButton) sendButton.disabled = true;
      try {
        console.log("Emitting 'sendMessage' for transaction ID: ".concat(this.transactionDetails.id));
        var messageData = {
          transaction_id: Number.parseInt(this.transactionDetails.id, 10),
          content: content
        };
        this._socket.emit("sendMessage", messageData);
        console.log("sendMessage event emitted with data:", messageData);
        if (messageInput) messageInput.value = "";
      } catch (error) {
        console.error("Error emitting sendMessage event:", error);
        sweetalert2_all_default().fire({
          icon: "error",
          title: "Gagal Mengirim",
          text: "Terjadi kesalahan saat mengirim pesan.",
          confirmButtonColor: "#4f46e5"
        });
      } finally {
        if (sendButton) sendButton.disabled = false;
      }
    }

    // ✅ PERBAIKAN: HANYA minta permission - TIDAK register service worker
  }, {
    key: "_ensureNotificationPermission",
    value: function () {
      var _ensureNotificationPermission2 = detail_transaction_page_asyncToGenerator(/*#__PURE__*/detail_transaction_page_regeneratorRuntime().mark(function _callee3() {
        return detail_transaction_page_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.prev = 0;
              if ("Notification" in window) {
                _context3.next = 4;
                break;
              }
              console.log("Browser tidak mendukung push notifications");
              return _context3.abrupt("return");
            case 4:
              if (!(Notification.permission === "granted")) {
                _context3.next = 7;
                break;
              }
              console.log("Notification permission sudah granted");
              return _context3.abrupt("return");
            case 7:
              if (!(Notification.permission === "default")) {
                _context3.next = 10;
                break;
              }
              console.log("Notification permission belum diminta, akan dihandle oleh sistem utama");
              return _context3.abrupt("return");
            case 10:
              if (!(Notification.permission === "denied")) {
                _context3.next = 13;
                break;
              }
              console.log("Notification permission denied");
              return _context3.abrupt("return");
            case 13:
              _context3.next = 18;
              break;
            case 15:
              _context3.prev = 15;
              _context3.t0 = _context3["catch"](0);
              console.error("Error checking notification permission:", _context3.t0);
            case 18:
            case "end":
              return _context3.stop();
          }
        }, _callee3, null, [[0, 15]]);
      }));
      function _ensureNotificationPermission() {
        return _ensureNotificationPermission2.apply(this, arguments);
      }
      return _ensureNotificationPermission;
    }()
  }, {
    key: "render",
    value: function render() {
      console.log("DetailTransaction Render method called. Current state:", {
        isLoading: this.isLoading,
        error: this.error,
        hasData: !!this.transactionDetails,
        messagesLoading: this._messagesLoading,
        messagesError: this._messagesError,
        hasMessages: this._messages.length > 0,
        isSocketConnected: this._isSocketConnected
      });
      this._emptyContent();
      console.log("Render method: Content cleared.");
      try {
        var contentHtml = this.renderContentContent(this.isLoading, this.error, this.transactionDetails, utils.getUserInfo());
        var messagesSectionHtml = this.renderMessagesSection(this._messagesLoading, this._messagesError, this._messages, utils.getUserInfo());
        if (!contentHtml) {
          console.warn("renderContentContent returned an empty string or null.");
        }
        this.innerHTML = "\n            <div class=\"container mx-auto px-4 py-8\">\n                <h1 class=\"text-2xl font-bold mb-6\">Detail Transaksi</h1>\n\n                <!-- Transaction Detail Area -->\n                <div id=\"transaction-detail-content\">\n                        ".concat(contentHtml, "\n                    </div>\n\n                    <!-- Messages Section -->\n                     <div class=\"mt-8 border-t pt-8\">\n                        <h2 class=\"text-2xl font-bold mb-6\">Pesan Transaksi</h2>\n                        ").concat(messagesSectionHtml, "\n                </div>\n            </div>\n        ");
        console.log("Render method: innerHTML set.");
      } catch (renderError) {
        console.error("Error inside render method:", renderError);
        this.innerHTML = '<p class="text-red-500">Terjadi kesalahan saat menampilkan detail.</p>';
      }
      if (!this.isLoading && !this._messagesLoading && !this.error && !this._messagesError) {
        this.setupEventListeners();
      }
    }
  }, {
    key: "renderContentContent",
    value: function renderContentContent(isLoading, error, transaction, currentUser) {
      console.log("renderContentContent called with state:", {
        isLoading: isLoading,
        error: error,
        hasTransaction: !!transaction,
        hasCurrentUser: !!currentUser
      });
      if (isLoading) {
        console.log("renderContentContent: Showing loading.");
        return "<p>Memuat detail transaksi...</p>";
      }
      if (error) {
        console.log("renderContentContent: Showing error:", error);
        return "<p class=\"text-red-500\">Error: ".concat(error, "</p>");
      }
      if (!transaction) {
        console.log("renderContentContent: Showing no data message.");
        return "<p>Detail transaksi tidak tersedia.</p>";
      }
      var isSeller = currentUser && transaction.seller_id === currentUser.id;
      var isBuyer = currentUser && transaction.buyer_id === currentUser.id;
      console.log("renderContentContent: Transaction data available. isSeller:", isSeller, "isBuyer:", isBuyer);
      var formatRupiah = function formatRupiah(money) {
        if (money === null || money === undefined) return "-";
        var numericMoney = typeof money === "string" ? Number.parseFloat(money) : money;
        if (isNaN(numericMoney)) return "-";
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0
        }).format(numericMoney);
      };
      var statusDisplay = transaction.status || "Unknown Status";
      var statusColorClass = "text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full text-xs font-semibold";
      switch (transaction.status) {
        case "pending":
          statusColorClass = "text-yellow-600 bg-yellow-100 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
        case "ongoing":
          statusColorClass = "text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
        case "completed":
          statusColorClass = "text-green-600 bg-green-100 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
        case "cancelled":
          statusColorClass = "text-red-600 bg-red-500 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
        case "returned":
          statusColorClass = "text-purple-600 bg-purple-100 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
        case "late":
          statusColorClass = "text-orange-600 bg-orange-100 px-2 py-0.5 rounded-full text-xs font-semibold";
          break;
      }
      var availableSellerStatusTransitions = [];
      if (isSeller) {
        switch (transaction.status) {
          case "pending":
            availableSellerStatusTransitions = [{
              status: "ongoing",
              text: "Konfirmasi & Proses"
            }, {
              status: "cancelled",
              text: "Batalkan Transaksi"
            }];
            break;
          case "ongoing":
            if (transaction.type === "rent") {
              availableSellerStatusTransitions = [{
                status: "returned",
                text: "Item Telah Dikembalikan"
              }, {
                status: "completed",
                text: "Selesaikan Transaksi Sewa"
              }];
            } else {
              availableSellerStatusTransitions = [{
                status: "completed",
                text: "Selesaikan Transaksi Penjualan"
              }];
            }
            break;
          case "returned":
            if (transaction.type === "rent") {
              availableSellerStatusTransitions = [{
                status: "completed",
                text: "Selesaikan Transaksi Sewa"
              }];
            }
            break;
          case "late":
            if (transaction.type === "rent") {
              availableSellerStatusTransitions = [{
                status: "returned",
                text: "Item Dikembalikan (Terlambat)"
              }, {
                status: "completed",
                text: "Selesaikan Transaksi Sewa"
              }];
            }
            break;
          default:
            availableSellerStatusTransitions = [];
        }
      }
      var availableBuyerStatusTransitions = [];
      if (isBuyer) {
        switch (transaction.status) {
          case "pending":
            availableBuyerStatusTransitions = [{
              status: "cancelled",
              text: "Batalkan Pesanan"
            }];
            break;
          default:
            availableBuyerStatusTransitions = [];
        }
      }
      return "\n            <div class=\"bg-white shadow-md rounded-lg p-6\">\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <h3 class=\"text-xl font-semibold mb-4\">Informasi Transaksi</h3>\n                        <p><strong>ID Transaksi:</strong> ".concat(transaction.id, "</p>\n                        <p><strong>Tanggal Dibuat:</strong> ").concat(transaction.created_at ? new Date(transaction.created_at).toLocaleDateString("id-ID") : "-", " ").concat(transaction.created_at ? new Date(transaction.created_at).toLocaleTimeString("id-ID") : "-", "</p>\n                        ").concat(transaction.updated_at ? "<p><strong>Terakhir Diperbarui:</strong> ".concat(new Date(transaction.updated_at).toLocaleDateString("id-ID"), " ").concat(new Date(transaction.updated_at).toLocaleTimeString("id-ID"), "</p>") : "", "\n                        <p><strong>Tipe:</strong> <span class=\"capitalize\">").concat(transaction.type || "-", "</span></p>\n                        <p><strong>Status:</strong> <span class=\"").concat(statusColorClass, "\">").concat(statusDisplay, "</span></p>\n                        <p><strong>Metode Pembayaran:</strong> ").concat(transaction.payment_method || "-", "</p>\n                        <p><strong>Total Harga:</strong> ").concat(formatRupiah(transaction.total_price), "</p>\n                         ").concat(transaction.type === "rent" ? "\n                             <p><strong>Periode Sewa:</strong> ".concat(transaction.rent_start_date ? new Date(transaction.rent_start_date).toLocaleDateString("id-ID") : "-", " - ").concat(transaction.rent_end_date ? new Date(transaction.rent_end_date).toLocaleDateString("id-ID") : "-", "</p>\n                             <p><strong>Deposit Dibayar:</strong> ").concat(formatRupiah(transaction.deposit_paid), "</p>\n                         ") : "", "\n                    </div>\n                    <div>\n                        <h3 class=\"text-xl font-semibold mb-4\">Informasi Item</h3>\n                         <p><strong>Nama Item:</strong> ").concat(transaction.item_name || "Tidak Diketahui", "</p>\n                         ").concat(transaction.item_photo ? "\n                             <img src=\"https://api.pinjemin.site".concat(transaction.item_photo, "\" alt=\"Item Photo\" class=\"w-32 h-32 object-cover rounded mt-2\">\n                         ") : "", "\n                         <div class=\"mt-2\">\n                             <a href=\"/#/items/").concat(transaction.item_id, "\" class=\"text-blue-600 hover:underline\">Lihat Detail Item</a>\n                         </div>\n                    </div>\n                     <div>\n                         <h3 class=\"text-xl font-semibold mb-4\">Informasi Pihak Terlibat</h3>\n                         <p><strong>Pembeli/Penyewa:</strong> ").concat(transaction.buyer_name || "Tidak Diketahui", " (").concat(transaction.buyer_email || "-", ")</p>\n                         <p><strong>Penjual/Pemilik:</strong> ").concat(transaction.seller_name || "Tidak Diketahui", " (").concat(transaction.seller_email || "-", ")</p>\n                     </div>\n                </div>\n\n                 <div class=\"mt-6 border-t pt-6\">\n                     <h3 class=\"text-xl font-semibold mb-4\">Aksi Transaksi</h3>\n                     <div id=\"transaction-actions\">\n                          ").concat(isSeller && availableSellerStatusTransitions.length > 0 ? availableSellerStatusTransitions.map(function (transition) {
        return "\n                                <button class=\"status-update-button bg-indigo-500 hover:bg-indigo-600 text-white text-sm px-3 py-1 rounded mr-2\"\n                                        data-status=\"".concat(transition.status, "\">\n                                    ").concat(transition.text, "\n                                </button>\n                            ");
      }).join("") : isBuyer && availableBuyerStatusTransitions.length > 0 ? availableBuyerStatusTransitions.map(function (transition) {
        return "\n                                <button class=\"status-update-button bg-indigo-500 hover:bg-indigo-600 text-white text-sm px-3 py-1 rounded mr-2\"\n                                        data-status=\"".concat(transition.status, "\">\n                                    ").concat(transition.text, "\n                                </button>\n                            ");
      }).join("") : isSeller ? "<p>Tidak ada aksi status yang tersedia untuk Anda sebagai Penjual saat ini.</p>" : isBuyer ? "<p>Tidak ada aksi yang tersedia untuk Anda sebagai Pembeli saat ini.</p>" : "<p>Anda tidak memiliki izin untuk mengambil tindakan pada transaksi ini.</p>", "\n                     </div>\n                 </div>\n            </div>\n        ");
    }
  }, {
    key: "renderMessagesSection",
    value: function renderMessagesSection(isLoading, error, messages, currentUser) {
      var _this5 = this;
      console.log("renderMessagesSection called with state:", {
        isLoading: isLoading,
        error: error,
        hasMessages: messages.length > 0,
        hasCurrentUser: !!currentUser
      });
      if (isLoading) {
        return "<p>Memuat pesan...</p>";
      }
      if (error) {
        return "<p class=\"text-red-500\">Error memuat pesan: ".concat(error, "</p>");
      }
      if (!currentUser) {
        return '<p class="text-gray-600">Login untuk melihat pesan.</p>';
      }
      var messagesListHtml = messages.length === 0 ? "<p>Belum ada pesan dalam transaksi ini.</p>" : messages.map(function (message) {
        return _this5.renderMessage(message, currentUser.id);
      }).join("");
      return "\n            <div class=\"bg-gray-100 p-4 rounded-lg shadow-inner\">\n                <div id=\"messages-list\" class=\"h-64 overflow-y-auto mb-4 p-2 border rounded bg-white\">\n                    ".concat(messagesListHtml, "\n                </div>\n                <form id=\"send-message-form\">\n                    <div class=\"flex\">\n                        <input type=\"text\" id=\"message-input\" placeholder=\"Ketik pesan...\"\n                               class=\"flex-grow rounded-l-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 sm:text-sm\"\n                               required>\n                        <button type=\"submit\"\n                                class=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-r-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\">\n                            Kirim\n                        </button>\n                    </div>\n                </form>\n            </div>\n         ");
    }
  }, {
    key: "renderMessage",
    value: function renderMessage(message, currentUserId) {
      if (!message) return "";
      var isSender = message.sender_id === currentUserId;
      var alignmentClass = isSender ? "items-end" : "items-start";
      var bubbleColorClass = isSender ? "bg-indigo-500 text-white" : "bg-gray-300 text-gray-800";
      var senderName = isSender ? "Anda" : message.sender_name || "Pengguna";
      return "\n             <div class=\"flex flex-col ".concat(alignmentClass, " mb-2\">\n                 <div class=\"text-xs text-gray-600 mb-0.5\">").concat(senderName, "</div>\n                 <div class=\"").concat(bubbleColorClass, " p-2 rounded-lg max-w-xs break-words\">\n                     ").concat(message.content || "", "\n                 </div>\n                  <div class=\"text-xs text-gray-500 mt-0.5\">\n                     ").concat(message.created_at ? new Date(message.created_at).toLocaleTimeString("id-ID", {
        hour: "2-digit",
        minute: "2-digit"
      }) : "", "\n                 </div>\n             </div>\n         ");
    }
  }, {
    key: "handleStatusUpdate",
    value: function () {
      var _handleStatusUpdate = detail_transaction_page_asyncToGenerator(/*#__PURE__*/detail_transaction_page_regeneratorRuntime().mark(function _callee4(transactionId, newStatus) {
        var result, response, errorMessage;
        return detail_transaction_page_regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              if (!(!transactionId || !newStatus)) {
                _context4.next = 4;
                break;
              }
              console.error("Missing transaction ID or new status for update.");
              alert("Gagal memperbarui status: Informasi tidak lengkap.");
              return _context4.abrupt("return");
            case 4:
              _context4.next = 6;
              return sweetalert2_all_default().fire({
                title: "Konfirmasi Perubahan Status",
                html: "Apakah Anda yakin ingin mengubah status transaksi ini menjadi <strong>\"".concat(newStatus, "\"</strong>?"),
                icon: "question",
                showCancelButton: true,
                confirmButtonColor: "#4f46e5",
                cancelButtonColor: "#6b7280",
                confirmButtonText: "Ya, Ubah Status",
                cancelButtonText: "Batal"
              });
            case 6:
              result = _context4.sent;
              if (result.isConfirmed) {
                _context4.next = 9;
                break;
              }
              return _context4.abrupt("return");
            case 9:
              _context4.prev = 9;
              console.log("Attempting to update transaction ".concat(transactionId, " status to: ").concat(newStatus));
              _context4.next = 13;
              return authenticatedRequest("/transactions/".concat(transactionId, "/status"), "PATCH", {
                status: newStatus
              });
            case 13:
              response = _context4.sent;
              if (!(response.status === "success")) {
                _context4.next = 21;
                break;
              }
              console.log("Transaction status updated successfully:", response.data);
              _context4.next = 18;
              return sweetalert2_all_default().fire({
                icon: "success",
                title: "Berhasil!",
                text: "Status transaksi berhasil diperbarui!",
                confirmButtonColor: "#4f46e5"
              });
            case 18:
              this.fetchTransactionDetails(transactionId);
              _context4.next = 25;
              break;
            case 21:
              console.error("Failed to update transaction status:", response.message || "Unknown error", response);
              errorMessage = "Gagal memperbarui status transaksi: " + (response.message || "Terjadi kesalahan");
              if (response.errors && Array.isArray(response.errors)) {
                errorMessage += "\nValidasi error:";
                response.errors.forEach(function (err) {
                  if (err && err.param && err.msg) {
                    errorMessage += "\n- ".concat(err.param, ": ").concat(err.msg);
                  } else if (typeof err === "string") {
                    errorMessage += "\n- ".concat(err);
                  }
                });
              }
              sweetalert2_all_default().fire({
                icon: "error",
                title: "Gagal Memperbarui Status",
                html: errorMessage.replace(/\n/g, "<br>"),
                confirmButtonColor: "#4f46e5"
              });
            case 25:
              _context4.next = 31;
              break;
            case 27:
              _context4.prev = 27;
              _context4.t0 = _context4["catch"](9);
              console.error("Error during API request for status update:", _context4.t0);
              sweetalert2_all_default().fire({
                icon: "error",
                title: "Error",
                text: "Terjadi kesalahan saat memperbarui status transaksi.",
                confirmButtonColor: "#4f46e5"
              });
            case 31:
            case "end":
              return _context4.stop();
          }
        }, _callee4, this, [[9, 27]]);
      }));
      function handleStatusUpdate(_x3, _x4) {
        return _handleStatusUpdate.apply(this, arguments);
      }
      return handleStatusUpdate;
    }()
  }], [{
    key: "observedAttributes",
    get: function get() {
      return ["transaction-id"];
    }
  }]);
}(/*#__PURE__*/detail_transaction_page_wrapNativeSuper(HTMLElement));
customElements.define("detail-transaction-page", DetailTransactionPage);
;// ./user/src/script/components/transaction/my-seller-transactions-page.js
function my_seller_transactions_page_typeof(o) { "@babel/helpers - typeof"; return my_seller_transactions_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, my_seller_transactions_page_typeof(o); }
function my_seller_transactions_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ my_seller_transactions_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == my_seller_transactions_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(my_seller_transactions_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function my_seller_transactions_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function my_seller_transactions_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { my_seller_transactions_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { my_seller_transactions_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function my_seller_transactions_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function my_seller_transactions_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, my_seller_transactions_page_toPropertyKey(o.key), o); } }
function my_seller_transactions_page_createClass(e, r, t) { return r && my_seller_transactions_page_defineProperties(e.prototype, r), t && my_seller_transactions_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function my_seller_transactions_page_toPropertyKey(t) { var i = my_seller_transactions_page_toPrimitive(t, "string"); return "symbol" == my_seller_transactions_page_typeof(i) ? i : i + ""; }
function my_seller_transactions_page_toPrimitive(t, r) { if ("object" != my_seller_transactions_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != my_seller_transactions_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function my_seller_transactions_page_callSuper(t, o, e) { return o = my_seller_transactions_page_getPrototypeOf(o), my_seller_transactions_page_possibleConstructorReturn(t, my_seller_transactions_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], my_seller_transactions_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function my_seller_transactions_page_possibleConstructorReturn(t, e) { if (e && ("object" == my_seller_transactions_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return my_seller_transactions_page_assertThisInitialized(t); }
function my_seller_transactions_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function my_seller_transactions_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && my_seller_transactions_page_setPrototypeOf(t, e); }
function my_seller_transactions_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return my_seller_transactions_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !my_seller_transactions_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return my_seller_transactions_page_construct(t, arguments, my_seller_transactions_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), my_seller_transactions_page_setPrototypeOf(Wrapper, t); }, my_seller_transactions_page_wrapNativeSuper(t); }
function my_seller_transactions_page_construct(t, e, r) { if (my_seller_transactions_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && my_seller_transactions_page_setPrototypeOf(p, r.prototype), p; }
function my_seller_transactions_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (my_seller_transactions_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function my_seller_transactions_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function my_seller_transactions_page_setPrototypeOf(t, e) { return my_seller_transactions_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, my_seller_transactions_page_setPrototypeOf(t, e); }
function my_seller_transactions_page_getPrototypeOf(t) { return my_seller_transactions_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, my_seller_transactions_page_getPrototypeOf(t); }

 // Assuming Utils has isAuthenticated and redirectToLogin
var MySellerTransactionsPage = /*#__PURE__*/function (_HTMLElement) {
  function MySellerTransactionsPage() {
    var _this;
    my_seller_transactions_page_classCallCheck(this, MySellerTransactionsPage);
    _this = my_seller_transactions_page_callSuper(this, MySellerTransactionsPage);
    // State to hold seller transaction data
    _this.sellerTransactions = [];
    _this.isLoading = true;
    _this.error = null;
    return _this;
  }
  my_seller_transactions_page_inherits(MySellerTransactionsPage, _HTMLElement);
  return my_seller_transactions_page_createClass(MySellerTransactionsPage, [{
    key: "_emptyContent",
    value: function _emptyContent() {
      this.innerHTML = "";
    }
  }, {
    key: "connectedCallback",
    value: function connectedCallback() {
      // Check login status - crucial for authenticated pages
      if (!utils.isAuthenticated()) {
        alert('Anda harus login untuk melihat halaman ini.');
        utils.redirectToLogin(); // Redirect if not logged in
        return; // Stop further execution
      }
      this._emptyContent(); // Clear initial content
      this.renderLayout(); // Render basic layout
      this.fetchSellerTransactions(); // Fetch seller transactions
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      // Cleanup if necessary
    }
  }, {
    key: "renderLayout",
    value: function renderLayout() {
      this.innerHTML = "\n            <div class=\"container mx-auto px-4 py-8\">\n                <h1 class=\"text-2xl font-bold mb-6\">Transaksi Item Saya (Sebagai Penjual)</h1>\n\n                <!-- Seller Transaction List Area -->\n                <div id=\"seller-transactions-list\">\n                    ".concat(this.isLoading ? '<p>Memuat transaksi item Anda...</p>' : '', "\n                    ").concat(this.error ? "<p class=\"text-red-500\">".concat(this.error, "</p>") : '', "\n                </div>\n\n                <!-- TODO: Add Pagination here if needed -->\n            </div>\n        ");
    }
  }, {
    key: "renderSellerTransactions",
    value: function renderSellerTransactions() {
      var listElement = this.querySelector('#seller-transactions-list');
      if (!listElement) {
        console.error('Seller transactions list element not found!');
        return;
      }
      listElement.innerHTML = ''; // Clear loading message or previous content

      if (this.sellerTransactions.length === 0) {
        listElement.innerHTML = '<p>Anda belum memiliki item yang terjual atau disewa.</p>';
        return;
      }

      // Generate HTML for the list of seller transactions
      // Adapt styling with Tailwind CSS as needed
      listElement.innerHTML = "\n             <div class=\"space-y-4\">\n                ".concat(this.sellerTransactions.map(function (transaction) {
        // Determine status display and color class
        var statusDisplay = transaction.status || 'Status Tidak Diketahui';
        var statusColorClass = 'text-gray-800 bg-gray-100'; // Default gray

        switch (transaction.status) {
          case 'pending':
            statusColorClass = 'text-yellow-800 bg-yellow-100'; // Yellow for pending
            break;
          case 'approved':
            statusColorClass = 'text-blue-800 bg-blue-100'; // Blue for approved
            break;
          case 'rejected':
          case 'cancelled':
            statusColorClass = 'text-red-800 bg-red-100'; // Red for rejected/cancelled
            break;
          case 'completed':
            statusColorClass = 'text-green-800 bg-green-100'; // Green for completed
            break;
          case 'rented':
            // Status ini mungkin muncul jika transaksi sewa masih berjalan
            statusColorClass = 'text-purple-800 bg-purple-100'; // Purple for rented
            break;
          // Tambahkan case lain jika ada status transaksi lain di backend
          default:
            // Gunakan default gray jika status tidak dikenali
            break;
        }

        // Combine base badge classes with status-specific color classes
        var badgeClasses = "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ".concat(statusColorClass);
        return "\n                    <div class=\"border p-4 rounded-md shadow-sm bg-white flex justify-between items-center flex-wrap\">\n                         <div class=\"flex-1 min-w-0 mr-4\">\n                            <h3 class=\"text-lg font-semibold\">Item: ".concat(transaction.item_name || 'Nama Item Tidak Diketahui', "</h3>\n                            <p>Tipe Transaksi: <span class=\"capitalize\">").concat(transaction.type, "</span></p>\n                            <p>Status: <span class=\"").concat(badgeClasses, "\">").concat(statusDisplay, "</span></p>\n                            <p>Pembeli/Penyewa: ").concat(transaction.buyer_name || 'Tidak Diketahui', "</p>\n                            <p>Total Harga: Rp ").concat(transaction.total_price ? parseFloat(transaction.total_price).toLocaleString('id-ID') : 'N/A', "</p>\n                            ").concat(transaction.type === 'rent' ? "\n                                <p>Tanggal Sewa: ".concat(transaction.rent_start_date ? new Date(transaction.rent_start_date).toLocaleDateString('id-ID') : '-', " - ").concat(transaction.rent_end_date ? new Date(transaction.rent_end_date).toLocaleDateString('id-ID') : '-', "</p>\n                                <p>Deposit Dibayar: Rp ").concat(transaction.deposit_paid ? parseFloat(transaction.deposit_paid).toLocaleString('id-ID') : '0', "</p>\n                            ") : '', "\n                            <p>Tanggal Transaksi: ").concat(transaction.created_at ? new Date(transaction.created_at).toLocaleDateString('id-ID') : '-', "</p>\n                            <!-- Add more details as needed -->\n                         </div>\n                        <div class=\"mt-4 md:mt-0\">\n                           <a href=\"/#/transactions/").concat(transaction.id, "\" class=\"bg-blue-500 hover:bg-blue-700 text-white text-sm px-3 py-1 rounded inline-block\">Detail</a>\n                            <!-- TODO: Add status update buttons based on current status and type -->\n                        </div>\n                    </div>\n                ");
      }).join(''), "\n             </div>\n        ");
    }
  }, {
    key: "fetchSellerTransactions",
    value: function () {
      var _fetchSellerTransactions = my_seller_transactions_page_asyncToGenerator(/*#__PURE__*/my_seller_transactions_page_regeneratorRuntime().mark(function _callee() {
        var response;
        return my_seller_transactions_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              this.isLoading = true;
              this.error = null;
              this.renderLayout(); // Show loading state
              _context.prev = 3;
              _context.next = 6;
              return authenticatedRequest("/transactions/seller", 'GET');
            case 6:
              response = _context.sent;
              if (response.status === 'success' && response.data) {
                console.log('Fetched seller transactions:', response.data);
                this.sellerTransactions = response.data; // Assuming response.data is the array
                this.error = null; // Clear any previous errors
              } else {
                console.error('Error fetching seller transactions:', response.message || 'Unknown error');
                this.sellerTransactions = []; // Clear data on error
                this.error = response.message || 'Gagal memuat transaksi penjual.';
              }
              _context.next = 15;
              break;
            case 10:
              _context.prev = 10;
              _context.t0 = _context["catch"](3);
              console.error('Error during API request for seller transactions:', _context.t0);
              this.sellerTransactions = []; // Clear data on error
              // apiService handles 401/403 redirect
              this.error = 'Terjadi kesalahan saat memuat transaksi penjual.';
            case 15:
              _context.prev = 15;
              this.isLoading = false; // Hide loading state
              this.renderSellerTransactions(); // Render the list (either with data or error/empty message)
              return _context.finish(15);
            case 19:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[3, 10, 15, 19]]);
      }));
      function fetchSellerTransactions() {
        return _fetchSellerTransactions.apply(this, arguments);
      }
      return fetchSellerTransactions;
    }()
  }]);
}(/*#__PURE__*/my_seller_transactions_page_wrapNativeSuper(HTMLElement));
customElements.define('my-seller-transactions-page', MySellerTransactionsPage);
;// ./user/src/script/components/community/community-page.js
function community_page_typeof(o) { "@babel/helpers - typeof"; return community_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, community_page_typeof(o); }
function community_page_toConsumableArray(r) { return community_page_arrayWithoutHoles(r) || community_page_iterableToArray(r) || community_page_unsupportedIterableToArray(r) || community_page_nonIterableSpread(); }
function community_page_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function community_page_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return community_page_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? community_page_arrayLikeToArray(r, a) : void 0; } }
function community_page_iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function community_page_arrayWithoutHoles(r) { if (Array.isArray(r)) return community_page_arrayLikeToArray(r); }
function community_page_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function community_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ community_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == community_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(community_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function community_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function community_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { community_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { community_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function community_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function community_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, community_page_toPropertyKey(o.key), o); } }
function community_page_createClass(e, r, t) { return r && community_page_defineProperties(e.prototype, r), t && community_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function community_page_toPropertyKey(t) { var i = community_page_toPrimitive(t, "string"); return "symbol" == community_page_typeof(i) ? i : i + ""; }
function community_page_toPrimitive(t, r) { if ("object" != community_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != community_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function community_page_callSuper(t, o, e) { return o = community_page_getPrototypeOf(o), community_page_possibleConstructorReturn(t, community_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], community_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function community_page_possibleConstructorReturn(t, e) { if (e && ("object" == community_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return community_page_assertThisInitialized(t); }
function community_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function community_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && community_page_setPrototypeOf(t, e); }
function community_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return community_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !community_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return community_page_construct(t, arguments, community_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), community_page_setPrototypeOf(Wrapper, t); }, community_page_wrapNativeSuper(t); }
function community_page_construct(t, e, r) { if (community_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && community_page_setPrototypeOf(p, r.prototype), p; }
function community_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (community_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function community_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function community_page_setPrototypeOf(t, e) { return community_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, community_page_setPrototypeOf(t, e); }
function community_page_getPrototypeOf(t) { return community_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, community_page_getPrototypeOf(t); }



var CommunityPage = /*#__PURE__*/function (_HTMLElement) {
  function CommunityPage() {
    var _this;
    community_page_classCallCheck(this, CommunityPage);
    _this = community_page_callSuper(this, CommunityPage);
    _this._messages = [];
    _this._socket = null;
    _this._isSocketConnected = false;
    _this._isLoading = false;
    _this._hasMoreMessages = true;
    _this._currentPage = 1;
    _this._messagesPerPage = 20;

    // Bind methods
    _this.fetchMessageHistory = _this.fetchMessageHistory.bind(_this);
    _this.loadMoreMessages = _this.loadMoreMessages.bind(_this);
    _this._connectSocket = _this._connectSocket.bind(_this);
    _this._handleNewMessage = _this._handleNewMessage.bind(_this);
    _this._handleScroll = _this._handleScroll.bind(_this);
    return _this;
  }
  community_page_inherits(CommunityPage, _HTMLElement);
  return community_page_createClass(CommunityPage, [{
    key: "connectedCallback",
    value: function () {
      var _connectedCallback = community_page_asyncToGenerator(/*#__PURE__*/community_page_regeneratorRuntime().mark(function _callee() {
        var _this2 = this;
        return community_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (utils.isAuthenticated()) {
                _context.next = 3;
                break;
              }
              utils.redirectToLogin();
              return _context.abrupt("return");
            case 3:
              _context.next = 5;
              return this.fetchMessageHistory();
            case 5:
              // page 1
              this._connectSocket();
              this.render();
              this._setupScrollListener();

              // ✅ Auto-scroll to bottom on first load
              setTimeout(function () {
                var container = _this2.querySelector('.messages-container');
                if (container) {
                  container.scrollTop = container.scrollHeight;
                }
              }, 0);
            case 9:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function connectedCallback() {
        return _connectedCallback.apply(this, arguments);
      }
      return connectedCallback;
    }()
  }, {
    key: "fetchMessageHistory",
    value: function () {
      var _fetchMessageHistory = community_page_asyncToGenerator(/*#__PURE__*/community_page_regeneratorRuntime().mark(function _callee2() {
        var page,
          response,
          newMessages,
          _args2 = arguments;
        return community_page_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              page = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : 1;
              _context2.prev = 1;
              this._isLoading = true;
              _context2.next = 5;
              return authenticatedRequest("/community-messages?page=".concat(page, "&limit=").concat(this._messagesPerPage), 'GET');
            case 5:
              response = _context2.sent;
              if (response.status === 'success') {
                newMessages = response.data || [];
                if (page === 1) {
                  this._messages = newMessages;
                } else {
                  // Prepend older messages at the beginning
                  this._messages = [].concat(community_page_toConsumableArray(newMessages), community_page_toConsumableArray(this._messages));
                }
                this._hasMoreMessages = newMessages.length === this._messagesPerPage;
                this._currentPage = page;
              }
              _context2.next = 11;
              break;
            case 9:
              _context2.prev = 9;
              _context2.t0 = _context2["catch"](1);
            case 11:
              _context2.prev = 11;
              this._isLoading = false;
              return _context2.finish(11);
            case 14:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[1, 9, 11, 14]]);
      }));
      function fetchMessageHistory() {
        return _fetchMessageHistory.apply(this, arguments);
      }
      return fetchMessageHistory;
    }()
  }, {
    key: "loadMoreMessages",
    value: function () {
      var _loadMoreMessages = community_page_asyncToGenerator(/*#__PURE__*/community_page_regeneratorRuntime().mark(function _callee3() {
        var container, previousScrollHeight;
        return community_page_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (!(this._isLoading || !this._hasMoreMessages)) {
                _context3.next = 2;
                break;
              }
              return _context3.abrupt("return");
            case 2:
              container = this.querySelector('.messages-container');
              previousScrollHeight = container.scrollHeight;
              _context3.next = 6;
              return this.fetchMessageHistory(this._currentPage + 1);
            case 6:
              this.render();

              // Maintain scroll position after loading older messages
              setTimeout(function () {
                var newScrollHeight = container.scrollHeight;
                container.scrollTop = newScrollHeight - previousScrollHeight;
              }, 0);
            case 8:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function loadMoreMessages() {
        return _loadMoreMessages.apply(this, arguments);
      }
      return loadMoreMessages;
    }()
  }, {
    key: "_setupScrollListener",
    value: function _setupScrollListener() {
      var container = this.querySelector('.messages-container');
      if (container) {
        container.addEventListener('scroll', this._handleScroll);
      }
    }
  }, {
    key: "_handleScroll",
    value: function _handleScroll(e) {
      var container = e.target;
      // Load more when scrolled to top
      if (container.scrollTop <= 100 && this._hasMoreMessages && !this._isLoading) {
        this.loadMoreMessages();
      }
    }
  }, {
    key: "_connectSocket",
    value: function _connectSocket() {
      var _this3 = this;
      var token = localStorage.getItem('token');
      this._socket = esm_lookup('https://api.pinjemin.site', {
        auth: {
          token: token
        }
      });
      this._socket.on('connect', function () {
        _this3._isSocketConnected = true;
        _this3._socket.emit('joinCommunity');
        _this3._setupInputListeners();
      });
      this._socket.on('newCommunityMessage', this._handleNewMessage);
    }
  }, {
    key: "_setupInputListeners",
    value: function _setupInputListeners() {
      var _this4 = this;
      var sendBtn = this.querySelector('.send-button');
      var input = this.querySelector('.message-input-field');
      var sendMessage = function sendMessage() {
        var message = input === null || input === void 0 ? void 0 : input.value.trim();
        if (message && _this4._isSocketConnected) {
          _this4._socket.emit('sendCommunityMessage', {
            content: message
          });
          input.value = '';
          input.style.height = 'auto';
        }
      };

      // Remove existing listeners to prevent duplicates
      sendBtn === null || sendBtn === void 0 || sendBtn.removeEventListener('click', this._sendMessage);
      input === null || input === void 0 || input.removeEventListener('keypress', this._handleKeypress);
      input === null || input === void 0 || input.removeEventListener('input', this._handleInput);

      // Store bound functions
      this._sendMessage = sendMessage;
      this._handleKeypress = function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };
      this._handleInput = function (e) {
        e.target.style.height = 'auto';
        e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
      };

      // Add new listeners
      sendBtn === null || sendBtn === void 0 || sendBtn.addEventListener('click', this._sendMessage);
      input === null || input === void 0 || input.addEventListener('keypress', this._handleKeypress);
      input === null || input === void 0 || input.addEventListener('input', this._handleInput);
    }
  }, {
    key: "_handleNewMessage",
    value: function _handleNewMessage(message) {
      var container = this.querySelector('.messages-container');
      var currentUserId = localStorage.getItem('userId');
      var isOwn = message.sender_id == currentUserId;
      var wasAtBottom = container && container.scrollTop + container.clientHeight >= container.scrollHeight - 50;

      // Tambahkan ke internal array
      this._messages.push(message);

      // ✅ Tambahkan langsung ke DOM, bukan render ulang
      if (container) {
        var msgEl = document.createElement('div');
        msgEl.className = "message ".concat(isOwn ? 'own' : '');
        var initials = (message.sender_name || 'U').charAt(0).toUpperCase();
        msgEl.innerHTML = "\n        <div class=\"message-avatar\">".concat(initials, "</div>\n        <div class=\"message-content\">\n          <div class=\"message-bubble\">").concat(message.content, "</div>\n          <div class=\"message-meta\">\n            ").concat(!isOwn ? "<span class=\"message-sender\">".concat(message.sender_name || 'User', "</span>") : '', "\n            <span class=\"message-time\">").concat(this._formatTime(message.created_at), "</span>\n          </div>\n        </div>\n      ");
        container.appendChild(msgEl);

        // ✅ Scroll ke bawah hanya jika:
        // - kamu sendiri yang kirim
        // - atau sebelumnya user memang scroll di bawah
        if (isOwn || wasAtBottom) {
          setTimeout(function () {
            container.scrollTop = container.scrollHeight;
          }, 0);
        }
      }
    }
  }, {
    key: "_formatTime",
    value: function _formatTime(dateString) {
      var date = new Date(dateString);
      var now = new Date();
      var diffInHours = (now - date) / (1000 * 60 * 60);
      if (diffInHours < 24) {
        return date.toLocaleTimeString('id-ID', {
          hour: '2-digit',
          minute: '2-digit'
        });
      } else {
        return date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$_messages$,
        _this5 = this;
      var provinceName = ((_this$_messages$ = this._messages[0]) === null || _this$_messages$ === void 0 ? void 0 : _this$_messages$.sender_province_name) || '';
      var currentUserId = localStorage.getItem('userId');
      this.innerHTML = "\n      <style>\n        * {\n          box-sizing: border-box;\n        }\n        \n        .community-container {\n          max-width: 800px;\n          margin: 0 auto;\n          height: 80vh;\n          display: flex;\n          flex-direction: column;\n          background: #f8fafc;\n          border: 1px solid #e2e8f0;\n          border-radius: 12px;\n          overflow: hidden;\n        }\n        \n        .chat-header {\n          background: #ffffff;\n          padding: 16px 20px;\n          border-bottom: 1px solid #e2e8f0;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .chat-header-info h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: #1a202c;\n        }\n        \n        .chat-header-info p {\n          margin: 0;\n          font-size: 14px;\n          color: #718096;\n        }\n        \n        .online-indicator {\n          width: 12px;\n          height: 12px;\n          background: #48bb78;\n          border-radius: 50%;\n          border: 2px solid #ffffff;\n        }\n        \n        .messages-container {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n          background: #ffffff;\n          scroll-behavior: smooth;\n        }\n        \n        .messages-container::-webkit-scrollbar {\n          width: 6px;\n        }\n        \n        .messages-container::-webkit-scrollbar-track {\n          background: transparent;\n        }\n        \n        .messages-container::-webkit-scrollbar-thumb {\n          background: #cbd5e0;\n          border-radius: 3px;\n        }\n        \n        .loading-indicator {\n          text-align: center;\n          padding: 12px;\n          color: #718096;\n          font-size: 14px;\n        }\n        \n        .message {\n          margin-bottom: 16px;\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n        }\n        \n        .message.own {\n          flex-direction: row-reverse;\n        }\n        \n        .message-avatar {\n          width: 36px;\n          height: 36px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-weight: 600;\n          font-size: 14px;\n          flex-shrink: 0;\n        }\n        \n        .message-content {\n          max-width: 70%;\n          min-width: 120px;\n        }\n        \n        .message-bubble {\n          padding: 12px 16px;\n          border-radius: 18px;\n          background: #f7fafc;\n          border: 1px solid #e2e8f0;\n          word-wrap: break-word;\n          line-height: 1.4;\n        }\n        \n        .message.own .message-bubble {\n          background: #4299e1;\n          color: white;\n          border-color: #4299e1;\n        }\n        \n        .message-meta {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin-top: 4px;\n          font-size: 12px;\n          color: #718096;\n        }\n        \n        .message.own .message-meta {\n          justify-content: flex-end;\n        }\n        \n        .message-sender {\n          font-weight: 500;\n        }\n        \n        .message-time {\n          color: #a0aec0;\n        }\n        \n        .message-input-container {\n          padding: 16px 20px;\n          background: #ffffff;\n          border-top: 1px solid #e2e8f0;\n          display: flex;\n          align-items: flex-end;\n          gap: 12px;\n        }\n        \n        .message-input-field {\n          flex: 1;\n          padding: 12px 16px;\n          border: 1px solid #e2e8f0;\n          border-radius: 24px;\n          background: #f7fafc;\n          resize: none;\n          outline: none;\n          font-family: inherit;\n          font-size: 14px;\n          line-height: 1.4;\n          max-height: 120px;\n          min-height: 44px;\n          transition: all 0.2s ease;\n        }\n        \n        .message-input-field:focus {\n          border-color: #4299e1;\n          background: #ffffff;\n          box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);\n        }\n        \n        .message-input-field::placeholder {\n          color: #a0aec0;\n        }\n        \n        .send-button {\n          width: 44px;\n          height: 44px;\n          border: none;\n          border-radius: 50%;\n          background: #4299e1;\n          color: white;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all 0.2s ease;\n          flex-shrink: 0;\n        }\n        \n        .send-button:hover {\n          background: #3182ce;\n          transform: scale(1.05);\n        }\n        \n        .send-button:active {\n          transform: scale(0.95);\n        }\n        \n        .empty-state {\n          text-align: center;\n          color: #718096;\n          padding: 40px 20px;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .empty-state-icon {\n          width: 64px;\n          height: 64px;\n          border-radius: 50%;\n          background: #f7fafc;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 24px;\n        }\n        \n        @media (max-width: 768px) {\n          .community-container {\n            height: 90vh;\n            border-radius: 0;\n            border: none;\n          }\n          \n          .message-content {\n            max-width: 85%;\n          }\n          \n          .chat-header {\n            padding: 12px 16px;\n          }\n          \n          .messages-container {\n            padding: 12px;\n          }\n          \n          .message-input-container {\n            padding: 12px 16px;\n          }\n        }\n      </style>\n      <div class=\"community-container\">\n        <div class=\"chat-header\">\n          <div class=\"online-indicator\"></div>\n          <div class=\"chat-header-info\">\n            <h3>Komunitas ".concat(provinceName, "</h3>\n            <p>").concat(this._isSocketConnected ? 'Online' : 'Connecting...', "</p>\n          </div>\n        </div>\n        \n        <div class=\"messages-container\">\n          ").concat(this._isLoading && this._currentPage > 1 ? '<div class="loading-indicator">Memuat pesan lama...</div>' : '', "\n          \n          ").concat(this._messages.length === 0 ? "<div class=\"empty-state\">\n              <div class=\"empty-state-icon\">\uD83D\uDCAC</div>\n              <p>Belum ada pesan dalam komunitas ini</p>\n              <p>Mulai percakapan dengan mengirim pesan pertama!</p>\n            </div>" : this._messages.map(function (msg) {
        var isOwn = currentUserId && msg.sender_id == currentUserId;
        var initials = (msg.sender_name || 'U').charAt(0).toUpperCase();
        return "\n                <div class=\"message ".concat(isOwn ? 'own' : '', "\">\n                  <div class=\"message-avatar\">").concat(initials, "</div>\n                  <div class=\"message-content\">\n                    <div class=\"message-bubble\">").concat(msg.content, "</div>\n                    <div class=\"message-meta\">\n                      ").concat(!isOwn ? "<span class=\"message-sender\">".concat(msg.sender_name || 'User', "</span>") : '', "\n                      <span class=\"message-time\">").concat(_this5._formatTime(msg.created_at), "</span>\n                    </div>\n                  </div>\n                </div>\n              ");
      }).join(''), "\n        </div>\n        \n        <div class=\"message-input-container\">\n          <textarea class=\"message-input-field\" placeholder=\"Ketik pesan...\" rows=\"1\"></textarea>\n          <button class=\"send-button\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n              <polygon points=\"22,2 15,22 11,13 2,9\"></polygon>\n            </svg>\n          </button>\n        </div>\n      </div>\n    ");

      // Re-setup listeners after render
      setTimeout(function () {
        _this5._setupScrollListener();
        if (_this5._isSocketConnected) {
          _this5._setupInputListeners();
        }
      }, 0);
    }
  }]);
}(/*#__PURE__*/community_page_wrapNativeSuper(HTMLElement));
customElements.define('community-page', CommunityPage);
;// ./user/src/script/components/hobby/hobby-page.js
function hobby_page_typeof(o) { "@babel/helpers - typeof"; return hobby_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, hobby_page_typeof(o); }
function hobby_page_toConsumableArray(r) { return hobby_page_arrayWithoutHoles(r) || hobby_page_iterableToArray(r) || hobby_page_unsupportedIterableToArray(r) || hobby_page_nonIterableSpread(); }
function hobby_page_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function hobby_page_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return hobby_page_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? hobby_page_arrayLikeToArray(r, a) : void 0; } }
function hobby_page_iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function hobby_page_arrayWithoutHoles(r) { if (Array.isArray(r)) return hobby_page_arrayLikeToArray(r); }
function hobby_page_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function hobby_page_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ hobby_page_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == hobby_page_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(hobby_page_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function hobby_page_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function hobby_page_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { hobby_page_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { hobby_page_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function hobby_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function hobby_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, hobby_page_toPropertyKey(o.key), o); } }
function hobby_page_createClass(e, r, t) { return r && hobby_page_defineProperties(e.prototype, r), t && hobby_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function hobby_page_toPropertyKey(t) { var i = hobby_page_toPrimitive(t, "string"); return "symbol" == hobby_page_typeof(i) ? i : i + ""; }
function hobby_page_toPrimitive(t, r) { if ("object" != hobby_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != hobby_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function hobby_page_callSuper(t, o, e) { return o = hobby_page_getPrototypeOf(o), hobby_page_possibleConstructorReturn(t, hobby_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], hobby_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function hobby_page_possibleConstructorReturn(t, e) { if (e && ("object" == hobby_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return hobby_page_assertThisInitialized(t); }
function hobby_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function hobby_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && hobby_page_setPrototypeOf(t, e); }
function hobby_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return hobby_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !hobby_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return hobby_page_construct(t, arguments, hobby_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), hobby_page_setPrototypeOf(Wrapper, t); }, hobby_page_wrapNativeSuper(t); }
function hobby_page_construct(t, e, r) { if (hobby_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && hobby_page_setPrototypeOf(p, r.prototype), p; }
function hobby_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (hobby_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function hobby_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function hobby_page_setPrototypeOf(t, e) { return hobby_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, hobby_page_setPrototypeOf(t, e); }
function hobby_page_getPrototypeOf(t) { return hobby_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, hobby_page_getPrototypeOf(t); }



var HobbyPage = /*#__PURE__*/function (_HTMLElement) {
  function HobbyPage() {
    var _this;
    hobby_page_classCallCheck(this, HobbyPage);
    _this = hobby_page_callSuper(this, HobbyPage);
    _this._messages = [];
    _this._socket = null;
    _this._isSocketConnected = false;
    _this._isLoading = false;
    _this._hasMoreMessages = true;
    _this._currentPage = 1;
    _this._messagesPerPage = 20;

    // Bind methods
    _this.fetchMessageHistory = _this.fetchMessageHistory.bind(_this);
    _this.loadMoreMessages = _this.loadMoreMessages.bind(_this);
    _this._connectSocket = _this._connectSocket.bind(_this);
    _this._handleNewMessage = _this._handleNewMessage.bind(_this);
    _this._handleScroll = _this._handleScroll.bind(_this);
    return _this;
  }
  hobby_page_inherits(HobbyPage, _HTMLElement);
  return hobby_page_createClass(HobbyPage, [{
    key: "connectedCallback",
    value: function () {
      var _connectedCallback = hobby_page_asyncToGenerator(/*#__PURE__*/hobby_page_regeneratorRuntime().mark(function _callee() {
        var _this2 = this;
        return hobby_page_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (utils.isAuthenticated()) {
                _context.next = 3;
                break;
              }
              utils.redirectToLogin();
              return _context.abrupt("return");
            case 3:
              _context.next = 5;
              return this.fetchMessageHistory();
            case 5:
              // page 1
              this._connectSocket();
              this.render();
              this._setupScrollListener();

              // ✅ Auto-scroll to bottom on first load
              setTimeout(function () {
                var container = _this2.querySelector('.messages-container');
                if (container) {
                  container.scrollTop = container.scrollHeight;
                }
              }, 0);
            case 9:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function connectedCallback() {
        return _connectedCallback.apply(this, arguments);
      }
      return connectedCallback;
    }()
  }, {
    key: "fetchMessageHistory",
    value: function () {
      var _fetchMessageHistory = hobby_page_asyncToGenerator(/*#__PURE__*/hobby_page_regeneratorRuntime().mark(function _callee2() {
        var page,
          response,
          newMessages,
          _args2 = arguments;
        return hobby_page_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              page = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : 1;
              _context2.prev = 1;
              this._isLoading = true;
              _context2.next = 5;
              return authenticatedRequest("/hobby-messages?page=".concat(page, "&limit=").concat(this._messagesPerPage), 'GET');
            case 5:
              response = _context2.sent;
              if (response.status === 'success') {
                newMessages = response.data || [];
                if (page === 1) {
                  this._messages = newMessages;
                } else {
                  // Prepend older messages at the beginning
                  this._messages = [].concat(hobby_page_toConsumableArray(newMessages), hobby_page_toConsumableArray(this._messages));
                }
                this._hasMoreMessages = newMessages.length === this._messagesPerPage;
                this._currentPage = page;
              }
              _context2.next = 12;
              break;
            case 9:
              _context2.prev = 9;
              _context2.t0 = _context2["catch"](1);
              console.error('Error fetching message history:', _context2.t0);
            case 12:
              _context2.prev = 12;
              this._isLoading = false;
              return _context2.finish(12);
            case 15:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[1, 9, 12, 15]]);
      }));
      function fetchMessageHistory() {
        return _fetchMessageHistory.apply(this, arguments);
      }
      return fetchMessageHistory;
    }()
  }, {
    key: "loadMoreMessages",
    value: function () {
      var _loadMoreMessages = hobby_page_asyncToGenerator(/*#__PURE__*/hobby_page_regeneratorRuntime().mark(function _callee3() {
        var container, previousScrollHeight;
        return hobby_page_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (!(this._isLoading || !this._hasMoreMessages)) {
                _context3.next = 2;
                break;
              }
              return _context3.abrupt("return");
            case 2:
              container = this.querySelector('.messages-container');
              previousScrollHeight = container.scrollHeight;
              _context3.next = 6;
              return this.fetchMessageHistory(this._currentPage + 1);
            case 6:
              this.render();

              // Maintain scroll position after loading older messages
              setTimeout(function () {
                var newScrollHeight = container.scrollHeight;
                container.scrollTop = newScrollHeight - previousScrollHeight;
              }, 0);
            case 8:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function loadMoreMessages() {
        return _loadMoreMessages.apply(this, arguments);
      }
      return loadMoreMessages;
    }()
  }, {
    key: "_setupScrollListener",
    value: function _setupScrollListener() {
      var container = this.querySelector('.messages-container');
      if (container) {
        container.addEventListener('scroll', this._handleScroll);
      }
    }
  }, {
    key: "_handleScroll",
    value: function _handleScroll(e) {
      var container = e.target;
      // Load more when scrolled to top
      if (container.scrollTop <= 100 && this._hasMoreMessages && !this._isLoading) {
        this.loadMoreMessages();
      }
    }
  }, {
    key: "_connectSocket",
    value: function _connectSocket() {
      var _this3 = this;
      var token = localStorage.getItem('token');
      this._socket = esm_lookup('https://api.pinjemin.site', {
        auth: {
          token: token
        }
      });
      this._socket.on('connect', function () {
        _this3._isSocketConnected = true;
        _this3._socket.emit('joinHobby');
        _this3._setupInputListeners();
      });
      this._socket.on('newHobbyMessage', this._handleNewMessage);
      this._socket.on('hobbyError', function (error) {
        console.error('Hobby error:', error);
        alert('Error: ' + error.error);
      });
      this._socket.on('hobbyMessageError', function (error) {
        console.error('Hobby message error:', error);
        alert('Error: ' + error.error);
      });
    }
  }, {
    key: "_setupInputListeners",
    value: function _setupInputListeners() {
      var _this4 = this;
      var sendBtn = this.querySelector('.send-button');
      var input = this.querySelector('.message-input-field');
      var sendMessage = function sendMessage() {
        var message = input === null || input === void 0 ? void 0 : input.value.trim();
        if (message && _this4._isSocketConnected) {
          _this4._socket.emit('sendHobbyMessage', {
            content: message
          });
          input.value = '';
          input.style.height = 'auto';
        }
      };

      // Remove existing listeners to prevent duplicates
      sendBtn === null || sendBtn === void 0 || sendBtn.removeEventListener('click', this._sendMessage);
      input === null || input === void 0 || input.removeEventListener('keypress', this._handleKeypress);
      input === null || input === void 0 || input.removeEventListener('input', this._handleInput);

      // Store bound functions
      this._sendMessage = sendMessage;
      this._handleKeypress = function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };
      this._handleInput = function (e) {
        e.target.style.height = 'auto';
        e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
      };

      // Add new listeners
      sendBtn === null || sendBtn === void 0 || sendBtn.addEventListener('click', this._sendMessage);
      input === null || input === void 0 || input.addEventListener('keypress', this._handleKeypress);
      input === null || input === void 0 || input.addEventListener('input', this._handleInput);
    }
  }, {
    key: "_handleNewMessage",
    value: function _handleNewMessage(message) {
      var container = this.querySelector('.messages-container');
      var currentUserId = localStorage.getItem('userId');
      var isOwn = message.sender_id == currentUserId;
      var wasAtBottom = container && container.scrollTop + container.clientHeight >= container.scrollHeight - 50;

      // Tambahkan ke internal array
      this._messages.push(message);

      // ✅ Tambahkan langsung ke DOM, bukan render ulang
      if (container) {
        var msgEl = document.createElement('div');
        msgEl.className = "message ".concat(isOwn ? 'own' : '');
        var initials = (message.sender_name || 'U').charAt(0).toUpperCase();
        msgEl.innerHTML = "\n        <div class=\"message-avatar\">".concat(initials, "</div>\n        <div class=\"message-content\">\n          <div class=\"message-bubble\">").concat(message.content, "</div>\n          <div class=\"message-meta\">\n            ").concat(!isOwn ? "<span class=\"message-sender\">".concat(message.sender_name || 'User', "</span>") : '', "\n            <span class=\"message-time\">").concat(this._formatTime(message.created_at), "</span>\n          </div>\n        </div>\n      ");
        container.appendChild(msgEl);

        // ✅ Scroll ke bawah hanya jika:
        // - kamu sendiri yang kirim
        // - atau sebelumnya user memang scroll di bawah
        if (isOwn || wasAtBottom) {
          setTimeout(function () {
            container.scrollTop = container.scrollHeight;
          }, 0);
        }
      }
    }
  }, {
    key: "_formatTime",
    value: function _formatTime(dateString) {
      var date = new Date(dateString);
      var now = new Date();
      var diffInHours = (now - date) / (1000 * 60 * 60);
      if (diffInHours < 24) {
        return date.toLocaleTimeString('id-ID', {
          hour: '2-digit',
          minute: '2-digit'
        });
      } else {
        return date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$_messages$,
        _this5 = this;
      var hobbyName = ((_this$_messages$ = this._messages[0]) === null || _this$_messages$ === void 0 ? void 0 : _this$_messages$.sender_hobby) || '';
      var currentUserId = localStorage.getItem('userId');
      this.innerHTML = "\n      <style>\n        * {\n          box-sizing: border-box;\n        }\n        \n        .hobby-container {\n          max-width: 800px;\n          margin: 0 auto;\n          height: 80vh;\n          display: flex;\n          flex-direction: column;\n          background: #f8fafc;\n          border: 1px solid #e2e8f0;\n          border-radius: 12px;\n          overflow: hidden;\n        }\n        \n        .chat-header {\n          background: #ffffff;\n          padding: 16px 20px;\n          border-bottom: 1px solid #e2e8f0;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .chat-header-info h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: #1a202c;\n        }\n        \n        .chat-header-info p {\n          margin: 0;\n          font-size: 14px;\n          color: #718096;\n        }\n        \n        .online-indicator {\n          width: 12px;\n          height: 12px;\n          background: #48bb78;\n          border-radius: 50%;\n          border: 2px solid #ffffff;\n        }\n        \n        .messages-container {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n          background: #ffffff;\n          scroll-behavior: smooth;\n        }\n        \n        .messages-container::-webkit-scrollbar {\n          width: 6px;\n        }\n        \n        .messages-container::-webkit-scrollbar-track {\n          background: transparent;\n        }\n        \n        .messages-container::-webkit-scrollbar-thumb {\n          background: #cbd5e0;\n          border-radius: 3px;\n        }\n        \n        .loading-indicator {\n          text-align: center;\n          padding: 12px;\n          color: #718096;\n          font-size: 14px;\n        }\n        \n        .message {\n          margin-bottom: 16px;\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n        }\n        \n        .message.own {\n          flex-direction: row-reverse;\n        }\n        \n        .message-avatar {\n          width: 36px;\n          height: 36px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-weight: 600;\n          font-size: 14px;\n          flex-shrink: 0;\n        }\n        \n        .message-content {\n          max-width: 70%;\n          min-width: 120px;\n        }\n        \n        .message-bubble {\n          padding: 12px 16px;\n          border-radius: 18px;\n          background: #f7fafc;\n          border: 1px solid #e2e8f0;\n          word-wrap: break-word;\n          line-height: 1.4;\n        }\n        \n        .message.own .message-bubble {\n          background: #ed8936;\n          color: white;\n          border-color: #ed8936;\n        }\n        \n        .message-meta {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin-top: 4px;\n          font-size: 12px;\n          color: #718096;\n        }\n        \n        .message.own .message-meta {\n          justify-content: flex-end;\n        }\n        \n        .message-sender {\n          font-weight: 500;\n        }\n        \n        .message-time {\n          color: #a0aec0;\n        }\n        \n        .message-input-container {\n          padding: 16px 20px;\n          background: #ffffff;\n          border-top: 1px solid #e2e8f0;\n          display: flex;\n          align-items: flex-end;\n          gap: 12px;\n        }\n        \n        .message-input-field {\n          flex: 1;\n          padding: 12px 16px;\n          border: 1px solid #e2e8f0;\n          border-radius: 24px;\n          background: #f7fafc;\n          resize: none;\n          outline: none;\n          font-family: inherit;\n          font-size: 14px;\n          line-height: 1.4;\n          max-height: 120px;\n          min-height: 44px;\n          transition: all 0.2s ease;\n        }\n        \n        .message-input-field:focus {\n          border-color: #ed8936;\n          background: #ffffff;\n          box-shadow: 0 0 0 3px rgba(237, 137, 54, 0.1);\n        }\n        \n        .message-input-field::placeholder {\n          color: #a0aec0;\n        }\n        \n        .send-button {\n          width: 44px;\n          height: 44px;\n          border: none;\n          border-radius: 50%;\n          background: #ed8936;\n          color: white;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all 0.2s ease;\n          flex-shrink: 0;\n        }\n        \n        .send-button:hover {\n          background: #dd6b20;\n          transform: scale(1.05);\n        }\n        \n        .send-button:active {\n          transform: scale(0.95);\n        }\n        \n        .empty-state {\n          text-align: center;\n          color: #718096;\n          padding: 40px 20px;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .empty-state-icon {\n          width: 64px;\n          height: 64px;\n          border-radius: 50%;\n          background: #f7fafc;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 24px;\n        }\n        \n        @media (max-width: 768px) {\n          .hobby-container {\n            height: 90vh;\n            border-radius: 0;\n            border: none;\n          }\n          \n          .message-content {\n            max-width: 85%;\n          }\n          \n          .chat-header {\n            padding: 12px 16px;\n          }\n          \n          .messages-container {\n            padding: 12px;\n          }\n          \n          .message-input-container {\n            padding: 12px 16px;\n          }\n        }\n      </style>\n      <div class=\"hobby-container\">\n        <div class=\"chat-header\">\n          <div class=\"online-indicator\"></div>\n          <div class=\"chat-header-info\">\n            <h3>Hobby ".concat(hobbyName, "</h3>\n            <p>").concat(this._isSocketConnected ? 'Online' : 'Connecting...', "</p>\n          </div>\n        </div>\n        \n        <div class=\"messages-container\">\n          ").concat(this._isLoading && this._currentPage > 1 ? '<div class="loading-indicator">Memuat pesan lama...</div>' : '', "\n          \n          ").concat(this._messages.length === 0 ? "<div class=\"empty-state\">\n              <div class=\"empty-state-icon\">\uD83C\uDFAF</div>\n              <p>Belum ada pesan dalam grup hobby ini</p>\n              <p>Mulai percakapan dengan sesama penggemar hobby!</p>\n            </div>" : this._messages.map(function (msg) {
        var isOwn = currentUserId && msg.sender_id == currentUserId;
        var initials = (msg.sender_name || 'U').charAt(0).toUpperCase();
        return "\n                <div class=\"message ".concat(isOwn ? 'own' : '', "\">\n                  <div class=\"message-avatar\">").concat(initials, "</div>\n                  <div class=\"message-content\">\n                    <div class=\"message-bubble\">").concat(msg.content, "</div>\n                    <div class=\"message-meta\">\n                      ").concat(!isOwn ? "<span class=\"message-sender\">".concat(msg.sender_name || 'User', "</span>") : '', "\n                      <span class=\"message-time\">").concat(_this5._formatTime(msg.created_at), "</span>\n                    </div>\n                  </div>\n                </div>\n              ");
      }).join(''), "\n        </div>\n        \n        <div class=\"message-input-container\">\n          <textarea class=\"message-input-field\" placeholder=\"Bagikan tentang hobby Anda...\" rows=\"1\"></textarea>\n          <button class=\"send-button\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n              <polygon points=\"22,2 15,22 11,13 2,9\"></polygon>\n            </svg>\n          </button>\n        </div>\n      </div>\n    ");

      // Re-setup listeners after render
      setTimeout(function () {
        _this5._setupScrollListener();
        if (_this5._isSocketConnected) {
          _this5._setupInputListeners();
        }
      }, 0);
    }
  }]);
}(/*#__PURE__*/hobby_page_wrapNativeSuper(HTMLElement));
customElements.define('hobby-page', HobbyPage);
;// ./user/src/script/utils/push-notification-helper.js
function push_notification_helper_typeof(o) { "@babel/helpers - typeof"; return push_notification_helper_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, push_notification_helper_typeof(o); }
function push_notification_helper_createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = push_notification_helper_unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function push_notification_helper_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return push_notification_helper_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? push_notification_helper_arrayLikeToArray(r, a) : void 0; } }
function push_notification_helper_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function push_notification_helper_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ push_notification_helper_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == push_notification_helper_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(push_notification_helper_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function push_notification_helper_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function push_notification_helper_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { push_notification_helper_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { push_notification_helper_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function push_notification_helper_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function push_notification_helper_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, push_notification_helper_toPropertyKey(o.key), o); } }
function push_notification_helper_createClass(e, r, t) { return r && push_notification_helper_defineProperties(e.prototype, r), t && push_notification_helper_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function push_notification_helper_toPropertyKey(t) { var i = push_notification_helper_toPrimitive(t, "string"); return "symbol" == push_notification_helper_typeof(i) ? i : i + ""; }
function push_notification_helper_toPrimitive(t, r) { if ("object" != push_notification_helper_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != push_notification_helper_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }

var PushNotificationHelper = /*#__PURE__*/function () {
  function PushNotificationHelper() {
    push_notification_helper_classCallCheck(this, PushNotificationHelper);
    this.vapidPublicKey = null; // Jangan hardcode, ambil dari server
    this.isInitializing = false; // Prevent multiple initialization
  }

  // ===== VAPID Key Management =====
  return push_notification_helper_createClass(PushNotificationHelper, [{
    key: "getVapidPublicKey",
    value: function () {
      var _getVapidPublicKey = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee() {
        var response;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.prev = 0;
              _context.next = 3;
              return apiGet("/notifications/vapid-public-key");
            case 3:
              response = _context.sent;
              if (!(response && response.status === "success" && response.data && response.data.publicKey)) {
                _context.next = 8;
                break;
              }
              this.vapidPublicKey = response.data.publicKey;
              console.log("VAPID public key retrieved from server:", this.vapidPublicKey);
              return _context.abrupt("return", this.vapidPublicKey);
            case 8:
              console.error("Failed to get VAPID public key from server");
              return _context.abrupt("return", null);
            case 12:
              _context.prev = 12;
              _context.t0 = _context["catch"](0);
              console.error("Error getting VAPID public key:", _context.t0);
              return _context.abrupt("return", null);
            case 16:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[0, 12]]);
      }));
      function getVapidPublicKey() {
        return _getVapidPublicKey.apply(this, arguments);
      }
      return getVapidPublicKey;
    }() // ===== Service Worker Management =====
  }, {
    key: "registerServiceWorker",
    value: function () {
      var _registerServiceWorker = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee2() {
        var registrations, _iterator, _step, _registration, registration;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.prev = 0;
              if ("serviceWorker" in navigator) {
                _context2.next = 4;
                break;
              }
              console.error("Service workers are not supported.");
              return _context2.abrupt("return", null);
            case 4:
              _context2.next = 6;
              return navigator.serviceWorker.getRegistrations();
            case 6:
              registrations = _context2.sent;
              _iterator = push_notification_helper_createForOfIteratorHelper(registrations);
              _context2.prev = 8;
              _iterator.s();
            case 10:
              if ((_step = _iterator.n()).done) {
                _context2.next = 17;
                break;
              }
              _registration = _step.value;
              if (!(_registration.active && _registration.active.scriptURL.includes("sw.bundle.js"))) {
                _context2.next = 15;
                break;
              }
              console.log("Service Worker sudah terdaftar:", _registration);
              return _context2.abrupt("return", _registration);
            case 15:
              _context2.next = 10;
              break;
            case 17:
              _context2.next = 22;
              break;
            case 19:
              _context2.prev = 19;
              _context2.t0 = _context2["catch"](8);
              _iterator.e(_context2.t0);
            case 22:
              _context2.prev = 22;
              _iterator.f();
              return _context2.finish(22);
            case 25:
              // ✅ Jika belum ada, baru register
              console.log("No existing service worker found, registering new one...");
              _context2.next = 28;
              return navigator.serviceWorker.register("/sw.bundle.js");
            case 28:
              registration = _context2.sent;
              if (!registration.installing) {
                _context2.next = 32;
                break;
              }
              _context2.next = 32;
              return new Promise(function (resolve) {
                registration.installing.addEventListener("statechange", function (e) {
                  if (e.target.state === "activated") {
                    console.log("Service worker activated");
                    resolve();
                  }
                });
              });
            case 32:
              console.log("Service Worker registered successfully:", registration);
              return _context2.abrupt("return", registration);
            case 36:
              _context2.prev = 36;
              _context2.t1 = _context2["catch"](0);
              console.error("Service Worker registration failed:", _context2.t1);
              return _context2.abrupt("return", null);
            case 40:
            case "end":
              return _context2.stop();
          }
        }, _callee2, null, [[0, 36], [8, 19, 22, 25]]);
      }));
      function registerServiceWorker() {
        return _registerServiceWorker.apply(this, arguments);
      }
      return registerServiceWorker;
    }() // ===== Notification Permission =====
  }, {
    key: "requestPermission",
    value: function () {
      var _requestPermission = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee3() {
        var result;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if ("Notification" in window) {
                _context3.next = 3;
                break;
              }
              console.log("Notifications are not supported in this browser");
              return _context3.abrupt("return", false);
            case 3:
              _context3.next = 5;
              return Notification.requestPermission();
            case 5:
              result = _context3.sent;
              console.log("Notification permission result:", result);
              if (!(result === "denied")) {
                _context3.next = 10;
                break;
              }
              console.log("Notification permission denied");
              return _context3.abrupt("return", false);
            case 10:
              if (!(result === "default")) {
                _context3.next = 13;
                break;
              }
              console.log("Notification permission request was dismissed");
              return _context3.abrupt("return", false);
            case 13:
              return _context3.abrupt("return", result === "granted");
            case 14:
            case "end":
              return _context3.stop();
          }
        }, _callee3);
      }));
      function requestPermission() {
        return _requestPermission.apply(this, arguments);
      }
      return requestPermission;
    }() // ===== Support Checks =====
  }, {
    key: "isNotificationSupported",
    value: function isNotificationSupported() {
      if (!("Notification" in window)) {
        console.log("Notifications are not supported in this browser");
        return false;
      }
      if (!("serviceWorker" in navigator)) {
        console.log("Service workers are not supported in this browser");
        return false;
      }
      if (!("PushManager" in window)) {
        console.log("Push messaging is not supported in this browser");
        return false;
      }
      return true;
    }

    // ===== Server Subscription Status =====
  }, {
    key: "checkServerSubscription",
    value: function () {
      var _checkServerSubscription = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee4() {
        var response;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              _context4.prev = 0;
              _context4.next = 3;
              return apiGet("/notifications/subscription-status");
            case 3:
              response = _context4.sent;
              console.log("Server subscription status:", response);
              if (!(response && response.status === "success")) {
                _context4.next = 7;
                break;
              }
              return _context4.abrupt("return", {
                hasSubscription: response.data.hasSubscription,
                isActive: response.data.isActive,
                subscription: response.data.subscription
              });
            case 7:
              return _context4.abrupt("return", {
                hasSubscription: false,
                isActive: false,
                subscription: null
              });
            case 10:
              _context4.prev = 10;
              _context4.t0 = _context4["catch"](0);
              console.error("Error checking server subscription:", _context4.t0);
              return _context4.abrupt("return", {
                hasSubscription: false,
                isActive: false,
                subscription: null
              });
            case 14:
            case "end":
              return _context4.stop();
          }
        }, _callee4, null, [[0, 10]]);
      }));
      function checkServerSubscription() {
        return _checkServerSubscription.apply(this, arguments);
      }
      return checkServerSubscription;
    }() // ===== Subscription Management =====
  }, {
    key: "subscribe",
    value: function () {
      var _subscribe = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee5(registration) {
        var existingSubscription, serverStatus, newSubscription;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              _context5.prev = 0;
              _context5.next = 3;
              return this._getSubscription(registration);
            case 3:
              existingSubscription = _context5.sent;
              if (!existingSubscription) {
                _context5.next = 26;
                break;
              }
              console.log("Already subscribed locally");

              // ✅ Verifikasi dengan server tanpa unsubscribe otomatis
              _context5.next = 8;
              return this.checkServerSubscription();
            case 8:
              serverStatus = _context5.sent;
              if (!(serverStatus.hasSubscription && serverStatus.isActive)) {
                _context5.next = 14;
                break;
              }
              console.log("Subscription also exists on server");
              return _context5.abrupt("return", existingSubscription);
            case 14:
              console.log("Local subscription exists but not on server, sending to server...");
              // ✅ Coba kirim subscription yang ada ke server dulu
              _context5.prev = 15;
              _context5.next = 18;
              return this._sendSubscriptionToServer(existingSubscription);
            case 18:
              return _context5.abrupt("return", existingSubscription);
            case 21:
              _context5.prev = 21;
              _context5.t0 = _context5["catch"](15);
              console.log("Failed to send existing subscription to server, creating new one...");
              _context5.next = 26;
              return existingSubscription.unsubscribe();
            case 26:
              if (this.vapidPublicKey) {
                _context5.next = 29;
                break;
              }
              console.error("VAPID public key not available");
              throw new Error("VAPID public key not available");
            case 29:
              _context5.next = 31;
              return registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: this._urlBase64ToUint8Array(this.vapidPublicKey)
              });
            case 31:
              newSubscription = _context5.sent;
              console.log("Successfully subscribed to push notifications:", newSubscription);
              _context5.next = 35;
              return this._sendSubscriptionToServer(newSubscription);
            case 35:
              return _context5.abrupt("return", newSubscription);
            case 38:
              _context5.prev = 38;
              _context5.t1 = _context5["catch"](0);
              console.error("Failed to subscribe to push notifications:", _context5.t1);
              throw _context5.t1;
            case 42:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this, [[0, 38], [15, 21]]);
      }));
      function subscribe(_x) {
        return _subscribe.apply(this, arguments);
      }
      return subscribe;
    }()
  }, {
    key: "unsubscribe",
    value: function () {
      var _unsubscribe = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee6(registration) {
        var subscription;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee6$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              _context6.prev = 0;
              _context6.next = 3;
              return this._getSubscription(registration);
            case 3:
              subscription = _context6.sent;
              if (subscription) {
                _context6.next = 7;
                break;
              }
              console.log("No subscription found");
              return _context6.abrupt("return", {
                error: false,
                message: "No subscription found"
              });
            case 7:
              _context6.prev = 7;
              _context6.next = 10;
              return unsubscribeNotification(subscription.endpoint);
            case 10:
              _context6.next = 15;
              break;
            case 12:
              _context6.prev = 12;
              _context6.t0 = _context6["catch"](7);
              console.warn("Failed to unsubscribe from server:", _context6.t0);
              // Lanjutkan untuk unsubscribe dari browser
            case 15:
              _context6.next = 17;
              return subscription.unsubscribe();
            case 17:
              console.log("Successfully unsubscribed from push notifications");

              // ✅ Clear initialization flag
              this.markAsUninitialized();
              return _context6.abrupt("return", {
                error: false,
                message: "Successfully unsubscribed"
              });
            case 22:
              _context6.prev = 22;
              _context6.t1 = _context6["catch"](0);
              console.error("Failed to unsubscribe from push notifications:", _context6.t1);
              throw _context6.t1;
            case 26:
            case "end":
              return _context6.stop();
          }
        }, _callee6, this, [[0, 22], [7, 12]]);
      }));
      function unsubscribe(_x2) {
        return _unsubscribe.apply(this, arguments);
      }
      return unsubscribe;
    }()
  }, {
    key: "_getSubscription",
    value: function () {
      var _getSubscription2 = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee7(registration) {
        return push_notification_helper_regeneratorRuntime().wrap(function _callee7$(_context7) {
          while (1) switch (_context7.prev = _context7.next) {
            case 0:
              _context7.next = 2;
              return registration.pushManager.getSubscription();
            case 2:
              return _context7.abrupt("return", _context7.sent);
            case 3:
            case "end":
              return _context7.stop();
          }
        }, _callee7);
      }));
      function _getSubscription(_x3) {
        return _getSubscription2.apply(this, arguments);
      }
      return _getSubscription;
    }() // ===== Utility Functions =====
  }, {
    key: "_urlBase64ToUint8Array",
    value: function _urlBase64ToUint8Array(base64String) {
      var padding = "=".repeat((4 - base64String.length % 4) % 4);
      var base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
      var rawData = window.atob(base64);
      var outputArray = new Uint8Array(rawData.length);
      for (var i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }
      return outputArray;
    }

    // ===== Server Communication =====
  }, {
    key: "_sendSubscriptionToServer",
    value: function () {
      var _sendSubscriptionToServer2 = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee8(subscription) {
        var subscriptionData, response;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee8$(_context8) {
          while (1) switch (_context8.prev = _context8.next) {
            case 0:
              _context8.prev = 0;
              subscriptionData = {
                endpoint: subscription.endpoint,
                keys: {
                  p256dh: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey("p256dh")))),
                  auth: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey("auth"))))
                }
              };
              _context8.next = 4;
              return subscribeNotification(subscriptionData);
            case 4:
              response = _context8.sent;
              console.log("Subscription successfully sent to server:", response);
              return _context8.abrupt("return", response);
            case 9:
              _context8.prev = 9;
              _context8.t0 = _context8["catch"](0);
              console.error("Failed to send subscription to server:", _context8.t0);
              throw _context8.t0;
            case 13:
            case "end":
              return _context8.stop();
          }
        }, _callee8, null, [[0, 9]]);
      }));
      function _sendSubscriptionToServer(_x4) {
        return _sendSubscriptionToServer2.apply(this, arguments);
      }
      return _sendSubscriptionToServer;
    }() // ===== Initialization Status =====
  }, {
    key: "isInitialized",
    value: function isInitialized() {
      return localStorage.getItem("notification_initialized") === "true";
    }
  }, {
    key: "markAsInitialized",
    value: function markAsInitialized() {
      localStorage.setItem("notification_initialized", "true");
    }
  }, {
    key: "markAsUninitialized",
    value: function markAsUninitialized() {
      localStorage.removeItem("notification_initialized");
    }

    // ===== Main Initialization Method =====
  }, {
    key: "initializePushNotifications",
    value: function () {
      var _initializePushNotifications = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee9() {
        var vapidKey, registration, permissionGranted, subscription, serverStatus;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee9$(_context9) {
          while (1) switch (_context9.prev = _context9.next) {
            case 0:
              _context9.prev = 0;
              if (!this.isInitializing) {
                _context9.next = 4;
                break;
              }
              console.log("Push notification initialization already in progress");
              return _context9.abrupt("return", false);
            case 4:
              this.isInitializing = true;
              console.log("Starting push notification initialization...");

              // ✅ Check if notifications are supported
              if (this.isNotificationSupported()) {
                _context9.next = 10;
                break;
              }
              console.log("Notifications not supported, skipping initialization");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 10:
              _context9.next = 12;
              return this.getVapidPublicKey();
            case 12:
              vapidKey = _context9.sent;
              if (vapidKey) {
                _context9.next = 17;
                break;
              }
              console.error("Failed to get VAPID public key from server");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 17:
              _context9.next = 19;
              return this.registerServiceWorker();
            case 19:
              registration = _context9.sent;
              if (registration) {
                _context9.next = 24;
                break;
              }
              console.error("Failed to register service worker");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 24:
              _context9.next = 26;
              return this.requestPermission();
            case 26:
              permissionGranted = _context9.sent;
              if (permissionGranted) {
                _context9.next = 31;
                break;
              }
              console.error("Notification permission not granted");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 31:
              _context9.next = 33;
              return this.subscribe(registration);
            case 33:
              subscription = _context9.sent;
              if (subscription) {
                _context9.next = 38;
                break;
              }
              console.error("Failed to subscribe to push notifications");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 38:
              _context9.next = 40;
              return this.checkServerSubscription();
            case 40:
              serverStatus = _context9.sent;
              if (serverStatus.hasSubscription) {
                _context9.next = 45;
                break;
              }
              console.error("Subscription not found on server after initialization");
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 45:
              // ✅ Mark as initialized
              this.markAsInitialized();
              this.isInitializing = false;
              console.log("Push notifications initialized successfully");
              return _context9.abrupt("return", true);
            case 51:
              _context9.prev = 51;
              _context9.t0 = _context9["catch"](0);
              console.error("Error initializing push notifications:", _context9.t0);
              this.isInitializing = false;
              return _context9.abrupt("return", false);
            case 56:
            case "end":
              return _context9.stop();
          }
        }, _callee9, this, [[0, 51]]);
      }));
      function initializePushNotifications() {
        return _initializePushNotifications.apply(this, arguments);
      }
      return initializePushNotifications;
    }() // ===== ✅ PERBAIKAN: Strict Setup Check - WAJIB PUNYA SUBSCRIPTION =====
  }, {
    key: "needsNotificationSetup",
    value: function () {
      var _needsNotificationSetup = push_notification_helper_asyncToGenerator(/*#__PURE__*/push_notification_helper_regeneratorRuntime().mark(function _callee10() {
        var permission, serverStatus;
        return push_notification_helper_regeneratorRuntime().wrap(function _callee10$(_context10) {
          while (1) switch (_context10.prev = _context10.next) {
            case 0:
              _context10.prev = 0;
              if (this.isNotificationSupported()) {
                _context10.next = 3;
                break;
              }
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "not_supported",
                canProceed: false // ❌ BLOCK - tidak bisa pakai aplikasi
              });
            case 3:
              permission = Notification.permission;
              _context10.next = 6;
              return this.checkServerSubscription();
            case 6:
              serverStatus = _context10.sent;
              if (!(permission === "denied")) {
                _context10.next = 10;
                break;
              }
              console.log("Notification permission denied by user");
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "permission_denied",
                canProceed: false // ❌ BLOCK - tidak bisa pakai aplikasi
              });
            case 10:
              if (!(permission === "granted" && serverStatus.hasSubscription && serverStatus.isActive)) {
                _context10.next = 13;
                break;
              }
              console.log("User has active subscription on server");
              return _context10.abrupt("return", {
                needsSetup: false,
                reason: "already_subscribed",
                canProceed: true // ✅ ALLOW - bisa pakai aplikasi
              });
            case 13:
              if (!(permission === "granted" && !serverStatus.hasSubscription)) {
                _context10.next = 16;
                break;
              }
              console.log("Permission granted but no server subscription, need to resubscribe");
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "missing_server_subscription",
                canProceed: false // ❌ BLOCK - harus resubscribe dulu
              });
            case 16:
              if (!(permission === "default")) {
                _context10.next = 19;
                break;
              }
              console.log("Notification permission not requested yet");
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "permission_not_requested",
                canProceed: false // ❌ BLOCK - harus request permission dulu
              });
            case 19:
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "unknown",
                canProceed: false // ❌ BLOCK - kondisi tidak dikenali
              });
            case 22:
              _context10.prev = 22;
              _context10.t0 = _context10["catch"](0);
              console.error("Error checking notification setup needs:", _context10.t0);
              return _context10.abrupt("return", {
                needsSetup: true,
                reason: "error",
                canProceed: false // ❌ BLOCK - ada error
              });
            case 26:
            case "end":
              return _context10.stop();
          }
        }, _callee10, this, [[0, 22]]);
      }));
      function needsNotificationSetup() {
        return _needsNotificationSetup.apply(this, arguments);
      }
      return needsNotificationSetup;
    }()
  }]);
}();
/* harmony default export */ const push_notification_helper = (PushNotificationHelper);
;// ./user/src/script/components/notification-permission-popup.js
function notification_permission_popup_typeof(o) { "@babel/helpers - typeof"; return notification_permission_popup_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, notification_permission_popup_typeof(o); }
function notification_permission_popup_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ notification_permission_popup_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == notification_permission_popup_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(notification_permission_popup_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function notification_permission_popup_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function notification_permission_popup_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { notification_permission_popup_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { notification_permission_popup_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function notification_permission_popup_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function notification_permission_popup_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, notification_permission_popup_toPropertyKey(o.key), o); } }
function notification_permission_popup_createClass(e, r, t) { return r && notification_permission_popup_defineProperties(e.prototype, r), t && notification_permission_popup_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function notification_permission_popup_toPropertyKey(t) { var i = notification_permission_popup_toPrimitive(t, "string"); return "symbol" == notification_permission_popup_typeof(i) ? i : i + ""; }
function notification_permission_popup_toPrimitive(t, r) { if ("object" != notification_permission_popup_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != notification_permission_popup_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function notification_permission_popup_callSuper(t, o, e) { return o = notification_permission_popup_getPrototypeOf(o), notification_permission_popup_possibleConstructorReturn(t, notification_permission_popup_isNativeReflectConstruct() ? Reflect.construct(o, e || [], notification_permission_popup_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function notification_permission_popup_possibleConstructorReturn(t, e) { if (e && ("object" == notification_permission_popup_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return notification_permission_popup_assertThisInitialized(t); }
function notification_permission_popup_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function notification_permission_popup_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && notification_permission_popup_setPrototypeOf(t, e); }
function notification_permission_popup_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return notification_permission_popup_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !notification_permission_popup_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return notification_permission_popup_construct(t, arguments, notification_permission_popup_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), notification_permission_popup_setPrototypeOf(Wrapper, t); }, notification_permission_popup_wrapNativeSuper(t); }
function notification_permission_popup_construct(t, e, r) { if (notification_permission_popup_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && notification_permission_popup_setPrototypeOf(p, r.prototype), p; }
function notification_permission_popup_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (notification_permission_popup_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function notification_permission_popup_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function notification_permission_popup_setPrototypeOf(t, e) { return notification_permission_popup_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, notification_permission_popup_setPrototypeOf(t, e); }
function notification_permission_popup_getPrototypeOf(t) { return notification_permission_popup_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, notification_permission_popup_getPrototypeOf(t); }

var NotificationPermissionPopup = /*#__PURE__*/function (_HTMLElement) {
  function NotificationPermissionPopup() {
    var _this;
    notification_permission_popup_classCallCheck(this, NotificationPermissionPopup);
    _this = notification_permission_popup_callSuper(this, NotificationPermissionPopup);
    _this.isShown = false;
    _this.currentReason = null;
    return _this;
  }
  notification_permission_popup_inherits(NotificationPermissionPopup, _HTMLElement);
  return notification_permission_popup_createClass(NotificationPermissionPopup, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      console.log("NotificationPermissionPopup connected");

      // Listen for login events
      window.addEventListener("userLoggedIn", this.handleUserLoggedIn.bind(this));

      // Listen for notifications activated event to refresh the page
      window.addEventListener("notificationsActivated", this.handleNotificationsActivated.bind(this));
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      window.removeEventListener("userLoggedIn", this.handleUserLoggedIn);
      window.removeEventListener("notificationsActivated", this.handleNotificationsActivated);
    }
  }, {
    key: "handleUserLoggedIn",
    value: function handleUserLoggedIn() {
      var _this2 = this;
      console.log("NotificationPermissionPopup: User logged in event received");

      // Wait a bit for the login process to complete
      setTimeout(function () {
        _this2.checkAndShowPopup();
      }, 1000);
    }
  }, {
    key: "handleNotificationsActivated",
    value: function handleNotificationsActivated() {
      console.log("NotificationPermissionPopup: Notifications activated, refreshing route");

      // Refresh the current route to show the actual content
      setTimeout(function () {
        var currentHash = window.location.hash;
        if (currentHash && currentHash !== "#/login" && currentHash !== "#/register") {
          // Trigger router to re-evaluate the current route
          window.dispatchEvent(new HashChangeEvent("hashchange"));
        } else {
          // Default to home page
          window.location.hash = "#/";
        }
      }, 500);
    }
  }, {
    key: "checkAndShowPopup",
    value: function () {
      var _checkAndShowPopup = notification_permission_popup_asyncToGenerator(/*#__PURE__*/notification_permission_popup_regeneratorRuntime().mark(function _callee() {
        var token, helper, notificationStatus;
        return notification_permission_popup_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              token = localStorage.getItem("token");
              if (token) {
                _context.next = 4;
                break;
              }
              console.log("No token found, skipping notification check");
              return _context.abrupt("return");
            case 4:
              _context.prev = 4;
              helper = new push_notification_helper();
              _context.next = 8;
              return helper.needsNotificationSetup();
            case 8:
              notificationStatus = _context.sent;
              console.log("Checking popup conditions:", notificationStatus);
              if (notificationStatus.needsSetup && !notificationStatus.canProceed) {
                console.log("Conditions met, showing notification popup");
                this.triggerPopup(notificationStatus.reason);
              } else {
                console.log("Conditions not met for showing popup:", notificationStatus.reason);
              }
              _context.next = 16;
              break;
            case 13:
              _context.prev = 13;
              _context.t0 = _context["catch"](4);
              console.error("Error checking notification status:", _context.t0);
            case 16:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[4, 13]]);
      }));
      function checkAndShowPopup() {
        return _checkAndShowPopup.apply(this, arguments);
      }
      return checkAndShowPopup;
    }() // Method to manually trigger popup with reason
  }, {
    key: "triggerPopup",
    value: function triggerPopup() {
      var reason = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      if (this.isShown) {
        console.log("Popup already shown, skipping");
        return;
      }
      this.currentReason = reason;
      console.log("Showing notification permission popup for reason:", reason);
      this.showPopup();
    }
  }, {
    key: "showPopup",
    value: function showPopup() {
      var _this3 = this;
      if (this.isShown) return;
      this.isShown = true;
      console.log("Rendering notification permission popup");

      // Customize content based on reason
      var title = "Aktifkan Notifikasi";
      var description = "Untuk menggunakan <strong>Pinjemin</strong>, Anda <strong>wajib</strong> mengaktifkan notifikasi.";
      var buttonText = "Aktifkan Notifikasi (Wajib)";
      var showRetryInfo = false;
      switch (this.currentReason) {
        case "permission_denied":
          title = "Notifikasi Diblokir";
          description = "Notifikasi telah diblokir. Mohon aktifkan melalui pengaturan browser Anda.";
          buttonText = "Coba Aktifkan Lagi";
          showRetryInfo = true;
          break;
        case "missing_server_subscription":
          title = "Perlu Daftar Ulang Notifikasi";
          description = "Notifikasi perlu didaftarkan ulang ke server. Ini hanya memerlukan satu klik.";
          buttonText = "Daftar Ulang Notifikasi";
          break;
        case "permission_not_requested":
          title = "Aktifkan Notifikasi";
          description = "Untuk menggunakan <strong>Pinjemin</strong>, Anda <strong>wajib</strong> mengaktifkan notifikasi.";
          buttonText = "Aktifkan Notifikasi (Wajib)";
          break;
        case "resubscribe":
          title = "Aktifkan Notifikasi";
          description = "Kami mendeteksi notifikasi Anda nonaktif. Klik di bawah untuk mengaktifkannya kembali.";
          buttonText = "Aktifkan Notifikasi (Wajib)";
          break;
      }
      this.innerHTML = "\n      <div class=\"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4\">\n        <div class=\"bg-white rounded-lg shadow-xl max-w-md w-full p-6 transform transition-all\">\n          <div class=\"flex items-center mb-4\">\n            <div class=\"bg-blue-100 rounded-full p-3 mr-4\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-8 w-8 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\n              </svg>\n            </div>\n            <h3 class=\"text-xl font-bold text-gray-900\">".concat(title, "</h3>\n          </div>\n          \n          <div class=\"mb-6\">\n            <p class=\"text-gray-700 mb-4 leading-relaxed\">\n              ").concat(description, "\n            </p>\n            \n            ").concat(showRetryInfo ? "\n              <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4\">\n                <p class=\"text-sm font-medium text-yellow-800 mb-2\">\n                  Cara mengaktifkan notifikasi yang diblokir:\n                </p>\n                <ol class=\"text-sm text-yellow-700 space-y-1 list-decimal list-inside\">\n                  <li>Klik ikon gembok/info di address bar browser</li>\n                  <li>Pilih \"Izinkan\" atau \"Allow\" untuk notifikasi</li>\n                  <li>Klik tombol di bawah untuk mencoba lagi</li>\n                </ol>\n              </div>\n            " : "\n              <div class=\"bg-blue-50 rounded-lg p-4 mb-4\">\n                <p class=\"text-sm font-medium text-blue-800 mb-2\">\n                  Anda akan mendapat notifikasi untuk:\n                </p>\n                <ul class=\"text-sm text-blue-700 space-y-1\">\n                  <li class=\"flex items-center\">\n                    <svg class=\"w-4 h-4 mr-2 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"></path>\n                    </svg>\n                    Status transaksi pembelian dan penjualan\n                  </li>\n                  <li class=\"flex items-center\">\n                    <svg class=\"w-4 h-4 mr-2 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"></path>\n                    </svg>\n                    Pengingat jatuh tempo sewa\n                  </li>\n                  <li class=\"flex items-center\">\n                    <svg class=\"w-4 h-4 mr-2 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"></path>\n                    </svg>\n                    Pesan baru dari pengguna lain\n                  </li>\n                </ul>\n              </div>\n            ", "\n            \n            <div class=\"bg-red-50 border border-red-200 rounded-lg p-3 mb-4\">\n              <p class=\"text-sm text-red-700 font-medium\">\n                \u26A0\uFE0F Wajib: Anda tidak dapat menggunakan aplikasi tanpa mengaktifkan notifikasi.\n              </p>\n            </div>\n          </div>\n          \n          <div class=\"flex flex-col gap-3\">\n            <button id=\"notification-allow-btn\" class=\"w-full px-4 py-3 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors\">\n              ").concat(buttonText, "\n            </button>\n          </div>\n          \n          <div id=\"error-message\" class=\"hidden mt-3 p-3 bg-red-50 border border-red-200 rounded-lg\">\n            <p class=\"text-red-600 text-sm\"></p>\n          </div>\n        </div>\n      </div>\n    ");

      // Add event listeners
      this.querySelector("#notification-allow-btn").addEventListener("click", function () {
        _this3.initializeNotifications();
      });

      // Prevent closing by clicking outside (since it's mandatory)
      this.querySelector(".fixed").addEventListener("click", function (e) {
        if (e.target === e.currentTarget) {
          _this3.showImportanceMessage();
        }
      });
    }
  }, {
    key: "showImportanceMessage",
    value: function showImportanceMessage() {
      var popup = this.querySelector(".bg-white");
      if (popup) {
        popup.classList.add("animate-bounce");

        // Show additional warning
        var existingWarning = this.querySelector("#mandatory-warning");
        if (!existingWarning) {
          var warningDiv = document.createElement("div");
          warningDiv.id = "mandatory-warning";
          warningDiv.className = "mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg";
          warningDiv.innerHTML = "\n          <p class=\"text-yellow-800 text-sm font-medium\">\n            \uD83D\uDEA8 Notifikasi wajib diaktifkan untuk melanjutkan menggunakan aplikasi!\n          </p>\n        ";
          var buttonContainer = this.querySelector(".flex.flex-col.gap-3");
          buttonContainer.parentNode.insertBefore(warningDiv, buttonContainer);
        }
        setTimeout(function () {
          popup.classList.remove("animate-bounce");
        }, 1000);
      }
    }
  }, {
    key: "hidePopup",
    value: function hidePopup() {
      this.isShown = false;
      this.currentReason = null;
      this.innerHTML = "";
    }
  }, {
    key: "showError",
    value: function showError(message) {
      var errorDiv = this.querySelector("#error-message");
      if (!errorDiv) {
        console.error("Error message element not found. Popup may not be rendered.");
        return;
      }
      var errorText = errorDiv.querySelector("p");
      if (errorDiv && errorText) {
        errorText.textContent = message;
        errorDiv.classList.remove("hidden");
      }
    }
  }, {
    key: "initializeNotifications",
    value: function () {
      var _initializeNotifications = notification_permission_popup_asyncToGenerator(/*#__PURE__*/notification_permission_popup_regeneratorRuntime().mark(function _callee2() {
        var allowBtn, helper, success, serverStatus, _allowBtn;
        return notification_permission_popup_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.prev = 0;
              console.log("Initializing push notifications...");
              allowBtn = this.querySelector("#notification-allow-btn");
              if (allowBtn) {
                allowBtn.innerHTML = "\n          <svg class=\"animate-spin -ml-1 mr-3 h-4 w-4 text-white inline\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          Mengaktifkan...\n        ";
                allowBtn.disabled = true;
              }
              helper = new push_notification_helper();
              _context2.next = 7;
              return helper.initializePushNotifications();
            case 7:
              success = _context2.sent;
              if (!success) {
                _context2.next = 23;
                break;
              }
              console.log("Push notifications initialized successfully");

              // Verify subscription was created on server
              _context2.next = 12;
              return helper.checkServerSubscription();
            case 12:
              serverStatus = _context2.sent;
              if (!(serverStatus.hasSubscription && serverStatus.isActive)) {
                _context2.next = 20;
                break;
              }
              this.hidePopup();
              this.showSuccessMessage();

              // Mark as completed so popup won't show again until token expires
              localStorage.setItem("notification_permission_completed", "true");

              // Dispatch event to notify app that notifications are ready
              window.dispatchEvent(new CustomEvent("notificationsActivated"));
              _context2.next = 21;
              break;
            case 20:
              throw new Error("Subscription not found on server after initialization");
            case 21:
              _context2.next = 26;
              break;
            case 23:
              console.error("Failed to initialize push notifications");
              this.showError("Gagal mengaktifkan notifikasi. Silakan coba lagi atau periksa pengaturan browser Anda.");
              if (allowBtn) {
                allowBtn.innerHTML = "Coba Lagi (Wajib)";
                allowBtn.disabled = false;
              }
            case 26:
              _context2.next = 34;
              break;
            case 28:
              _context2.prev = 28;
              _context2.t0 = _context2["catch"](0);
              console.error("Error initializing notifications:", _context2.t0);
              this.showError("Terjadi kesalahan saat mengaktifkan notifikasi. Silakan coba lagi.");
              _allowBtn = this.querySelector("#notification-allow-btn");
              if (_allowBtn) {
                _allowBtn.innerHTML = "Coba Lagi (Wajib)";
                _allowBtn.disabled = false;
              }
            case 34:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[0, 28]]);
      }));
      function initializeNotifications() {
        return _initializeNotifications.apply(this, arguments);
      }
      return initializeNotifications;
    }()
  }, {
    key: "showSuccessMessage",
    value: function showSuccessMessage() {
      var successDiv = document.createElement("div");
      successDiv.className = "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-[10000] transform transition-all duration-300";
      successDiv.innerHTML = "\n      <div class=\"flex items-center\">\n        <svg class=\"w-5 h-5 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n          <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"></path>\n        </svg>\n        Notifikasi berhasil diaktifkan! Selamat menggunakan Pinjemin.\n      </div>\n    ";
      document.body.appendChild(successDiv);
      setTimeout(function () {
        successDiv.style.transform = "translateX(100%)";
        setTimeout(function () {
          if (document.body.contains(successDiv)) {
            document.body.removeChild(successDiv);
          }
        }, 300);
      }, 4000);
    }
  }]);
}(/*#__PURE__*/notification_permission_popup_wrapNativeSuper(HTMLElement));
customElements.define("notification-permission-popup", NotificationPermissionPopup);
/* harmony default export */ const notification_permission_popup = ((/* unused pure expression or super */ null && (NotificationPermissionPopup)));
;// ./user/src/script/components/notification-badge.js
function notification_badge_typeof(o) { "@babel/helpers - typeof"; return notification_badge_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, notification_badge_typeof(o); }
function notification_badge_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ notification_badge_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == notification_badge_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(notification_badge_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function notification_badge_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function notification_badge_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { notification_badge_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { notification_badge_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function notification_badge_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function notification_badge_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, notification_badge_toPropertyKey(o.key), o); } }
function notification_badge_createClass(e, r, t) { return r && notification_badge_defineProperties(e.prototype, r), t && notification_badge_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function notification_badge_toPropertyKey(t) { var i = notification_badge_toPrimitive(t, "string"); return "symbol" == notification_badge_typeof(i) ? i : i + ""; }
function notification_badge_toPrimitive(t, r) { if ("object" != notification_badge_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != notification_badge_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function notification_badge_callSuper(t, o, e) { return o = notification_badge_getPrototypeOf(o), notification_badge_possibleConstructorReturn(t, notification_badge_isNativeReflectConstruct() ? Reflect.construct(o, e || [], notification_badge_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function notification_badge_possibleConstructorReturn(t, e) { if (e && ("object" == notification_badge_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return notification_badge_assertThisInitialized(t); }
function notification_badge_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function notification_badge_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && notification_badge_setPrototypeOf(t, e); }
function notification_badge_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return notification_badge_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !notification_badge_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return notification_badge_construct(t, arguments, notification_badge_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), notification_badge_setPrototypeOf(Wrapper, t); }, notification_badge_wrapNativeSuper(t); }
function notification_badge_construct(t, e, r) { if (notification_badge_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && notification_badge_setPrototypeOf(p, r.prototype), p; }
function notification_badge_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (notification_badge_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function notification_badge_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function notification_badge_setPrototypeOf(t, e) { return notification_badge_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, notification_badge_setPrototypeOf(t, e); }
function notification_badge_getPrototypeOf(t) { return notification_badge_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, notification_badge_getPrototypeOf(t); }

var NotificationBadge = /*#__PURE__*/function (_HTMLElement) {
  function NotificationBadge() {
    var _this;
    notification_badge_classCallCheck(this, NotificationBadge);
    _this = notification_badge_callSuper(this, NotificationBadge);
    _this.count = 0;
    _this.interval = null;
    _this.isDropdownOpen = false;
    return _this;
  }
  notification_badge_inherits(NotificationBadge, _HTMLElement);
  return notification_badge_createClass(NotificationBadge, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      var _this2 = this;
      this.render();

      // Only fetch count if user is authenticated
      var token = localStorage.getItem("token");
      if (token) {
        this.fetchUnreadCount();

        // Update unread count every minute
        this.interval = setInterval(function () {
          var currentToken = localStorage.getItem("token");
          if (currentToken) {
            _this2.fetchUnreadCount();
          }
        }, 60000);
      }

      // Listen for notification events
      window.addEventListener("notification-received", this.handleNotificationReceived.bind(this));
      window.addEventListener("notification-read", this.handleNotificationRead.bind(this));
      window.addEventListener("userLoggedIn", this.handleUserLoggedIn.bind(this));
      window.addEventListener("userLoggedOut", this.handleUserLoggedOut.bind(this));

      // Setup click handler
      this.addEventListener("click", this.handleClick.bind(this));

      // Close dropdown when clicking outside
      document.addEventListener("click", this.handleOutsideClick.bind(this));
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      if (this.interval) {
        clearInterval(this.interval);
      }
      window.removeEventListener("notification-received", this.handleNotificationReceived);
      window.removeEventListener("notification-read", this.handleNotificationRead);
      window.removeEventListener("userLoggedIn", this.handleUserLoggedIn);
      window.removeEventListener("userLoggedOut", this.handleUserLoggedOut);
      document.removeEventListener("click", this.handleOutsideClick);
    }
  }, {
    key: "handleUserLoggedIn",
    value: function handleUserLoggedIn() {
      var _this3 = this;
      // Reset count and fetch new data for the logged in user
      this.count = 0;
      this.updateBadge();

      // Fetch unread count after a short delay to ensure user is fully logged in
      setTimeout(function () {
        _this3.fetchUnreadCount();

        // Start interval for periodic updates
        if (_this3.interval) {
          clearInterval(_this3.interval);
        }
        _this3.interval = setInterval(function () {
          var token = localStorage.getItem("token");
          if (token) {
            _this3.fetchUnreadCount();
          }
        }, 60000);
      }, 1000);
    }
  }, {
    key: "handleUserLoggedOut",
    value: function handleUserLoggedOut() {
      // Clear count and stop interval
      this.count = 0;
      this.updateBadge();
      this.closeDropdown();
      if (this.interval) {
        clearInterval(this.interval);
        this.interval = null;
      }
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      event.preventDefault();
      event.stopPropagation();
      var bellButton = event.target.closest(".notification-bell-button");
      if (bellButton) {
        this.toggleDropdown();
      }
    }
  }, {
    key: "handleOutsideClick",
    value: function handleOutsideClick(event) {
      if (!this.contains(event.target)) {
        this.closeDropdown();
      }
    }
  }, {
    key: "toggleDropdown",
    value: function toggleDropdown() {
      this.isDropdownOpen = !this.isDropdownOpen;
      this.renderDropdown();
    }
  }, {
    key: "closeDropdown",
    value: function closeDropdown() {
      this.isDropdownOpen = false;
      this.renderDropdown();
    }
  }, {
    key: "renderDropdown",
    value: function renderDropdown() {
      var existingDropdown = document.querySelector("#notification-dropdown");
      if (existingDropdown) {
        existingDropdown.remove();
      }
      if (this.isDropdownOpen) {
        var dropdown = document.createElement("div");
        dropdown.id = "notification-dropdown";
        dropdown.className = "absolute top-full right-0 mt-2 z-50";
        dropdown.innerHTML = "<notification-list></notification-list>";
        this.appendChild(dropdown);
      }
    }
  }, {
    key: "fetchUnreadCount",
    value: function () {
      var _fetchUnreadCount = notification_badge_asyncToGenerator(/*#__PURE__*/notification_badge_regeneratorRuntime().mark(function _callee() {
        var response;
        return notification_badge_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.prev = 0;
              _context.next = 3;
              return getUnreadNotificationCount();
            case 3:
              response = _context.sent;
              if (response && response.status === "success" && response.data) {
                this.updateCount(response.data.unread_count || 0);
              }
              _context.next = 11;
              break;
            case 7:
              _context.prev = 7;
              _context.t0 = _context["catch"](0);
              console.error("Error fetching unread notification count:", _context.t0);
              // If there's an auth error, reset count
              if (_context.t0.message.includes("Authentication failed")) {
                this.count = 0;
                this.updateBadge();
              }
            case 11:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[0, 7]]);
      }));
      function fetchUnreadCount() {
        return _fetchUnreadCount.apply(this, arguments);
      }
      return fetchUnreadCount;
    }()
  }, {
    key: "updateCount",
    value: function updateCount(count) {
      this.count = count;
      this.updateBadge();
    }
  }, {
    key: "handleNotificationReceived",
    value: function handleNotificationReceived() {
      this.updateCount(this.count + 1);
    }
  }, {
    key: "handleNotificationRead",
    value: function handleNotificationRead(event) {
      var _ref = event.detail || {},
        all = _ref.all;
      if (all) {
        this.updateCount(0);
      } else {
        this.updateCount(Math.max(0, this.count - 1));
      }
    }
  }, {
    key: "updateBadge",
    value: function updateBadge() {
      var badge = this.querySelector(".notification-badge");
      if (badge) {
        if (this.count > 0) {
          badge.textContent = this.count > 99 ? "99+" : this.count;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      this.innerHTML = "\n      <div class=\"relative\">\n        <button class=\"notification-bell-button relative inline-flex items-center p-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\n          </svg>\n          <span class=\"notification-badge absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform bg-red-600 rounded-full min-w-[1.25rem] h-5 hidden\">\n            0\n          </span>\n        </button>\n      </div>\n    ";
      this.updateBadge();
    }
  }]);
}(/*#__PURE__*/notification_badge_wrapNativeSuper(HTMLElement));
customElements.define("notification-badge", NotificationBadge);
/* harmony default export */ const notification_badge = ((/* unused pure expression or super */ null && (NotificationBadge)));
;// ./user/src/script/components/notifications-page.js
function notifications_page_typeof(o) { "@babel/helpers - typeof"; return notifications_page_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, notifications_page_typeof(o); }
function notifications_page_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function notifications_page_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, notifications_page_toPropertyKey(o.key), o); } }
function notifications_page_createClass(e, r, t) { return r && notifications_page_defineProperties(e.prototype, r), t && notifications_page_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function notifications_page_toPropertyKey(t) { var i = notifications_page_toPrimitive(t, "string"); return "symbol" == notifications_page_typeof(i) ? i : i + ""; }
function notifications_page_toPrimitive(t, r) { if ("object" != notifications_page_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != notifications_page_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function notifications_page_callSuper(t, o, e) { return o = notifications_page_getPrototypeOf(o), notifications_page_possibleConstructorReturn(t, notifications_page_isNativeReflectConstruct() ? Reflect.construct(o, e || [], notifications_page_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function notifications_page_possibleConstructorReturn(t, e) { if (e && ("object" == notifications_page_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return notifications_page_assertThisInitialized(t); }
function notifications_page_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function notifications_page_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && notifications_page_setPrototypeOf(t, e); }
function notifications_page_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return notifications_page_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !notifications_page_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return notifications_page_construct(t, arguments, notifications_page_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), notifications_page_setPrototypeOf(Wrapper, t); }, notifications_page_wrapNativeSuper(t); }
function notifications_page_construct(t, e, r) { if (notifications_page_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && notifications_page_setPrototypeOf(p, r.prototype), p; }
function notifications_page_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (notifications_page_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function notifications_page_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function notifications_page_setPrototypeOf(t, e) { return notifications_page_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, notifications_page_setPrototypeOf(t, e); }
function notifications_page_getPrototypeOf(t) { return notifications_page_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, notifications_page_getPrototypeOf(t); }
var NotificationsPage = /*#__PURE__*/function (_HTMLElement) {
  function NotificationsPage() {
    notifications_page_classCallCheck(this, NotificationsPage);
    return notifications_page_callSuper(this, NotificationsPage, arguments);
  }
  notifications_page_inherits(NotificationsPage, _HTMLElement);
  return notifications_page_createClass(NotificationsPage, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
    }
  }, {
    key: "render",
    value: function render() {
      this.innerHTML = "\n        <div class=\"container mx-auto px-4 py-8 max-w-4xl\">\n          <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">Notifikasi</h1>\n            <p class=\"text-gray-600\">Kelola semua notifikasi Anda di sini</p>\n          </div>\n  \n          <div class=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n            <notification-list></notification-list>\n          </div>\n        </div>\n      ";
    }
  }]);
}(/*#__PURE__*/notifications_page_wrapNativeSuper(HTMLElement));
customElements.define("notifications-page", NotificationsPage);
/* harmony default export */ const notifications_page = ((/* unused pure expression or super */ null && (NotificationsPage)));
;// ./user/src/script/components/notification-list.js
function notification_list_typeof(o) { "@babel/helpers - typeof"; return notification_list_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, notification_list_typeof(o); }
function notification_list_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ notification_list_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == notification_list_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(notification_list_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function notification_list_toConsumableArray(r) { return notification_list_arrayWithoutHoles(r) || notification_list_iterableToArray(r) || notification_list_unsupportedIterableToArray(r) || notification_list_nonIterableSpread(); }
function notification_list_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function notification_list_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return notification_list_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? notification_list_arrayLikeToArray(r, a) : void 0; } }
function notification_list_iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function notification_list_arrayWithoutHoles(r) { if (Array.isArray(r)) return notification_list_arrayLikeToArray(r); }
function notification_list_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function notification_list_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function notification_list_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { notification_list_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { notification_list_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function notification_list_classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function notification_list_defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, notification_list_toPropertyKey(o.key), o); } }
function notification_list_createClass(e, r, t) { return r && notification_list_defineProperties(e.prototype, r), t && notification_list_defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function notification_list_toPropertyKey(t) { var i = notification_list_toPrimitive(t, "string"); return "symbol" == notification_list_typeof(i) ? i : i + ""; }
function notification_list_toPrimitive(t, r) { if ("object" != notification_list_typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != notification_list_typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function notification_list_callSuper(t, o, e) { return o = notification_list_getPrototypeOf(o), notification_list_possibleConstructorReturn(t, notification_list_isNativeReflectConstruct() ? Reflect.construct(o, e || [], notification_list_getPrototypeOf(t).constructor) : o.apply(t, e)); }
function notification_list_possibleConstructorReturn(t, e) { if (e && ("object" == notification_list_typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return notification_list_assertThisInitialized(t); }
function notification_list_assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function notification_list_inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && notification_list_setPrototypeOf(t, e); }
function notification_list_wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return notification_list_wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !notification_list_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return notification_list_construct(t, arguments, notification_list_getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), notification_list_setPrototypeOf(Wrapper, t); }, notification_list_wrapNativeSuper(t); }
function notification_list_construct(t, e, r) { if (notification_list_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && notification_list_setPrototypeOf(p, r.prototype), p; }
function notification_list_isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (notification_list_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function notification_list_isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function notification_list_setPrototypeOf(t, e) { return notification_list_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, notification_list_setPrototypeOf(t, e); }
function notification_list_getPrototypeOf(t) { return notification_list_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, notification_list_getPrototypeOf(t); }

var NotificationList = /*#__PURE__*/function (_HTMLElement) {
  function NotificationList() {
    var _this;
    notification_list_classCallCheck(this, NotificationList);
    _this = notification_list_callSuper(this, NotificationList);
    _this.notifications = [];
    _this.isLoading = false;
    _this.page = 1;
    _this.hasMore = true;
    return _this;
  }
  notification_list_inherits(NotificationList, _HTMLElement);
  return notification_list_createClass(NotificationList, [{
    key: "connectedCallback",
    value: function connectedCallback() {
      this.render();
      this.loadNotifications();
      this.setupEventListeners();
    }
  }, {
    key: "disconnectedCallback",
    value: function disconnectedCallback() {
      // Clean up event listeners
      window.removeEventListener("notification-received", this.handleNewNotification);
    }
  }, {
    key: "setupEventListeners",
    value: function setupEventListeners() {
      // Listen for new notifications
      window.addEventListener("notification-received", this.handleNewNotification.bind(this));

      // Setup click handlers
      this.addEventListener("click", this.handleClick.bind(this));
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      var notificationItem = event.target.closest(".notification-item");
      if (notificationItem) {
        var notificationId = notificationItem.dataset.notificationId;
        var notificationType = notificationItem.dataset.notificationType;
        var targetUrl = notificationItem.dataset.targetUrl;
        this.markAsRead(notificationId);
        if (targetUrl) {
          window.location.hash = targetUrl;
        }
      }

      // Mark all as read button
      if (event.target.closest("#mark-all-read-btn")) {
        this.markAllAsRead();
      }

      // Load more button
      if (event.target.closest("#load-more-btn")) {
        this.loadNotifications();
      }
    }
  }, {
    key: "loadNotifications",
    value: function () {
      var _loadNotifications = notification_list_asyncToGenerator(/*#__PURE__*/notification_list_regeneratorRuntime().mark(function _callee() {
        var response, newNotifications;
        return notification_list_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (!(this.isLoading || !this.hasMore)) {
                _context.next = 2;
                break;
              }
              return _context.abrupt("return");
            case 2:
              this.isLoading = true;
              this.updateLoadingState();
              _context.prev = 4;
              _context.next = 7;
              return apiGet("/notifications?page=".concat(this.page, "&limit=10"));
            case 7:
              response = _context.sent;
              if (response && response.status === "success" && response.data) {
                newNotifications = response.data.notifications || [];
                if (this.page === 1) {
                  this.notifications = newNotifications;
                } else {
                  this.notifications = [].concat(notification_list_toConsumableArray(this.notifications), notification_list_toConsumableArray(newNotifications));
                }
                this.hasMore = newNotifications.length === 10;
                this.page++;
                this.renderNotifications();
              }
              _context.next = 15;
              break;
            case 11:
              _context.prev = 11;
              _context.t0 = _context["catch"](4);
              console.error("Error loading notifications:", _context.t0);
              this.showError("Gagal memuat notifikasi");
            case 15:
              _context.prev = 15;
              this.isLoading = false;
              this.updateLoadingState();
              return _context.finish(15);
            case 19:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[4, 11, 15, 19]]);
      }));
      function loadNotifications() {
        return _loadNotifications.apply(this, arguments);
      }
      return loadNotifications;
    }()
  }, {
    key: "markAsRead",
    value: function () {
      var _markAsRead = notification_list_asyncToGenerator(/*#__PURE__*/notification_list_regeneratorRuntime().mark(function _callee2(notificationId) {
        var notification;
        return notification_list_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.prev = 0;
              _context2.next = 3;
              return apiPatch("/notifications/".concat(notificationId, "/read"));
            case 3:
              // Update local state
              notification = this.notifications.find(function (n) {
                return n.id === Number.parseInt(notificationId);
              });
              if (notification) {
                notification.is_read = true;
              }
              this.renderNotifications();

              // Dispatch event to update badge
              window.dispatchEvent(new CustomEvent("notification-read", {
                detail: {
                  notificationId: notificationId
                }
              }));
              _context2.next = 12;
              break;
            case 9:
              _context2.prev = 9;
              _context2.t0 = _context2["catch"](0);
              console.error("Error marking notification as read:", _context2.t0);
            case 12:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[0, 9]]);
      }));
      function markAsRead(_x) {
        return _markAsRead.apply(this, arguments);
      }
      return markAsRead;
    }()
  }, {
    key: "markAllAsRead",
    value: function () {
      var _markAllAsRead = notification_list_asyncToGenerator(/*#__PURE__*/notification_list_regeneratorRuntime().mark(function _callee3() {
        return notification_list_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.prev = 0;
              _context3.next = 3;
              return apiPatch("/notifications/read-all");
            case 3:
              // Update local state
              this.notifications.forEach(function (notification) {
                notification.is_read = true;
              });
              this.renderNotifications();

              // Dispatch event to update badge
              window.dispatchEvent(new CustomEvent("notification-read", {
                detail: {
                  all: true
                }
              }));
              _context3.next = 11;
              break;
            case 8:
              _context3.prev = 8;
              _context3.t0 = _context3["catch"](0);
              console.error("Error marking all notifications as read:", _context3.t0);
            case 11:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this, [[0, 8]]);
      }));
      function markAllAsRead() {
        return _markAllAsRead.apply(this, arguments);
      }
      return markAllAsRead;
    }()
  }, {
    key: "handleNewNotification",
    value: function handleNewNotification(event) {
      var newNotification = event.detail;
      this.notifications.unshift(newNotification);
      this.renderNotifications();
    }

    // ✅ Perbaikan di method getNotificationIcon dan getTargetUrl
  }, {
    key: "getNotificationIcon",
    value: function getNotificationIcon(type) {
      // ✅ Tambahkan fallback untuk type yang undefined
      var notificationType = type || 'general';
      switch (notificationType) {
        case "transaction":
          return "\n        <svg class=\"w-5 h-5 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\"></path>\n        </svg>\n      ";
        case "message":
          return "\n        <svg class=\"w-5 h-5 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.959 8.959 0 01-4.906-1.524A11.956 11.956 0 012.944 18.5c-.666-.806-.944-1.743-.944-2.75 0-1.257.5-2.5 1.5-3.5L4 12c0-4.418 3.582-8 8-8s8 3.582 8 8z\"></path>\n        </svg>\n      ";
        case "rent_reminder":
          return "\n        <svg class=\"w-5 h-5 text-orange-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n        </svg>\n      ";
        default:
          return "\n        <svg class=\"w-5 h-5 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"></path>\n        </svg>\n      ";
      }
    }
  }, {
    key: "getTargetUrl",
    value: function getTargetUrl(notification) {
      var _notification$data, _notification$data2;
      // ✅ Perbaiki akses ke data notifikasi
      var notificationType = notification.type || 'general';
      switch (notificationType) {
        case "transaction":
          // ✅ Cek multiple possible data structures
          return "#/transactions/".concat(notification.transaction_id || ((_notification$data = notification.data) === null || _notification$data === void 0 ? void 0 : _notification$data.transactionId) || "");
        case "message":
          return "#/messages/".concat(notification.related_user_id || ((_notification$data2 = notification.data) === null || _notification$data2 === void 0 ? void 0 : _notification$data2.senderId) || "");
        case "rent_reminder":
          return "#/my-rentals";
        default:
          return "#/notifications";
      }
    }
  }, {
    key: "formatTimeAgo",
    value: function formatTimeAgo(dateString) {
      var date = new Date(dateString);
      var now = new Date();
      var diffInSeconds = Math.floor((now - date) / 1000);
      if (diffInSeconds < 60) {
        return "Baru saja";
      } else if (diffInSeconds < 3600) {
        var minutes = Math.floor(diffInSeconds / 60);
        return "".concat(minutes, " menit yang lalu");
      } else if (diffInSeconds < 86400) {
        var hours = Math.floor(diffInSeconds / 3600);
        return "".concat(hours, " jam yang lalu");
      } else {
        var days = Math.floor(diffInSeconds / 86400);
        return "".concat(days, " hari yang lalu");
      }
    }

    // ✅ Perbaikan di renderNotifications untuk debugging
  }, {
    key: "renderNotifications",
    value: function renderNotifications() {
      var _this2 = this;
      var container = this.querySelector("#notifications-container");
      if (!container) return;
      if (this.notifications.length === 0) {
        container.innerHTML = "\n      <div class=\"text-center py-8\">\n        <svg class=\"w-16 h-16 text-gray-300 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"></path>\n        </svg>\n        <p class=\"text-gray-500\">Belum ada notifikasi</p>\n      </div>\n    ";
        return;
      }
      var notificationsHtml = this.notifications.map(function (notification) {
        // ✅ Debug logging untuk memeriksa struktur data
        console.log('Notification data:', notification);

        // ✅ Pastikan type tersedia
        var notificationType = notification.type || 'general';
        return "\n        <div class=\"notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors duration-200 ".concat(!notification.is_read ? "bg-blue-50" : "", "\"\n             data-notification-id=\"").concat(notification.id, "\"\n             data-notification-type=\"").concat(notificationType, "\"\n             data-target-url=\"").concat(_this2.getTargetUrl(notification), "\">\n          <div class=\"flex items-start space-x-3\">\n            <div class=\"flex-shrink-0 mt-1\">\n              ").concat(_this2.getNotificationIcon(notificationType), "\n            </div>\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"flex items-center justify-between\">\n                <p class=\"text-sm font-medium text-gray-900 truncate\">\n                  ").concat(notification.title || 'Notifikasi', "\n                </p>\n                ").concat(!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"></div>' : "", "\n              </div>\n              <p class=\"text-sm text-gray-600 mt-1 line-clamp-2\">\n                ").concat(notification.message, "\n              </p>\n              <!-- \u2705 Tambahkan badge untuk rent reminder -->\n              ").concat(notificationType === 'rent_reminder' ? '<span class="inline-block px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full mt-2">Pengingat Sewa</span>' : '', "\n              <p class=\"text-xs text-gray-400 mt-2\">\n                ").concat(_this2.formatTimeAgo(notification.created_at), "\n              </p>\n            </div>\n          </div>\n        </div>\n      ");
      }).join("");
      container.innerHTML = notificationsHtml;

      // Update load more button
      var loadMoreBtn = this.querySelector("#load-more-btn");
      if (loadMoreBtn) {
        if (this.hasMore) {
          loadMoreBtn.classList.remove("hidden");
        } else {
          loadMoreBtn.classList.add("hidden");
        }
      }
    }
  }, {
    key: "updateLoadingState",
    value: function updateLoadingState() {
      var loadMoreBtn = this.querySelector("#load-more-btn");
      if (loadMoreBtn) {
        if (this.isLoading) {
          loadMoreBtn.innerHTML = "\n          <svg class=\"animate-spin -ml-1 mr-3 h-4 w-4 text-gray-600 inline\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          Memuat...\n        ";
          loadMoreBtn.disabled = true;
        } else {
          loadMoreBtn.innerHTML = "Muat Lebih Banyak";
          loadMoreBtn.disabled = false;
        }
      }
    }
  }, {
    key: "showError",
    value: function showError(message) {
      var container = this.querySelector("#notifications-container");
      if (container) {
        container.innerHTML = "\n        <div class=\"text-center py-8\">\n          <svg class=\"w-16 h-16 text-red-300 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n          </svg>\n          <p class=\"text-red-500\">".concat(message, "</p>\n          <button class=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\" onclick=\"this.closest('notification-list').loadNotifications()\">\n            Coba Lagi\n          </button>\n        </div>\n      ");
      }
    }
  }, {
    key: "render",
    value: function render() {
      this.innerHTML = "\n      <div class=\"bg-white rounded-lg shadow-lg border border-gray-200 max-w-md w-full max-h-96 flex flex-col\">\n        <!-- Header -->\n        <div class=\"flex items-center justify-between p-4 border-b border-gray-200\">\n          <h3 class=\"text-lg font-semibold text-gray-900\">Notifikasi</h3>\n          <button id=\"mark-all-read-btn\" class=\"text-sm text-blue-600 hover:text-blue-800 font-medium\">\n            Tandai Semua Dibaca\n          </button>\n        </div>\n\n        <!-- Notifications Container -->\n        <div id=\"notifications-container\" class=\"flex-1 overflow-y-auto\">\n          <!-- Notifications will be rendered here -->\n        </div>\n\n        <!-- Load More Button -->\n        <div class=\"p-4 border-t border-gray-200\">\n          <button id=\"load-more-btn\" class=\"w-full px-4 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 hidden\">\n            Muat Lebih Banyak\n          </button>\n        </div>\n      </div>\n    ";
    }
  }]);
}(/*#__PURE__*/notification_list_wrapNativeSuper(HTMLElement));
customElements.define("notification-list", NotificationList);
/* harmony default export */ const notification_list = ((/* unused pure expression or super */ null && (NotificationList)));
// EXTERNAL MODULE: ./user/src/script/components/landing/landing-page.js
var landing_page = __webpack_require__(4);
;// ./user/src/script/components/index.js




















// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js
var injectStylesIntoStyleTag = __webpack_require__(72);
var injectStylesIntoStyleTag_default = /*#__PURE__*/__webpack_require__.n(injectStylesIntoStyleTag);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/styleDomAPI.js
var styleDomAPI = __webpack_require__(825);
var styleDomAPI_default = /*#__PURE__*/__webpack_require__.n(styleDomAPI);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/insertBySelector.js
var insertBySelector = __webpack_require__(659);
var insertBySelector_default = /*#__PURE__*/__webpack_require__.n(insertBySelector);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js
var setAttributesWithoutAttributes = __webpack_require__(56);
var setAttributesWithoutAttributes_default = /*#__PURE__*/__webpack_require__.n(setAttributesWithoutAttributes);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/insertStyleElement.js
var insertStyleElement = __webpack_require__(540);
var insertStyleElement_default = /*#__PURE__*/__webpack_require__.n(insertStyleElement);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/styleTagTransform.js
var styleTagTransform = __webpack_require__(113);
var styleTagTransform_default = /*#__PURE__*/__webpack_require__.n(styleTagTransform);
// EXTERNAL MODULE: ./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./user/src/styles/style.css
var style = __webpack_require__(424);
;// ./user/src/styles/style.css

      
      
      
      
      
      
      
      
      

var options = {};

options.styleTagTransform = (styleTagTransform_default());
options.setAttributes = (setAttributesWithoutAttributes_default());
options.insert = insertBySelector_default().bind(null, "head");
options.domAPI = (styleDomAPI_default());
options.insertStyleElement = (insertStyleElement_default());

var update = injectStylesIntoStyleTag_default()(style/* default */.A, options);




       /* harmony default export */ const styles_style = (style/* default */.A && style/* default */.A.locals ? style/* default */.A.locals : undefined);

;// ./user/src/script/routes/url-parser.js
function extractPathnameSegments(path) {
  var pathSegments = path.replace(/^\/|\/$/g, '').split('/');
  return {
    resource: pathSegments[0] || null,
    id: pathSegments[1] || null
  };
}
function constructRouteFromSegments(pathSegments) {
  var route = '';
  if (pathSegments.resource) {
    route = route.concat("/".concat(pathSegments.resource));
  }
  if (pathSegments.id) {
    route = route.concat('/:id');
  }
  return route || '/';
}
function getActivePathname() {
  return location.hash.slice(1) || '/';
}
function getActiveRoute() {
  var pathname = getActivePathname();
  var urlSegments = extractPathnameSegments(pathname);
  return constructRouteFromSegments(urlSegments);
}
var parseActivePathname = function parseActivePathname() {
  var pathname = getActivePathname();
  return extractPathnameSegments(pathname);
};
function getRoute(pathname) {
  var urlSegments = extractPathnameSegments(pathname);
  return constructRouteFromSegments(urlSegments);
}
function parsePathname(pathname) {
  return extractPathnameSegments(pathname);
}
;// ./user/src/script/routes/routes.js
function routes_typeof(o) { "@babel/helpers - typeof"; return routes_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, routes_typeof(o); }
function routes_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ routes_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == routes_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(routes_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function routes_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function routes_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { routes_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { routes_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }



// Function to manage app bar visibility
var manageAppBar = function manageAppBar() {
  var show = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
  var appBarContainer = document.getElementById("app-bar-container");
  if (show) {
    if (appBarContainer && !appBarContainer.querySelector("app-bar")) {
      appBarContainer.innerHTML = "<app-bar></app-bar>";
    }
  } else {
    if (appBarContainer) {
      appBarContainer.innerHTML = "";
    }
  }
};

// Function to manage footer visibility
var manageFooter = function manageFooter() {
  var show = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
  var footer = document.querySelector("footer");
  if (footer) {
    footer.style.display = show ? "block" : "none";
  }
};

// Check if user needs to enable notifications
var checkNotificationRequirement = /*#__PURE__*/function () {
  var _ref = routes_asyncToGenerator(/*#__PURE__*/routes_regeneratorRuntime().mark(function _callee() {
    var token, helper, notificationStatus;
    return routes_regeneratorRuntime().wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          token = localStorage.getItem("token"); // If not authenticated, no need to check notifications
          if (token) {
            _context.next = 3;
            break;
          }
          return _context.abrupt("return", {
            canProceed: true,
            needsSetup: false
          });
        case 3:
          _context.prev = 3;
          helper = new push_notification_helper();
          _context.next = 7;
          return helper.needsNotificationSetup();
        case 7:
          notificationStatus = _context.sent;
          console.log("Notification requirement check:", notificationStatus);
          return _context.abrupt("return", notificationStatus);
        case 12:
          _context.prev = 12;
          _context.t0 = _context["catch"](3);
          console.error("Error checking notification requirement:", _context.t0);
          // On error, allow access but log the issue
          return _context.abrupt("return", {
            canProceed: true,
            needsSetup: false,
            reason: "error"
          });
        case 16:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[3, 12]]);
  }));
  return function checkNotificationRequirement() {
    return _ref.apply(this, arguments);
  };
}();

// Show notification permission popup
var showNotificationPopup = function showNotificationPopup(reason) {
  var notificationPopup = document.querySelector("notification-permission-popup");
  if (notificationPopup) {
    notificationPopup.triggerPopup(reason);
  }
};

// Enhanced authentication check that also verifies notification requirement
var checkAuthenticatedWithNotification = /*#__PURE__*/function () {
  var _ref2 = routes_asyncToGenerator(/*#__PURE__*/routes_regeneratorRuntime().mark(function _callee2(mainContent, renderFn) {
    var _len,
      args,
      _key,
      notificationStatus,
      message,
      showPopup,
      _args2 = arguments;
    return routes_regeneratorRuntime().wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          for (_len = _args2.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
            args[_key - 2] = _args2[_key];
          }
          if (utils.isAuthenticated()) {
            _context2.next = 4;
            break;
          }
          window.location.hash = "#/login";
          return _context2.abrupt("return");
        case 4:
          // Show loading screen while checking notification status
          mainContent.innerHTML = "\n    <div class=\"flex items-center justify-center min-h-screen bg-gray-50\">\n      <div class=\"text-center\">\n        <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n        <h2 class=\"text-xl font-semibold text-gray-900 mb-2\">Memeriksa Status Aplikasi</h2>\n        <p class=\"text-gray-600\">Mohon tunggu sebentar...</p>\n      </div>\n    </div>\n  ";
          _context2.prev = 5;
          _context2.next = 8;
          return checkNotificationRequirement();
        case 8:
          notificationStatus = _context2.sent;
          if (notificationStatus.canProceed) {
            _context2.next = 28;
            break;
          }
          // Show appropriate message based on reason
          message = "Mohon aktifkan notifikasi untuk melanjutkan...";
          showPopup = true;
          _context2.t0 = notificationStatus.reason;
          _context2.next = _context2.t0 === "permission_denied" ? 15 : _context2.t0 === "missing_server_subscription" ? 18 : _context2.t0 === "permission_not_requested" ? 20 : _context2.t0 === "resubscribe" ? 22 : 24;
          break;
        case 15:
          message = "Notifikasi diblokir. Mohon aktifkan di pengaturan browser...";
          showPopup = false;
          return _context2.abrupt("break", 25);
        case 18:
          message = "Mohon daftarkan ulang notifikasi...";
          return _context2.abrupt("break", 25);
        case 20:
          message = "Mohon aktifkan notifikasi untuk melanjutkan...";
          return _context2.abrupt("break", 25);
        case 22:
          message = "Kami mendeteksi notifikasi Anda nonaktif. Klik di bawah untuk mengaktifkannya kembali.";
          return _context2.abrupt("break", 25);
        case 24:
          message = "Mohon aktifkan notifikasi untuk melanjutkan...";
        case 25:
          mainContent.innerHTML = "\n        <div class=\"flex items-center justify-center min-h-screen bg-gray-50\">\n          <div class=\"text-center max-w-md mx-auto p-6\">\n            <div class=\"bg-yellow-100 rounded-full p-4 mx-auto mb-4 w-16 h-16 flex items-center justify-center\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-8 w-8 text-yellow-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\n              </svg>\n            </div>\n            <h2 class=\"text-xl font-semibold text-gray-900 mb-2\">Notifikasi Diperlukan</h2>\n            <p class=\"text-gray-600 mb-4\">".concat(message, "</p>\n            ").concat(notificationStatus.reason === "permission_denied" ? "\n              <div class=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-4\">\n                <p class=\"text-sm text-red-700\">\n                  Untuk mengaktifkan notifikasi yang diblokir:\n                  <br>1. Klik ikon gembok di address bar\n                  <br>2. Pilih \"Izinkan\" untuk notifikasi\n                  <br>3. Refresh halaman ini\n                </p>\n              </div>\n              <button onclick=\"window.location.reload()\" class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">\n                Refresh Halaman\n              </button>\n            " : "", "\n          </div>\n        </div>\n      ");
          if (showPopup) {
            setTimeout(function () {
              showNotificationPopup(notificationStatus.reason);
            }, 500);
          }
          return _context2.abrupt("return");
        case 28:
          // If all checks pass, render the component
          renderFn.apply(void 0, [mainContent].concat(args));
          _context2.next = 36;
          break;
        case 31:
          _context2.prev = 31;
          _context2.t1 = _context2["catch"](5);
          console.error("Error in authentication check:", _context2.t1);
          // On error, show error message but allow access
          mainContent.innerHTML = "\n      <div class=\"flex items-center justify-center min-h-screen bg-gray-50\">\n        <div class=\"text-center max-w-md mx-auto p-6\">\n          <div class=\"bg-red-100 rounded-full p-4 mx-auto mb-4 w-16 h-16 flex items-center justify-center\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-8 w-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z\" />\n            </svg>\n          </div>\n          <h2 class=\"text-xl font-semibold text-gray-900 mb-2\">Terjadi Kesalahan</h2>\n          <p class=\"text-gray-600 mb-4\">Tidak dapat memeriksa status notifikasi. Melanjutkan ke aplikasi...</p>\n        </div>\n      </div>\n    ";
          setTimeout(function () {
            renderFn.apply(void 0, [mainContent].concat(args));
          }, 2000);
        case 36:
        case "end":
          return _context2.stop();
      }
    }, _callee2, null, [[5, 31]]);
  }));
  return function checkAuthenticatedWithNotification(_x, _x2) {
    return _ref2.apply(this, arguments);
  };
}();
var checkAuthenticated = function checkAuthenticated(mainContent, renderFn) {
  if (Utils.isAuthenticated()) {
    for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
      args[_key2 - 2] = arguments[_key2];
    }
    renderFn.apply(void 0, [mainContent].concat(args));
  } else {
    window.location.hash = "#/login";
  }
};
var checkUnauthenticated = function checkUnauthenticated(mainContent, renderFn) {
  if (!utils.isAuthenticated()) {
    for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {
      args[_key3 - 2] = arguments[_key3];
    }
    renderFn.apply(void 0, [mainContent].concat(args));
  } else {
    window.location.hash = "#/home"; // Changed from "#/" to "#/home"
  }
};
var routes = {
  // Main route - requires authentication AND notification setup
  "/": function _(mainContent) {
    manageAppBar(false); // Hide app bar for landing page
    manageFooter(false); // Hide default footer for landing page
    mainContent.innerHTML = "<landing-page></landing-page>";
  },
  "/home": function _home(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<all-product></all-product>";
    });
  },
  // Product detail - requires authentication AND notification setup
  "/items/:id": function _items_Id(mainContent, id) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc, itemId) {
      mc.innerHTML = "<detail-product item-id=\"".concat(itemId, "\"></detail-product>");
    }, id);
  },
  // Transaction detail - requires authentication AND notification setup
  "/transactions/:id": function _transactions_Id(mainContent, id) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc, transactionId) {
      mc.innerHTML = "<detail-transaction-page transaction-id=\"".concat(transactionId, "\"></detail-transaction-page>");
    }, id);
  },
  // Notifications page - requires authentication AND notification setup
  "/notifications": function _notifications(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<notifications-page></notifications-page>";
    });
  },
  // Auth routes - don't require notification setup, hide app bar and footer
  "/login": function _login(mainContent) {
    manageAppBar(false); // Hide app bar for login page
    manageFooter(false); // Hide footer for login page
    checkUnauthenticated(mainContent, function (mc) {
      mc.innerHTML = "<login-page></login-page>";
    });
  },
  "/register": function _register(mainContent) {
    manageAppBar(false); // Hide app bar for register page
    manageFooter(false); // Hide footer for register page
    checkUnauthenticated(mainContent, function (mc) {
      mc.innerHTML = "<register-page></register-page>";
    });
  },
  // Protected routes - require authentication AND notification setup
  "/cart": function _cart(mainContent) {
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<h1>Cart Page (Requires Login)</h1>";
    });
  },
  "/my-rentals": function _myRentals(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<my-transactions-page></my-transactions-page>";
    });
  },
  "/profile": function _profile(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<profile-page></profile-page>";
    });
  },
  "/my-items": function _myItems(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<my-items-page></my-items-page>";
    });
  },
  "/my-transactions": function _myTransactions(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<my-transactions-page></my-transactions-page>";
    });
  },
  "/my-sales": function _mySales(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    checkAuthenticatedWithNotification(mainContent, function (mc) {
      mc.innerHTML = "<my-seller-transactions-page></my-seller-transactions-page>";
    });
  },
  // Community page - public access (no authentication required)
  "/community": function _community(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    mainContent.innerHTML = "<community-page></community-page>";
  },
  // Community page - public access (no authentication required)
  "/hobby": function _hobby(mainContent) {
    manageAppBar(true);
    manageFooter(true);
    mainContent.innerHTML = "<hobby-page></hobby-page>";
  }
};
;// ./user/src/app.js
function app_typeof(o) { "@babel/helpers - typeof"; return app_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, app_typeof(o); }
function app_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ app_regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == app_typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(app_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function app_asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function app_asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { app_asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { app_asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }



// Import notification components dan helper






// Import routing logic


var mainContent = document.querySelector("main");
var searchBarElement = document.querySelector("search-bar");

// ✅ Global helper instance untuk mencegah multiple instances
var globalNotificationHelper = null;
var router = function router() {
  var activeRoute = getActiveRoute();
  var routeHandler = routes[activeRoute];
  var hideSearchBar = activeRoute === "/login" || activeRoute === "/register";
  if (searchBarElement) {
    if (hideSearchBar) {
      searchBarElement.classList.add("hidden");
    } else {
      searchBarElement.classList.remove("hidden");
    }
  }
  if (routeHandler) {
    var params = parseActivePathname();
    if (activeRoute === "/items/:id") {
      routeHandler(mainContent, params ? params.id : undefined);
    } else if (activeRoute === "/transactions/:id") {
      routeHandler(mainContent, params ? params.id : undefined);
    } else {
      routeHandler(mainContent);
    }
  } else {
    window.location.hash = "#/";
  }
};

// ✅ PERBAIKAN: Strict Notification System - WAJIB PUNYA SUBSCRIPTION
var initializeNotificationSystem = /*#__PURE__*/function () {
  var _ref = app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee() {
    var existingPopup, notificationPopup, token, setupStatus, popup, success, _popup, _popup2;
    return app_regeneratorRuntime().wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          // Add notification permission popup to the DOM
          existingPopup = document.querySelector("notification-permission-popup");
          if (!existingPopup) {
            notificationPopup = document.createElement("notification-permission-popup");
            document.body.appendChild(notificationPopup);
          }

          // ✅ Buat global helper instance
          if (!globalNotificationHelper) {
            globalNotificationHelper = new push_notification_helper();
          }
          token = localStorage.getItem("token");
          if (token) {
            _context.next = 6;
            break;
          }
          return _context.abrupt("return");
        case 6:
          _context.prev = 6;
          _context.next = 9;
          return globalNotificationHelper.needsNotificationSetup();
        case 9:
          setupStatus = _context.sent;
          if (!(!setupStatus.needsSetup && setupStatus.canProceed)) {
            _context.next = 13;
            break;
          }
          localStorage.setItem("notification_permission_completed", "true");
          return _context.abrupt("return");
        case 13:
          if (setupStatus.canProceed) {
            _context.next = 19;
            break;
          }
          console.warn("User cannot proceed without notifications:", setupStatus.reason);
          localStorage.removeItem("notification_permission_completed");

          // ✅ Show popup berdasarkan reason
          popup = document.querySelector("notification-permission-popup");
          if (popup && typeof popup.triggerPopup === "function") {
            if (setupStatus.reason === "permission_denied") {
              popup.triggerPopup("permission_denied");
            } else if (setupStatus.reason === "missing_server_subscription") {
              popup.triggerPopup("resubscribe");
            } else if (setupStatus.reason === "permission_not_requested") {
              popup.triggerPopup("initial");
            } else {
              popup.triggerPopup("error");
            }
          }
          return _context.abrupt("return");
        case 19:
          if (!(setupStatus.canProceed && Notification.permission === "granted")) {
            _context.next = 24;
            break;
          }
          _context.next = 22;
          return globalNotificationHelper.initializePushNotifications();
        case 22:
          success = _context.sent;
          if (success) {
            localStorage.setItem("notification_permission_completed", "true");
            window.dispatchEvent(new CustomEvent("notificationsActivated"));
          } else {
            console.warn("Auto-initialization failed, showing popup");
            localStorage.removeItem("notification_permission_completed");
            _popup = document.querySelector("notification-permission-popup");
            if (_popup && typeof _popup.triggerPopup === "function") {
              _popup.triggerPopup("resubscribe");
            }
          }
        case 24:
          _context.next = 32;
          break;
        case 26:
          _context.prev = 26;
          _context.t0 = _context["catch"](6);
          console.error("Error during notification system initialization:", _context.t0);
          localStorage.removeItem("notification_permission_completed");

          // ✅ Show error popup
          _popup2 = document.querySelector("notification-permission-popup");
          if (_popup2 && typeof _popup2.triggerPopup === "function") {
            _popup2.triggerPopup("error");
          }
        case 32:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[6, 26]]);
  }));
  return function initializeNotificationSystem() {
    return _ref.apply(this, arguments);
  };
}();

// ✅ PERBAIKAN: Strict recheck - WAJIB SHOW POPUP jika subscription hilang
var recheckNotificationSubscription = /*#__PURE__*/function () {
  var _ref2 = app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee2() {
    var token, setupStatus, popup, success, _popup3, _popup4;
    return app_regeneratorRuntime().wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          token = localStorage.getItem("token");
          if (token) {
            _context2.next = 3;
            break;
          }
          return _context2.abrupt("return");
        case 3:
          // ✅ Gunakan global helper instance
          if (!globalNotificationHelper) {
            globalNotificationHelper = new push_notification_helper();
          }
          _context2.prev = 4;
          _context2.next = 7;
          return globalNotificationHelper.needsNotificationSetup();
        case 7:
          setupStatus = _context2.sent;
          if (!(setupStatus.needsSetup && !setupStatus.canProceed)) {
            _context2.next = 14;
            break;
          }
          console.warn("Subscription missing and user cannot proceed:", setupStatus.reason);
          localStorage.removeItem("notification_permission_completed");
          popup = document.querySelector("notification-permission-popup");
          if (popup && typeof popup.triggerPopup === "function") {
            if (setupStatus.reason === "missing_server_subscription") {
              popup.triggerPopup("resubscribe");
            } else if (setupStatus.reason === "permission_denied") {
              popup.triggerPopup("permission_denied");
            } else {
              popup.triggerPopup("error");
            }
          }
          return _context2.abrupt("return");
        case 14:
          if (!(setupStatus.needsSetup && setupStatus.canProceed && Notification.permission === "granted")) {
            _context2.next = 19;
            break;
          }
          _context2.next = 17;
          return globalNotificationHelper.initializePushNotifications();
        case 17:
          success = _context2.sent;
          if (success) {
            localStorage.setItem("notification_permission_completed", "true");
            window.dispatchEvent(new CustomEvent("notificationsActivated"));
          } else {
            console.warn("Auto-reinitialization failed, showing popup");
            localStorage.removeItem("notification_permission_completed");
            _popup3 = document.querySelector("notification-permission-popup");
            if (_popup3 && typeof _popup3.triggerPopup === "function") {
              _popup3.triggerPopup("resubscribe");
            }
          }
        case 19:
          _context2.next = 27;
          break;
        case 21:
          _context2.prev = 21;
          _context2.t0 = _context2["catch"](4);
          console.error("Error during notification subscription recheck:", _context2.t0);
          localStorage.removeItem("notification_permission_completed");

          // ✅ Show error popup
          _popup4 = document.querySelector("notification-permission-popup");
          if (_popup4 && typeof _popup4.triggerPopup === "function") {
            _popup4.triggerPopup("error");
          }
        case 27:
        case "end":
          return _context2.stop();
      }
    }, _callee2, null, [[4, 21]]);
  }));
  return function recheckNotificationSubscription() {
    return _ref2.apply(this, arguments);
  };
}();

// Function to check if JWT token is valid/not expired
var checkTokenValidity = function checkTokenValidity() {
  var token = localStorage.getItem("token");
  if (!token) return false;
  try {
    // Decode JWT token to check expiration
    var payload = JSON.parse(atob(token.split(".")[1]));
    var currentTime = Math.floor(Date.now() / 1000);
    if (payload.exp && payload.exp < currentTime) {
      // ✅ Clean up notification data on token expiry
      localStorage.removeItem("notification_permission_completed");
      localStorage.removeItem("notification_initialized");

      // Dispatch token expired event
      window.dispatchEvent(new CustomEvent("tokenExpired"));
      return false;
    }
    return true;
  } catch (error) {
    console.error("Error checking token validity:", error);
    return false;
  }
};

// ✅ Service Worker Registration - biarkan helper yang handle
if ("serviceWorker" in navigator) {
  window.addEventListener("load", /*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee3() {
    var registration;
    return app_regeneratorRuntime().wrap(function _callee3$(_context3) {
      while (1) switch (_context3.prev = _context3.next) {
        case 0:
          _context3.prev = 0;
          _context3.next = 3;
          return navigator.serviceWorker.getRegistration();
        case 3:
          registration = _context3.sent;
          if (registration) {
            registration.addEventListener("updatefound", function () {
              var newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener("statechange", function () {
                  if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
                    console.log("New service worker available");
                  }
                });
              }
            });
          }
          _context3.next = 10;
          break;
        case 7:
          _context3.prev = 7;
          _context3.t0 = _context3["catch"](0);
          console.error("Error setting up service worker event listeners:", _context3.t0);
        case 10:
        case "end":
          return _context3.stop();
      }
    }, _callee3, null, [[0, 7]]);
  })));
}

// Listen for service worker messages
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.addEventListener("message", function (event) {
    var _event$data = event.data,
      type = _event$data.type,
      notificationData = _event$data.notificationData;
    switch (type) {
      case "NOTIFICATION_CLICKED":
        console.log("Notification clicked:", notificationData);
        break;
      case "NOTIFICATION_DISMISSED":
        console.log("Notification dismissed:", notificationData);
        break;
      case "NAVIGATE_TO":
        console.log("Navigate to:", event.data.url);
        window.location.hash = event.data.url;
        break;
      default:
        console.log("Unknown service worker message:", type);
    }
  });
}

// ✅ Handle user logout
window.addEventListener("userLoggedOut", function () {
  console.log("User logged out, cleaning up notifications...");
  localStorage.removeItem("notification_permission_completed");
  localStorage.removeItem("notification_initialized");
  globalNotificationHelper = null;
});

// ✅ Handle user login
window.addEventListener("userLoggedIn", /*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee5() {
  return app_regeneratorRuntime().wrap(function _callee5$(_context5) {
    while (1) switch (_context5.prev = _context5.next) {
      case 0:
        console.log("User logged in, initializing notifications...");
        setTimeout(/*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee4() {
          return app_regeneratorRuntime().wrap(function _callee4$(_context4) {
            while (1) switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return initializeNotificationSystem();
              case 2:
              case "end":
                return _context4.stop();
            }
          }, _callee4);
        })), 1000);
      case 2:
      case "end":
        return _context5.stop();
    }
  }, _callee5);
})));

// Check token validity periodically
setInterval(function () {
  checkTokenValidity();
}, 60000);

// ✅ PERBAIKAN: Strict DOM content loaded handler
document.addEventListener("DOMContentLoaded", /*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee7() {
  var isValidToken;
  return app_regeneratorRuntime().wrap(function _callee7$(_context7) {
    while (1) switch (_context7.prev = _context7.next) {
      case 0:
        console.log("DOM Content Loaded - Initializing app...");
        isValidToken = checkTokenValidity(); // ✅ STRICT: Initialize notification system dan BLOCK jika perlu
        if (!isValidToken) {
          _context7.next = 12;
          break;
        }
        _context7.prev = 3;
        _context7.next = 6;
        return initializeNotificationSystem();
      case 6:
        // ✅ Recheck subscription setelah initialization
        setTimeout(/*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee6() {
          return app_regeneratorRuntime().wrap(function _callee6$(_context6) {
            while (1) switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return recheckNotificationSubscription();
              case 2:
              case "end":
                return _context6.stop();
            }
          }, _callee6);
        })), 2000);
        _context7.next = 12;
        break;
      case 9:
        _context7.prev = 9;
        _context7.t0 = _context7["catch"](3);
        console.error("Error during notification initialization:", _context7.t0);
      case 12:
        if (!window.location.hash || window.location.hash === "#") {
          window.location.hash = "#/";
        } else {
          router();
        }
      case 13:
      case "end":
        return _context7.stop();
    }
  }, _callee7, null, [[3, 9]]);
})));

// Handle hash changes
window.addEventListener("hashchange", function () {
  checkTokenValidity();
  router();
});

// ✅ Export global helper
window.getNotificationHelper = function () {
  if (!globalNotificationHelper) {
    globalNotificationHelper = new push_notification_helper();
  }
  return globalNotificationHelper;
};

// ✅ Handle page visibility change untuk strict recheck
document.addEventListener("visibilitychange", /*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee9() {
  return app_regeneratorRuntime().wrap(function _callee9$(_context9) {
    while (1) switch (_context9.prev = _context9.next) {
      case 0:
        if (!document.hidden && localStorage.getItem("token")) {
          setTimeout(/*#__PURE__*/app_asyncToGenerator(/*#__PURE__*/app_regeneratorRuntime().mark(function _callee8() {
            return app_regeneratorRuntime().wrap(function _callee8$(_context8) {
              while (1) switch (_context8.prev = _context8.next) {
                case 0:
                  _context8.next = 2;
                  return recheckNotificationSubscription();
                case 2:
                case "end":
                  return _context8.stop();
              }
            }, _callee8);
          })), 1000);
        }
      case 1:
      case "end":
        return _context9.stop();
    }
  }, _callee9);
})));
})();

/******/ })()
;